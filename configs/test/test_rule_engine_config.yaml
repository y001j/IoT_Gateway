gateway:
  id: "gateway-rule-engine-test"
  http_port: 8080
  log_level: "debug"
  nats_url: "embedded"
  plugins_dir: "./plugins"

# 规则引擎配置
rule_engine:
  enabled: true
  rules_dir: "./data/rules"
  subject: "iot.data.>"
  rules:
    - id: "temp_10point_avg"
      name: "温度10点移动平均值"
      description: "计算每个温度传感器的10点移动平均值并发送回数据总线"
      enabled: true
      priority: 10
      conditions:
        type: "simple"
        field: "key"
        operator: "regex"
        value: ".*temperature$"
      actions:
        - type: "aggregate"
          config:
            window_type: "count"
            size: 10
            functions: ["avg"]
            group_by: ["key", "device_id"]
            output_key: "{{.Key}}_avg"
            forward: true

# 南向适配器配置
southbound:
  adapters:
    - name: "modbus-device1"
      type: "modbus"
      config:
        name: "modbus-device1"
        mode: "tcp"
        address: "127.0.0.1:502"
        timeout_ms: 3000
        interval_ms: 2000
        max_retries: 3
        retry_interval: 5000
        unit_id: 1
        registers:
          - key: "device1_temperature"
            address: 0
            quantity: 1
            type: "int16"
            function: 3
            scale: 0.1
            device_id: 1
            tags:
              description: "设备1温度传感器"
              unit: "°C"
              location: "车间A"
          - key: "device1_humidity"
            address: 1
            quantity: 1
            type: "int16"
            function: 3
            scale: 0.1
            device_id: 1
            tags:
              description: "设备1湿度传感器"
              unit: "%"
              location: "车间A"

    - name: "modbus-device2"
      type: "modbus"
      config:
        name: "modbus-device2"
        mode: "tcp"
        address: "127.0.0.1:502"
        timeout_ms: 3000
        interval_ms: 2000
        max_retries: 3
        retry_interval: 5000
        unit_id: 2
        registers:
          - key: "device2_temperature"
            address: 0
            quantity: 1
            type: "int16"
            function: 3
            scale: 0.1
            device_id: 2
            tags:
              description: "设备2温度传感器"
              unit: "°C"
              location: "车间B"

# 北向连接器配置
northbound:
  sinks:
    - name: "console"
      type: "console"
      config:
        name: "console"
        format: "json"
        enable_timestamp: true
        enable_colors: false

    - name: "websocket"
      type: "websocket"
      config:
        name: "websocket"
        host: "localhost"
        port: 8081
        path: "/ws"
        enable_cors: true
        allowed_origins: ["*"]
        ping_interval: 30
        write_timeout: 10
        read_timeout: 60 