# Windows æ‰¹å¤„ç†æ–‡ä»¶ä¸­æ–‡ç¼–ç ä¿®å¤æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•è§£å†³Windowsæ‰¹å¤„ç†æ–‡ä»¶ä¸­çš„ä¸­æ–‡å­—ç¬¦ä¹±ç é—®é¢˜ã€‚

## ğŸ¯ é—®é¢˜æè¿°

åœ¨Windowsç¯å¢ƒä¸‹è¿è¡ŒåŒ…å«ä¸­æ–‡å­—ç¬¦çš„æ‰¹å¤„ç†æ–‡ä»¶æ—¶ï¼Œå¯èƒ½å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š
- ä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºä¸ºä¹±ç  (å¦‚: ï¿½ï¿½ï¿½ï¿½ï¿½)
- ç•Œé¢å¸ƒå±€é”™ä¹±
- ç¨‹åºåŠŸèƒ½å¼‚å¸¸

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

æˆ‘ä»¬æä¾›äº†3ä¸ªä¸åŒç‰ˆæœ¬çš„æ‰¹å¤„ç†æ–‡ä»¶å’Œè‡ªåŠ¨ä¿®å¤å·¥å…·ï¼š

### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ä¿®å¤åçš„æ‰¹å¤„ç†æ–‡ä»¶ (æ¨è)

#### 1. è‹±æ–‡ç‰ˆæœ¬ (æ— ç¼–ç é—®é¢˜)
```batch
# è¿è¡Œè‹±æ–‡ç‰ˆæœ¬ï¼Œé¿å…ä¸­æ–‡ç¼–ç é—®é¢˜
test_filters_fixed.bat
```

#### 2. ä¸­æ–‡ç‰ˆæœ¬ (UTF-8ç¼–ç )
```batch
# è¿è¡Œä¸­æ–‡ç‰ˆæœ¬ï¼ŒåŒ…å«å®Œæ•´ä¸­æ–‡ç•Œé¢
test_filters_cn.bat
```

### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ç¼–ç ä¿®å¤å·¥å…·

#### 1. è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤
```powershell
# æ£€æµ‹æ‰€æœ‰æ‰¹å¤„ç†æ–‡ä»¶çš„ç¼–ç é—®é¢˜
.\scripts\fix_encoding.ps1

# è‡ªåŠ¨ä¿®å¤æ‰€æœ‰é—®é¢˜æ–‡ä»¶
.\scripts\fix_encoding.ps1 -FixAll

# åªæ£€æŸ¥ä¸ä¿®å¤
.\scripts\fix_encoding.ps1 -CheckOnly
```

#### 2. ä¿®å¤ç‰¹å®šæ–‡ä»¶
```powershell
# ä¿®å¤åŸå§‹çš„æ‰¹å¤„ç†æ–‡ä»¶
.\scripts\fix_encoding.ps1 -TargetFile "test_filters.bat"
```

### æ–¹æ¡ˆä¸‰ï¼šæ‰‹åŠ¨ä¿®å¤æ­¥éª¤

#### 1. è®¾ç½®æ§åˆ¶å°ç¼–ç 
```batch
# åœ¨æ‰¹å¤„ç†æ–‡ä»¶å¼€å¤´æ·»åŠ 
@echo off
chcp 65001 >nul 2>&1
```

#### 2. ä¿å­˜æ–‡ä»¶ä¸ºUTF-8ç¼–ç 
- ç”¨è®°äº‹æœ¬æˆ–å…¶ä»–ç¼–è¾‘å™¨æ‰“å¼€`.bat`æ–‡ä»¶
- å¦å­˜ä¸ºæ—¶é€‰æ‹©"UTF-8"ç¼–ç 
- ç¡®ä¿æ–‡ä»¶å¼€å¤´åŒ…å«`chcp 65001`å‘½ä»¤

## ğŸ“ æ–‡ä»¶è¯´æ˜

### æµ‹è¯•ç›¸å…³æ–‡ä»¶
```
IoT Gateway\
â”œâ”€â”€ test_filters.bat              # åŸå§‹æ–‡ä»¶ (å¯èƒ½æœ‰ç¼–ç é—®é¢˜)
â”œâ”€â”€ test_filters_fixed.bat        # è‹±æ–‡ç‰ˆæœ¬ (æ— ç¼–ç é—®é¢˜) â­
â”œâ”€â”€ test_filters_cn.bat           # ä¸­æ–‡ç‰ˆæœ¬ (UTF-8ç¼–ç ) â­
â”œâ”€â”€ encoding_test.bat             # ç¼–ç æµ‹è¯•æ–‡ä»¶
â””â”€â”€ scripts\
    â””â”€â”€ fix_encoding.ps1          # ç¼–ç ä¿®å¤å·¥å…·
```

### æ¨èä½¿ç”¨é¡ºåº
1. **é¦–é€‰**: `test_filters_cn.bat` (å®Œæ•´ä¸­æ–‡ç•Œé¢)
2. **å¤‡é€‰**: `test_filters_fixed.bat` (è‹±æ–‡ç•Œé¢)
3. **ä¿®å¤**: ä½¿ç”¨ `fix_encoding.ps1` ä¿®å¤åŸæ–‡ä»¶

## ğŸ§ª æµ‹è¯•ç¼–ç æ˜¯å¦æ­£å¸¸

### 1. è¿è¡Œç¼–ç æµ‹è¯•
```batch
# ä¼šè‡ªåŠ¨åˆ›å»ºæµ‹è¯•æ–‡ä»¶
.\scripts\fix_encoding.ps1

# è¿è¡Œæµ‹è¯•æ–‡ä»¶
.\encoding_test.bat
```

### 2. æ£€æŸ¥æ˜¾ç¤ºæ•ˆæœ
å¦‚æœèƒ½æ­£ç¡®æ˜¾ç¤ºä»¥ä¸‹å†…å®¹ï¼Œè¯´æ˜ç¼–ç æ­£å¸¸ï¼š
```
ç¼–ç æµ‹è¯•æ–‡ä»¶
=============

è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ä¸­æ–‡æ˜¾ç¤ºçš„æ‰¹å¤„ç†æ–‡ä»¶

å¦‚æœä½ èƒ½æ­£ç¡®çœ‹åˆ°è¿™äº›ä¸­æ–‡å­—ç¬¦ï¼Œè¯´æ˜ç¼–ç è®¾ç½®æ­£ç¡®ï¼š
  â€¢ æµ‹è¯•å­—ç¬¦: ä½ å¥½ä¸–ç•Œ
  â€¢ ç‰¹æ®Šç¬¦å·: â˜…â˜†â™¦â™ â™£â™¥
  â€¢ æ•°å­—: â‘ â‘¡â‘¢â‘£â‘¤

æµ‹è¯•å®Œæˆ âœ…
```

## âš™ï¸ æ§åˆ¶å°ç¼–ç è®¾ç½®

### ä¸´æ—¶è®¾ç½® (å½“å‰ä¼šè¯)
```batch
# è®¾ç½®UTF-8ç¼–ç 
chcp 65001

# éªŒè¯è®¾ç½®
chcp
```

### æ°¸ä¹…è®¾ç½® (ç³»ç»Ÿçº§åˆ«)
1. æ‰“å¼€"æ§åˆ¶é¢æ¿"
2. é€‰æ‹©"æ—¶é’Ÿå’ŒåŒºåŸŸ" â†’ "åŒºåŸŸ"
3. ç‚¹å‡»"ç®¡ç†"é€‰é¡¹å¡
4. ç‚¹å‡»"æ›´æ”¹ç³»ç»ŸåŒºåŸŸè®¾ç½®"
5. å‹¾é€‰"Beta: ä½¿ç”¨UTF-8æä¾›å…¨çƒè¯­è¨€æ”¯æŒ"
6. é‡å¯è®¡ç®—æœº

## ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: ä»ç„¶æ˜¾ç¤ºä¹±ç 
**è§£å†³æ–¹æ¡ˆ**:
```powershell
# 1. æ£€æŸ¥æ–‡ä»¶ç¼–ç 
.\scripts\fix_encoding.ps1 -CheckOnly

# 2. å¼ºåˆ¶ä¿®å¤
.\scripts\fix_encoding.ps1 -FixAll

# 3. ä½¿ç”¨UTF-8ç‰ˆæœ¬
.\test_filters_cn.bat
```

### é—®é¢˜2: PowerShellæ‰§è¡Œç­–ç•¥é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
```powershell
# ä¸´æ—¶å…è®¸æ‰§è¡Œ
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process

# æˆ–ç›´æ¥è¿è¡Œ
powershell -ExecutionPolicy Bypass -File "scripts\fix_encoding.ps1"
```

### é—®é¢˜3: æ§åˆ¶å°å­—ä½“æ˜¾ç¤ºé—®é¢˜
**è§£å†³æ–¹æ¡ˆ**:
1. å³é”®ç‚¹å‡»å‘½ä»¤è¡Œçª—å£æ ‡é¢˜æ 
2. é€‰æ‹©"å±æ€§"
3. åœ¨"å­—ä½“"é€‰é¡¹å¡ä¸­é€‰æ‹©æ”¯æŒUnicodeçš„å­—ä½“ (å¦‚: Consolas, Lucida Console)
4. ç‚¹å‡»"ç¡®å®š"

### é—®é¢˜4: ç¼–ç ä¿®å¤åä»æœ‰é—®é¢˜
**è§£å†³æ–¹æ¡ˆ**:
```batch
# 1. æ£€æŸ¥æ˜¯å¦æ­£ç¡®è®¾ç½®äº†chcpå‘½ä»¤
type test_filters_cn.bat | findstr chcp

# 2. æ‰‹åŠ¨è¿è¡Œç¼–ç è®¾ç½®
chcp 65001

# 3. ä½¿ç”¨è‹±æ–‡ç‰ˆæœ¬é¿å…ç¼–ç é—®é¢˜
test_filters_fixed.bat
```

## ğŸ’¡ æœ€ä½³å®è·µ

### å¼€å‘å»ºè®®
1. **åˆ›å»ºæ‰¹å¤„ç†æ–‡ä»¶æ—¶**:
   - å§‹ç»ˆä½¿ç”¨UTF-8ç¼–ç ä¿å­˜
   - åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ `chcp 65001 >nul 2>&1`
   - æµ‹è¯•åœ¨ä¸åŒç¯å¢ƒä¸‹çš„æ˜¾ç¤ºæ•ˆæœ

2. **åˆ†å‘è½¯ä»¶æ—¶**:
   - æä¾›è‹±æ–‡å’Œä¸­æ–‡ä¸¤ä¸ªç‰ˆæœ¬
   - åŒ…å«ç¼–ç ä¿®å¤å·¥å…·
   - åœ¨READMEä¸­è¯´æ˜ç¼–ç è¦æ±‚

### ä½¿ç”¨å»ºè®®
1. **ä¼˜å…ˆä½¿ç”¨**: `test_filters_cn.bat` (ä¸­æ–‡ç•Œé¢)
2. **å¤‡é€‰æ–¹æ¡ˆ**: `test_filters_fixed.bat` (è‹±æ–‡ç•Œé¢)
3. **é—®é¢˜ä¿®å¤**: è¿è¡Œ `.\scripts\fix_encoding.ps1`
4. **ç¯å¢ƒæµ‹è¯•**: å…ˆè¿è¡Œ `.\encoding_test.bat` éªŒè¯

## ğŸ“š æŠ€æœ¯ç»†èŠ‚

### ç¼–ç åŸç†
- **ANSI/GBK**: Windowsä¸­æ–‡ç³»ç»Ÿé»˜è®¤ç¼–ç ï¼Œä¸æ”¯æŒUnicode
- **UTF-8**: å›½é™…æ ‡å‡†Unicodeç¼–ç ï¼Œæ”¯æŒæ‰€æœ‰è¯­è¨€
- **BOM**: å­—èŠ‚é¡ºåºæ ‡è®°ï¼Œå¸®åŠ©è¯†åˆ«UTF-8æ–‡ä»¶

### chcp 65001 å‘½ä»¤
```batch
@echo off
chcp 65001 >nul 2>&1    # è®¾ç½®æ§åˆ¶å°ä¸ºUTF-8ç¼–ç 
                        # >nul 2>&1 éšè—å‘½ä»¤è¾“å‡º
```

### PowerShellç¼–ç å¤„ç†
```powershell
# è¯»å–ä¸åŒç¼–ç çš„æ–‡ä»¶
$content = Get-Content -Path $file -Encoding UTF8
$content | Out-File -FilePath $file -Encoding UTF8
```

---

ğŸ’¡ **æ€»ç»“**: ä½¿ç”¨ `test_filters_cn.bat` æˆ– `test_filters_fixed.bat` å¯ä»¥é¿å…ç¼–ç é—®é¢˜ï¼Œå¦‚éœ€ä¿®å¤ç°æœ‰æ–‡ä»¶è¯·ä½¿ç”¨ `fix_encoding.ps1` å·¥å…·ã€‚