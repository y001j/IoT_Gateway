# IoT Gateway ç«¯å£é…ç½®è¯´æ˜

## ğŸ”Œ ç«¯å£åˆ†é…

ä¸ºäº†é¿å…ç«¯å£å†²çªï¼ŒIoT Gatewayé¡¹ç›®ä¸­çš„å„ä¸ªæœåŠ¡ä½¿ç”¨ä¸åŒçš„ç«¯å£ï¼š

### æ ¸å¿ƒæœåŠ¡ç«¯å£

| æœåŠ¡åç§° | ç«¯å£ | ç”¨é€” | é…ç½®æ–‡ä»¶ |
|---------|------|------|----------|
| **Gateway ä¸»æœåŠ¡** | `8080` | IoTæ•°æ®å¤„ç†æ ¸å¿ƒæœåŠ¡ | `config.yaml` â†’ `gateway.http_port` |
| **Web API æœåŠ¡** | `8081` | REST API å’Œç®¡ç†ç•Œé¢åç«¯ | `configs/web/config.yaml` â†’ `server.addr` |
| **å‰ç«¯å¼€å‘æœåŠ¡å™¨** | `3000` | Reactå¼€å‘æœåŠ¡å™¨ (Vite) | `web/frontend/vite.config.ts` |

### å…¶ä»–ç«¯å£

| æœåŠ¡ | ç«¯å£ | ç”¨é€” |
|------|------|------|
| NATS | `4222` | å†…éƒ¨æ¶ˆæ¯æ€»çº¿ |
| MQTT | `1883` | MQTTä»£ç† |
| Modbus | `502` | Modbusè®¾å¤‡é€šä¿¡ |
| ISP Sidecar | `50052` | æ’ä»¶é€šä¿¡åè®® |

## ğŸ”§ ä¿®æ”¹å†å²

### ä¿®å¤ç«¯å£å†²çª (2025-01-XX)

**é—®é¢˜**: GatewayæœåŠ¡å’ŒWeb APIæœåŠ¡éƒ½ä½¿ç”¨8080ç«¯å£ï¼Œå¯¼è‡´å†²çª

**è§£å†³æ–¹æ¡ˆ**:
1. GatewayæœåŠ¡ä¿æŒ `8080` ç«¯å£ (æ ¸å¿ƒæœåŠ¡ä¼˜å…ˆ)
2. Web APIæœåŠ¡æ”¹ä¸º `8081` ç«¯å£
3. å‰ç«¯ä»£ç†é…ç½®æ›´æ–°ä¸ºæŒ‡å‘ `8081` ç«¯å£

**ä¿®æ”¹çš„æ–‡ä»¶**:
- `configs/web/config.yaml`: `server.addr` æ”¹ä¸º `:8081`
- `cmd/server/main.go`: é»˜è®¤ç«¯å£æ”¹ä¸º `:8081`  
- `web/frontend/vite.config.ts`: ä»£ç†ç›®æ ‡æ”¹ä¸º `localhost:8081`

## ğŸš€ å¯åŠ¨é¡ºåºå»ºè®®

1. **å¯åŠ¨GatewayæœåŠ¡** (ç«¯å£8080):
   ```bash
   go run cmd/gateway/main.go -config config.yaml
   ```

2. **å¯åŠ¨Web APIæœåŠ¡** (ç«¯å£8081):
   ```bash
   go run cmd/server/main.go
   ```

3. **å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨** (ç«¯å£3000):
   ```bash
   cd web/frontend
   npm run dev
   ```

## ğŸŒ è®¿é—®åœ°å€

- **å‰ç«¯ç®¡ç†ç•Œé¢**: http://localhost:3000
- **Web APIæ–‡æ¡£**: http://localhost:8081/api/v1/swagger
- **Gatewayå¥åº·æ£€æŸ¥**: http://localhost:8080/health

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§ç¯å¢ƒ**: å»ºè®®ä½¿ç”¨åå‘ä»£ç†(å¦‚Nginx)ç»Ÿä¸€ç«¯å£
2. **é˜²ç«å¢™**: ç¡®ä¿ç›¸å…³ç«¯å£åœ¨é˜²ç«å¢™ä¸­å¼€æ”¾
3. **é…ç½®åŒæ­¥**: ä¿®æ”¹ç«¯å£æ—¶éœ€è¦åŒæ­¥æ›´æ–°æ‰€æœ‰ç›¸å…³é…ç½®æ–‡ä»¶

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### ç«¯å£å ç”¨æ£€æŸ¥
```bash
# Windows
netstat -ano | findstr :8080
netstat -ano | findstr :8081

# Linux/Mac  
lsof -i :8080
lsof -i :8081
```

### å¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹
```bash
# Windows
taskkill /PID <è¿›ç¨‹ID> /F

# Linux/Mac
kill -9 <è¿›ç¨‹ID>
``` 