[
  {
    "id": "forward_http_example",
    "name": "HTTP转发示例",
    "description": "将温度数据转发到HTTP API",
    "enabled": true,
    "priority": 1,
    "conditions": {
      "type": "simple",
      "field": "key",
      "operator": "eq",
      "value": "temperature"
    },
    "actions": [
      {
        "type": "forward",
        "config": {
          "targets": [
            {
              "name": "webhook_api",
              "type": "http",
              "enabled": true,
              "async": false,
              "timeout": "10s",
              "retry": 3,
              "config": {
                "url": "https://api.example.com/webhooks/temperature",
                "method": "POST",
                "content_type": "application/json",
                "headers": {
                  "X-Device-Type": "IoT-Gateway",
                  "X-Source": "Rule-Engine"
                },
                "auth": {
                  "type": "bearer",
                  "token": "your-api-token-here"
                }
              }
            },
            {
              "name": "backup_api",
              "type": "http",
              "enabled": true,
              "async": true,
              "timeout": "5s",
              "retry": 1,
              "config": {
                "url": "https://backup.example.com/api/data",
                "method": "POST",
                "content_type": "application/xml",
                "auth": {
                  "type": "basic",
                  "username": "backup_user",
                  "password": "backup_pass"
                }
              }
            }
          ],
          "add_rule_info": true,
          "add_timestamp": true,
          "extra_fields": {
            "source": "iot-gateway",
            "environment": "production"
          }
        }
      }
    ]
  },
  {
    "id": "forward_file_example",
    "name": "文件转发示例",
    "description": "将所有数据记录到文件",
    "enabled": true,
    "priority": 2,
    "conditions": {
      "type": "simple",
      "field": "device_id",
      "operator": "contains",
      "value": "sensor"
    },
    "actions": [
      {
        "type": "forward",
        "config": {
          "targets": [
            {
              "name": "json_log",
              "type": "file",
              "enabled": true,
              "config": {
                "path": "/var/log/iot-gateway/sensor_data.json",
                "format": "json",
                "append": true
              }
            },
            {
              "name": "csv_export",
              "type": "file",
              "enabled": true,
              "config": {
                "path": "/var/exports/sensor_data.csv",
                "format": "csv",
                "append": true
              }
            },
            {
              "name": "custom_format",
              "type": "file",
              "enabled": true,
              "config": {
                "path": "/var/log/iot-gateway/custom.log",
                "format": "text",
                "template": "{{.timestamp}} [{{.device_id}}] {{.key}}={{.value}} ({{.type}})\n",
                "append": true
              }
            }
          ],
          "data_transform": {
            "fields": ["device_id", "key", "value", "timestamp", "type"],
            "exclude": ["tags"],
            "mapping": {
              "device_id": "sensor_id",
              "key": "metric_name",
              "value": "metric_value"
            },
            "constants": {
              "version": "1.0",
              "source": "rule-engine"
            }
          }
        }
      }
    ]
  },
  {
    "id": "forward_mqtt_example",
    "name": "MQTT转发示例",
    "description": "将数据转发到MQTT broker",
    "enabled": true,
    "priority": 3,
    "conditions": {
      "type": "and",
      "conditions": [
        {
          "type": "simple",
          "field": "type",
          "operator": "eq",
          "value": "float"
        },
        {
          "type": "simple",
          "field": "value",
          "operator": "gt",
          "value": 0
        }
      ]
    },
    "actions": [
      {
        "type": "forward",
        "config": {
          "targets": [
            {
              "name": "local_mqtt",
              "type": "mqtt",
              "enabled": true,
              "async": true,
              "timeout": "15s",
              "retry": 2,
              "config": {
                "broker": "tcp://localhost:1883",
                "topic": "iot/sensors/{{.device_id}}/{{.key}}",
                "client_id": "iot-gateway-forward",
                "qos": 1,
                "retain": false,
                "format": "json",
                "username": "mqtt_user",
                "password": "mqtt_pass"
              }
            },
            {
              "name": "cloud_mqtt",
              "type": "mqtt",
              "enabled": true,
              "async": true,
              "timeout": "20s",
              "retry": 3,
              "config": {
                "broker": "ssl://mqtt.cloud.example.com:8883",
                "topic": "devices/{{.device_id}}/telemetry",
                "client_id": "gateway-{{.device_id}}",
                "qos": 2,
                "retain": true,
                "format": "json",
                "tls": true,
                "username": "cloud_user",
                "password": "cloud_pass"
              }
            }
          ]
        }
      }
    ]
  },
  {
    "id": "forward_nats_example",
    "name": "NATS转发示例",
    "description": "将处理后的数据转发到NATS",
    "enabled": true,
    "priority": 4,
    "conditions": {
      "type": "simple",
      "field": "tags.processed",
      "operator": "eq",
      "value": true
    },
    "actions": [
      {
        "type": "forward",
        "config": {
          "targets": [
            {
              "name": "processed_stream",
              "type": "nats",
              "enabled": true,
              "async": false,
              "config": {
                "subject": "iot.processed.{{.device_id}}"
              }
            },
            {
              "name": "analytics_stream",
              "type": "nats",
              "enabled": true,
              "async": true,
              "config": {
                "subject": "analytics.input"
              }
            }
          ],
          "add_rule_info": true,
          "extra_fields": {
            "forwarded_at": "{{.timestamp}}",
            "rule_version": "1.0"
          }
        }
      }
    ]
  },
  {
    "id": "forward_multi_target_example",
    "name": "多目标转发示例",
    "description": "同时转发到多个目标",
    "enabled": true,
    "priority": 5,
    "conditions": {
      "type": "simple",
      "field": "key",
      "operator": "eq",
      "value": "alert"
    },
    "actions": [
      {
        "type": "forward",
        "config": {
          "targets": [
            {
              "name": "webhook_alert",
              "type": "http",
              "enabled": true,
              "config": {
                "url": "https://hooks.slack.com/services/YOUR/WEBHOOK/URL",
                "method": "POST",
                "content_type": "application/json",
                "template": "{\"text\": \"Alert from {{.device_id}}: {{.value}}\"}"
              }
            },
            {
              "name": "alert_log",
              "type": "file",
              "enabled": true,
              "config": {
                "path": "/var/log/iot-gateway/alerts.log",
                "format": "text",
                "template": "{{.timestamp}} ALERT [{{.device_id}}] {{.value}}\n",
                "append": true
              }
            },
            {
              "name": "alert_mqtt",
              "type": "mqtt",
              "enabled": true,
              "config": {
                "broker": "tcp://localhost:1883",
                "topic": "alerts/{{.device_id}}",
                "qos": 2,
                "retain": true,
                "format": "json"
              }
            },
            {
              "name": "alert_nats",
              "type": "nats",
              "enabled": true,
              "config": {
                "subject": "alerts.{{.device_id}}"
              }
            }
          ],
          "add_rule_info": true,
          "add_timestamp": true,
          "data_transform": {
            "constants": {
              "alert_level": "high",
              "source": "rule-engine"
            }
          }
        }
      }
    ]
  }
] 