import{u as E,a as j,j as e,b as A}from"./index-BEjgWUn2.js";import{F as a,a as n,k as R,T as C,l as r,D as I,I as w,m as z,n as F,B as k,o as $,p as q,q as G}from"./antd-BFy_CllK.js";import"./vendor-DavUf6mE.js";const{Title:D,Text:L}=C,M=()=>{const[T]=a.useForm(),[g,c]=n.useState(!1),[p,i]=n.useState(null),[h,f]=n.useState(null),[u,l]=n.useState("checking"),m=E(),{isAuthenticated:x,isInitialized:y,logout:S}=j(),d=async()=>{l("checking");try{const o=await fetch("/api/v1/plugins?page=1&page_size=1",{method:"GET",headers:{"Content-Type":"application/json"}});l("online"),console.log("âœ… åç«¯æœåŠ¡åœ¨çº¿ï¼ŒçŠ¶æ€ç :",o.status)}catch(o){l("offline"),console.log("âŒ åç«¯æœåŠ¡ç¦»çº¿:",o)}};n.useEffect(()=>{d();const o=setInterval(d,3e4);return()=>clearInterval(o)},[]),n.useEffect(()=>{y&&x&&(console.log("âœ… ç”¨æˆ·å·²è®¤è¯ï¼Œè·³è½¬åˆ°é¦–é¡µ"),m("/",{replace:!0}))},[x,y,m]);const B=async o=>{if(console.log("ğŸš€ å¼€å§‹ç™»å½•æµç¨‹ï¼Œç”¨æˆ·å:",o.username),c(!0),i(null),f(null),u==="offline"){i("åç«¯æœåŠ¡ä¸å¯ç”¨ï¼Œè¯·ç¡®è®¤æœåŠ¡å·²å¯åŠ¨ã€‚"),c(!1);return}try{console.log("ğŸ“¤ å‘é€ç™»å½•è¯·æ±‚..."),S(),await new Promise(b=>setTimeout(b,100));const t=await A.login(o);console.log("âœ… ç™»å½•æˆåŠŸ:",t);const s=j.getState();if(console.log("ğŸ“‹ å½“å‰è®¤è¯çŠ¶æ€:",{hasAccessToken:!!s.accessToken,hasRefreshToken:!!s.refreshToken,hasUser:!!s.user,isAuthenticated:s.isAuthenticated,isInitialized:s.isInitialized}),console.log("ğŸ’¾ æ£€æŸ¥å­˜å‚¨çŠ¶æ€..."),s.isAuthenticated&&s.accessToken)f("ç™»å½•æˆåŠŸï¼æ­£åœ¨è·³è½¬åˆ°é¦–é¡µ..."),setTimeout(()=>{console.log("ğŸ”„ è·³è½¬åˆ°é¦–é¡µ"),m("/",{replace:!0})},1500);else throw new Error("ç™»å½•å“åº”æ­£å¸¸ï¼Œä½†è®¤è¯çŠ¶æ€æœªæ­£ç¡®è®¾ç½®")}catch(t){console.error("âŒ ç™»å½•å¤±è´¥:",t);let s="ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚";t.name==="NetworkError"?(s="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œã€‚",l("offline")):t.name==="AuthExpiredError"?s="è®¤è¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ã€‚":t.response?.status===401?s="ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚":t.response?.status===400?s=t.response.data?.message||"è¯·æ±‚å‚æ•°é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥ã€‚":t.response?.status===500?s="æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚":t.message&&(s=t.message),i(s)}finally{c(!1)}},v=()=>{switch(u){case"checking":return e.jsx(r,{message:"æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€ä¸­...",type:"info",showIcon:!0,icon:e.jsx(G,{spin:!0}),style:{marginBottom:16}});case"online":return e.jsx(r,{message:"åç«¯æœåŠ¡æ­£å¸¸",type:"success",showIcon:!0,icon:e.jsx(q,{}),style:{marginBottom:16}});case"offline":return e.jsx(r,{message:"åç«¯æœåŠ¡ä¸å¯ç”¨",description:"è¯·ç¡®è®¤IoT GatewayæœåŠ¡å·²å¯åŠ¨ï¼Œå¹¶è¿è¡Œåœ¨ç«¯å£8081ä¸Šã€‚",type:"error",showIcon:!0,icon:e.jsx($,{}),style:{marginBottom:16},action:e.jsx(k,{size:"small",onClick:d,children:"é‡æ–°æ£€æŸ¥"})})}};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},children:e.jsxs(R,{style:{width:450,boxShadow:"0 10px 30px rgba(0,0,0,0.1)",borderRadius:"12px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[e.jsx(D,{level:2,style:{color:"#1890ff",marginBottom:8},children:"IoT Gateway"}),e.jsx(L,{type:"secondary",children:"ç‰©è”ç½‘ç½‘å…³ç®¡ç†ç³»ç»Ÿ"})]}),v(),p&&e.jsx(r,{message:p,type:"error",showIcon:!0,closable:!0,onClose:()=>i(null),style:{marginBottom:16}}),h&&e.jsx(r,{message:h,type:"success",showIcon:!0,style:{marginBottom:16}}),e.jsx(I,{}),e.jsxs(a,{form:T,name:"login",initialValues:{username:"admin",password:"admin123"},onFinish:B,size:"large",children:[e.jsx(a.Item,{name:"username",rules:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å"},{min:3,message:"ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦"}],children:e.jsx(w,{prefix:e.jsx(z,{}),placeholder:"ç”¨æˆ·å",autoComplete:"username"})}),e.jsx(a.Item,{name:"password",rules:[{required:!0,message:"è¯·è¾“å…¥å¯†ç "},{min:6,message:"å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦"}],children:e.jsx(w.Password,{prefix:e.jsx(F,{}),placeholder:"å¯†ç ",autoComplete:"current-password"})}),e.jsx(a.Item,{children:e.jsx(k,{type:"primary",htmlType:"submit",loading:g,disabled:u==="offline",style:{width:"100%",height:"45px"},children:g?"ç™»å½•ä¸­...":"ç™»å½•"})})]}),e.jsx(I,{}),!1]})})};export{M as default};
