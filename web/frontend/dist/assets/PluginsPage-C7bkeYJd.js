import{j as e}from"./index-BEjgWUn2.js";import{a as o,k as i,s as F,u as a,z as P,y as n,a4 as ce,B as g,K as L,v as c,U as X,w as T,V as u,T as Z,j as de,F as Y,I as ee,a5 as ue,a6 as xe,a1 as he,a7 as p,a8 as ge,a9 as je,aa as S,a0 as pe,a2 as fe,N as me,ab as ye,ac as q,H as ve,h as Se,ad as we,ae as ke,o as be,p as Ce}from"./antd-BFy_CllK.js";import{p as k}from"./pluginService-ChNb5F4s.js";import"./vendor-DavUf6mE.js";const{Option:w}=P,{RangePicker:ze}=ce,{Text:Q}=Z,_e=({pluginName:b})=>{const[f,M]=o.useState([]),[C,$]=o.useState(!1),[x,m]=o.useState({current:1,pageSize:20,total:0}),[h,z]=o.useState({level:"",source:"",dateRange:null}),_=async()=>{$(!0);try{const t={page:x.current,page_size:x.pageSize,level:h.level||void 0,source:h.source||void 0,from:h.dateRange?.[0]?.toISOString(),to:h.dateRange?.[1]?.toISOString()},d=await k.getPluginLogs(b,t);M(d.data),m(l=>({...l,total:d.total}))}catch(t){u.error("è·å–æ—¥å¿—å¤±è´¥ï¼š"+(t.message||"æœªçŸ¥é”™è¯¯"))}finally{$(!1)}},j=t=>{switch(t.toLowerCase()){case"error":return e.jsx(n,{color:"red",children:t.toUpperCase()});case"warn":case"warning":return e.jsx(n,{color:"orange",children:t.toUpperCase()});case"info":return e.jsx(n,{color:"blue",children:t.toUpperCase()});case"debug":return e.jsx(n,{color:"default",children:t.toUpperCase()});default:return e.jsx(n,{children:t.toUpperCase()})}},D=[{title:"æ—¶é—´",dataIndex:"timestamp",key:"timestamp",width:180,render:t=>e.jsx(Q,{style:{fontSize:12,fontFamily:"monospace"},children:de(t).format("YYYY-MM-DD HH:mm:ss")})},{title:"çº§åˆ«",dataIndex:"level",key:"level",width:80,render:t=>j(t)},{title:"æ¥æº",dataIndex:"source",key:"source",width:120,render:t=>e.jsx(n,{color:"geekblue",children:t})},{title:"æ¶ˆæ¯",dataIndex:"message",key:"message",render:t=>e.jsx(Q,{style:{fontFamily:"monospace",fontSize:12,wordBreak:"break-all"},children:t})}],A=t=>{m(d=>({...d,current:t.current||1,pageSize:t.pageSize||20}))},I=(t,d)=>{z(l=>({...l,[t]:d})),m(l=>({...l,current:1}))};return o.useEffect(()=>{_()},[x.current,x.pageSize,h]),e.jsxs(i,{title:e.jsxs(T,{children:[e.jsxs("span",{children:["æ’ä»¶æ—¥å¿— - ",b]}),e.jsxs(n,{color:"blue",children:[f.length," æ¡æ—¥å¿—"]})]}),extra:e.jsx(g,{type:"primary",size:"small",icon:e.jsx(L,{}),onClick:_,loading:C,children:"åˆ·æ–°"}),children:[e.jsxs(F,{gutter:16,style:{marginBottom:16},children:[e.jsx(a,{xs:24,sm:6,md:4,children:e.jsxs(P,{placeholder:"æ—¥å¿—çº§åˆ«",allowClear:!0,style:{width:"100%"},value:h.level,onChange:t=>I("level",t),children:[e.jsx(w,{value:"error",children:e.jsx(n,{color:"red",children:"ERROR"})}),e.jsx(w,{value:"warn",children:e.jsx(n,{color:"orange",children:"WARN"})}),e.jsx(w,{value:"info",children:e.jsx(n,{color:"blue",children:"INFO"})}),e.jsx(w,{value:"debug",children:e.jsx(n,{color:"default",children:"DEBUG"})})]})}),e.jsx(a,{xs:24,sm:6,md:4,children:e.jsxs(P,{placeholder:"æ—¥å¿—æ¥æº",allowClear:!0,style:{width:"100%"},value:h.source,onChange:t=>I("source",t),children:[e.jsx(w,{value:b,children:b}),e.jsx(w,{value:"system",children:"ç³»ç»Ÿ"}),e.jsx(w,{value:"gateway",children:"ç½‘å…³"})]})}),e.jsx(a,{xs:24,sm:12,md:8,children:e.jsx(ze,{style:{width:"100%"},value:h.dateRange,onChange:t=>I("dateRange",t),showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:["å¼€å§‹æ—¶é—´","ç»“æŸæ—¶é—´"]})}),e.jsx(a,{xs:24,sm:12,md:4,children:e.jsx(g,{icon:e.jsx(L,{}),onClick:_,loading:C,style:{width:"100%"},children:"åˆ·æ–°"})}),e.jsx(a,{xs:24,sm:12,md:4,children:e.jsx(g,{type:"default",style:{width:"100%"},onClick:()=>{z({level:"",source:"",dateRange:null}),m(t=>({...t,current:1}))},children:"æ¸…ç©ºç­›é€‰"})})]}),f.length>0&&e.jsxs(F,{gutter:16,style:{marginBottom:16},children:[e.jsx(a,{span:6,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"æ€»æ—¥å¿—æ•°",value:x.total,valueStyle:{fontSize:"16px"}})})}),e.jsx(a,{span:6,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"é”™è¯¯æ—¥å¿—",value:f.filter(t=>t.level==="error").length,valueStyle:{color:"#f5222d",fontSize:"16px"}})})}),e.jsx(a,{span:6,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"è­¦å‘Šæ—¥å¿—",value:f.filter(t=>t.level==="warn"||t.level==="warning").length,valueStyle:{color:"#faad14",fontSize:"16px"}})})}),e.jsx(a,{span:6,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"ä¿¡æ¯æ—¥å¿—",value:f.filter(t=>t.level==="info").length,valueStyle:{color:"#1890ff",fontSize:"16px"}})})})]}),e.jsx(X,{columns:D,dataSource:f,rowKey:"id",loading:C,size:"small",pagination:{current:x.current,pageSize:x.pageSize,total:x.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,d)=>`ç¬¬ ${d[0]}-${d[1]} æ¡ï¼Œå…± ${t} æ¡`,pageSizeOptions:["10","20","50","100"]},onChange:A,scroll:{y:400},rowClassName:t=>{switch(t.level.toLowerCase()){case"error":return"log-row-error";case"warn":case"warning":return"log-row-warning";case"debug":return"log-row-debug";default:return""}}}),e.jsx("style",{jsx:!0,global:!0,children:`
        .log-row-error {
          background-color: #fff2f0;
          border-left: 3px solid #f5222d;
        }
        .log-row-warning {
          background-color: #fffbe6;
          border-left: 3px solid #faad14;
        }
        .log-row-debug {
          background-color: #f6f6f6;
          border-left: 3px solid #d9d9d9;
        }
        .log-row-error:hover,
        .log-row-warning:hover,
        .log-row-debug:hover {
          background-color: #e6f7ff;
        }
      `})]})},{Title:G,Text:W}=Z,{Search:Ie}=ee,{Option:O}=P,Oe=()=>{const[b,f]=o.useState([]),[M,C]=o.useState(!1),[$,x]=o.useState(""),[m,h]=o.useState(""),[z,_]=o.useState(""),[j,D]=o.useState({current:1,pageSize:10,total:0}),[A,I]=o.useState(!1),[t,d]=o.useState(null),[l,V]=o.useState(null),[te,B]=o.useState(!1),[N]=Y.useForm(),R=async()=>{C(!0);try{const s={page:j.current,page_size:j.pageSize,search:$||void 0,type:m||void 0,status:z||void 0},r=await k.getPlugins(s);console.log(`ğŸ“Š è·å–åˆ° ${r.data?.length||0} ä¸ªæ’ä»¶:`,r.data?.map(v=>`${v.name}(${v.type})`).join(", "));const y=[...r.data||[]].sort((v,J)=>v.status==="running"&&J.status!=="running"?-1:v.status!=="running"&&J.status==="running"?1:v.name.localeCompare(J.name));f(y),D(v=>({...v,total:r.pagination.total}))}catch(s){u.error("è·å–æ’ä»¶åˆ—è¡¨å¤±è´¥ï¼š"+(s.message||"æœªçŸ¥é”™è¯¯"))}finally{C(!1)}},se=async s=>{try{console.log("æ­£åœ¨è·å–æ’ä»¶ç»Ÿè®¡:",s);const r=await k.getPluginStats(s);console.log("æ’ä»¶ç»Ÿè®¡æ•°æ®:",r),V(r)}catch(r){console.error("è·å–æ’ä»¶ç»Ÿè®¡å¤±è´¥:",r),u.error("è·å–æ’ä»¶ç»Ÿè®¡å¤±è´¥ï¼š"+(r.message||"æœªçŸ¥é”™è¯¯")),V({plugin_id:0,data_points_total:0,data_points_hour:0,errors_total:0,errors_hour:0,uptime_seconds:0,average_latency:0,memory_usage:0,cpu_usage:0,last_update:new Date().toISOString()})}},U=async(s,r)=>{try{const y=await k.executePluginAction(s.name,r);y.success?(u.success(`${E(r)}æˆåŠŸ`),await R()):u.error(y.message||`${E(r)}å¤±è´¥`)}catch(y){u.error(`${E(r)}å¤±è´¥ï¼š`+(y.message||"æœªçŸ¥é”™è¯¯"))}},re=async s=>{try{await k.deletePlugin(s.name),u.success("åˆ é™¤æ’ä»¶æˆåŠŸ"),await R()}catch(r){u.error("åˆ é™¤æ’ä»¶å¤±è´¥ï¼š"+(r.message||"æœªçŸ¥é”™è¯¯"))}},le=async s=>{d(s),I(!0),await se(s.name)},ae=async s=>{try{const r=await k.getPluginConfig(s.name);d(s),N.setFieldsValue({config:JSON.stringify(r,null,2)}),B(!0)}catch(r){u.error("è·å–æ’ä»¶é…ç½®å¤±è´¥ï¼š"+(r.message||"æœªçŸ¥é”™è¯¯"))}},ne=async()=>{if(t)try{const s=await N.validateFields(),r=JSON.parse(s.config);await k.updatePluginConfig(t.name,r),u.success("é…ç½®ä¿å­˜æˆåŠŸ"),B(!1),await R()}catch(s){s instanceof SyntaxError?u.error("é…ç½®æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥ JSON æ ¼å¼"):u.error("ä¿å­˜é…ç½®å¤±è´¥ï¼š"+(s.message||"æœªçŸ¥é”™è¯¯"))}},E=s=>{switch(s){case"start":return"å¯åŠ¨";case"stop":return"åœæ­¢";case"restart":return"é‡å¯";default:return"æ“ä½œ"}},H=s=>{switch(s){case"running":return e.jsx(n,{color:"green",icon:e.jsx(Ce,{}),children:"è¿è¡Œä¸­"});case"stopped":return e.jsx(n,{color:"default",icon:e.jsx(q,{}),children:"å·²åœæ­¢"});case"error":return e.jsx(n,{color:"red",icon:e.jsx(be,{}),children:"é”™è¯¯"});default:return e.jsx(n,{color:"default",children:s})}},K=s=>{switch(s){case"adapter":return e.jsx(n,{color:"blue",children:"é€‚é…å™¨"});case"sink":return e.jsx(n,{color:"purple",children:"è¿æ¥å™¨"});default:return e.jsx(n,{children:s})}},oe=[{title:"æ’ä»¶åç§°",dataIndex:"name",key:"name",render:(s,r)=>e.jsxs(T,{children:[e.jsx(je,{shape:"square",style:{backgroundColor:r.type==="adapter"?"#1890ff":"#722ed1"},children:s.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("strong",{children:s})}),e.jsx(W,{type:"secondary",style:{fontSize:12},children:r.description||"æ— æè¿°"})]})]})},{title:"ç±»å‹",dataIndex:"type",key:"type",render:s=>K(s),filters:[{text:"é€‚é…å™¨",value:"adapter"},{text:"è¿æ¥å™¨",value:"sink"}]},{title:"ç‰ˆæœ¬",dataIndex:"version",key:"version"},{title:"çŠ¶æ€",dataIndex:"status",key:"status",render:(s,r)=>e.jsxs(T,{children:[H(s),r.error_count&&r.error_count>0&&e.jsx(S,{title:`é”™è¯¯æ¬¡æ•°: ${r.error_count}`,children:e.jsx(pe,{count:r.error_count,size:"small",children:e.jsx(fe,{style:{color:"#ff4d4f"}})})})]}),filters:[{text:"è¿è¡Œä¸­",value:"running"},{text:"å·²åœæ­¢",value:"stopped"},{text:"é”™è¯¯",value:"error"}]},{title:"å¯ç”¨çŠ¶æ€",dataIndex:"enabled",key:"enabled",render:s=>e.jsx(me,{checked:s,disabled:!0,size:"small"})},{title:"ç«¯å£",dataIndex:"port",key:"port",render:s=>s||"-"},{title:"æ“ä½œ",key:"actions",width:200,render:(s,r)=>e.jsxs(T,{children:[e.jsx(S,{title:"æŸ¥çœ‹è¯¦æƒ…",children:e.jsx(g,{type:"link",icon:e.jsx(ye,{}),onClick:()=>le(r)})}),r.status==="running"?e.jsx(S,{title:"åœæ­¢",children:e.jsx(g,{type:"link",icon:e.jsx(q,{}),onClick:()=>U(r,"stop")})}):e.jsx(S,{title:"å¯åŠ¨",children:e.jsx(g,{type:"link",icon:e.jsx(ve,{}),onClick:()=>U(r,"start")})}),e.jsx(S,{title:"é‡å¯",children:e.jsx(g,{type:"link",icon:e.jsx(L,{}),onClick:()=>U(r,"restart")})}),e.jsx(S,{title:"é…ç½®",children:e.jsx(g,{type:"link",icon:e.jsx(Se,{}),onClick:()=>ae(r)})}),e.jsx(we,{title:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ’ä»¶å—ï¼Ÿ",description:"åˆ é™¤åæ— æ³•æ¢å¤",onConfirm:()=>re(r),okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",children:e.jsx(S,{title:"åˆ é™¤",children:e.jsx(g,{type:"link",danger:!0,icon:e.jsx(ke,{})})})})]})}],ie=(s,r)=>{D(y=>({...y,current:s.current||1,pageSize:s.pageSize||10})),r.type&&h(r.type[0]||""),r.status&&_(r.status[0]||"")};return o.useEffect(()=>{R()},[j.current,j.pageSize,$,m,z]),e.jsxs("div",{children:[e.jsx(G,{level:2,children:"æ’ä»¶ç®¡ç†"}),e.jsx(i,{style:{marginBottom:16},children:e.jsxs(F,{gutter:16,align:"middle",children:[e.jsx(a,{flex:"auto",children:e.jsxs(T,{children:[e.jsx(Ie,{placeholder:"æœç´¢æ’ä»¶åç§°æˆ–æè¿°",allowClear:!0,style:{width:300},onSearch:x,onClear:()=>x("")}),e.jsxs(P,{placeholder:"æ’ä»¶ç±»å‹",allowClear:!0,style:{width:120},value:m,onChange:h,children:[e.jsx(O,{value:"adapter",children:"é€‚é…å™¨"}),e.jsx(O,{value:"sink",children:"è¿æ¥å™¨"})]}),e.jsxs(P,{placeholder:"çŠ¶æ€",allowClear:!0,style:{width:120},value:z,onChange:_,children:[e.jsx(O,{value:"running",children:"è¿è¡Œä¸­"}),e.jsx(O,{value:"stopped",children:"å·²åœæ­¢"}),e.jsx(O,{value:"error",children:"é”™è¯¯"})]})]})}),e.jsx(a,{children:e.jsxs(T,{children:[e.jsx(g,{icon:e.jsx(L,{}),onClick:R,children:"åˆ·æ–°"}),e.jsx(g,{type:"primary",icon:e.jsx(ue,{}),children:"æ·»åŠ æ’ä»¶"})]})})]})}),e.jsx(i,{children:e.jsx(X,{columns:oe,dataSource:b,rowKey:"name",loading:M,pagination:{current:j.current,pageSize:j.pageSize,total:j.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(s,r)=>`ç¬¬ ${r[0]}-${r[1]} æ¡ï¼Œå…± ${s} æ¡`},onChange:ie})}),e.jsx(xe,{title:"æ’ä»¶è¯¦æƒ…",width:600,open:A,onClose:()=>I(!1),children:t&&e.jsx("div",{children:e.jsx(he,{defaultActiveKey:"1",items:[{key:"1",label:"åŸºæœ¬ä¿¡æ¯",children:e.jsxs(p,{title:"åŸºæœ¬ä¿¡æ¯",bordered:!0,children:[e.jsx(p.Item,{label:"åç§°",children:t.name}),e.jsx(p.Item,{label:"ç±»å‹",children:K(t.type)}),e.jsx(p.Item,{label:"ç‰ˆæœ¬",children:t.version}),e.jsx(p.Item,{label:"çŠ¶æ€",children:H(t.status)}),e.jsx(p.Item,{label:"ç«¯å£",children:t.port||"æ— "}),e.jsx(p.Item,{label:"ä½œè€…",children:t.author||"æœªçŸ¥"}),e.jsx(p.Item,{label:"è·¯å¾„",span:3,children:t.path}),e.jsx(p.Item,{label:"æè¿°",span:3,children:t.description||"æ— æè¿°"})]})},{key:"2",label:"è¿è¡Œç»Ÿè®¡",children:l?e.jsxs("div",{style:{marginTop:24},children:[e.jsx(G,{level:4,children:"è¿è¡Œç»Ÿè®¡"}),e.jsxs(F,{gutter:[16,16],children:[e.jsx(a,{xs:24,sm:12,lg:8,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"æ€»æ•°æ®ç‚¹",value:l.data_points_total,valueStyle:{color:"#1890ff"},formatter:s=>Number(s).toLocaleString()})})}),e.jsx(a,{xs:24,sm:12,lg:8,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"å°æ—¶æ•°æ®ç‚¹",value:l.data_points_hour,valueStyle:{color:"#52c41a"},formatter:s=>Number(s).toLocaleString()})})}),e.jsx(a,{xs:24,sm:12,lg:8,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"è¿è¡Œæ—¶é—´",value:Math.floor(l.uptime_seconds/3600),suffix:"å°æ—¶",valueStyle:{color:"#722ed1"}})})}),e.jsx(a,{xs:24,sm:12,lg:8,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"æ€»é”™è¯¯",value:l.errors_total,valueStyle:{color:l.errors_total>0?"#f5222d":"#52c41a"}})})}),e.jsx(a,{xs:24,sm:12,lg:8,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"å°æ—¶é”™è¯¯",value:l.errors_hour,valueStyle:{color:l.errors_hour>0?"#f5222d":"#52c41a"}})})}),e.jsx(a,{xs:24,sm:12,lg:8,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"å¹³å‡å»¶è¿Ÿ",value:l.average_latency,precision:2,suffix:"ms",valueStyle:{color:l.average_latency>100?"#f5222d":l.average_latency>50?"#faad14":"#52c41a"}})})}),e.jsx(a,{xs:24,sm:12,lg:8,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"å†…å­˜ä½¿ç”¨",value:l.memory_usage/1024/1024,precision:1,suffix:"MB",valueStyle:{color:"#13c2c2"}})})}),e.jsx(a,{xs:24,sm:12,lg:8,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"CPUä½¿ç”¨ç‡",value:l.cpu_usage,precision:1,suffix:"%",valueStyle:{color:l.cpu_usage>80?"#f5222d":l.cpu_usage>50?"#faad14":"#52c41a"}})})}),e.jsx(a,{xs:24,sm:12,lg:8,children:e.jsx(i,{size:"small",children:e.jsx(c,{title:"æœ€åæ›´æ–°",value:new Date(l.last_update).toLocaleString(),valueStyle:{color:"#666",fontSize:"14px"}})})})]})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center",color:"#999"},children:e.jsx(W,{type:"secondary",children:"æš‚æ— ç»Ÿè®¡æ•°æ®"})})},{key:"3",label:"æ’ä»¶æ—¥å¿—",children:e.jsx(_e,{pluginName:t.name})}]})})}),e.jsx(ge,{title:"æ’ä»¶é…ç½®",open:te,onOk:ne,onCancel:()=>B(!1),width:800,okText:"ä¿å­˜",cancelText:"å–æ¶ˆ",children:t&&e.jsx(Y,{form:N,layout:"vertical",children:e.jsx(Y.Item,{label:"é…ç½® (JSON æ ¼å¼)",name:"config",rules:[{required:!0,message:"è¯·è¾“å…¥é…ç½®"},{validator:(s,r)=>{try{return JSON.parse(r),Promise.resolve()}catch{return Promise.reject(new Error("JSON æ ¼å¼é”™è¯¯"))}}}],children:e.jsx(ee.TextArea,{rows:20,placeholder:'{"key": "value"}',style:{fontFamily:"monospace"}})})})})]})};export{Oe as default};
