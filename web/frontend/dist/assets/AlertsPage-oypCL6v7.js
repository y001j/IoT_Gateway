import{j as e,a as _e}from"./index-BEjgWUn2.js";import{a,aH as he,a0 as I,p as K,a2 as Me,o as ne,f as ie,k as F,s as D,u as h,v as B,P as xe,a3 as re,w as R,F as i,V as v,z as A,y as L,I as b,B as j,K as ee,a5 as te,U as le,h as Oe,aw as N,T as Pe,a1 as qe,a8 as se,D as Ve,aa as fe,ad as Be}from"./antd-BFy_CllK.js";import{u as ge,a as g}from"./useRealTimeData-BUsqV8Uu.js";import"./vendor-DavUf6mE.js";import"./websocketService-DUqqsEfN.js";class Je{cache=new Map;maxSize;constructor(c=100){this.maxSize=c}get(c){const d=this.cache.get(c);return d?Date.now()>d.expiry?(this.cache.delete(c),null):d:null}set(c,d,p){if(this.cache.size>=this.maxSize){const n=this.cache.keys().next().value;this.cache.delete(n)}const o={data:d,timestamp:Date.now(),expiry:Date.now()+p};this.cache.set(c,o)}isStale(c,d){const p=this.cache.get(c);if(!p||!d)return!1;const o=p.timestamp+d;return Date.now()>o}delete(c){this.cache.delete(c)}clear(){this.cache.clear()}size(){return this.cache.size}keys(){return Array.from(this.cache.keys())}}const z=new Je(200);function J(l,c,d={}){const{ttl:p=5*60*1e3,staleWhileRevalidate:o=30*1e3}=d,n=z.get(l),[u,r]=a.useState(n?.data||null),[S,y]=a.useState(!n),[M,w]=a.useState(null),[k,m]=a.useState(!1),T=a.useRef(null),x=a.useRef(!0),q=a.useRef(c);a.useEffect(()=>{q.current=c},[c]);const $=a.useCallback(async(O=!1)=>{if(console.log(`ğŸ”„ [useSmartCache] loadDataå¼€å§‹ - key: ${l}, forceRefresh: ${O}`),T.current&&T.current.abort(),!O){const f=z.get(l);if(console.log(`ğŸ’¾ [useSmartCache] ç¼“å­˜æ£€æŸ¥ - key: ${l}, æœ‰ç¼“å­˜: ${!!f}`),f){x.current&&(console.log(`âœ… [useSmartCache] ä½¿ç”¨ç¼“å­˜æ•°æ® - key: ${l}`),r(f.data),w(null),m(z.isStale(l,o)),y(!1)),z.isStale(l,o)&&(console.log(`ğŸ”„ [useSmartCache] æ•°æ®è¿‡æœŸï¼Œåå°æ›´æ–° - key: ${l}`),setTimeout(()=>$(!0),0));return}}x.current&&(console.log(`â³ [useSmartCache] å¼€å§‹åŠ è½½æ•°æ® - key: ${l}`),y(!0),w(null));try{T.current=new AbortController,console.log(`ğŸ“¡ [useSmartCache] è°ƒç”¨fetchFn - key: ${l}`);const f=await q.current();console.log(`âœ… [useSmartCache] fetchFnæˆåŠŸ - key: ${l}`,f),console.log(`ğŸ” [useSmartCache] isMountedRef.current: ${x.current} - key: ${l}`),x.current||(console.log(`ğŸ”§ [useSmartCache] é‡æ–°è®¾ç½®isMountedRefä¸ºtrue - key: ${l}`),x.current=!0),x.current?(console.log(`ğŸ’¾ [useSmartCache] è®¾ç½®æ•°æ®å’Œç¼“å­˜ - key: ${l}`),r(f),w(null),m(!1),y(!1),z.set(l,f,p)):console.warn(`âš ï¸ [useSmartCache] ç»„ä»¶å·²å¸è½½ï¼Œè·³è¿‡è®¾ç½®æ•°æ® - key: ${l}`)}catch(f){if(console.error(`âŒ [useSmartCache] åŠ è½½å¤±è´¥ - key: ${l}`,f),x.current&&f instanceof Error&&f.name!=="AbortError"){console.error("useSmartCache error:",f),w(f),(f.message.includes("401")||f.message.includes("unauthorized")||f.message.includes("æœªæä¾›è®¤è¯ä»¤ç‰Œ"))&&(console.warn("è®¤è¯é”™è¯¯ï¼Œæ¸…é™¤ç¼“å­˜"),z.delete(l));const E=z.get(l);E&&(r(E.data),m(!0)),y(!1)}}finally{x.current&&(console.log(`ğŸ [useSmartCache] å®ŒæˆåŠ è½½ - key: ${l}`),y(!1))}},[l,p,o]),H=a.useCallback(async()=>{await $(!0)},[$]),_=a.useCallback(()=>{z.delete(l),x.current&&(r(null),w(null),m(!1))},[l]);return a.useEffect(()=>{console.log(`ğŸš€ [useSmartCache] åˆå§‹åŠ è½½ effect è§¦å‘ for key: ${l}`),$()},[$]),a.useEffect(()=>()=>{x.current=!1,T.current&&T.current.abort()},[]),{data:u,loading:S,error:M,isStale:k,refresh:H,clear:_}}const Ke=({enabled:l=!0,position:c="topRight"})=>{const{data:d}=ge(),[p,o]=a.useState(new Set);return a.useEffect(()=>{!l||!d||!d.alerts||d.alerts.forEach(n=>{if(!p.has(n.id))if(o(u=>new Set(u).add(n.id)),n.type==="alert_created"){const u=n.data,r=y=>{switch(y){case"critical":return e.jsx(ie,{style:{color:"#ff4d4f"}});case"error":return e.jsx(ne,{style:{color:"#ff7a45"}});case"warning":return e.jsx(Me,{style:{color:"#fa8c16"}});default:return e.jsx(K,{style:{color:"#52c41a"}})}},S=y=>{switch(y){case"critical":return"ä¸¥é‡";case"error":return"é”™è¯¯";case"warning":return"è­¦å‘Š";case"info":return"ä¿¡æ¯";default:return y}};he.open({message:`æ–°å‘Šè­¦ï¼š${u.title}`,description:e.jsxs("div",{children:[e.jsx("p",{children:u.description}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(I,{color:He(u.level),text:`çº§åˆ«: ${S(u.level)}`}),e.jsxs("span",{style:{marginLeft:16},children:["æ¥æº: ",u.source]})]})]}),icon:r(u.level),placement:c,duration:u.level==="critical"?0:6,key:u.id,onClick:()=>{window.location.hash="#/alerts"}})}else n.type==="alert_resolved"&&he.success({message:"å‘Šè­¦å·²è§£å†³",description:`å‘Šè­¦ ${n.data.alert_id} å·²è¢«è§£å†³`,placement:c,duration:3,key:`resolved-${n.data.alert_id}`})})},[d,l,c,p]),a.useEffect(()=>{const n=setInterval(()=>{o(u=>{const r=Date.now(),S=new Set;return u.forEach(y=>{const M=parseInt(y.split("-")[0])||0;r-M<3e5&&S.add(y)}),S})},6e4);return()=>clearInterval(n)},[]),null},He=l=>{switch(l){case"critical":return"#ff4d4f";case"error":return"#ff7a45";case"warning":return"#fa8c16";case"info":return"#1890ff";default:return"#d9d9d9"}},Ue=({stats:l,loading:c=!1})=>{if(!l)return null;const d=l.total>0?l.active/l.total*100:0,p=l.total>0?l.resolved/l.total*100:0,o=l.byLevel||{},n=l.bySource||{};return e.jsxs(F,{title:"å‘Šè­¦ç»Ÿè®¡",style:{marginBottom:16},loading:c,children:[e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:6,children:e.jsx(B,{title:"æ€»å‘Šè­¦æ•°",value:l.total,prefix:e.jsx(ie,{}),valueStyle:{color:"#1890ff"}})}),e.jsx(h,{span:6,children:e.jsx(B,{title:"æ´»è·ƒå‘Šè­¦",value:l.active,prefix:e.jsx(ne,{}),valueStyle:{color:"#ff4d4f"},suffix:e.jsx(xe,{percent:d,size:"small",strokeColor:"#ff4d4f",showInfo:!1,style:{marginLeft:8,width:60}})})}),e.jsx(h,{span:6,children:e.jsx(B,{title:"å·²ç¡®è®¤",value:l.acknowledged,prefix:e.jsx(K,{}),valueStyle:{color:"#fa8c16"}})}),e.jsx(h,{span:6,children:e.jsx(B,{title:"å·²è§£å†³",value:l.resolved,prefix:e.jsx(re,{}),valueStyle:{color:"#52c41a"},suffix:e.jsx(xe,{percent:p,size:"small",strokeColor:"#52c41a",showInfo:!1,style:{marginLeft:8,width:60}})})})]}),e.jsxs(D,{gutter:16,style:{marginTop:16},children:[e.jsx(h,{span:12,children:e.jsx(F,{size:"small",title:"æŒ‰çº§åˆ«ç»Ÿè®¡",style:{height:200},children:e.jsxs(R,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(I,{color:"#ff4d4f",text:"ä¸¥é‡"}),e.jsx("span",{children:o.critical||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(I,{color:"#fa8c16",text:"é”™è¯¯"}),e.jsx("span",{children:o.error||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(I,{color:"#faad14",text:"è­¦å‘Š"}),e.jsx("span",{children:o.warning||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(I,{color:"#1890ff",text:"ä¿¡æ¯"}),e.jsx("span",{children:o.info||0})]})]})})}),e.jsx(h,{span:12,children:e.jsx(F,{size:"small",title:"æŒ‰æ¥æºç»Ÿè®¡",style:{height:200},children:e.jsxs(R,{direction:"vertical",style:{width:"100%"},children:[Object.entries(n).map(([u,r])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:u}),e.jsx(I,{count:r,showZero:!0,color:"#1890ff"})]},u)),Object.keys(n).length===0&&e.jsx("div",{style:{textAlign:"center",color:"#999"},children:"æš‚æ— æ•°æ®"})]})})})]})]})},ae=[{value:"info",label:"ä¿¡æ¯",color:"blue"},{value:"warning",label:"è­¦å‘Š",color:"orange"},{value:"error",label:"é”™è¯¯",color:"red"},{value:"critical",label:"ä¸¥é‡",color:"purple"}],We=[{value:"active",label:"æ´»è·ƒ",color:"red"},{value:"acknowledged",label:"å·²ç¡®è®¤",color:"orange"},{value:"resolved",label:"å·²è§£å†³",color:"green"}],je=[{value:"email",label:"é‚®ä»¶",icon:e.jsx(N,{})},{value:"webhook",label:"Webhook",icon:e.jsx(N,{})},{value:"sms",label:"çŸ­ä¿¡",icon:e.jsx(N,{})},{value:"slack",label:"Slack",icon:e.jsx(N,{})},{value:"dingtalk",label:"é’‰é’‰",icon:e.jsx(N,{})}],{Text:me}=Pe,{Option:C}=A,et=()=>{const[l,c]=a.useState("alerts"),[d,p]=a.useState(!1),{isAuthenticated:o,isInitialized:n,initialize:u}=_e(),[r,S]=a.useState({page:1,pageSize:20}),y=a.useMemo(()=>`alerts-${JSON.stringify(r)}`,[r]),M=a.useCallback(()=>(console.log("ğŸ“¡ AlertsPage: è°ƒç”¨ alertService.getAlerts, filters:",r),g.getAlerts(r)),[r]),{data:w,loading:k,error:m,isStale:T,refresh:x}=J(y,M,{ttl:2*60*1e3,staleWhileRevalidate:30*1e3}),q=a.useCallback(()=>g.getAlertRules(),[]),$=a.useCallback(()=>g.getNotificationChannels(),[]),H=a.useCallback(()=>g.getAlertStats(),[]),{data:_,loading:O,refresh:f}=J("alert-rules",q,{ttl:10*60*1e3}),{data:E,loading:ce,refresh:oe}=J("notification-channels",$,{ttl:10*60*1e3}),U=w?.alerts||[],pe=w?.total||0,ye=Array.isArray(_)?_:[],de=Array.isArray(E)?E:[],{data:ve,loading:Ce}=J("alert-stats",H,{ttl:1*60*1e3}),[we,W]=a.useState(!1),[Se,Q]=a.useState(!1),[be,Y]=a.useState(!1),[Z]=i.useForm(),[G]=i.useForm(),[X]=i.useForm(),{data:V}=ge(),P=a.useRef(null);a.useEffect(()=>{console.log("ğŸ” AlertsPage è®¤è¯çŠ¶æ€:",{isInitialized:n,isAuthenticated:o}),n||(console.log("ğŸš€ AlertsPage åˆå§‹åŒ–è®¤è¯çŠ¶æ€..."),u())},[n,u,o]),a.useEffect(()=>{l==="alerts"?p(k):l==="rules"?p(O):l==="channels"&&p(ce)},[l,k,O,ce]);const ue=a.useCallback(()=>{P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{l==="alerts"&&x()},1e3)},[l,x]);a.useEffect(()=>{V&&V.alerts&&V.alerts.length>0&&l==="alerts"&&ue()},[V?.alerts,l,ue]),a.useEffect(()=>()=>{P.current&&clearTimeout(P.current)},[]),a.useEffect(()=>{m&&v.error("è·å–å‘Šè­¦åˆ—è¡¨å¤±è´¥: "+m.message)},[m]),a.useEffect(()=>{console.log("AlertsPage æ•°æ®çŠ¶æ€:",{isInitialized:n,isAuthenticated:o,alertsLoading:k,alertsError:m?.message,alertsCount:w?.alerts?.length||0,rulesCount:_?.length||0,channelsCount:E?.length||0,activeTab:l})},[n,o,w,_,E,k,m,l]);const Ae=async t=>{try{await g.acknowledgeAlert(t,"æ‰‹åŠ¨ç¡®è®¤"),v.success("å‘Šè­¦ç¡®è®¤æˆåŠŸ"),x()}catch(s){v.error("ç¡®è®¤å‘Šè­¦å¤±è´¥: "+s.message)}},ke=async t=>{try{await g.resolveAlert(t,"æ‰‹åŠ¨è§£å†³"),v.success("å‘Šè­¦è§£å†³æˆåŠŸ"),x()}catch(s){v.error("è§£å†³å‘Šè­¦å¤±è´¥: "+s.message)}},Ie=async t=>{try{await g.deleteAlert(t),v.success("å‘Šè­¦åˆ é™¤æˆåŠŸ"),x()}catch(s){v.error("åˆ é™¤å‘Šè­¦å¤±è´¥: "+s.message)}},Te=async()=>{try{const t=await Z.validateFields(),s={title:t.title,description:t.description,level:t.level,source:t.source||"manual",data:t.data?JSON.parse(t.data):{}};await g.createAlert(s),v.success("å‘Šè­¦åˆ›å»ºæˆåŠŸ"),W(!1),Z.resetFields(),x()}catch(t){v.error("åˆ›å»ºå‘Šè­¦å¤±è´¥: "+t.message)}},ze=async()=>{try{const t=await G.validateFields(),s={name:t.name,description:t.description,enabled:t.enabled,level:t.level,condition:{type:t.conditionType,field:t.field,operator:t.operator,value:t.value},notificationChannels:t.notificationChannels||[]};await g.createAlertRule(s),v.success("å‘Šè­¦è§„åˆ™åˆ›å»ºæˆåŠŸ"),Q(!1),G.resetFields(),f()}catch(t){v.error("åˆ›å»ºå‘Šè­¦è§„åˆ™å¤±è´¥: "+t.message)}},Re=async()=>{try{const t=await X.validateFields(),s={name:t.name,type:t.type,enabled:t.enabled,config:t.config?JSON.parse(t.config):{}};await g.createNotificationChannel(s),v.success("é€šçŸ¥æ¸ é“åˆ›å»ºæˆåŠŸ"),Y(!1),X.resetFields(),oe()}catch(t){v.error("åˆ›å»ºé€šçŸ¥æ¸ é“å¤±è´¥: "+t.message)}},$e=async t=>{try{await g.testNotificationChannel(t),v.success("æµ‹è¯•é€šçŸ¥å‘é€æˆåŠŸ")}catch(s){v.error("æµ‹è¯•é€šçŸ¥å¤±è´¥: "+s.message)}},Ee=[{title:"æ ‡é¢˜",dataIndex:"title",key:"title",ellipsis:!0},{title:"çº§åˆ«",dataIndex:"level",key:"level",width:80,render:t=>e.jsx(L,{color:g.getAlertLevelColor(t),children:g.getAlertLevelText(t)})},{title:"çŠ¶æ€",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(L,{color:g.getAlertStatusColor(t),icon:t==="active"?e.jsx(ne,{}):t==="acknowledged"?e.jsx(K,{}):e.jsx(re,{}),children:g.getAlertStatusText(t)})},{title:"æ¥æº",dataIndex:"source",key:"source",width:120,render:(t,s)=>e.jsxs("div",{children:[e.jsx("div",{children:t}),s.rule_name&&e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["è§„åˆ™: ",s.rule_name]})]})},{title:"è®¾å¤‡/é”®å€¼",key:"device_key",width:150,render:(t,s)=>e.jsxs("div",{children:[s.device_id&&e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["è®¾å¤‡: ",s.device_id]}),s.key&&e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["é”®: ",s.key]}),s.value&&e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["å€¼: ",JSON.stringify(s.value)]})]})},{title:"åˆ›å»ºæ—¶é—´",dataIndex:"createdAt",key:"createdAt",width:160,render:t=>{try{const s=t instanceof Date?t:new Date(t);return isNaN(s.getTime())?"æ— æ•ˆæ—¶é—´":s.toLocaleString("zh-CN")}catch{return"æ— æ•ˆæ—¶é—´"}}},{title:"æ“ä½œ",key:"actions",width:200,render:(t,s)=>e.jsxs(R,{size:"small",children:[s.status==="active"&&e.jsx(fe,{title:"ç¡®è®¤å‘Šè­¦",children:e.jsx(j,{size:"small",icon:e.jsx(K,{}),onClick:()=>Ae(s.id),children:"ç¡®è®¤"})}),(s.status==="active"||s.status==="acknowledged")&&e.jsx(fe,{title:"è§£å†³å‘Šè­¦",children:e.jsx(j,{size:"small",type:"primary",icon:e.jsx(re,{}),onClick:()=>ke(s.id),children:"è§£å†³"})}),e.jsx(Be,{title:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå‘Šè­¦å—ï¼Ÿ",onConfirm:()=>Ie(s.id),children:e.jsx(j,{size:"small",danger:!0,children:"åˆ é™¤"})})]})}],Le=[{title:"åç§°",dataIndex:"name",key:"name"},{title:"çº§åˆ«",dataIndex:"level",key:"level",width:80,render:t=>e.jsx(L,{color:g.getAlertLevelColor(t),children:g.getAlertLevelText(t)})},{title:"çŠ¶æ€",dataIndex:"enabled",key:"enabled",width:80,render:t=>e.jsx(I,{status:t?"success":"default",text:t?"å¯ç”¨":"ç¦ç”¨"})},{title:"æ¡ä»¶",key:"condition",render:(t,s)=>e.jsxs(me,{code:!0,children:[s.condition.field," ",s.condition.operator," ",s.condition.value]})},{title:"é€šçŸ¥æ¸ é“",dataIndex:"notificationChannels",key:"notificationChannels",render:t=>e.jsxs("span",{children:[t?.length||0," ä¸ªæ¸ é“"]})},{title:"æ“ä½œ",key:"actions",width:150,render:t=>e.jsxs(R,{size:"small",children:[e.jsx(j,{size:"small",children:"æµ‹è¯•"}),e.jsx(j,{size:"small",children:"ç¼–è¾‘"}),e.jsx(j,{size:"small",danger:!0,children:"åˆ é™¤"})]})}],De=[{title:"åç§°",dataIndex:"name",key:"name"},{title:"ç±»å‹",dataIndex:"type",key:"type",width:100,render:t=>{const s=je.find(Fe=>Fe.value===t);return e.jsxs("span",{children:[s?.icon," ",s?.label||t]})}},{title:"çŠ¶æ€",dataIndex:"enabled",key:"enabled",width:80,render:t=>e.jsx(I,{status:t?"success":"default",text:t?"å¯ç”¨":"ç¦ç”¨"})},{title:"åˆ›å»ºæ—¶é—´",dataIndex:"createdAt",key:"createdAt",width:160,render:t=>{try{const s=t instanceof Date?t:new Date(t);return isNaN(s.getTime())?"æ— æ•ˆæ—¶é—´":s.toLocaleString("zh-CN")}catch{return"æ— æ•ˆæ—¶é—´"}}},{title:"æ“ä½œ",key:"actions",width:150,render:(t,s)=>e.jsxs(R,{size:"small",children:[e.jsx(j,{size:"small",icon:e.jsx(N,{}),onClick:()=>$e(s.id),children:"æµ‹è¯•"}),e.jsx(j,{size:"small",children:"ç¼–è¾‘"}),e.jsx(j,{size:"small",danger:!0,children:"åˆ é™¤"})]})}],Ne=[{key:"alerts",label:e.jsxs("span",{children:[e.jsx(ie,{}),"å‘Šè­¦åˆ—è¡¨",U.filter(t=>t.status==="active").length>0&&e.jsx(I,{count:U.filter(t=>t.status==="active").length,style:{marginLeft:8}})]}),children:e.jsxs("div",{children:[e.jsx(Ue,{stats:ve,loading:Ce}),e.jsx(F,{size:"small",style:{marginBottom:16},children:e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:4,children:e.jsx(A,{placeholder:"å‘Šè­¦çº§åˆ«",allowClear:!0,value:r.level,onChange:t=>S({...r,level:t,page:1}),children:ae.map(t=>e.jsx(C,{value:t.value,children:e.jsx(L,{color:t.color,children:t.label})},t.value))})}),e.jsx(h,{span:4,children:e.jsx(A,{placeholder:"å‘Šè­¦çŠ¶æ€",allowClear:!0,value:r.status,onChange:t=>S({...r,status:t,page:1}),children:We.map(t=>e.jsx(C,{value:t.value,children:e.jsx(L,{color:t.color,children:t.label})},t.value))})}),e.jsx(h,{span:4,children:e.jsx(b,{placeholder:"æ¥æºç­›é€‰",allowClear:!0,value:r.source,onChange:t=>S({...r,source:t.target.value,page:1})})}),e.jsx(h,{span:6,children:e.jsx(b.Search,{placeholder:"æœç´¢å‘Šè­¦",allowClear:!0,value:r.search,onChange:t=>S({...r,search:t.target.value,page:1}),onSearch:()=>x()})}),e.jsx(h,{span:6,children:e.jsxs(R,{children:[e.jsx(j,{icon:e.jsx(ee,{}),onClick:x,loading:k,type:T?"primary":"default",children:T?"æ•°æ®è¿‡æœŸï¼Œç‚¹å‡»åˆ·æ–°":"åˆ·æ–°"}),e.jsx(j,{type:"primary",icon:e.jsx(te,{}),onClick:()=>W(!0),children:"æ‰‹åŠ¨åˆ›å»ºå‘Šè­¦"})]})})]})}),e.jsx(F,{children:e.jsx(le,{columns:Ee,dataSource:U,rowKey:"id",loading:d,pagination:{current:r.page,pageSize:r.pageSize,total:pe,onChange:(t,s)=>S({...r,page:t,pageSize:s}),showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,s)=>`ç¬¬ ${s[0]}-${s[1]} æ¡ï¼Œå…± ${t} æ¡`}})})]})},{key:"rules",label:e.jsxs("span",{children:[e.jsx(Oe,{}),"å‘Šè­¦è§„åˆ™"]}),children:e.jsxs(F,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(R,{children:[e.jsx(j,{icon:e.jsx(ee,{}),onClick:f,children:"åˆ·æ–°"}),e.jsx(j,{type:"primary",icon:e.jsx(te,{}),onClick:()=>Q(!0),children:"åˆ›å»ºè§„åˆ™"})]})}),e.jsx(le,{columns:Le,dataSource:ye,rowKey:"id",loading:d,pagination:{pageSize:10}})]})},{key:"channels",label:e.jsxs("span",{children:[e.jsx(N,{}),"é€šçŸ¥æ¸ é“"]}),children:e.jsxs(F,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(R,{children:[e.jsx(j,{icon:e.jsx(ee,{}),onClick:oe,children:"åˆ·æ–°"}),e.jsx(j,{type:"primary",icon:e.jsx(te,{}),onClick:()=>Y(!0),children:"åˆ›å»ºæ¸ é“"})]})}),e.jsx(le,{columns:De,dataSource:de,rowKey:"id",loading:d,pagination:{pageSize:10}})]})}];if(!n)return e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"åˆå§‹åŒ–ä¸­..."});if(!o)return e.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[e.jsx("p",{children:"è¯·å…ˆç™»å½•ç³»ç»Ÿ"}),e.jsx(j,{type:"primary",onClick:()=>window.location.href="/login",children:"å»ç™»å½•"})]});if(console.log("ğŸ¯ AlertsPage æ¸²æŸ“çŠ¶æ€:",{isInitialized:n,isAuthenticated:o,alertsLoading:k,hasAlertsData:!!w,alertsError:m?.message}),k&&!w&&!m)return console.log("â³ AlertsPage: æ˜¾ç¤ºåŠ è½½ä¸­çŠ¶æ€"),e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"åŠ è½½ä¸­..."});if(m&&!w){const t=m.message.includes("401")||m.message.includes("unauthorized")||m.message.includes("æœªæä¾›è®¤è¯ä»¤ç‰Œ");return e.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[e.jsxs("p",{children:["åŠ è½½å¤±è´¥: ",m.message]}),t?e.jsxs("div",{children:[e.jsx("p",{children:"è¯·å…ˆç™»å½•ç³»ç»Ÿ"}),e.jsx(j,{type:"primary",onClick:()=>window.location.href="/login",children:"å»ç™»å½•"})]}):e.jsx(j,{onClick:()=>window.location.reload(),children:"é‡æ–°åŠ è½½"})]})}return e.jsxs("div",{children:[e.jsx(Ke,{enabled:!0,position:"topRight"}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("h2",{children:"å‘Šè­¦ç®¡ç†"}),e.jsx(me,{type:"secondary",children:"ç®¡ç†ç³»ç»Ÿå‘Šè­¦ã€å‘Šè­¦è§„åˆ™å’Œé€šçŸ¥æ¸ é“"})]}),e.jsx(qe,{activeKey:l,onChange:c,items:Ne}),e.jsx(se,{title:"åˆ›å»ºå‘Šè­¦",open:we,onOk:Te,onCancel:()=>W(!1),width:600,children:e.jsxs(i,{form:Z,layout:"vertical",children:[e.jsx(i.Item,{name:"title",label:"å‘Šè­¦æ ‡é¢˜",rules:[{required:!0}],children:e.jsx(b,{placeholder:"è¯·è¾“å…¥å‘Šè­¦æ ‡é¢˜"})}),e.jsx(i.Item,{name:"description",label:"å‘Šè­¦æè¿°",rules:[{required:!0}],children:e.jsx(b.TextArea,{rows:3,placeholder:"è¯·è¾“å…¥å‘Šè­¦æè¿°"})}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(i.Item,{name:"level",label:"å‘Šè­¦çº§åˆ«",rules:[{required:!0}],children:e.jsx(A,{placeholder:"é€‰æ‹©å‘Šè­¦çº§åˆ«",children:ae.map(t=>e.jsx(C,{value:t.value,children:e.jsx(L,{color:t.color,children:t.label})},t.value))})})}),e.jsx(h,{span:12,children:e.jsx(i.Item,{name:"source",label:"å‘Šè­¦æ¥æº",children:e.jsx(b,{placeholder:"è¯·è¾“å…¥å‘Šè­¦æ¥æº"})})})]}),e.jsx(i.Item,{name:"data",label:"é™„åŠ æ•°æ®",children:e.jsx(b.TextArea,{rows:3,placeholder:"è¯·è¾“å…¥JSONæ ¼å¼çš„é™„åŠ æ•°æ®ï¼ˆå¯é€‰ï¼‰"})})]})}),e.jsx(se,{title:"åˆ›å»ºå‘Šè­¦è§„åˆ™",open:Se,onOk:ze,onCancel:()=>Q(!1),width:700,children:e.jsxs(i,{form:G,layout:"vertical",children:[e.jsx(i.Item,{name:"name",label:"è§„åˆ™åç§°",rules:[{required:!0}],children:e.jsx(b,{placeholder:"è¯·è¾“å…¥è§„åˆ™åç§°"})}),e.jsx(i.Item,{name:"description",label:"è§„åˆ™æè¿°",children:e.jsx(b.TextArea,{rows:2,placeholder:"è¯·è¾“å…¥è§„åˆ™æè¿°"})}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(i.Item,{name:"level",label:"å‘Šè­¦çº§åˆ«",rules:[{required:!0}],children:e.jsx(A,{placeholder:"é€‰æ‹©å‘Šè­¦çº§åˆ«",children:ae.map(t=>e.jsx(C,{value:t.value,children:e.jsx(L,{color:t.color,children:t.label})},t.value))})})}),e.jsx(h,{span:12,children:e.jsx(i.Item,{name:"enabled",label:"å¯ç”¨çŠ¶æ€",initialValue:!0,children:e.jsxs(A,{children:[e.jsx(C,{value:!0,children:"å¯ç”¨"}),e.jsx(C,{value:!1,children:"ç¦ç”¨"})]})})})]}),e.jsx(Ve,{children:"å‘Šè­¦æ¡ä»¶"}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:8,children:e.jsx(i.Item,{name:"field",label:"å­—æ®µå",rules:[{required:!0}],children:e.jsx(b,{placeholder:"å¦‚: temperature"})})}),e.jsx(h,{span:8,children:e.jsx(i.Item,{name:"operator",label:"æ“ä½œç¬¦",rules:[{required:!0}],children:e.jsxs(A,{placeholder:"é€‰æ‹©æ“ä½œç¬¦",children:[e.jsx(C,{value:"gt",children:"å¤§äº (>)"}),e.jsx(C,{value:"lt",children:"å°äº (<)"}),e.jsx(C,{value:"eq",children:"ç­‰äº (=)"}),e.jsx(C,{value:"gte",children:"å¤§äºç­‰äº (â‰¥)"}),e.jsx(C,{value:"lte",children:"å°äºç­‰äº (â‰¤)"})]})})}),e.jsx(h,{span:8,children:e.jsx(i.Item,{name:"value",label:"é˜ˆå€¼",rules:[{required:!0}],children:e.jsx(b,{placeholder:"å¦‚: 80"})})})]}),e.jsx(i.Item,{name:"notificationChannels",label:"é€šçŸ¥æ¸ é“",children:e.jsx(A,{mode:"multiple",placeholder:"é€‰æ‹©é€šçŸ¥æ¸ é“ï¼ˆå¯é€‰ï¼‰",children:de.map(t=>e.jsx(C,{value:t.id,children:t.name},t.id))})})]})}),e.jsx(se,{title:"åˆ›å»ºé€šçŸ¥æ¸ é“",open:be,onOk:Re,onCancel:()=>Y(!1),width:600,children:e.jsxs(i,{form:X,layout:"vertical",children:[e.jsx(i.Item,{name:"name",label:"æ¸ é“åç§°",rules:[{required:!0}],children:e.jsx(b,{placeholder:"è¯·è¾“å…¥æ¸ é“åç§°"})}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(i.Item,{name:"type",label:"æ¸ é“ç±»å‹",rules:[{required:!0}],children:e.jsx(A,{placeholder:"é€‰æ‹©æ¸ é“ç±»å‹",children:je.map(t=>e.jsxs(C,{value:t.value,children:[t.icon," ",t.label]},t.value))})})}),e.jsx(h,{span:12,children:e.jsx(i.Item,{name:"enabled",label:"å¯ç”¨çŠ¶æ€",initialValue:!0,children:e.jsxs(A,{children:[e.jsx(C,{value:!0,children:"å¯ç”¨"}),e.jsx(C,{value:!1,children:"ç¦ç”¨"})]})})})]}),e.jsx(i.Item,{name:"config",label:"æ¸ é“é…ç½®",rules:[{required:!0}],children:e.jsx(b.TextArea,{rows:6,placeholder:`è¯·è¾“å…¥JSONæ ¼å¼çš„æ¸ é“é…ç½®ï¼Œä¾‹å¦‚ï¼š
{
  "url": "https://hooks.slack.com/...",
  "channel": "#alerts"
}`})})]})})]})};export{et as AlertsPage};
