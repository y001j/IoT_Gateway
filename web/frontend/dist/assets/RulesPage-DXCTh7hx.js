import{c as ge,j as e}from"./index-BEjgWUn2.js";import{a6 as $t,l as P,af as ce,ag as lt,U as Vt,w as p,k as I,T as pe,y as g,D as st,Z as Ft,ah as Me,ai as _e,aj as se,ak as Jt,a as b,F as u,z as O,B as E,a5 as $e,aa as oe,al as Ce,I as B,s as Z,u as R,am as W,ae as Ee,N as he,a8 as Te,W as at,h as be,f as na,an as oa,g as ca,ao as da,a1 as ke,ap as qt,aq as Bt,p as me,ar as vt,as as rt,at as pa,au as ua,Y as xa,a9 as ha,V as Y,b as Ht,H as jt,av as dt,aw as kt,ax as de,$ as De,X as pt,ab as Ie,ay as Ve,az as ma,a7 as je,ac as ya,aA as ga,aB as ut,aC as zt,aD as va,ad as ja}from"./antd-BFy_CllK.js";import"./vendor-DavUf6mE.js";const ve={async getRules(h){return(await ge.get("/plugins/rules",{params:h,headers:{"Cache-Control":"no-cache",Pragma:"no-cache","If-Modified-Since":"0"}})).data.data},async getRule(h){return(await ge.get(`/plugins/rules/${h}`,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache","If-Modified-Since":"0"}})).data.data},async createRule(h){return(await ge.post("/plugins/rules",h)).data.data},async updateRule(h,v){return(await ge.put(`/plugins/rules/${h}`,v)).data.data},async deleteRule(h){await ge.delete(`/plugins/rules/${h}`)},async enableRule(h){await ge.post(`/plugins/rules/${h}/enable`)},async disableRule(h){await ge.post(`/plugins/rules/${h}/disable`)},async validateRule(h){return(await ge.post("/plugins/rules/validate",h)).data.data},async testRule(h){return(await ge.post("/plugins/rules/test",h)).data.data},async getRuleTemplates(){return(await ge.get("/plugins/rules/templates")).data.data}},{Title:ie,Text:Ae,Paragraph:xe}=pe,{Panel:Se}=lt,fa=({visible:h,onClose:v})=>{const M=[{type:"simple",name:"ç®€å•æ¡ä»¶",description:"åŸºäºå•ä¸ªå­—æ®µçš„æ¡ä»¶åˆ¤æ–­",example:{type:"simple",field:"temperature",operator:"gt",value:30}},{type:"and",name:"é€»è¾‘ä¸",description:"æ‰€æœ‰å­æ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³",example:{type:"and",and:[{type:"simple",field:"temperature",operator:"gt",value:20},{type:"simple",field:"humidity",operator:"lt",value:80}]}},{type:"or",name:"é€»è¾‘æˆ–",description:"ä»»æ„ä¸€ä¸ªå­æ¡ä»¶æ»¡è¶³å³å¯",example:{type:"or",or:[{type:"simple",field:"status",operator:"eq",value:"error"},{type:"simple",field:"status",operator:"eq",value:"warning"}]}},{type:"expression",name:"è¡¨è¾¾å¼",description:"ä½¿ç”¨å¢å¼ºè¡¨è¾¾å¼å¼•æ“è¿›è¡Œå¤æ‚åˆ¤æ–­ï¼Œæ”¯æŒæ•°å­¦å‡½æ•°å’Œå†…ç½®å‡½æ•°",example:{type:"expression",expression:'abs(value - 25) > 5 && contains(device_id, "sensor") && len(device_id) > 5'}}],c=[{op:"eq",name:"ç­‰äº",description:"å­—æ®µå€¼ç­‰äºæŒ‡å®šå€¼"},{op:"ne",name:"ä¸ç­‰äº",description:"å­—æ®µå€¼ä¸ç­‰äºæŒ‡å®šå€¼"},{op:"gt",name:"å¤§äº",description:"å­—æ®µå€¼å¤§äºæŒ‡å®šå€¼ï¼ˆæ•°å€¼æ¯”è¾ƒï¼‰"},{op:"gte",name:"å¤§äºç­‰äº",description:"å­—æ®µå€¼å¤§äºç­‰äºæŒ‡å®šå€¼"},{op:"lt",name:"å°äº",description:"å­—æ®µå€¼å°äºæŒ‡å®šå€¼"},{op:"lte",name:"å°äºç­‰äº",description:"å­—æ®µå€¼å°äºç­‰äºæŒ‡å®šå€¼"},{op:"contains",name:"åŒ…å«",description:"å­—æ®µå€¼åŒ…å«æŒ‡å®šå­å­—ç¬¦ä¸²"},{op:"startswith",name:"å¼€å§‹äº",description:"å­—æ®µå€¼ä»¥æŒ‡å®šå­—ç¬¦ä¸²å¼€å§‹"},{op:"endswith",name:"ç»“æŸäº",description:"å­—æ®µå€¼ä»¥æŒ‡å®šå­—ç¬¦ä¸²ç»“æŸ"},{op:"regex",name:"æ­£åˆ™åŒ¹é…",description:"å­—æ®µå€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ”¯æŒç¼“å­˜ï¼‰"},{op:"in",name:"åœ¨èŒƒå›´å†…",description:"å­—æ®µå€¼åœ¨æŒ‡å®šæ•°ç»„ä¸­"},{op:"exists",name:"å­—æ®µå­˜åœ¨",description:"æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨"}],C=[{type:"alert",name:"å‘Šè­¦",icon:e.jsx(Ft,{style:{color:"#ff4d4f"}}),description:"å‘é€å‘Šè­¦é€šçŸ¥",config:{level:"warning | error | info | critical",message:"å‘Šè­¦æ¶ˆæ¯æ¨¡æ¿ï¼Œæ”¯æŒå˜é‡ {{.DeviceID}}, {{.Key}}, {{.Value}}",channels:"é€šé“é…ç½®æ•°ç»„ï¼Œæ”¯æŒconsole, webhook, email, sms, nats",throttle:'é™æµæ—¶é—´ï¼Œå¦‚ "5m"'},example:{type:"alert",config:{level:"warning",message:"è®¾å¤‡{{.DeviceID}}æ¸©åº¦å¼‚å¸¸: {{.Value}}Â°C",channels:[{type:"console",enabled:!0},{type:"nats",enabled:!0,config:{subject:"iot.alerts.temperature"}}]}}},{type:"transform",name:"æ•°æ®è½¬æ¢",icon:e.jsx(Me,{style:{color:"#1890ff"}}),description:"å¢å¼ºçš„æ•°æ®è½¬æ¢å¤„ç†ï¼Œæ”¯æŒè¡¨è¾¾å¼è®¡ç®—å’ŒNATSå‘å¸ƒ",config:{type:"scale | offset | expression | unit_convert | lookup | format",parameters:"è½¬æ¢å‚æ•°é…ç½®",output_key:"è¾“å‡ºå­—æ®µå",publish_subject:"NATSå‘å¸ƒä¸»é¢˜ï¼ˆå¯é€‰ï¼‰",precision:"æ•°å€¼ç²¾åº¦"},example:{type:"transform",config:{type:"expression",parameters:{expression:"(value - 32) * 5 / 9"},output_key:"celsius_temp",output_type:"float",precision:2,publish_subject:"iot.data.converted"}}},{type:"filter",name:"æ•°æ®è¿‡æ»¤",icon:e.jsx(_e,{style:{color:"#722ed1"}}),description:"è¿‡æ»¤æˆ–ä¸¢å¼ƒæ•°æ®",config:{type:"range | dedup | rate_limit",drop_on_match:"åŒ¹é…æ—¶æ˜¯å¦ä¸¢å¼ƒæ•°æ®",pass_on_match:"åŒ¹é…æ—¶æ˜¯å¦é€šè¿‡æ•°æ®"},example:{type:"filter",config:{type:"range",min:0,max:100,drop_on_match:!1}}},{type:"aggregate",name:"æ•°æ®èšåˆ",icon:e.jsx(se,{style:{color:"#52c41a"}}),description:"å¯¹æ•°æ®è¿›è¡Œèšåˆè®¡ç®—",config:{window_type:"time | count",window_size:"çª—å£å¤§å°",functions:"èšåˆå‡½æ•°ï¼Œæ”¯æŒ28ä¸ªå‡½æ•°ï¼šåŸºç¡€ç»Ÿè®¡(count,sum,avg,min,max)ã€ç™¾åˆ†ä½æ•°(p25,p50,p75,p90,p95,p99)ã€æ•°æ®è´¨é‡(null_rate,completeness)ã€å˜åŒ–æ£€æµ‹(change,change_rate)ã€é˜ˆå€¼ç›‘æ§(above_count,below_count)ç­‰",group_by:"åˆ†ç»„å­—æ®µ",output_key:"è¾“å‡ºå­—æ®µå",upper_limit:"ä¸Šé™é˜ˆå€¼ï¼ˆç”¨äºé˜ˆå€¼ç›‘æ§å‡½æ•°ï¼‰",lower_limit:"ä¸‹é™é˜ˆå€¼ï¼ˆç”¨äºé˜ˆå€¼ç›‘æ§å‡½æ•°ï¼‰",outlier_threshold:"å¼‚å¸¸å€¼é˜ˆå€¼ï¼ˆç”¨äºoutlier_countå‡½æ•°ï¼‰"},example:{type:"aggregate",config:{window_type:"count",window_size:10,functions:["avg","max","min","p90","null_rate"],group_by:["device_id"],output_key:"aggregated_value",upper_limit:100,lower_limit:0,forward:!0}}},{type:"forward",name:"æ•°æ®è½¬å‘",icon:e.jsx(Jt,{style:{color:"#fa8c16"}}),description:"ç®€åŒ–çš„NATSæ•°æ®è½¬å‘ï¼Œä¸“æ³¨äºæ¶ˆæ¯æ€»çº¿è½¬å‘",config:{subject:"NATSä¸»é¢˜ï¼Œæ”¯æŒå˜é‡æ¨¡æ¿",include_metadata:"æ˜¯å¦åŒ…å«å…ƒæ•°æ®",transform_data:"æ•°æ®è½¬æ¢é…ç½®"},example:{type:"forward",config:{subject:"iot.data.processed.{{.DeviceID}}",include_metadata:!0,transform_data:{add_timestamp:!0,add_rule_info:!0}}}}],V=[{field:"device_id",description:"è®¾å¤‡IDæ ‡è¯†ç¬¦"},{field:"key",description:"æ•°æ®ç‚¹é”®åï¼Œå¦‚ temperature, humidity"},{field:"value",description:"æ•°æ®ç‚¹æ•°å€¼"},{field:"timestamp",description:"æ•°æ®æ—¶é—´æˆ³"},{field:"tags",description:"è®¾å¤‡æ ‡ç­¾ä¿¡æ¯"},{field:"quality",description:"æ•°æ®è´¨é‡æ ‡è¯†"},{field:"unit",description:"æ•°æ®å•ä½"},{field:"latitude",description:"çº¬åº¦ (-90 ~ 90)"},{field:"longitude",description:"ç»åº¦ (-180 ~ 180)"},{field:"altitude",description:"æµ·æ‹”é«˜åº¦ (ç±³)"},{field:"accuracy",description:"GPSå®šä½ç²¾åº¦ (ç±³)"},{field:"speed",description:"ç§»åŠ¨é€Ÿåº¦ (km/h)"},{field:"heading",description:"æ–¹å‘è§’ (åº¦)"},{field:"elevation_category",description:"æµ·æ‹”ç­‰çº§åˆ†ç±»"},{field:"speed_category",description:"é€Ÿåº¦ç­‰çº§åˆ†ç±»"},{field:"x",description:"Xè½´æ•°å€¼"},{field:"y",description:"Yè½´æ•°å€¼"},{field:"z",description:"Zè½´æ•°å€¼"},{field:"magnitude",description:"å‘é‡æ¨¡é•¿/å¹…åº¦"},{field:"x_ratio",description:"Xè½´æ¯”ä¾‹åˆ†é‡"},{field:"y_ratio",description:"Yè½´æ¯”ä¾‹åˆ†é‡"},{field:"z_ratio",description:"Zè½´æ¯”ä¾‹åˆ†é‡"},{field:"dominant_axis",description:"ä¸»å¯¼è½´ (x/y/z)"},{field:"r",description:"çº¢è‰²åˆ†é‡ (0-255)"},{field:"g",description:"ç»¿è‰²åˆ†é‡ (0-255)"},{field:"b",description:"è“è‰²åˆ†é‡ (0-255)"},{field:"a",description:"é€æ˜åº¦ (0-255)"},{field:"hue",description:"è‰²ç›¸ (0-360åº¦)"},{field:"saturation",description:"é¥±å’Œåº¦ (0-1)"},{field:"lightness",description:"äº®åº¦ (0-1)"},{field:"dimension",description:"å‘é‡ç»´åº¦"},{field:"size",description:"æ•°ç»„å¤§å°"},{field:"length",description:"æ•°æ®é•¿åº¦"},{field:"rows",description:"çŸ©é˜µè¡Œæ•°"},{field:"cols",description:"çŸ©é˜µåˆ—æ•°"},{field:"norm",description:"å‘é‡èŒƒæ•°/æ¨¡é•¿"},{field:"dominant_dimension",description:"ä¸»å¯¼ç»´åº¦ç´¢å¼•"},{field:"data_type",description:"å…ƒç´ æ•°æ®ç±»å‹"},{field:"numeric_count",description:"æ•°å€¼å…ƒç´ æ•°é‡"},{field:"null_count",description:"ç©ºå€¼æ•°é‡"},{field:"duration",description:"æ—¶é—´åºåˆ—æ€»æ—¶é•¿"},{field:"avg_interval",description:"å¹³å‡é‡‡æ ·é—´éš”"},{field:"trend",description:"è¶‹åŠ¿æ–¹å‘ (increasing/decreasing/stable)"},{field:"trend_slope",description:"è¶‹åŠ¿æ–œç‡"}];return e.jsxs($t,{title:"è§„åˆ™é…ç½®å¸®åŠ©",width:800,open:h,onClose:v,styles:{body:{padding:24}},children:[e.jsx(P,{message:"å¢å¼ºè§„åˆ™å¼•æ“è¯´æ˜",description:"è§„åˆ™å¼•æ“ç”¨äºå®æ—¶å¤„ç†IoTæ•°æ®æµï¼Œæ”¯æŒå¤æ‚æ¡ä»¶åŒ¹é…å’Œå¤šç§åŠ¨ä½œæ‰§è¡Œã€‚åŒ…å«è¡¨è¾¾å¼å¼•æ“ã€æ­£åˆ™ç¼“å­˜ã€å¢å¼ºè½¬æ¢åŠ¨ä½œå’Œè§„åˆ™æ‰§è¡Œäº‹ä»¶å‘å¸ƒç­‰åŠŸèƒ½ã€‚",type:"info",icon:e.jsx(ce,{}),style:{marginBottom:24}}),e.jsxs(lt,{defaultActiveKey:["1"],size:"large",children:[e.jsx(Se,{header:"ğŸ“‹ å¸¸ç”¨æ•°æ®å­—æ®µ",children:e.jsx(Vt,{dataSource:V,columns:[{title:"å­—æ®µå",dataIndex:"field",key:"field",width:120},{title:"è¯´æ˜",dataIndex:"description",key:"description"}],pagination:!1,size:"small"})},"1"),e.jsx(Se,{header:"ğŸ¯ æ¡ä»¶ç±»å‹é…ç½®",children:e.jsx(p,{direction:"vertical",size:"large",style:{width:"100%"},children:M.map(m=>e.jsxs(I,{size:"small",children:[e.jsxs(ie,{level:5,children:[e.jsx(g,{color:"blue",children:m.type}),m.name]}),e.jsx(xe,{children:m.description}),e.jsx(Ae,{strong:!0,children:"ç¤ºä¾‹é…ç½®ï¼š"}),e.jsx("pre",{style:{background:"#f5f5f5",padding:12,borderRadius:4,marginTop:8,fontSize:12},children:JSON.stringify(m.example,null,2)})]},m.type))})},"2"),e.jsx(Se,{header:"âš–ï¸ æ¯”è¾ƒæ“ä½œç¬¦",children:e.jsx(p,{wrap:!0,children:c.map(m=>e.jsxs(I,{size:"small",style:{width:200,marginBottom:8},children:[e.jsx(g,{color:"geekblue",children:m.op}),e.jsx(Ae,{strong:!0,children:m.name}),e.jsx("br",{}),e.jsx(Ae,{type:"secondary",style:{fontSize:12},children:m.description})]},m.op))})},"3"),e.jsxs(Se,{header:"ğŸ”— å¤åˆæ•°æ®æ ¼å¼æ”¯æŒ",children:[e.jsx(P,{message:"IoT Gateway å¤åˆæ•°æ®æ ¼å¼å…¨é¢æ”¯æŒ",description:"ç³»ç»Ÿç°å·²æ”¯æŒ7ç§å¤åˆæ•°æ®æ ¼å¼ï¼Œè‡ªåŠ¨è§£æå¹¶æå–è¡ç”Ÿå­—æ®µï¼Œå¯ç›´æ¥åœ¨è§„åˆ™æ¡ä»¶ä¸­ä½¿ç”¨",type:"success",style:{marginBottom:16}}),e.jsxs(p,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:"ğŸ“ GPS/åœ°ç†ä½ç½®æ•°æ® (location)"}),e.jsx(xe,{type:"secondary",children:"åŒ…å«çº¬åº¦ã€ç»åº¦ã€æµ·æ‹”ã€ç²¾åº¦ã€é€Ÿåº¦ã€æ–¹å‘è§’ç­‰å­—æ®µï¼Œè‡ªåŠ¨è®¡ç®—æµ·æ‹”ç­‰çº§å’Œé€Ÿåº¦ç­‰çº§"}),e.jsxs(p,{wrap:!0,children:[e.jsx(g,{color:"blue",children:"latitude"}),e.jsx(g,{color:"blue",children:"longitude"}),e.jsx(g,{color:"blue",children:"altitude"}),e.jsx(g,{color:"blue",children:"accuracy"}),e.jsx(g,{color:"blue",children:"speed"}),e.jsx(g,{color:"blue",children:"heading"}),e.jsx(g,{color:"cyan",children:"elevation_category"}),e.jsx(g,{color:"cyan",children:"speed_category"})]}),e.jsx("pre",{style:{background:"#f5f5f5",padding:8,borderRadius:4,fontSize:11,marginTop:8},children:"ç¤ºä¾‹è§„åˆ™: latitude > 39.9 && longitude > 116.3 && speed > 60"})]}),e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:"ğŸ“ ä¸‰è½´å‘é‡æ•°æ® (vector3d)"}),e.jsx(xe,{type:"secondary",children:"é€‚ç”¨äºåŠ é€Ÿåº¦è®¡ã€é™€èºä»ªã€ç£åŠ›è®¡ç­‰ä¼ æ„Ÿå™¨ï¼Œè‡ªåŠ¨è®¡ç®—æ¨¡é•¿å’Œä¸»å¯¼è½´"}),e.jsxs(p,{wrap:!0,children:[e.jsx(g,{color:"purple",children:"x"}),e.jsx(g,{color:"purple",children:"y"}),e.jsx(g,{color:"purple",children:"z"}),e.jsx(g,{color:"orange",children:"magnitude"}),e.jsx(g,{color:"orange",children:"dominant_axis"}),e.jsx(g,{color:"geekblue",children:"x_ratio"}),e.jsx(g,{color:"geekblue",children:"y_ratio"}),e.jsx(g,{color:"geekblue",children:"z_ratio"})]}),e.jsx("pre",{style:{background:"#f5f5f5",padding:8,borderRadius:4,fontSize:11,marginTop:8},children:'ç¤ºä¾‹è§„åˆ™: magnitude > 10.0 && dominant_axis == "z"'})]}),e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:"ğŸ¨ é¢œè‰²æ•°æ® (color)"}),e.jsx(xe,{type:"secondary",children:"RGBé¢œè‰²æ•°æ®ï¼Œè‡ªåŠ¨è®¡ç®—HSLè‰²å½©ç©ºé—´çš„è‰²ç›¸ã€é¥±å’Œåº¦ã€äº®åº¦"}),e.jsxs(p,{wrap:!0,children:[e.jsx(g,{color:"red",children:"r"}),e.jsx(g,{color:"green",children:"g"}),e.jsx(g,{color:"blue",children:"b"}),e.jsx(g,{color:"gray",children:"a"}),e.jsx(g,{color:"magenta",children:"hue"}),e.jsx(g,{color:"orange",children:"saturation"}),e.jsx(g,{color:"gold",children:"lightness"})]}),e.jsx("pre",{style:{background:"#f5f5f5",padding:8,borderRadius:4,fontSize:11,marginTop:8},children:"ç¤ºä¾‹è§„åˆ™: hue >= 120 && hue <= 240 && saturation > 0.5"})]}),e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:"ğŸ”¢ å‘é‡/æ•°ç»„/çŸ©é˜µæ•°æ®"}),e.jsx(xe,{type:"secondary",children:"æ”¯æŒé€šç”¨å‘é‡ã€æ•°ç»„ã€çŸ©é˜µå’Œæ—¶é—´åºåˆ—æ•°æ®ï¼Œè‡ªåŠ¨è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡å’Œç»“æ„ç‰¹å¾"}),e.jsxs(p,{wrap:!0,children:[e.jsx(g,{color:"volcano",children:"dimension"}),e.jsx(g,{color:"volcano",children:"size"}),e.jsx(g,{color:"volcano",children:"length"}),e.jsx(g,{color:"lime",children:"norm"}),e.jsx(g,{color:"lime",children:"dominant_dimension"}),e.jsx(g,{color:"cyan",children:"numeric_count"}),e.jsx(g,{color:"cyan",children:"null_count"}),e.jsx(g,{color:"purple",children:"trend"}),e.jsx(g,{color:"purple",children:"trend_slope"})]}),e.jsx("pre",{style:{background:"#f5f5f5",padding:8,borderRadius:4,fontSize:11,marginTop:8},children:'ç¤ºä¾‹è§„åˆ™: dimension > 3 && norm > 1.0 && trend == "increasing"'})]}),e.jsx(P,{message:"ä½¿ç”¨æç¤º",description:e.jsxs("ul",{style:{margin:0,paddingLeft:20},children:[e.jsx("li",{children:"å¤åˆæ•°æ®å­—æ®µå¯ç›´æ¥åœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œæ— éœ€ç‰¹æ®Šè¯­æ³•"}),e.jsx("li",{children:"ç³»ç»Ÿè‡ªåŠ¨è§£æå¤åˆæ•°æ®å¹¶æå–æ‰€æœ‰å¯ç”¨çš„è¡ç”Ÿå­—æ®µ"}),e.jsx("li",{children:"æ”¯æŒä¸ä¼ ç»Ÿæ•°æ®å­—æ®µæ··åˆä½¿ç”¨ï¼Œå¦‚ temperature > 30 && magnitude > 10"}),e.jsx("li",{children:"èšåˆå‡½æ•°åŒæ ·æ”¯æŒå¤åˆæ•°æ®å­—æ®µçš„ç»Ÿè®¡åˆ†æ"})]}),type:"info",style:{marginTop:16}})]})]},"4"),e.jsxs(Se,{header:"ğŸ“Š èšåˆå‡½æ•°è¯¦è§£",children:[e.jsx(P,{message:"28ä¸ªèšåˆå‡½æ•°å®Œæ•´æ”¯æŒ",description:"è§„åˆ™å¼•æ“ç°å·²æ”¯æŒ28ä¸ªèšåˆå‡½æ•°ï¼Œæ¶µç›–åŸºç¡€ç»Ÿè®¡ã€ç™¾åˆ†ä½æ•°ã€æ•°æ®è´¨é‡ã€å˜åŒ–æ£€æµ‹å’Œé˜ˆå€¼ç›‘æ§ç­‰å„ä¸ªæ–¹é¢",type:"success",style:{marginBottom:16}}),e.jsxs(p,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:"ğŸ“Š åŸºç¡€ç»Ÿè®¡å‡½æ•° (10ä¸ª)"}),e.jsxs(p,{wrap:!0,children:[e.jsx(g,{color:"blue",children:"count"}),e.jsx(g,{color:"blue",children:"sum"}),e.jsx(g,{color:"blue",children:"avg/mean/average"}),e.jsx(g,{color:"blue",children:"min"}),e.jsx(g,{color:"blue",children:"max"}),e.jsx(g,{color:"blue",children:"median"}),e.jsx(g,{color:"blue",children:"first"}),e.jsx(g,{color:"blue",children:"last"}),e.jsx(g,{color:"blue",children:"stddev/std"}),e.jsx(g,{color:"blue",children:"variance"})]}),e.jsx(xe,{type:"secondary",style:{marginTop:8},children:"æ—¥å¸¸ç»Ÿè®¡åˆ†æçš„æ ¸å¿ƒå‡½æ•°ï¼ŒåŒ…æ‹¬è®¡æ•°ã€æ±‚å’Œã€å¹³å‡å€¼ã€æå€¼ã€ä¸­ä½æ•°å’Œç¦»æ•£åº¦æŒ‡æ ‡"})]}),e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:"ğŸ“ˆ åˆ†å¸ƒç»Ÿè®¡å‡½æ•° (2ä¸ª)"}),e.jsxs(p,{wrap:!0,children:[e.jsx(g,{color:"geekblue",children:"volatility"}),e.jsx(g,{color:"geekblue",children:"cv"})]}),e.jsx(xe,{type:"secondary",style:{marginTop:8},children:"é«˜çº§ç»Ÿè®¡æŒ‡æ ‡ï¼švolatilityï¼ˆæ³¢åŠ¨ç‡ï¼‰= å˜å¼‚ç³»æ•°Ã—100ï¼Œcvï¼ˆå˜å¼‚ç³»æ•°ï¼‰= æ ‡å‡†å·®/å‡å€¼"})]}),e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:"ğŸ“Š ç™¾åˆ†ä½æ•°å‡½æ•° (6ä¸ª)"}),e.jsxs(p,{wrap:!0,children:[e.jsx(g,{color:"cyan",children:"p25"}),e.jsx(g,{color:"cyan",children:"p50"}),e.jsx(g,{color:"cyan",children:"p75"}),e.jsx(g,{color:"cyan",children:"p90"}),e.jsx(g,{color:"cyan",children:"p95"}),e.jsx(g,{color:"cyan",children:"p99"})]}),e.jsx(xe,{type:"secondary",style:{marginTop:8},children:"æ€§èƒ½ç›‘æ§å…³é”®æŒ‡æ ‡ï¼Œç”¨äºå»¶è¿Ÿã€å“åº”æ—¶é—´ç­‰åˆ†å¸ƒåˆ†æã€‚p90/p95/p99å¸¸ç”¨äºSLAç›‘æ§"})]}),e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:"ğŸ” æ•°æ®è´¨é‡å‡½æ•° (3ä¸ª)"}),e.jsxs(p,{wrap:!0,children:[e.jsx(g,{color:"orange",children:"null_rate"}),e.jsx(g,{color:"orange",children:"completeness"}),e.jsx(g,{color:"orange",children:"outlier_count"})]}),e.jsx(xe,{type:"secondary",style:{marginTop:8},children:"æ•°æ®å¥åº·åº¦æŒ‡æ ‡ï¼šnull_rateï¼ˆç©ºå€¼æ¯”ä¾‹ï¼‰ã€completenessï¼ˆå®Œæ•´æ€§=1-null_rateï¼‰ã€outlier_countï¼ˆå¼‚å¸¸å€¼æ•°é‡ï¼Œéœ€é…ç½®outlier_thresholdï¼‰"})]}),e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:"ğŸ“‰ å˜åŒ–æ£€æµ‹å‡½æ•° (2ä¸ª)"}),e.jsxs(p,{wrap:!0,children:[e.jsx(g,{color:"purple",children:"change"}),e.jsx(g,{color:"purple",children:"change_rate"})]}),e.jsx(xe,{type:"secondary",style:{marginTop:8},children:"è¶‹åŠ¿åˆ†æï¼šchangeï¼ˆç»å¯¹å˜åŒ–é‡ï¼‰= æœ€æ–°å€¼-ç¬¬ä¸€ä¸ªå€¼ï¼Œchange_rateï¼ˆå˜åŒ–ç‡ï¼‰= change/ç¬¬ä¸€ä¸ªå€¼Ã—100%"})]}),e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:"âš¡ é˜ˆå€¼ç›‘æ§å‡½æ•° (3ä¸ª)"}),e.jsxs(p,{wrap:!0,children:[e.jsx(g,{color:"red",children:"above_count"}),e.jsx(g,{color:"red",children:"below_count"}),e.jsx(g,{color:"red",children:"in_range_count"})]}),e.jsx(xe,{type:"secondary",style:{marginTop:8},children:"é˜ˆå€¼ç›‘æ§ï¼šéœ€é…ç½®upper_limitå’Œ/æˆ–lower_limitå‚æ•°ã€‚ç”¨äºç»Ÿè®¡è¶…æ ‡æ•°æ®ç‚¹æ•°é‡"})]}),e.jsx(P,{message:"ä½¿ç”¨æç¤º",description:e.jsxs("ul",{style:{margin:0,paddingLeft:20},children:[e.jsx("li",{children:"æ”¯æŒå¤šé€‰ï¼šå¯åŒæ—¶é€‰æ‹©å¤šä¸ªå‡½æ•°è¿›è¡Œå¹¶è¡Œè®¡ç®—"}),e.jsx("li",{children:"æœç´¢åŠŸèƒ½ï¼šåœ¨é€‰æ‹©å™¨ä¸­è¾“å…¥å…³é”®è¯å¿«é€ŸæŸ¥æ‰¾å‡½æ•°"}),e.jsx("li",{children:"å‚æ•°é…ç½®ï¼šé˜ˆå€¼ç›‘æ§å‡½æ•°éœ€è¦é…ç½®ç›¸åº”çš„é˜ˆå€¼å‚æ•°"}),e.jsx("li",{children:"æ€§èƒ½ä¼˜åŒ–ï¼šå†…ç½®å¢é‡ç»Ÿè®¡ç®—æ³•ï¼Œæ”¯æŒæ»‘åŠ¨çª—å£å’Œç´¯ç§¯æ¨¡å¼"})]}),type:"info",style:{marginTop:16}})]})]},"5"),e.jsx(Se,{header:"âš¡ åŠ¨ä½œç±»å‹é…ç½®",children:e.jsx(p,{direction:"vertical",size:"large",style:{width:"100%"},children:C.map(m=>e.jsxs(I,{size:"small",children:[e.jsx(ie,{level:5,children:e.jsxs(p,{children:[m.icon,e.jsx(g,{color:"green",children:m.type}),m.name]})}),e.jsx(xe,{children:m.description}),e.jsx(st,{size:"small"}),e.jsx(Ae,{strong:!0,children:"é…ç½®å‚æ•°ï¼š"}),e.jsx("ul",{style:{marginTop:8,marginBottom:12},children:Object.entries(m.config).map(([S,G])=>e.jsxs("li",{children:[e.jsx(Ae,{code:!0,children:S}),": ",G]},S))}),e.jsx(Ae,{strong:!0,children:"ç¤ºä¾‹é…ç½®ï¼š"}),e.jsx("pre",{style:{background:"#f5f5f5",padding:12,borderRadius:4,marginTop:8,fontSize:12},children:JSON.stringify(m.example,null,2)})]},m.type))})},"6"),e.jsx(Se,{header:"ğŸ’¡ é…ç½®æŠ€å·§",children:e.jsxs(p,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsx(P,{message:"ä¼˜å…ˆçº§è®¾ç½®",description:"æ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚å»ºè®®ï¼šç´§æ€¥å‘Šè­¦ 100+ï¼Œé‡è¦å¤„ç† 50-99ï¼Œä¸€èˆ¬å¤„ç† 1-49",type:"info"}),e.jsx(P,{message:"å˜é‡ä½¿ç”¨",description:"åœ¨å‘Šè­¦æ¶ˆæ¯ä¸­å¯ä»¥ä½¿ç”¨ {{.DeviceID}}, {{.Key}}, {{.Value}} ç­‰å˜é‡",type:"info"}),e.jsx(P,{message:"è¡¨è¾¾å¼å¼•æ“",description:"æ”¯æŒæ•°å­¦å‡½æ•°ï¼šabs(), max(), min(), sqrt()ï¼›å­—ç¬¦ä¸²å‡½æ•°ï¼šlen(), contains(), startsWith()ï¼›æ—¶é—´å‡½æ•°ï¼šnow(), timeFormat()",type:"info"}),e.jsx(P,{message:"æ€§èƒ½ä¼˜åŒ–",description:"æ­£åˆ™è¡¨è¾¾å¼è‡ªåŠ¨ç¼“å­˜ï¼Œå­—ç¬¦ä¸²æ“ä½œå·²ä¼˜åŒ–ï¼Œé¿å…è¿‡äºå¤æ‚çš„è¡¨è¾¾å¼ä»¥ä¿è¯æ€§èƒ½",type:"warning"}),e.jsx(P,{message:"è§„åˆ™äº‹ä»¶",description:"è§„åˆ™æ‰§è¡Œä¼šè‡ªåŠ¨å‘å¸ƒåˆ° iot.rules.* ä¸»é¢˜ï¼ŒåŒ…å«è¯„ä¼°ç»“æœã€æ‰§è¡Œæ—¶é—´ç­‰ä¿¡æ¯",type:"success"}),e.jsx(P,{message:"æµ‹è¯•å»ºè®®",description:"åˆ›å»ºè§„åˆ™åå»ºè®®å…ˆç¦ç”¨çŠ¶æ€ä¸‹æµ‹è¯•ï¼Œç¡®è®¤æ— è¯¯åå†å¯ç”¨",type:"success"})]})},"7"),e.jsxs(Se,{header:"ğŸ“ å®Œæ•´ç¤ºä¾‹",children:[e.jsxs(I,{style:{marginBottom:16},children:[e.jsx(ie,{level:5,children:"å¤åˆæ•°æ®ç¤ºä¾‹ï¼šGPSä½ç½®ç›‘æ§"}),e.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,fontSize:12,lineHeight:1.5},children:`{
  "name": "è½¦è¾†ä½ç½®å’Œé€Ÿåº¦ç›‘æ§",
  "description": "ç›‘æ§è½¦è¾†GPSä½ç½®ã€é€Ÿåº¦å’ŒåŒºåŸŸé™åˆ¶",
  "priority": 90,
  "enabled": true,
  "conditions": {
    "type": "expression",
    "expression": "(latitude > 39.9 && longitude > 116.3) && (speed > 80 || altitude < 0)"
  },
  "actions": [
    {
      "type": "alert",
      "config": {
        "level": "warning",
        "message": "è½¦è¾†{{.DeviceID}}ä½ç½®å¼‚å¸¸: çº¬åº¦{{.latitude}}, ç»åº¦{{.longitude}}, é€Ÿåº¦{{.speed}}km/h",
        "channels": ["console", "webhook"],
        "throttle": "2m"
      }
    },
    {
      "type": "aggregate",
      "config": {
        "window_size": 20,
        "functions": ["avg", "max", "p90"],
        "group_by": ["device_id"],
        "output_key": "location_stats"
      }
    }
  ]
}`})]}),e.jsxs(I,{style:{marginBottom:16},children:[e.jsx(ie,{level:5,children:"èšåˆå‡½æ•°ç¤ºä¾‹ï¼šä¼ æ„Ÿå™¨æ€§èƒ½ç›‘æ§"}),e.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,fontSize:12,lineHeight:1.5},children:`{
  "name": "ä¼ æ„Ÿå™¨æ€§èƒ½ç›‘æ§",
  "description": "ç›‘æ§ä¼ æ„Ÿå™¨æ•°æ®è´¨é‡å’Œæ€§èƒ½æŒ‡æ ‡",
  "priority": 80,
  "enabled": true,
  "conditions": {
    "type": "simple",
    "field": "key",
    "operator": "eq",
    "value": "temperature"
  },
  "actions": [
    {
      "type": "aggregate",
      "config": {
        "window_type": "count",
        "window_size": 20,
        "functions": ["avg", "min", "max", "p90", "p95", "null_rate", "change_rate", "above_count"],
        "group_by": ["device_id"],
        "output_key": "sensor_stats",
        "upper_limit": 50,
        "lower_limit": 10,
        "outlier_threshold": 2.0,
        "forward": true
      }
    }
  ]
}`})]}),e.jsxs(I,{children:[e.jsx(ie,{level:5,children:"å¢å¼ºè§„åˆ™ç¤ºä¾‹ï¼šæ™ºèƒ½æ¸©åº¦ç›‘æ§"}),e.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,fontSize:12,lineHeight:1.5},children:`{
  "name": "æ™ºèƒ½æ¸©åº¦ç›‘æ§ä¸è½¬æ¢",
  "description": "ç›‘æ§æ¸©åº¦ï¼Œä½¿ç”¨è¡¨è¾¾å¼æ¡ä»¶åˆ¤æ–­ï¼Œè½¬æ¢å•ä½å¹¶å‘å¸ƒ",
  "priority": 100,
  "enabled": true,
  "conditions": {
    "type": "expression",
    "expression": "key == \\"temperature\\" && abs(value - 25) > 10 && contains(device_id, \\"sensor\\")"
  },
  "actions": [
    {
      "type": "alert",
      "config": {
        "level": "warning",
        "message": "è®¾å¤‡{{.DeviceID}}æ¸©åº¦å¼‚å¸¸: {{.Value}}Â°C",
        "channels": [
          { "type": "console", "enabled": true },
          { 
            "type": "nats", 
            "enabled": true, 
            "config": { "subject": "iot.alerts.temperature" }
          }
        ]
      }
    },
    {
      "type": "transform",
      "config": {
        "type": "expression",
        "parameters": {
          "expression": "(value - 32) * 5 / 9"
        },
        "output_key": "celsius_temp",
        "output_type": "float",
        "precision": 2,
        "publish_subject": "iot.data.converted"
      }
    },
    {
      "type": "forward",
      "config": {
        "subject": "iot.data.processed.{{.DeviceID}}",
        "include_metadata": true,
        "transform_data": {
          "add_timestamp": true,
          "add_rule_info": true
        }
      }
    }
  ]
}`})]})]},"8")]})]})},{Option:T}=O,{TextArea:It}=B,ba=({value:h,onChange:v})=>{const M=b.useRef(),c=b.useRef({conditionType:"simple",simpleCondition:{field:"",operator:"eq",value:""},andConditions:[],orConditions:[],expression:""}),C=[{value:"eq",label:"ç­‰äº (=)",description:"å­—æ®µå€¼ç­‰äºæŒ‡å®šå€¼"},{value:"ne",label:"ä¸ç­‰äº (â‰ )",description:"å­—æ®µå€¼ä¸ç­‰äºæŒ‡å®šå€¼"},{value:"gt",label:"å¤§äº (>)",description:"å­—æ®µå€¼å¤§äºæŒ‡å®šå€¼"},{value:"gte",label:"å¤§äºç­‰äº (â‰¥)",description:"å­—æ®µå€¼å¤§äºç­‰äºæŒ‡å®šå€¼"},{value:"lt",label:"å°äº (<)",description:"å­—æ®µå€¼å°äºæŒ‡å®šå€¼"},{value:"lte",label:"å°äºç­‰äº (â‰¤)",description:"å­—æ®µå€¼å°äºç­‰äºæŒ‡å®šå€¼"},{value:"contains",label:"åŒ…å«",description:"å­—ç¬¦ä¸²åŒ…å«å­å­—ç¬¦ä¸²"},{value:"regex",label:"æ­£åˆ™åŒ¹é…",description:"æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"},{value:"in",label:"åœ¨æ•°ç»„ä¸­",description:"å€¼åœ¨æŒ‡å®šæ•°ç»„ä¸­"},{value:"exists",label:"å­—æ®µå­˜åœ¨",description:"æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨"}],V=b.useCallback((t,l)=>{if(t===l)return!0;if(!t||!l)return t===l;if(typeof t!=typeof l)return!1;if(typeof t!="object")return t===l;const r=Object.keys(t),n=Object.keys(l);if(r.length!==n.length)return!1;for(let i of r)if(!n.includes(i)||!V(t[i],l[i]))return!1;return!0},[]),m=b.useMemo(()=>{if(!h){const t={conditionType:"simple",simpleCondition:{field:"",operator:"eq",value:""},andConditions:[],orConditions:[],expression:""};return M.current=void 0,c.current=t,t}if(!V(h,M.current)){let t;return h.type==="simple"?t={conditionType:"simple",simpleCondition:{field:h.field||"",operator:h.operator||"eq",value:h.value||""},andConditions:[],orConditions:[],expression:""}:h.type==="and"&&h.and?t={conditionType:"and",simpleCondition:{field:"",operator:"eq",value:""},andConditions:h.and.map(l=>l.type==="simple"?{type:"simple",field:l.field||"",operator:l.operator||"eq",value:l.value||""}:l.type==="expression"?{type:"expression",expression:l.expression||""}:{type:"simple",field:"",operator:"eq",value:""}),orConditions:[],expression:""}:h.type==="or"&&h.or?t={conditionType:"or",simpleCondition:{field:"",operator:"eq",value:""},andConditions:[],orConditions:h.or.map(l=>l.type==="simple"?{type:"simple",field:l.field||"",operator:l.operator||"eq",value:l.value||""}:l.type==="expression"?{type:"expression",expression:l.expression||""}:{type:"simple",field:"",operator:"eq",value:""}),expression:""}:h.type==="expression"?t={conditionType:"expression",simpleCondition:{field:"",operator:"eq",value:""},andConditions:[],orConditions:[],expression:h.expression||""}:t={conditionType:"simple",simpleCondition:{field:"",operator:"eq",value:""},andConditions:[],orConditions:[],expression:""},M.current=JSON.parse(JSON.stringify(h)),c.current=t,t}return c.current},[h,V]),S=b.useCallback(t=>{let l;return t.conditionType==="simple"?l={type:"simple",field:t.simpleCondition.field,operator:t.simpleCondition.operator,value:t.simpleCondition.value}:t.conditionType==="and"?l={type:"and",and:t.andConditions.map(r=>r.type==="expression"?{type:"expression",expression:r.expression}:{type:"simple",field:r.field,operator:r.operator,value:r.value})}:t.conditionType==="or"?l={type:"or",or:t.orConditions.map(r=>r.type==="expression"?{type:"expression",expression:r.expression}:{type:"simple",field:r.field,operator:r.operator,value:r.value})}:t.conditionType==="expression"?l={type:"expression",expression:t.expression}:l={type:"simple",field:"",operator:"eq",value:""},l},[]),G=b.useCallback(t=>{if(m.conditionType!==t){const l={...m};l.conditionType=t,t==="and"&&l.andConditions.length===0?l.andConditions=[{type:"simple",field:"",operator:"eq",value:""},{type:"simple",field:"",operator:"eq",value:""}]:t==="or"&&l.orConditions.length===0&&(l.orConditions=[{type:"simple",field:"",operator:"eq",value:""},{type:"simple",field:"",operator:"eq",value:""}]),c.current=l;const r=S(l);v?.(r)}},[m,S,v]),J=(t,l,r=0)=>e.jsxs(Z,{gutter:8,children:[e.jsx(R,{span:7,children:e.jsxs(O,{placeholder:"é€‰æ‹©å­—æ®µ",value:t.field,onChange:n=>{l.length===3?l(r,"field",n):l("field",n)},style:{width:"100%"},showSearch:!0,allowClear:!0,children:[e.jsxs(O.OptGroup,{label:"ğŸ“Š åŸºç¡€æ•°æ®å­—æ®µ",children:[e.jsx(T,{value:"device_id",children:"è®¾å¤‡ID"},"device_id"),e.jsx(T,{value:"key",children:"æ•°æ®é”®"},"key"),e.jsx(T,{value:"value",children:"æ•°æ®å€¼"},"value"),e.jsx(T,{value:"timestamp",children:"æ—¶é—´æˆ³"},"timestamp"),e.jsx(T,{value:"quality",children:"è´¨é‡ç "},"quality"),e.jsx(T,{value:"unit",children:"å•ä½"},"unit")]}),e.jsxs(O.OptGroup,{label:"ğŸŒ¡ï¸ ä¼ æ„Ÿå™¨æ•°æ®",children:[e.jsx(T,{value:"temperature",children:"æ¸©åº¦"},"temperature"),e.jsx(T,{value:"humidity",children:"æ¹¿åº¦"},"humidity"),e.jsx(T,{value:"pressure",children:"å‹åŠ›"},"pressure"),e.jsx(T,{value:"status",children:"çŠ¶æ€"},"status")]}),e.jsxs(O.OptGroup,{label:"ğŸ“ GPSä½ç½®æ•°æ®",children:[e.jsx(T,{value:"latitude",children:"çº¬åº¦"},"latitude"),e.jsx(T,{value:"longitude",children:"ç»åº¦"},"longitude"),e.jsx(T,{value:"altitude",children:"æµ·æ‹”"},"altitude"),e.jsx(T,{value:"accuracy",children:"GPSç²¾åº¦"},"accuracy"),e.jsx(T,{value:"speed",children:"ç§»åŠ¨é€Ÿåº¦"},"speed"),e.jsx(T,{value:"heading",children:"æ–¹å‘è§’"},"heading"),e.jsx(T,{value:"elevation_category",children:"æµ·æ‹”ç­‰çº§"},"elevation_category"),e.jsx(T,{value:"speed_category",children:"é€Ÿåº¦ç­‰çº§"},"speed_category")]}),e.jsxs(O.OptGroup,{label:"ğŸ“ ä¸‰è½´å‘é‡æ•°æ®",children:[e.jsx(T,{value:"x",children:"Xè½´æ•°å€¼"},"x"),e.jsx(T,{value:"y",children:"Yè½´æ•°å€¼"},"y"),e.jsx(T,{value:"z",children:"Zè½´æ•°å€¼"},"z"),e.jsx(T,{value:"magnitude",children:"å‘é‡æ¨¡é•¿"},"magnitude"),e.jsx(T,{value:"x_ratio",children:"Xè½´æ¯”ä¾‹"},"x_ratio"),e.jsx(T,{value:"y_ratio",children:"Yè½´æ¯”ä¾‹"},"y_ratio"),e.jsx(T,{value:"z_ratio",children:"Zè½´æ¯”ä¾‹"},"z_ratio"),e.jsx(T,{value:"dominant_axis",children:"ä¸»å¯¼è½´"},"dominant_axis")]}),e.jsxs(O.OptGroup,{label:"ğŸ¨ é¢œè‰²æ•°æ®",children:[e.jsx(T,{value:"r",children:"çº¢è‰²åˆ†é‡"},"r"),e.jsx(T,{value:"g",children:"ç»¿è‰²åˆ†é‡"},"g"),e.jsx(T,{value:"b",children:"è“è‰²åˆ†é‡"},"b"),e.jsx(T,{value:"a",children:"é€æ˜åº¦"},"a"),e.jsx(T,{value:"hue",children:"è‰²ç›¸"},"hue"),e.jsx(T,{value:"saturation",children:"é¥±å’Œåº¦"},"saturation"),e.jsx(T,{value:"lightness",children:"äº®åº¦"},"lightness")]}),e.jsxs(O.OptGroup,{label:"ğŸ”¢ å‘é‡/æ•°ç»„/çŸ©é˜µ",children:[e.jsx(T,{value:"dimension",children:"ç»´åº¦"},"dimension"),e.jsx(T,{value:"size",children:"å¤§å°"},"size"),e.jsx(T,{value:"length",children:"é•¿åº¦"},"length"),e.jsx(T,{value:"rows",children:"è¡Œæ•°"},"rows"),e.jsx(T,{value:"cols",children:"åˆ—æ•°"},"cols"),e.jsx(T,{value:"norm",children:"èŒƒæ•°"},"norm"),e.jsx(T,{value:"dominant_dimension",children:"ä¸»å¯¼ç»´åº¦"},"dominant_dimension"),e.jsx(T,{value:"data_type",children:"æ•°æ®ç±»å‹"},"data_type"),e.jsx(T,{value:"numeric_count",children:"æ•°å€¼æ•°é‡"},"numeric_count"),e.jsx(T,{value:"null_count",children:"ç©ºå€¼æ•°é‡"},"null_count")]}),e.jsxs(O.OptGroup,{label:"ğŸ“ˆ æ—¶é—´åºåˆ—",children:[e.jsx(T,{value:"duration",children:"æ€»æ—¶é•¿"},"duration"),e.jsx(T,{value:"avg_interval",children:"å¹³å‡é—´éš”"},"avg_interval"),e.jsx(T,{value:"trend",children:"è¶‹åŠ¿"},"trend"),e.jsx(T,{value:"trend_slope",children:"è¶‹åŠ¿æ–œç‡"},"trend_slope")]})]})}),e.jsx(R,{span:6,children:e.jsx(O,{value:t.operator,onChange:n=>{l.length===3?l(r,"operator",n):l("operator",n)},style:{width:"100%"},children:C.map(n=>e.jsx(T,{value:n.value,title:n.description,children:n.label},n.value))})}),e.jsx(R,{span:8,children:["exists"].includes(t.operator)?e.jsx(B,{disabled:!0,placeholder:"æ— éœ€å¡«å†™"}):["in"].includes(t.operator)?e.jsx(O,{mode:"tags",placeholder:"è¾“å…¥å¤šä¸ªå€¼",value:Array.isArray(t.value)?t.value:[],onChange:n=>{l.length===3?l(r,"value",n):l("value",n)},style:{width:"100%"}}):["gt","gte","lt","lte"].includes(t.operator)?e.jsx(W,{placeholder:"æ•°å€¼",value:t.value,onChange:n=>{l.length===3?l(r,"value",n):l("value",n)},style:{width:"100%"}}):e.jsx(B,{placeholder:"æ¯”è¾ƒå€¼",value:t.value,onChange:n=>{l.length===3?l(r,"value",n.target.value):l("value",n.target.value)}})})]},r),D=(t,l,r,n)=>e.jsxs("div",{style:{border:"1px solid #d9d9d9",padding:12,borderRadius:6,marginBottom:8},children:[e.jsxs(Z,{gutter:8,style:{marginBottom:8},children:[e.jsx(R,{span:6,children:e.jsxs(O,{placeholder:"æ¡ä»¶ç±»å‹",value:t.type,onChange:i=>l(r,"type",i),style:{width:"100%"},children:[e.jsx(T,{value:"simple",children:e.jsxs(p,{children:[e.jsx(g,{color:"blue",size:"small",children:"ç®€å•"}),"å­—æ®µæ¡ä»¶"]})},"simple"),e.jsx(T,{value:"expression",children:e.jsxs(p,{children:[e.jsx(g,{color:"purple",size:"small",children:"è¡¨è¾¾å¼"}),"è‡ªå®šä¹‰è¡¨è¾¾å¼"]})},"expression")]})}),e.jsx(R,{span:15,children:t.type==="simple"?e.jsxs(Z,{gutter:4,children:[e.jsx(R,{span:8,children:e.jsxs(O,{placeholder:"é€‰æ‹©å­—æ®µ",value:t.field,onChange:i=>l(r,"field",i),style:{width:"100%"},showSearch:!0,allowClear:!0,children:[e.jsxs(O.OptGroup,{label:"ğŸ“Š åŸºç¡€æ•°æ®å­—æ®µ",children:[e.jsx(T,{value:"device_id",children:"è®¾å¤‡ID"},"device_id"),e.jsx(T,{value:"key",children:"æ•°æ®é”®"},"key"),e.jsx(T,{value:"value",children:"æ•°æ®å€¼"},"value"),e.jsx(T,{value:"timestamp",children:"æ—¶é—´æˆ³"},"timestamp"),e.jsx(T,{value:"quality",children:"è´¨é‡ç "},"quality"),e.jsx(T,{value:"unit",children:"å•ä½"},"unit")]}),e.jsxs(O.OptGroup,{label:"ğŸŒ¡ï¸ ä¼ æ„Ÿå™¨æ•°æ®",children:[e.jsx(T,{value:"temperature",children:"æ¸©åº¦"},"temperature"),e.jsx(T,{value:"humidity",children:"æ¹¿åº¦"},"humidity"),e.jsx(T,{value:"pressure",children:"å‹åŠ›"},"pressure"),e.jsx(T,{value:"status",children:"çŠ¶æ€"},"status")]}),e.jsxs(O.OptGroup,{label:"ğŸ“ GPSä½ç½®æ•°æ®",children:[e.jsx(T,{value:"latitude",children:"çº¬åº¦"},"latitude"),e.jsx(T,{value:"longitude",children:"ç»åº¦"},"longitude"),e.jsx(T,{value:"altitude",children:"æµ·æ‹”"},"altitude"),e.jsx(T,{value:"speed",children:"ç§»åŠ¨é€Ÿåº¦"},"speed"),e.jsx(T,{value:"heading",children:"æ–¹å‘è§’"},"heading")]}),e.jsxs(O.OptGroup,{label:"ğŸ“ ä¸‰è½´å‘é‡æ•°æ®",children:[e.jsx(T,{value:"x",children:"Xè½´æ•°å€¼"},"x"),e.jsx(T,{value:"y",children:"Yè½´æ•°å€¼"},"y"),e.jsx(T,{value:"z",children:"Zè½´æ•°å€¼"},"z"),e.jsx(T,{value:"magnitude",children:"å‘é‡æ¨¡é•¿"},"magnitude"),e.jsx(T,{value:"dominant_axis",children:"ä¸»å¯¼è½´"},"dominant_axis")]}),e.jsxs(O.OptGroup,{label:"ğŸ¨ é¢œè‰²æ•°æ®",children:[e.jsx(T,{value:"r",children:"çº¢è‰²åˆ†é‡"},"r"),e.jsx(T,{value:"g",children:"ç»¿è‰²åˆ†é‡"},"g"),e.jsx(T,{value:"b",children:"è“è‰²åˆ†é‡"},"b"),e.jsx(T,{value:"hue",children:"è‰²ç›¸"},"hue")]})]})}),e.jsx(R,{span:6,children:e.jsx(O,{value:t.operator,onChange:i=>l(r,"operator",i),style:{width:"100%"},children:C.map(i=>e.jsx(T,{value:i.value,title:i.description,children:i.label},i.value))})}),e.jsx(R,{span:10,children:["exists"].includes(t.operator||"")?e.jsx(B,{disabled:!0,placeholder:"æ— éœ€å¡«å†™"}):["in"].includes(t.operator||"")?e.jsx(O,{mode:"tags",placeholder:"è¾“å…¥å¤šä¸ªå€¼",value:Array.isArray(t.value)?t.value:[],onChange:i=>l(r,"value",i),style:{width:"100%"}}):["gt","gte","lt","lte"].includes(t.operator||"")?e.jsx(W,{placeholder:"æ•°å€¼",value:t.value,onChange:i=>l(r,"value",i),style:{width:"100%"}}):e.jsx(B,{placeholder:"æ¯”è¾ƒå€¼",value:t.value,onChange:i=>l(r,"value",i.target.value)})})]}):e.jsx(It,{rows:2,placeholder:"ä¾‹å¦‚: temperature > 30 && magnitude > 10.0 || hue between 120,240",value:t.expression,onChange:i=>l(r,"expression",i.target.value)})}),e.jsx(R,{span:3,children:n&&e.jsx(E,{type:"text",danger:!0,icon:e.jsx(Ee,{}),onClick:n})})]}),t.type==="expression"&&e.jsx("div",{style:{fontSize:12,color:"#666"},children:"æ”¯æŒçš„è¿ç®—ç¬¦ï¼š&& (ä¸”), || (æˆ–), ! (é), ==, !=, >, >=, <, <="})]},r),_=b.useCallback((t,l)=>{const r={...m};r.simpleCondition={...r.simpleCondition,[t]:l},c.current=r;const n=S(r);v?.(n)},[m,S,v]),k=b.useCallback((t,l,r)=>{const n={...m};n.andConditions=[...n.andConditions],l==="type"?r==="expression"?n.andConditions[t]={type:"expression",expression:""}:n.andConditions[t]={type:"simple",field:"",operator:"eq",value:""}:n.andConditions[t]={...n.andConditions[t],[l]:r},c.current=n;const i=S(n);v?.(i)},[m,S,v]),q=b.useCallback((t,l,r)=>{const n={...m};n.orConditions=[...n.orConditions],l==="type"?r==="expression"?n.orConditions[t]={type:"expression",expression:""}:n.orConditions[t]={type:"simple",field:"",operator:"eq",value:""}:n.orConditions[t]={...n.orConditions[t],[l]:r},c.current=n;const i=S(n);v?.(i)},[m,S,v]),X=b.useCallback(t=>{const l={...m};l.expression=t,c.current=l;const r=S(l);v?.(r)},[m,S,v]),N=b.useCallback(()=>{const t={...m};t.andConditions=[...t.andConditions,{type:"simple",field:"",operator:"eq",value:""}],c.current=t;const l=S(t);v?.(l)},[m,S,v]),$=b.useCallback(t=>{const l={...m};l.andConditions=l.andConditions.filter((n,i)=>i!==t),c.current=l;const r=S(l);v?.(r)},[m,S,v]),L=b.useCallback(()=>{const t={...m};t.orConditions=[...t.orConditions,{type:"simple",field:"",operator:"eq",value:""}],c.current=t;const l=S(t);v?.(l)},[m,S,v]),s=b.useCallback(t=>{const l={...m};l.orConditions=l.orConditions.filter((n,i)=>i!==t),c.current=l;const r=S(l);v?.(r)},[m,S,v]);return e.jsx(I,{title:"è§¦å‘æ¡ä»¶é…ç½®",size:"small",children:e.jsxs("div",{children:[e.jsx(u.Item,{label:"æ¡ä»¶ç±»å‹",children:e.jsxs(O,{value:m.conditionType,onChange:G,children:[e.jsx(T,{value:"simple",children:e.jsxs(p,{children:[e.jsx(g,{color:"blue",children:"ç®€å•"}),"å•ä¸ªå­—æ®µæ¡ä»¶"]})},"simple"),e.jsx(T,{value:"and",children:e.jsxs(p,{children:[e.jsx(g,{color:"green",children:"é€»è¾‘ä¸"}),"æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³"]})},"and"),e.jsx(T,{value:"or",children:e.jsxs(p,{children:[e.jsx(g,{color:"orange",children:"é€»è¾‘æˆ–"}),"ä»»ä¸€æ¡ä»¶æ»¡è¶³"]})},"or"),e.jsx(T,{value:"expression",children:e.jsxs(p,{children:[e.jsx(g,{color:"purple",children:"è¡¨è¾¾å¼"}),"è‡ªå®šä¹‰è¡¨è¾¾å¼"]})},"expression")]})}),m.conditionType==="simple"&&e.jsx(u.Item,{label:"æ¡ä»¶è®¾ç½®",children:J(m.simpleCondition,_,0)}),m.conditionType==="and"&&e.jsx(u.Item,{label:e.jsxs(p,{children:["é€»è¾‘ä¸æ¡ä»¶",e.jsx(oe,{title:"æ‰€æœ‰æ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³æ‰ä¼šè§¦å‘è§„åˆ™",children:e.jsx(Ce,{})})]}),children:e.jsxs(p,{direction:"vertical",style:{width:"100%"},children:[m.andConditions.map((t,l)=>e.jsxs("div",{children:[l>0&&e.jsx("div",{style:{textAlign:"center",margin:"8px 0"},children:e.jsx(g,{color:"green",children:"ä¸”"})}),D(t,k,l,l>1?()=>$(l):void 0)]},l)),e.jsx(E,{type:"dashed",icon:e.jsx($e,{}),onClick:N,style:{width:"100%"},children:"æ·»åŠ æ¡ä»¶"})]})}),m.conditionType==="or"&&e.jsx(u.Item,{label:e.jsxs(p,{children:["é€»è¾‘æˆ–æ¡ä»¶",e.jsx(oe,{title:"ä»»æ„ä¸€ä¸ªæ¡ä»¶æ»¡è¶³å°±ä¼šè§¦å‘è§„åˆ™",children:e.jsx(Ce,{})})]}),children:e.jsxs(p,{direction:"vertical",style:{width:"100%"},children:[m.orConditions.map((t,l)=>e.jsxs("div",{children:[l>0&&e.jsx("div",{style:{textAlign:"center",margin:"8px 0"},children:e.jsx(g,{color:"orange",children:"æˆ–"})}),D(t,q,l,l>1?()=>s(l):void 0)]},l)),e.jsx(E,{type:"dashed",icon:e.jsx($e,{}),onClick:L,style:{width:"100%"},children:"æ·»åŠ æ¡ä»¶"})]})}),m.conditionType==="expression"&&e.jsxs(u.Item,{label:e.jsxs(p,{children:["è¡¨è¾¾å¼æ¡ä»¶",e.jsx(oe,{title:"ä½¿ç”¨è¡¨è¾¾å¼è¯­è¨€ç¼–å†™å¤æ‚æ¡ä»¶ï¼Œå¦‚: temperature > 30 && humidity < 60",children:e.jsx(Ce,{})})]}),children:[e.jsx(It,{rows:3,placeholder:"ä¾‹å¦‚: temperature > 30 && magnitude > 10.0 || hue between 120,240",value:m.expression,onChange:t=>X(t.target.value)}),e.jsx("div",{style:{marginTop:8,fontSize:12,color:"#666"},children:"æ”¯æŒçš„è¿ç®—ç¬¦ï¼š&& (ä¸”), || (æˆ–), ! (é), ==, !=, >, >=, <, <="})]})]})})},{Option:w}=O,{TextArea:Qe}=B,{Text:_a}=pe,wa=({value:h,onChange:v})=>{const M=b.useRef(),c=b.useRef([]),C=b.useCallback((s,t)=>{if(s===t)return!0;if(!s||!t)return s===t;if(typeof s!=typeof t)return!1;if(typeof s!="object")return s===t;const l=Object.keys(s),r=Object.keys(t);if(l.length!==r.length)return!1;for(let n of l)if(!r.includes(n)||!C(s[n],t[n]))return!1;return!0},[]),V=b.useMemo(()=>{if(!h||h.length===0){const s=[{type:"alert",config:{},async:!1,timeout:"30s",retry:0}];return M.current=[],c.current=s,s}if(!C(h,M.current)){const s=h.map((t,l)=>{const r=JSON.parse(JSON.stringify(t.config||{}));return{type:t.type,config:r,async:t.async,timeout:t.timeout,retry:t.retry}});return M.current=JSON.parse(JSON.stringify(h)),c.current=s,s}return c.current},[h,C]),m=[{value:"alert",label:"å‘Šè­¦é€šçŸ¥",icon:e.jsx(Ft,{style:{color:"#ff4d4f"}}),description:"å‘é€å‘Šè­¦æ¶ˆæ¯"},{value:"transform",label:"æ•°æ®è½¬æ¢",icon:e.jsx(Me,{style:{color:"#1890ff"}}),description:"è½¬æ¢æ•°æ®æ ¼å¼æˆ–å€¼"},{value:"filter",label:"æ•°æ®è¿‡æ»¤",icon:e.jsx(_e,{style:{color:"#722ed1"}}),description:"è¿‡æ»¤æˆ–ä¸¢å¼ƒæ•°æ®"},{value:"aggregate",label:"æ•°æ®èšåˆ",icon:e.jsx(se,{style:{color:"#52c41a"}}),description:"èšåˆè®¡ç®—ç»Ÿè®¡å€¼"},{value:"forward",label:"æ•°æ®è½¬å‘",icon:e.jsx(Jt,{style:{color:"#fa8c16"}}),description:"è½¬å‘åˆ°å¤–éƒ¨ç³»ç»Ÿ"}],S=b.useCallback(s=>s.map(t=>({type:t.type,config:t.config,async:t.async||!1,timeout:t.timeout||"30s",retry:t.retry||0})),[]),G=b.useCallback(()=>{const s=[...V,{type:"alert",config:{},async:!1,timeout:"30s",retry:0}];c.current=s;const t=S(s);v?.(t)},[V,v,S]),J=b.useCallback(s=>{const t=V.filter((r,n)=>n!==s);c.current=t;const l=S(t);v?.(l)},[V,v,S]),D=b.useCallback((s,t,l)=>{const r=[...V];r[s]={...r[s],[t]:l},c.current=r;const n=S(r);v?.(n)},[V,v,S]),_=b.useCallback((s,t,l)=>{const r=[...V];r[s]={...r[s],config:{...r[s].config,[t]:l}},c.current=r;const n=S(r);v?.(n)},[V,v,S]),k=(s,t)=>{let l=[];return s.config.channels&&Array.isArray(s.config.channels)&&(l=s.config.channels.map(r=>typeof r=="string"?r:typeof r=="object"&&r.type?r.type:r)),e.jsxs("div",{children:[e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"å‘Šè­¦çº§åˆ«",children:e.jsxs(O,{value:s.config.level||"warning",onChange:r=>_(t,"level",r),children:[e.jsx(w,{value:"info",children:"ä¿¡æ¯"},"info"),e.jsx(w,{value:"warning",children:"è­¦å‘Š"},"warning"),e.jsx(w,{value:"error",children:"é”™è¯¯"},"error"),e.jsx(w,{value:"critical",children:"ä¸¥é‡"},"critical")]})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"é™æµæ—¶é—´",children:e.jsx(B,{placeholder:"å¦‚ 5m, 1h",value:s.config.throttle||"",onChange:r=>_(t,"throttle",r.target.value)})})})]}),e.jsx(u.Item,{label:"å‘Šè­¦æ¶ˆæ¯",children:e.jsx(Qe,{rows:2,placeholder:"æ”¯æŒå˜é‡: {{.DeviceID}}, {{.Key}}, {{.Value}}",value:s.config.message||"",onChange:r=>_(t,"message",r.target.value)})}),e.jsx(u.Item,{label:"é€šçŸ¥æ¸ é“",children:e.jsxs(O,{mode:"multiple",placeholder:"é€‰æ‹©é€šçŸ¥æ¸ é“",value:l,onChange:r=>_(t,"channels",r),children:[e.jsx(w,{value:"console",children:"æ§åˆ¶å°"},"console"),e.jsx(w,{value:"webhook",children:"Webhook"},"webhook"),e.jsx(w,{value:"email",children:"é‚®ä»¶"},"email"),e.jsx(w,{value:"sms",children:"çŸ­ä¿¡"},"sms")]})})]})},q=(s,t)=>{const l=s.config.type||"scale";let r=s.config.parameters||{};!r.expression&&s.config.expression&&(r={...r,expression:s.config.expression}),!r.factor&&s.config.factor!==void 0&&(r={...r,factor:s.config.factor}),!r.offset&&s.config.offset!==void 0&&(r={...r,offset:s.config.offset});const n=(x,j)=>{const H={...r,[x]:j};_(t,"parameters",H)},i=()=>{switch(l){case"scale":return e.jsxs(u.Item,{label:"ç¼©æ”¾å› å­",children:[e.jsx(W,{placeholder:"ä¹˜æ•°ï¼Œå¦‚ 2.0",value:r.factor,onChange:x=>n("factor",x),style:{width:"100%"},step:.1}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"å°†åŸå§‹å€¼ä¹˜ä»¥æ­¤å› å­"})]});case"offset":return e.jsxs(u.Item,{label:"åç§»é‡",children:[e.jsx(W,{placeholder:"åç§»å€¼ï¼Œå¦‚ 32",value:r.offset,onChange:x=>n("offset",x),style:{width:"100%"},step:.1}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"å°†åŸå§‹å€¼åŠ ä¸Šæ­¤åç§»é‡"})]});case"expression":return e.jsxs(u.Item,{label:"è¡¨è¾¾å¼",children:[e.jsx(B,{placeholder:"æ•°å­¦è¡¨è¾¾å¼ï¼Œå¦‚ x * 1.8 + 32",value:r.expression,onChange:x=>n("expression",x.target.value)}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"ä½¿ç”¨ x è¡¨ç¤ºåŸå§‹å€¼ï¼Œæ”¯æŒ +ã€-ã€*ã€/ã€()ã€å‡½æ•°è°ƒç”¨å¦‚ abs(x)ã€sqrt(x)"})]});case"unit_convert":return e.jsx(e.Fragment,{children:e.jsxs(Z,{gutter:8,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"æºå•ä½",children:e.jsxs(O,{placeholder:"é€‰æ‹©æºå•ä½",value:r.from,onChange:x=>n("from",x),style:{width:"100%"},children:[e.jsx(w,{value:"C",children:"æ‘„æ°åº¦ (Â°C)"},"from-C"),e.jsx(w,{value:"F",children:"åæ°åº¦ (Â°F)"},"from-F"),e.jsx(w,{value:"K",children:"å¼€å°”æ–‡ (K)"},"from-K"),e.jsx(w,{value:"m",children:"ç±³ (m)"},"from-m"),e.jsx(w,{value:"ft",children:"è‹±å°º (ft)"},"from-ft"),e.jsx(w,{value:"kg",children:"åƒå…‹ (kg)"},"from-kg"),e.jsx(w,{value:"lb",children:"ç£… (lb)"},"from-lb")]})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"ç›®æ ‡å•ä½",children:e.jsxs(O,{placeholder:"é€‰æ‹©ç›®æ ‡å•ä½",value:r.to,onChange:x=>n("to",x),style:{width:"100%"},children:[e.jsx(w,{value:"C",children:"æ‘„æ°åº¦ (Â°C)"},"to-C"),e.jsx(w,{value:"F",children:"åæ°åº¦ (Â°F)"},"to-F"),e.jsx(w,{value:"K",children:"å¼€å°”æ–‡ (K)"},"to-K"),e.jsx(w,{value:"m",children:"ç±³ (m)"},"to-m"),e.jsx(w,{value:"ft",children:"è‹±å°º (ft)"},"to-ft"),e.jsx(w,{value:"kg",children:"åƒå…‹ (kg)"},"to-kg"),e.jsx(w,{value:"lb",children:"ç£… (lb)"},"to-lb")]})})})]})});case"lookup":return e.jsxs(e.Fragment,{children:[e.jsx(u.Item,{label:"æŸ¥æ‰¾è¡¨",children:e.jsx(Qe,{rows:4,placeholder:'JSONæ ¼å¼çš„æ˜ å°„è¡¨ï¼Œå¦‚: {"0": "æ­£å¸¸", "1": "è­¦å‘Š", "2": "é”™è¯¯"}',value:r.table?JSON.stringify(r.table,null,2):"",onChange:x=>{try{const j=JSON.parse(x.target.value||"{}");n("table",j)}catch{}}})}),e.jsx(u.Item,{label:"é»˜è®¤å€¼",children:e.jsx(B,{placeholder:"æœªæ‰¾åˆ°æ˜ å°„æ—¶çš„é»˜è®¤å€¼",value:r.default,onChange:x=>n("default",x.target.value)})})]});case"round":return e.jsx(u.Item,{label:"å°æ•°ä½æ•°",children:e.jsx(W,{placeholder:"ä¿ç•™çš„å°æ•°ä½æ•°",value:r.decimals||0,onChange:x=>n("decimals",x),min:0,max:10,style:{width:"100%"}})});case"clamp":return e.jsxs(Z,{gutter:8,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"æœ€å°å€¼",children:e.jsx(W,{placeholder:"æ•°å€¼ä¸‹é™",value:r.min,onChange:x=>n("min",x),style:{width:"100%"}})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"æœ€å¤§å€¼",children:e.jsx(W,{placeholder:"æ•°å€¼ä¸Šé™",value:r.max,onChange:x=>n("max",x),style:{width:"100%"}})})})]});case"format":return e.jsxs(u.Item,{label:"æ ¼å¼å­—ç¬¦ä¸²",children:[e.jsx(B,{placeholder:"æ ¼å¼åŒ–æ¨¡æ¿ï¼Œå¦‚ %.2f",value:r.format,onChange:x=>n("format",x.target.value)}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"ä½¿ç”¨ Go è¯­è¨€æ ¼å¼åŒ–è¯­æ³•"})]});case"map":return e.jsx(u.Item,{label:"æ˜ å°„è¡¨",children:e.jsx(Qe,{rows:4,placeholder:'JSONæ ¼å¼çš„æ˜ å°„è¡¨ï¼Œå¦‚: {"high": 1, "low": 0}',value:r.mapping?JSON.stringify(r.mapping,null,2):"",onChange:x=>{try{const j=JSON.parse(x.target.value||"{}");n("mapping",j)}catch{}}})});default:return null}};return e.jsxs("div",{children:[e.jsx(u.Item,{label:"è½¬æ¢ç±»å‹",children:e.jsxs(O,{placeholder:"é€‰æ‹©è½¬æ¢ç±»å‹",value:l,onChange:x=>_(t,"type",x),style:{width:"100%"},children:[e.jsx(w,{value:"scale",children:"æ•°å€¼ç¼©æ”¾"},"scale"),e.jsx(w,{value:"offset",children:"æ•°å€¼åç§»"},"offset"),e.jsx(w,{value:"expression",children:"è¡¨è¾¾å¼è®¡ç®—"},"expression"),e.jsx(w,{value:"unit_convert",children:"å•ä½è½¬æ¢"},"unit_convert"),e.jsx(w,{value:"lookup",children:"æŸ¥æ‰¾è¡¨æ˜ å°„"},"lookup"),e.jsx(w,{value:"round",children:"å››èˆäº”å…¥"},"round"),e.jsx(w,{value:"clamp",children:"æ•°å€¼é™å¹…"},"clamp"),e.jsx(w,{value:"format",children:"æ ¼å¼åŒ–"},"format"),e.jsx(w,{value:"map",children:"å€¼æ˜ å°„"},"map")]})}),i(),e.jsxs(u.Item,{label:e.jsxs(p,{children:["è¾“å‡ºå­—æ®µå",e.jsx(oe,{title:"ä¸è®¾ç½®æ—¶å°†ç›´æ¥è¦†ç›–åŸå§‹å­—æ®µçš„å€¼ï¼ŒåŸå§‹æ•°æ®å°†ä¸¢å¤±ã€‚å»ºè®®è®¾ç½®æ–°çš„å­—æ®µåä»¥ä¿ç•™åŸå§‹æ•°æ®ã€‚",children:e.jsx(Ce,{style:{color:"#1890ff"}})})]}),children:[e.jsx(B,{placeholder:"è½¬æ¢åçš„å­—æ®µåï¼Œå¦‚ temperature_fahrenheitï¼ˆæ¨èè®¾ç½®ï¼‰",value:s.config.output_key||"",onChange:x=>_(t,"output_key",x.target.value)}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:s.config.output_key?"âœ… å°†åˆ›å»ºæ–°å­—æ®µï¼ŒåŸå§‹æ•°æ®ä¿ç•™":"âš ï¸ ç•™ç©ºå°†ç›´æ¥è¦†ç›–åŸå§‹å­—æ®µçš„å€¼ï¼ŒåŸå§‹æ•°æ®ä¸¢å¤±"})]}),e.jsxs(u.Item,{label:"è¾“å‡ºæ•°æ®ç±»å‹",children:[e.jsxs(O,{placeholder:"é€‰æ‹©è¾“å‡ºæ•°æ®ç±»å‹",value:s.config.output_type||void 0,onChange:x=>_(t,"output_type",x),allowClear:!0,children:[e.jsx(w,{value:"string",children:"å­—ç¬¦ä¸²"},"string"),e.jsx(w,{value:"int",children:"æ•´æ•°"},"int"),e.jsx(w,{value:"float",children:"æµ®ç‚¹æ•°"},"float"),e.jsx(w,{value:"bool",children:"å¸ƒå°”å€¼"},"bool")]}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"ä¸æŒ‡å®šåˆ™ä¿æŒåŸæ•°æ®ç±»å‹"})]}),e.jsxs(u.Item,{label:"æ•°å€¼ç²¾åº¦",children:[e.jsx(W,{placeholder:"å°æ•°ä½æ•°ï¼ˆä»…å¯¹æ•°å€¼ç±»å‹æœ‰æ•ˆï¼‰",value:s.config.precision!==void 0?s.config.precision:void 0,onChange:x=>_(t,"precision",x),min:0,max:10,style:{width:"100%"}}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"ä»…å¯¹æ•°å€¼ç±»å‹æœ‰æ•ˆï¼Œä¸è®¾ç½®åˆ™ä½¿ç”¨é»˜è®¤ç²¾åº¦"})]}),e.jsx(u.Item,{label:"é”™è¯¯å¤„ç†ç­–ç•¥",children:e.jsxs(O,{placeholder:"è½¬æ¢å‡ºé”™æ—¶çš„å¤„ç†æ–¹å¼",value:s.config.error_action||"error",onChange:x=>_(t,"error_action",x),children:[e.jsx(w,{value:"error",children:"æŠ›å‡ºé”™è¯¯"},"error-handling"),e.jsx(w,{value:"ignore",children:"å¿½ç•¥é”™è¯¯ï¼Œè¿”å›åŸå€¼"},"ignore"),e.jsx(w,{value:"default",children:"ä½¿ç”¨é»˜è®¤å€¼"},"default")]})}),s.config.error_action==="default"&&e.jsx(u.Item,{label:"é»˜è®¤å€¼",children:e.jsx(B,{placeholder:"é”™è¯¯æ—¶ä½¿ç”¨çš„é»˜è®¤å€¼",value:s.config.default_value!==void 0?String(s.config.default_value):"",onChange:x=>_(t,"default_value",x.target.value)})}),e.jsxs(u.Item,{label:"å‘å¸ƒä¸»é¢˜",children:[e.jsx(B,{placeholder:"NATSå‘å¸ƒä¸»é¢˜ï¼ˆå¯é€‰ï¼‰ï¼Œå¦‚ iot.data.transformed",value:s.config.publish_subject||"",onChange:x=>_(t,"publish_subject",x.target.value)}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:["æ”¯æŒå˜é‡æ¨¡æ¿ï¼Œå¦‚ iot.data.","{{.DeviceID}}"]})]})]})},X=(s,t)=>e.jsxs("div",{children:[e.jsx(u.Item,{label:"è¿‡æ»¤ç±»å‹",children:e.jsxs(O,{value:s.config.type||"range",onChange:l=>_(t,"type",l),children:[e.jsx(w,{value:"range",children:"èŒƒå›´è¿‡æ»¤"},"range"),e.jsx(w,{value:"dedup",children:"å»é‡è¿‡æ»¤"},"dedup"),e.jsx(w,{value:"rate_limit",children:"é€Ÿç‡é™åˆ¶"},"rate_limit")]})}),s.config.type==="range"&&e.jsxs("div",{children:[e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"æœ€å°å€¼",children:e.jsx(W,{value:s.config.min,onChange:l=>_(t,"min",l),style:{width:"100%"}})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"æœ€å¤§å€¼",children:e.jsx(W,{value:s.config.max,onChange:l=>_(t,"max",l),style:{width:"100%"}})})})]}),e.jsx(u.Item,{label:"åŒ¹é…æ—¶åŠ¨ä½œ",children:e.jsxs(O,{value:s.config.drop_on_match?"drop":"pass",onChange:l=>_(t,"drop_on_match",l==="drop"),children:[e.jsx(w,{value:"pass",children:"é€šè¿‡æ•°æ®"},"pass"),e.jsx(w,{value:"drop",children:"ä¸¢å¼ƒæ•°æ®"},"drop")]})})]}),s.config.type==="rate_limit"&&e.jsx("div",{children:e.jsx(u.Item,{label:"é€Ÿç‡é™åˆ¶",children:e.jsxs(Z,{gutter:8,children:[e.jsx(R,{span:12,children:e.jsx(W,{placeholder:"æ•°é‡",value:s.config.rate,onChange:l=>_(t,"rate",l),style:{width:"100%"}})}),e.jsx(R,{span:12,children:e.jsx(B,{placeholder:"æ—¶é—´çª—å£ï¼Œå¦‚ 1m",value:s.config.window,onChange:l=>_(t,"window",l.target.value)})})]})})})]}),N=(s,t)=>{const l=s.config.size||s.config.window_size;let r=s.config.output_key||s.config.output_field;return!r&&s.config.output&&typeof s.config.output=="object"&&(r=s.config.output.key_template),e.jsxs("div",{children:[e.jsxs(u.Item,{label:"çª—å£å¤§å°",children:[e.jsx(W,{placeholder:"æ•°æ®ç‚¹æ•°é‡",value:l,onChange:n=>{_(t,"window_size",n),s.config.size!==void 0&&_(t,"size",n)},min:1,style:{width:"100%"},addonAfter:"ä¸ªæ•°æ®ç‚¹"}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"åŸºäºæ•°æ®ç‚¹è®¡æ•°çš„æ»‘åŠ¨çª—å£ï¼Œå¦‚è®¾ç½®ä¸º10è¡¨ç¤ºç»Ÿè®¡æœ€è¿‘10ä¸ªæ•°æ®ç‚¹"})]}),e.jsxs(u.Item,{label:e.jsxs(p,{children:["èšåˆå‡½æ•°",e.jsx(oe,{title:"æ”¯æŒ28ä¸ªèšåˆå‡½æ•°ï¼ŒåŒ…æ‹¬åŸºç¡€ç»Ÿè®¡ã€ç™¾åˆ†ä½æ•°ã€æ•°æ®è´¨é‡ã€å˜åŒ–æ£€æµ‹ç­‰",children:e.jsx(Ce,{style:{color:"#1890ff"}})})]}),children:[e.jsxs(O,{mode:"multiple",placeholder:"é€‰æ‹©èšåˆå‡½æ•°ï¼ˆæ”¯æŒæœç´¢ï¼‰",value:s.config.functions||[],onChange:n=>_(t,"functions",n),showSearch:!0,filterOption:(n,i)=>i?.children?.toString().toLowerCase().includes(n.toLowerCase())||i?.value?.toString().toLowerCase().includes(n.toLowerCase()),style:{width:"100%"},children:[e.jsxs(O.OptGroup,{label:"ğŸ“Š åŸºç¡€ç»Ÿè®¡",children:[e.jsx(w,{value:"count",children:"è®¡æ•° (count)"},"count"),e.jsx(w,{value:"sum",children:"æ±‚å’Œ (sum)"},"sum"),e.jsx(w,{value:"avg",children:"å¹³å‡å€¼ (avg)"},"avg"),e.jsx(w,{value:"mean",children:"å¹³å‡å€¼ (mean)"},"mean"),e.jsx(w,{value:"average",children:"å¹³å‡å€¼ (average)"},"average"),e.jsx(w,{value:"min",children:"æœ€å°å€¼ (min)"},"min"),e.jsx(w,{value:"max",children:"æœ€å¤§å€¼ (max)"},"max"),e.jsx(w,{value:"median",children:"ä¸­ä½æ•° (median)"},"median"),e.jsx(w,{value:"first",children:"é¦–ä¸ªå€¼ (first)"},"first"),e.jsx(w,{value:"last",children:"æœ€åå€¼ (last)"},"last")]}),e.jsxs(O.OptGroup,{label:"ğŸ“ˆ åˆ†å¸ƒç»Ÿè®¡",children:[e.jsx(w,{value:"stddev",children:"æ ‡å‡†å·® (stddev)"},"stddev"),e.jsx(w,{value:"std",children:"æ ‡å‡†å·® (std)"},"std"),e.jsx(w,{value:"variance",children:"æ–¹å·® (variance)"},"variance"),e.jsx(w,{value:"volatility",children:"æ³¢åŠ¨ç‡ (volatility)"},"volatility"),e.jsx(w,{value:"cv",children:"å˜å¼‚ç³»æ•° (cv)"},"cv")]}),e.jsxs(O.OptGroup,{label:"ğŸ“Š ç™¾åˆ†ä½æ•°",children:[e.jsx(w,{value:"p25",children:"25ç™¾åˆ†ä½ (p25)"},"p25"),e.jsx(w,{value:"p50",children:"50ç™¾åˆ†ä½ (p50)"},"p50"),e.jsx(w,{value:"p75",children:"75ç™¾åˆ†ä½ (p75)"},"p75"),e.jsx(w,{value:"p90",children:"90ç™¾åˆ†ä½ (p90)"},"p90"),e.jsx(w,{value:"p95",children:"95ç™¾åˆ†ä½ (p95)"},"p95"),e.jsx(w,{value:"p99",children:"99ç™¾åˆ†ä½ (p99)"},"p99")]}),e.jsxs(O.OptGroup,{label:"ğŸ” æ•°æ®è´¨é‡",children:[e.jsx(w,{value:"null_rate",children:"ç©ºå€¼ç‡ (null_rate)"},"null_rate"),e.jsx(w,{value:"completeness",children:"å®Œæ•´æ€§ (completeness)"},"completeness"),e.jsx(w,{value:"outlier_count",children:"å¼‚å¸¸å€¼è®¡æ•° (outlier_count)"},"outlier_count")]}),e.jsxs(O.OptGroup,{label:"ğŸ“‰ å˜åŒ–æ£€æµ‹",children:[e.jsx(w,{value:"change",children:"å˜åŒ–é‡ (change)"},"change"),e.jsx(w,{value:"change_rate",children:"å˜åŒ–ç‡ (change_rate)"},"change_rate")]}),e.jsxs(O.OptGroup,{label:"âš¡ é˜ˆå€¼ç›‘æ§",children:[e.jsx(w,{value:"above_count",children:"è¶…è¿‡é˜ˆå€¼è®¡æ•° (above_count)"},"above_count"),e.jsx(w,{value:"below_count",children:"ä½äºé˜ˆå€¼è®¡æ•° (below_count)"},"below_count"),e.jsx(w,{value:"in_range_count",children:"èŒƒå›´å†…è®¡æ•° (in_range_count)"},"in_range_count")]})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"},children:["ğŸ’¡ æç¤ºï¼šæ”¯æŒå¤šé€‰å’Œæœç´¢ï¼ŒåŒ…æ‹¬åŸºç¡€ç»Ÿè®¡ã€ç™¾åˆ†ä½æ•°ã€æ•°æ®è´¨é‡æ£€æµ‹ç­‰28ä¸ªå‡½æ•°ã€‚",e.jsx("br",{}),"ğŸ“Š ",e.jsx("strong",{children:"åŸºç¡€ç»Ÿè®¡"}),": count, sum, avg, min, max ç­‰æ—¥å¸¸ç»Ÿè®¡",e.jsx("br",{}),"ğŸ“ˆ ",e.jsx("strong",{children:"åˆ†å¸ƒç»Ÿè®¡"}),": stddev, variance, volatility ç­‰ç¦»æ•£åº¦æŒ‡æ ‡",e.jsx("br",{}),"ğŸ“Š ",e.jsx("strong",{children:"ç™¾åˆ†ä½æ•°"}),": p25, p50, p75, p90, p95, p99 æ€§èƒ½ç›‘æ§å…³é”®æŒ‡æ ‡",e.jsx("br",{}),"ğŸ” ",e.jsx("strong",{children:"æ•°æ®è´¨é‡"}),": null_rate, completeness, outlier_count æ•°æ®å¥åº·åº¦",e.jsx("br",{}),"ğŸ“‰ ",e.jsx("strong",{children:"å˜åŒ–æ£€æµ‹"}),": change, change_rate è¶‹åŠ¿åˆ†æ",e.jsx("br",{}),"âš¡ ",e.jsx("strong",{children:"é˜ˆå€¼ç›‘æ§"}),": above_count, below_count, in_range_count éœ€é…ç½®é˜ˆå€¼å‚æ•°"]})]}),e.jsx(u.Item,{label:"åˆ†ç»„å­—æ®µ",children:e.jsxs(O,{mode:"tags",placeholder:"æŒ‰å­—æ®µåˆ†ç»„",value:s.config.group_by||[],onChange:n=>_(t,"group_by",n),children:[e.jsx(w,{value:"device_id",children:"è®¾å¤‡ID"},"device_id"),e.jsx(w,{value:"key",children:"æ•°æ®é”®"},"key"),e.jsx(w,{value:"tags",children:"æ ‡ç­¾"},"tags")]})}),e.jsx(u.Item,{label:e.jsxs(p,{children:["è¾“å‡ºå­—æ®µå",e.jsx(oe,{title:"èšåˆç»“æœçš„å­—æ®µåã€‚æ”¯æŒæ¨¡æ¿å˜é‡ï¼Œå¦‚ {{.Key}}_statsã€‚ç•™ç©ºå°†ä½¿ç”¨é»˜è®¤å­—æ®µåã€‚",children:e.jsx(Ce,{style:{color:"#1890ff"}})})]}),children:e.jsx(B,{placeholder:"å¦‚ {{.Key}}_statsï¼ˆæ”¯æŒæ¨¡æ¿å˜é‡ï¼‰",value:r||"",onChange:n=>{const i=n.target.value;s.config.output&&typeof s.config.output=="object"?_(t,"output",{...s.config.output,key_template:i}):_(t,"output_key",i),s.config.output_field!==void 0&&_(t,"output_field",i)}},`output-field-${t}-${r||"empty"}`)}),e.jsx(u.Item,{label:"çª—å£ç±»å‹",tooltip:"è®¡æ•°çª—å£ï¼šåŸºäºæ•°æ®ç‚¹æ•°é‡ï¼›æ—¶é—´çª—å£ï¼šåŸºäºæ—¶é—´èŒƒå›´",children:e.jsxs(O,{value:s.config.window_type||"count",onChange:n=>_(t,"window_type",n),children:[e.jsx(w,{value:"count",children:"è®¡æ•°çª—å£"}),e.jsx(w,{value:"time",children:"æ—¶é—´çª—å£"})]})}),s.config.window_type==="time"&&e.jsx(u.Item,{label:"æ—¶é—´çª—å£",tooltip:"æ—¶é—´æ ¼å¼ï¼š1s, 30s, 1m, 5m, 1hç­‰",children:e.jsx(B,{placeholder:"å¦‚: 1m, 30s, 1h",value:s.config.window||"",onChange:n=>_(t,"window",n.target.value)})}),e.jsx(u.Item,{label:"ä¸Šé™é˜ˆå€¼",tooltip:"ç”¨äºabove_countã€in_range_countç­‰é˜ˆå€¼ç›‘æ§å‡½æ•°",children:e.jsx(W,{style:{width:"100%"},placeholder:"å¯é€‰ï¼Œç”¨äºé˜ˆå€¼ç›‘æ§å‡½æ•°",value:s.config.upper_limit,onChange:n=>_(t,"upper_limit",n)})}),e.jsx(u.Item,{label:"ä¸‹é™é˜ˆå€¼",tooltip:"ç”¨äºbelow_countã€in_range_countç­‰é˜ˆå€¼ç›‘æ§å‡½æ•°",children:e.jsx(W,{style:{width:"100%"},placeholder:"å¯é€‰ï¼Œç”¨äºé˜ˆå€¼ç›‘æ§å‡½æ•°",value:s.config.lower_limit,onChange:n=>_(t,"lower_limit",n)})}),e.jsx(u.Item,{label:"å¼‚å¸¸å€¼é˜ˆå€¼",tooltip:"ç”¨äºoutlier_countå‡½æ•°ï¼Œæ ‡å‡†å·®çš„å€æ•°ï¼Œå¦‚2.0è¡¨ç¤º2å€æ ‡å‡†å·®",children:e.jsx(W,{min:0,step:.1,style:{width:"100%"},placeholder:"å¦‚ï¼š2.0è¡¨ç¤º2å€æ ‡å‡†å·®",value:s.config.outlier_threshold,onChange:n=>_(t,"outlier_threshold",n)})}),e.jsx(u.Item,{label:"è½¬å‘ç»“æœ",tooltip:"æ˜¯å¦å°†èšåˆç»“æœè½¬å‘åˆ°NATSæ¶ˆæ¯æ€»çº¿",children:e.jsx(he,{checked:s.config.forward!==!1,onChange:n=>_(t,"forward",n),checkedChildren:"æ˜¯",unCheckedChildren:"å¦"})})]})},$=(s,t)=>e.jsxs("div",{children:[e.jsx(u.Item,{label:"è½¬å‘ç›®æ ‡",children:e.jsxs(O,{value:s.config.target_type||"http",onChange:l=>_(t,"target_type",l),children:[e.jsx(w,{value:"http",children:"HTTPæ¥å£"},"http"),e.jsx(w,{value:"file",children:"æ–‡ä»¶"},"file"),e.jsx(w,{value:"mqtt",children:"MQTT"},"mqtt"),e.jsx(w,{value:"kafka",children:"Kafka"},"kafka")]})}),s.config.target_type==="http"&&e.jsxs("div",{children:[e.jsx(u.Item,{label:"URLåœ°å€",children:e.jsx(B,{placeholder:"https://api.example.com/data",value:s.config.url,onChange:l=>_(t,"url",l.target.value)})}),e.jsx(u.Item,{label:"HTTPæ–¹æ³•",children:e.jsxs(O,{value:s.config.method||"POST",onChange:l=>_(t,"method",l),children:[e.jsx(w,{value:"POST",children:"POST"},"POST"),e.jsx(w,{value:"PUT",children:"PUT"},"PUT"),e.jsx(w,{value:"PATCH",children:"PATCH"},"PATCH")]})}),e.jsx(u.Item,{label:"è¯·æ±‚å¤´",children:e.jsx(Qe,{rows:2,placeholder:'JSONæ ¼å¼ï¼Œå¦‚: {"Content-Type": "application/json"}',value:s.config.headers?JSON.stringify(s.config.headers,null,2):"",onChange:l=>{try{const r=JSON.parse(l.target.value||"{}");_(t,"headers",r)}catch{}}})})]}),s.config.target_type==="file"&&e.jsx(u.Item,{label:"æ–‡ä»¶è·¯å¾„",children:e.jsx(B,{placeholder:"/var/log/iot_data.log",value:s.config.path,onChange:l=>_(t,"path",l.target.value)})}),s.config.target_type==="mqtt"&&e.jsxs("div",{children:[e.jsx(u.Item,{label:"MQTTä»£ç†",children:e.jsx(B,{placeholder:"tcp://localhost:1883",value:s.config.broker,onChange:l=>_(t,"broker",l.target.value)})}),e.jsx(u.Item,{label:"ä¸»é¢˜æ¨¡æ¿",children:e.jsx(B,{placeholder:"iot/{{.DeviceID}}/{{.Key}}",value:s.config.topic,onChange:l=>_(t,"topic",l.target.value)})})]}),e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"æ‰¹å¤„ç†å¤§å°",children:e.jsx(W,{placeholder:"1",value:s.config.batch_size||1,onChange:l=>_(t,"batch_size",l),min:1,style:{width:"100%"}})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"è¶…æ—¶æ—¶é—´",children:e.jsx(B,{placeholder:"30s",value:s.config.timeout,onChange:l=>_(t,"timeout",l.target.value)})})})]})]}),L=(s,t)=>{switch(s.type){case"alert":return k(s,t);case"transform":return q(s,t);case"filter":return X(s,t);case"aggregate":return N(s,t);case"forward":return $(s,t);default:return e.jsx("div",{children:"è¯·é€‰æ‹©åŠ¨ä½œç±»å‹"})}};return e.jsx(I,{title:"æ‰§è¡ŒåŠ¨ä½œé…ç½®",size:"small",children:e.jsxs(p,{direction:"vertical",style:{width:"100%"},children:[V.map((s,t)=>e.jsx(I,{size:"small",title:e.jsxs(p,{children:[m.find(l=>l.value===s.type)?.icon,e.jsxs("span",{children:["åŠ¨ä½œ ",t+1]}),e.jsx(g,{color:"blue",children:m.find(l=>l.value===s.type)?.label||s.type})]}),extra:V.length>1&&e.jsx(E,{type:"text",danger:!0,size:"small",icon:e.jsx(Ee,{}),onClick:()=>J(t)}),children:e.jsxs("div",{children:[e.jsx(u.Item,{label:"åŠ¨ä½œç±»å‹",children:e.jsx(O,{value:s.type,onChange:l=>{if(s.type!==l){let r={};switch(l){case"alert":r={level:"warning",message:"å‘Šè­¦ä¿¡æ¯",channels:["console"]};break;case"transform":r={type:"scale",parameters:{factor:1},output_key:"",output_type:"float",precision:2,error_action:"default",default_value:0};break;case"filter":r={type:"range",min:0,max:100,drop_on_match:!1};break;case"aggregate":r={window_size:10,window_type:"count",functions:["avg","min","max"],group_by:["device_id"],output_key:"aggregated_value",forward:!0};break;case"forward":r={target_type:"http",url:"",method:"POST",batch_size:1,timeout:"30s"};break;default:r={}}const n=[...V];n[t]={...n[t],type:l,config:r},c.current=n;const i=S(n);v?.(i)}},style:{width:"100%"},children:m.map(l=>e.jsx(w,{value:l.value,children:e.jsxs(p,{children:[l.icon,l.label,e.jsxs(_a,{type:"secondary",children:["- ",l.description]})]})},l.value))})}),L(s,t),e.jsx(st,{size:"small"}),e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:8,children:e.jsx(u.Item,{label:e.jsxs(p,{children:["å¼‚æ­¥æ‰§è¡Œ",e.jsx(oe,{title:"æ˜¯å¦å¼‚æ­¥æ‰§è¡Œæ­¤åŠ¨ä½œ",children:e.jsx(Ce,{})})]}),children:e.jsx(he,{checked:s.async,onChange:l=>D(t,"async",l),checkedChildren:"æ˜¯",unCheckedChildren:"å¦"})})}),e.jsx(R,{span:8,children:e.jsx(u.Item,{label:"è¶…æ—¶æ—¶é—´",children:e.jsx(B,{placeholder:"30s",value:s.timeout,onChange:l=>D(t,"timeout",l.target.value)})})}),e.jsx(R,{span:8,children:e.jsx(u.Item,{label:"é‡è¯•æ¬¡æ•°",children:e.jsx(W,{value:s.retry,onChange:l=>D(t,"retry",l||0),min:0,max:10,style:{width:"100%"}})})})]})]})},t)),e.jsx(E,{type:"dashed",icon:e.jsx($e,{}),onClick:G,style:{width:"100%"},children:"æ·»åŠ åŠ¨ä½œ"})]})})},{Text:et,Paragraph:Sa}=pe,{Search:Ca}=B,{Option:Ot}=O,Ta=({visible:h,onClose:v,onSelect:M})=>{const[c,C]=b.useState(""),[V,m]=b.useState("all"),[S,G]=b.useState("all"),J=[{id:"temperature_alert",name:"æ¸©åº¦å‘Šè­¦ç›‘æ§",description:"ç›‘æ§è®¾å¤‡æ¸©åº¦ï¼Œè¶…è¿‡é˜ˆå€¼æ—¶å‘é€å‘Šè­¦é€šçŸ¥",category:"monitoring",icon:e.jsx(at,{style:{color:"#ff4d4f"}}),difficulty:"beginner",tags:["æ¸©åº¦","å‘Šè­¦","ç›‘æ§"],rule:{name:"æ¸©åº¦å‘Šè­¦ç›‘æ§",description:"å½“è®¾å¤‡æ¸©åº¦è¶…è¿‡æŒ‡å®šé˜ˆå€¼æ—¶å‘é€å‘Šè­¦",priority:100,enabled:!0,conditions:{type:"and",and:[{type:"simple",field:"key",operator:"eq",value:"temperature"},{type:"simple",field:"value",operator:"gt",value:35}]},actions:[{type:"alert",config:{level:"warning",message:"è®¾å¤‡{{.DeviceID}}æ¸©åº¦è¿‡é«˜: {{.Value}}Â°C",channels:["console","webhook"]}}]}},{id:"humidity_control",name:"æ¹¿åº¦æ§åˆ¶è§„åˆ™",description:"æ ¹æ®æ¹¿åº¦æ•°æ®è‡ªåŠ¨è°ƒèŠ‚è®¾å¤‡çŠ¶æ€",category:"automation",icon:e.jsx(be,{style:{color:"#1890ff"}}),difficulty:"intermediate",tags:["æ¹¿åº¦","è‡ªåŠ¨åŒ–","æ§åˆ¶"],rule:{name:"æ¹¿åº¦è‡ªåŠ¨æ§åˆ¶",description:"æ ¹æ®æ¹¿åº¦å˜åŒ–è‡ªåŠ¨è°ƒèŠ‚è®¾å¤‡å·¥ä½œçŠ¶æ€",priority:80,enabled:!0,conditions:{type:"or",or:[{type:"simple",field:"value",operator:"gt",value:80},{type:"simple",field:"value",operator:"lt",value:30}]},actions:[{type:"transform",config:{add_tags:{control_action:"humidity_adjust",timestamp:"{{.Timestamp}}"}}},{type:"forward",config:{target_type:"http",url:"http://localhost:8080/api/device/control",method:"POST",headers:{"Content-Type":"application/json"}}}]}},{id:"data_aggregation",name:"æ•°æ®èšåˆç»Ÿè®¡",description:"å¯¹ä¼ æ„Ÿå™¨æ•°æ®è¿›è¡Œå®æ—¶èšåˆè®¡ç®—",category:"analytics",icon:e.jsx(se,{style:{color:"#52c41a"}}),difficulty:"intermediate",tags:["èšåˆ","ç»Ÿè®¡","åˆ†æ"],rule:{name:"ä¼ æ„Ÿå™¨æ•°æ®èšåˆ",description:"æ¯10ä¸ªæ•°æ®ç‚¹è®¡ç®—å¹³å‡å€¼ã€æœ€å¤§å€¼å’Œæœ€å°å€¼",priority:50,enabled:!0,conditions:{type:"simple",field:"key",operator:"in",value:["temperature","humidity","pressure"]},actions:[{type:"aggregate",config:{window_type:"count",size:10,functions:["avg","max","min"],group_by:["device_id","key"],output_key:"{{.Key}}_stats",forward:!0}}]}},{id:"error_detection",name:"è®¾å¤‡æ•…éšœæ£€æµ‹",description:"æ£€æµ‹è®¾å¤‡å¼‚å¸¸çŠ¶æ€å¹¶è®°å½•æ•…éšœä¿¡æ¯",category:"monitoring",icon:e.jsx(na,{style:{color:"#fa8c16"}}),difficulty:"advanced",tags:["æ•…éšœ","æ£€æµ‹","å¼‚å¸¸"],rule:{name:"è®¾å¤‡æ•…éšœæ£€æµ‹",description:"æ£€æµ‹è®¾å¤‡çŠ¶æ€å¼‚å¸¸å¹¶è§¦å‘æ•…éšœå¤„ç†æµç¨‹",priority:150,enabled:!0,conditions:{type:"or",or:[{type:"simple",field:"status",operator:"eq",value:"error"},{type:"simple",field:"quality",operator:"lt",value:50},{type:"expression",expression:"temperature > 60 || humidity > 95"}]},actions:[{type:"alert",config:{level:"critical",message:"è®¾å¤‡{{.DeviceID}}å‘ç”Ÿæ•…éšœ: {{.Status}}",channels:["console","webhook","email"]}},{type:"transform",config:{add_tags:{alert_type:"device_fault",severity:"critical",processed_at:"{{.Timestamp}}"}}},{type:"forward",config:{target_type:"file",path:"/var/log/device_faults.log"}}]}},{id:"data_filtering",name:"æ•°æ®è´¨é‡è¿‡æ»¤",description:"è¿‡æ»¤ä½è´¨é‡æ•°æ®ï¼Œåªä¿ç•™æœ‰æ•ˆæ•°æ®",category:"processing",icon:e.jsx(_e,{style:{color:"#722ed1"}}),difficulty:"beginner",tags:["è¿‡æ»¤","è´¨é‡","æ¸…æ´—"],rule:{name:"æ•°æ®è´¨é‡è¿‡æ»¤",description:"è¿‡æ»¤è´¨é‡ä½äºé˜ˆå€¼çš„æ•°æ®ç‚¹",priority:200,enabled:!0,conditions:{type:"simple",field:"quality",operator:"exists",value:null},actions:[{type:"filter",config:{type:"range",min:70,max:100,drop_on_match:!1}}]}},{id:"data_conversion",name:"å•ä½è½¬æ¢è§„åˆ™",description:"è‡ªåŠ¨è½¬æ¢æ•°æ®å•ä½ï¼ˆå¦‚æ‘„æ°åº¦è½¬åæ°åº¦ï¼‰",category:"processing",icon:e.jsx(Me,{style:{color:"#1890ff"}}),difficulty:"intermediate",tags:["è½¬æ¢","å•ä½","æ ¼å¼"],rule:{name:"æ¸©åº¦å•ä½è½¬æ¢",description:"å°†æ‘„æ°åº¦è½¬æ¢ä¸ºåæ°åº¦",priority:60,enabled:!0,conditions:{type:"and",and:[{type:"simple",field:"key",operator:"eq",value:"temperature"},{type:"simple",field:"unit",operator:"eq",value:"celsius"}]},actions:[{type:"transform",config:{field:"value",scale_factor:1.8,offset:32,precision:1,add_tags:{unit:"fahrenheit",converted:"true"}}}]}},{id:"security_monitoring",name:"å®‰å…¨ç›‘æ§è§„åˆ™",description:"ç›‘æ§å¼‚å¸¸è®¿é—®å’Œå®‰å…¨äº‹ä»¶",category:"security",icon:e.jsx(oa,{style:{color:"#f5222d"}}),difficulty:"advanced",tags:["å®‰å…¨","ç›‘æ§","å¼‚å¸¸"],rule:{name:"å®‰å…¨äº‹ä»¶ç›‘æ§",description:"æ£€æµ‹æ½œåœ¨çš„å®‰å…¨å¨èƒå’Œå¼‚å¸¸è¡Œä¸º",priority:180,enabled:!0,conditions:{type:"or",or:[{type:"simple",field:"event_type",operator:"eq",value:"unauthorized_access"},{type:"simple",field:"failed_attempts",operator:"gt",value:5}]},actions:[{type:"alert",config:{level:"critical",message:"æ£€æµ‹åˆ°å®‰å…¨å¨èƒ: {{.EventType}}",channels:["console","webhook","email","sms"]}},{type:"forward",config:{target_type:"http",url:"https://security.example.com/api/incidents",method:"POST"}}]}},{id:"performance_monitoring",name:"æ€§èƒ½ç›‘æ§è§„åˆ™",description:"ç›‘æ§ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡å’Œèµ„æºä½¿ç”¨æƒ…å†µ",category:"monitoring",icon:e.jsx(ca,{style:{color:"#13c2c2"}}),difficulty:"intermediate",tags:["æ€§èƒ½","ç›‘æ§","èµ„æº"],rule:{name:"ç³»ç»Ÿæ€§èƒ½ç›‘æ§",description:"ç›‘æ§CPUã€å†…å­˜ä½¿ç”¨ç‡å¼‚å¸¸",priority:90,enabled:!0,conditions:{type:"and",and:[{type:"simple",field:"key",operator:"in",value:["cpu_usage","memory_usage"]},{type:"simple",field:"value",operator:"gt",value:85}]},actions:[{type:"alert",config:{level:"warning",message:"ç³»ç»Ÿ{{.Key}}è¿‡é«˜: {{.Value}}%",channels:["console","webhook"],throttle:"5m"}},{type:"aggregate",config:{window_type:"time",size:"1m",functions:["avg","max"],group_by:["device_id"],output_key:"performance_stats"}}]}}],D=[{value:"all",label:"å…¨éƒ¨åˆ†ç±»"},{value:"monitoring",label:"ç›‘æ§å‘Šè­¦"},{value:"automation",label:"è‡ªåŠ¨åŒ–æ§åˆ¶"},{value:"analytics",label:"æ•°æ®åˆ†æ"},{value:"processing",label:"æ•°æ®å¤„ç†"},{value:"security",label:"å®‰å…¨ç›‘æ§"}],_=[{value:"all",label:"å…¨éƒ¨éš¾åº¦"},{value:"beginner",label:"åˆçº§",color:"green"},{value:"intermediate",label:"ä¸­çº§",color:"orange"},{value:"advanced",label:"é«˜çº§",color:"red"}],k=J.filter(N=>{const $=c===""||N.name.toLowerCase().includes(c.toLowerCase())||N.description.toLowerCase().includes(c.toLowerCase())||N.tags.some(t=>t.toLowerCase().includes(c.toLowerCase())),L=V==="all"||N.category===V,s=S==="all"||N.difficulty===S;return $&&L&&s}),q=N=>{M(N),v()},X=N=>_.find(L=>L.value===N)?.color||"default";return e.jsxs(Te,{title:"é€‰æ‹©è§„åˆ™æ¨¡æ¿",open:h,onCancel:v,footer:null,width:1e3,styles:{body:{maxHeight:"70vh",overflowY:"auto"}},children:[e.jsx(P,{message:"è§„åˆ™æ¨¡æ¿åº“",description:"é€‰æ‹©é¢„å®šä¹‰çš„è§„åˆ™æ¨¡æ¿å¿«é€Ÿå¼€å§‹ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹å’Œå®šåˆ¶ã€‚",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(I,{size:"small",style:{marginBottom:16},children:e.jsxs(Z,{gutter:16,align:"middle",children:[e.jsx(R,{span:8,children:e.jsx(Ca,{placeholder:"æœç´¢æ¨¡æ¿åç§°ã€æè¿°æˆ–æ ‡ç­¾",value:c,onChange:N=>C(N.target.value),allowClear:!0})}),e.jsx(R,{span:6,children:e.jsx(O,{placeholder:"é€‰æ‹©åˆ†ç±»",value:V,onChange:m,style:{width:"100%"},children:D.map(N=>e.jsx(Ot,{value:N.value,children:N.label},N.value))})}),e.jsx(R,{span:6,children:e.jsx(O,{placeholder:"é€‰æ‹©éš¾åº¦",value:S,onChange:G,style:{width:"100%"},children:_.map(N=>e.jsx(Ot,{value:N.value,children:N.label},N.value))})}),e.jsx(R,{span:4,children:e.jsxs(et,{type:"secondary",children:["å…± ",k.length," ä¸ªæ¨¡æ¿"]})})]})}),e.jsx(Z,{gutter:[16,16],children:k.map(N=>e.jsx(R,{span:12,children:e.jsxs(I,{hoverable:!0,size:"small",title:e.jsxs(p,{children:[N.icon,e.jsx("span",{children:N.name}),e.jsx(g,{color:X(N.difficulty),children:_.find($=>$.value===N.difficulty)?.label})]}),extra:e.jsx(E,{type:"primary",size:"small",onClick:()=>q(N),children:"ä½¿ç”¨æ¨¡æ¿"}),style:{height:200},children:[e.jsx(Sa,{ellipsis:{rows:2,expandable:!1},style:{marginBottom:12,minHeight:40},children:N.description}),e.jsx(p,{wrap:!0,style:{marginBottom:8},children:N.tags.map($=>e.jsx(g,{children:$},$))}),e.jsx(st,{style:{margin:"8px 0"}}),e.jsxs(Z,{justify:"space-between",align:"middle",children:[e.jsx(R,{children:e.jsx(et,{type:"secondary",style:{fontSize:12},children:D.find($=>$.value===N.category)?.label})}),e.jsx(R,{children:e.jsxs(et,{type:"secondary",style:{fontSize:12},children:["ä¼˜å…ˆçº§: ",N.rule.priority]})})]})]})},N.id))}),k.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(et,{type:"secondary",children:"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ¨¡æ¿"})})]})},{Text:He,Title:ka}=pe,{TabPane:Nt}=ke,Rt=[{type:"simple",category:"basic",key:"numeric",name:"æ•°å€¼æ•°æ®",icon:e.jsx(qt,{}),description:"æ¸©åº¦ã€æ¹¿åº¦ã€å‹åŠ›ç­‰å•ä¸€æ•°å€¼",examples:["temperature: 25.5","humidity: 60","pressure: 1013"],color:"#1890ff"},{type:"simple",category:"basic",key:"status",name:"çŠ¶æ€æ•°æ®",icon:e.jsx(me,{}),description:"å¼€å…³çŠ¶æ€ã€è®¾å¤‡çŠ¶æ€ç­‰å¸ƒå°”æˆ–æšä¸¾å€¼",examples:['status: "online"',"enabled: true",'level: "warning"'],color:"#52c41a"},{type:"complex",category:"geospatial",key:"location",name:"GPSä½ç½®",icon:e.jsx(vt,{}),description:"ç»çº¬åº¦ã€æµ·æ‹”ã€é€Ÿåº¦ç­‰åœ°ç†ä½ç½®ä¿¡æ¯",examples:["location: {lat: 39.9042, lng: 116.4074}","gps: {lat: 39.9042, lng: 116.4074, alt: 50, speed: 60}"],color:"#fa8c16"},{type:"complex",category:"vector",key:"vector3d",name:"ä¸‰ç»´å‘é‡",icon:e.jsx(Bt,{}),description:"åŠ é€Ÿåº¦ã€ç£åœºã€é™€èºä»ªç­‰ä¸‰ç»´å‘é‡æ•°æ®",examples:["acceleration: {x: 1.2, y: -0.8, z: 9.8}","magnetic: {x: 25, y: -30, z: 45}"],color:"#722ed1"},{type:"complex",category:"visual",key:"color",name:"é¢œè‰²æ•°æ®",icon:e.jsx(rt,{}),description:"RGBã€HSLé¢œè‰²å€¼å’Œé¢œè‰²ç©ºé—´æ•°æ®",examples:["color: {r: 255, g: 128, b: 0}","hsl: {h: 30, s: 100, l: 50}"],color:"#eb2f96"},{type:"complex",category:"array",key:"vector_array",name:"å‘é‡æ•°ç»„",icon:e.jsx(pa,{}),description:"ä¼ æ„Ÿå™¨é˜µåˆ—ã€é¢‘è°±æ•°æ®ç­‰æ•°ç»„ç±»å‹",examples:["spectrum: [1.2, 2.5, 1.8, 3.1, 2.7]","sensors: [25.1, 25.3, 24.9, 25.2]"],color:"#13c2c2"},{type:"complex",category:"matrix",key:"matrix",name:"çŸ©é˜µæ•°æ®",icon:e.jsx(ua,{}),description:"äºŒç»´çŸ©é˜µæ•°æ®ã€å›¾åƒæ•°æ®ç­‰",examples:["matrix: [[1,2,3], [4,5,6], [7,8,9]]","image: {rows: 100, cols: 100, data: [...]}"],color:"#2f54eb"},{type:"complex",category:"timeseries",key:"timeseries",name:"æ—¶é—´åºåˆ—",icon:e.jsx(xa,{}),description:"å†å²è¶‹åŠ¿ã€é‡‡æ ·åºåˆ—ç­‰æ—¶é—´åºåˆ—æ•°æ®",examples:["trend: {timestamps: [...], values: [...]}",'history: {interval: "1m", data: [...]}'],color:"#f5222d"}],za=({visible:h,onTypeSelect:v,onCancel:M})=>{const c=C=>e.jsx(R,{span:C.type==="simple"?12:8,children:e.jsx(I,{hoverable:!0,onClick:()=>v(C),className:"data-type-card",style:{height:"100%",border:`2px solid ${C.color}20`,borderRadius:"8px"},bodyStyle:{padding:"16px"},children:e.jsx(I.Meta,{avatar:e.jsx(ha,{size:48,icon:C.icon,style:{backgroundColor:C.color}}),title:e.jsxs(p,{children:[C.name,e.jsx(g,{color:C.color,size:"small",children:C.type==="simple"?"ç®€å•":"å¤åˆ"})]}),description:e.jsxs("div",{children:[e.jsx(He,{style:{fontSize:"13px",lineHeight:"1.4"},children:C.description}),e.jsx("div",{style:{marginTop:"8px"},children:C.examples.map((V,m)=>e.jsx(g,{style:{fontSize:"10px",margin:"2px",backgroundColor:`${C.color}15`,color:C.color,border:`1px solid ${C.color}30`},children:V},m))})]})})})},C.key);return h?e.jsx("div",{className:"data-type-selector-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:M,children:e.jsxs(I,{style:{width:"90%",maxWidth:"1200px",maxHeight:"90vh",overflow:"auto"},onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{style:{marginBottom:"24px",textAlign:"center"},children:[e.jsx(ka,{level:3,style:{margin:0},children:e.jsxs(p,{children:[e.jsx(da,{}),"é€‰æ‹©æ•°æ®ç±»å‹"]})}),e.jsx(He,{type:"secondary",children:"é€‰æ‹©é€‚åˆæ‚¨æ•°æ®ç»“æ„çš„è§„åˆ™ç¼–è¾‘å™¨ç±»å‹"})]}),e.jsxs(ke,{defaultActiveKey:"simple",size:"large",children:[e.jsxs(Nt,{tab:e.jsxs(p,{children:[e.jsx(qt,{}),"å•ç‚¹æ•°æ®è§„åˆ™",e.jsx(g,{color:"blue",size:"small",children:"ç®€å•é«˜æ•ˆ"})]}),children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx(He,{type:"secondary",children:"é€‚ç”¨äºå¤„ç†å•ä¸€æ•°å€¼ã€çŠ¶æ€ç­‰ç®€å•æ•°æ®ç±»å‹çš„è§„åˆ™"})}),e.jsx(Z,{gutter:[16,16],children:Rt.filter(C=>C.type==="simple").map(c)})]},"simple"),e.jsxs(Nt,{tab:e.jsxs(p,{children:[e.jsx(Bt,{}),"å¤åˆæ•°æ®è§„åˆ™",e.jsx(g,{color:"purple",size:"small",children:"åŠŸèƒ½å¼ºå¤§"})]}),children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx(He,{type:"secondary",children:"é€‚ç”¨äºå¤„ç†GPSä½ç½®ã€å‘é‡ã€çŸ©é˜µç­‰å¤æ‚æ•°æ®ç»“æ„çš„é«˜çº§è§„åˆ™"})}),e.jsx(Z,{gutter:[16,16],children:Rt.filter(C=>C.type==="complex").map(c)})]},"complex")]}),e.jsx("div",{style:{marginTop:"24px",textAlign:"center",padding:"16px",backgroundColor:"#f0f2f5",borderRadius:"6px"},children:e.jsx(He,{type:"secondary",style:{fontSize:"12px"},children:"ğŸ’¡ æç¤ºï¼šé€‰æ‹©æ•°æ®ç±»å‹åå°†è¿›å…¥å¯¹åº”çš„ä¸“ç”¨è§„åˆ™ç¼–è¾‘å™¨ï¼Œæä¾›æœ€ä½³çš„ç¼–è¾‘ä½“éªŒ"})})]})}):null};class Ya extends Ht.Component{form=u.useForm?u.useForm()[0]:null;constructor(v){super(v),this.state={saving:!1,validationErrors:[]}}componentDidUpdate(v){this.props.visible&&!v.visible&&this.props.rule&&this.loadRuleData(this.props.rule)}loadRuleData(v){this.form&&this.form.setFieldsValue({name:v.name||"",description:v.description||"",priority:v.priority||50,enabled:v.enabled!==!1}),this.loadConditions(v.conditions),this.loadActions(v.actions||[])}validateRule(v){const M=[];return(!v.name||v.name.trim()==="")&&M.push("è§„åˆ™åç§°ä¸èƒ½ä¸ºç©º"),v.conditions||M.push("å¿…é¡»è®¾ç½®è‡³å°‘ä¸€ä¸ªæ¡ä»¶"),(!v.actions||v.actions.length===0)&&M.push("å¿…é¡»è®¾ç½®è‡³å°‘ä¸€ä¸ªåŠ¨ä½œ"),(typeof v.priority!="number"||v.priority<0||v.priority>100)&&M.push("ä¼˜å…ˆçº§å¿…é¡»æ˜¯0-100ä¹‹é—´çš„æ•°å­—"),M}handleSave=async()=>{try{this.setState({saving:!0,validationErrors:[]});const v=this.form?await this.form.validateFields():{},M={id:this.props.rule?.id||"",name:v.name||"",description:v.description||"",priority:v.priority||50,enabled:v.enabled!==!1,data_type:this.props.rule?.data_type,conditions:this.buildConditions(),actions:this.buildActions(),tags:this.props.rule?.tags||{},version:this.props.rule?.version||1,created_at:this.props.rule?.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},c=this.validateRule(M);if(c.length>0){this.setState({validationErrors:c}),Y.error(`éªŒè¯å¤±è´¥: ${c.join(", ")}`);return}await this.props.onSave(M),Y.success("è§„åˆ™ä¿å­˜æˆåŠŸ"),this.props.onClose()}catch(v){console.error("ä¿å­˜è§„åˆ™å¤±è´¥:",v),Y.error("ä¿å­˜è§„åˆ™å¤±è´¥ï¼š"+(v.message||"æœªçŸ¥é”™è¯¯"))}finally{this.setState({saving:!1})}};handleCancel=()=>{this.form&&this.form.resetFields(),this.setState({validationErrors:[]}),this.props.onClose()};renderFooter(){return e.jsxs(p,{children:[e.jsx(E,{onClick:this.handleCancel,children:"å–æ¶ˆ"}),e.jsx(E,{type:"primary",loading:this.state.saving,onClick:this.handleSave,children:"ä¿å­˜è§„åˆ™"})]})}renderBaseForm(){return e.jsxs(u,{form:this.form,layout:"vertical",initialValues:{priority:50,enabled:!0},children:[e.jsx(u.Item,{label:"è§„åˆ™åç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥è§„åˆ™åç§°"}],children:e.jsx("input",{placeholder:"è¯·è¾“å…¥è§„åˆ™åç§°"})}),e.jsx(u.Item,{label:"è§„åˆ™æè¿°",name:"description",children:e.jsx("textarea",{placeholder:"è¯·è¾“å…¥è§„åˆ™æè¿°",rows:2})}),e.jsx(u.Item,{label:"ä¼˜å…ˆçº§",name:"priority",rules:[{required:!0,message:"è¯·è¾“å…¥ä¼˜å…ˆçº§"},{type:"number",min:0,max:100,message:"ä¼˜å…ˆçº§å¿…é¡»åœ¨0-100ä¹‹é—´"}],children:e.jsx("input",{type:"number",min:0,max:100})}),e.jsx(u.Item,{label:"å¯ç”¨çŠ¶æ€",name:"enabled",valuePropName:"checked",children:e.jsx("input",{type:"checkbox"})})]})}render(){return e.jsx(Te,{title:`${this.props.title} - ${this.props.dataTypeName}`,open:this.props.visible,onCancel:this.handleCancel,footer:this.renderFooter(),width:800,destroyOnHidden:!0,children:e.jsxs("div",{children:[this.renderBaseForm(),this.state.validationErrors.length>0&&e.jsxs("div",{style:{marginBottom:16,color:"#ff4d4f"},children:[e.jsx("strong",{children:"éªŒè¯é”™è¯¯ï¼š"}),e.jsx("ul",{children:this.state.validationErrors.map((v,M)=>e.jsx("li",{children:v},M))})]}),this.renderSpecializedContent()]})})}}const Pe=h=>{const[v]=u.useForm(),[M,c]=b.useState(!1),[C,V]=b.useState([]);b.useEffect(()=>{h.visible&&h.rule&&v.setFieldsValue({name:h.rule.name||"",description:h.rule.description||"",priority:h.rule.priority||50,enabled:h.rule.enabled!==!1})},[h.visible,h.rule,v]);const m=J=>{const D=[];return(!J.name||J.name.trim()==="")&&D.push("è§„åˆ™åç§°ä¸èƒ½ä¸ºç©º"),J.conditions||D.push("å¿…é¡»è®¾ç½®è‡³å°‘ä¸€ä¸ªæ¡ä»¶"),(!J.actions||J.actions.length===0)&&D.push("å¿…é¡»è®¾ç½®è‡³å°‘ä¸€ä¸ªåŠ¨ä½œ"),(typeof J.priority!="number"||J.priority<0||J.priority>100)&&D.push("ä¼˜å…ˆçº§å¿…é¡»æ˜¯0-100ä¹‹é—´çš„æ•°å­—"),D};return{form:v,saving:M,validationErrors:C,handleSave:async(J,D)=>{try{c(!0),V([]);const _=await v.validateFields(),k={id:h.rule?.id||"",name:_.name||"",description:_.description||"",priority:_.priority||50,enabled:_.enabled!==!1,data_type:h.rule?.data_type,conditions:J(),actions:D(),tags:h.rule?.tags||{},version:h.rule?.version||1,created_at:h.rule?.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},q=m(k);if(q.length>0){V(q),Y.error(`éªŒè¯å¤±è´¥: ${q.join(", ")}`);return}await h.onSave(k),Y.success("è§„åˆ™ä¿å­˜æˆåŠŸ"),h.onClose()}catch(_){console.error("ä¿å­˜è§„åˆ™å¤±è´¥:",_),Y.error("ä¿å­˜è§„åˆ™å¤±è´¥ï¼š"+(_.message||"æœªçŸ¥é”™è¯¯"))}finally{c(!1)}},handleCancel:()=>{v.resetFields(),V([]),h.onClose()}}},{Option:tt}=O,{Text:fe}=pe,{TextArea:Ia}=B,Fe=({value:h,onChange:v,availableFields:M=["device_id","key","value","timestamp","quality"],customFieldOptions:c=[],allowedOperators:C=["eq","ne","gt","gte","lt","lte","contains","startswith","endswith","regex"],supportExpressions:V=!0,dataTypeName:m="æ•°æ®"})=>{const[S,G]=b.useState(h);b.useEffect(()=>{G(h)},[h]);const J=[{value:"eq",label:"ç­‰äº (=)",description:"å­—æ®µå€¼ç­‰äºæŒ‡å®šå€¼"},{value:"ne",label:"ä¸ç­‰äº (â‰ )",description:"å­—æ®µå€¼ä¸ç­‰äºæŒ‡å®šå€¼"},{value:"gt",label:"å¤§äº (>)",description:"å­—æ®µå€¼å¤§äºæŒ‡å®šå€¼"},{value:"gte",label:"å¤§äºç­‰äº (â‰¥)",description:"å­—æ®µå€¼å¤§äºç­‰äºæŒ‡å®šå€¼"},{value:"lt",label:"å°äº (<)",description:"å­—æ®µå€¼å°äºæŒ‡å®šå€¼"},{value:"lte",label:"å°äºç­‰äº (â‰¤)",description:"å­—æ®µå€¼å°äºç­‰äºæŒ‡å®šå€¼"},{value:"contains",label:"åŒ…å«",description:"å­—æ®µå€¼åŒ…å«æŒ‡å®šæ–‡æœ¬"},{value:"startswith",label:"å¼€å¤´åŒ¹é…",description:"å­—æ®µå€¼ä»¥æŒ‡å®šæ–‡æœ¬å¼€å¤´"},{value:"endswith",label:"ç»“å°¾åŒ¹é…",description:"å­—æ®µå€¼ä»¥æŒ‡å®šæ–‡æœ¬ç»“å°¾"},{value:"regex",label:"æ­£åˆ™åŒ¹é…",description:"å­—æ®µå€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼"}].filter(r=>C.includes(r.value)),D=[{value:"simple",label:"ç®€å•æ¡ä»¶",description:"å•ä¸ªå­—æ®µæ¯”è¾ƒæ¡ä»¶"},{value:"and",label:"é€»è¾‘AND",description:"æ‰€æœ‰å­æ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³"},{value:"or",label:"é€»è¾‘OR",description:"è‡³å°‘ä¸€ä¸ªå­æ¡ä»¶æ»¡è¶³"}];V&&D.push({value:"expression",label:"è¡¨è¾¾å¼æ¡ä»¶",description:"ä½¿ç”¨è¡¨è¾¾å¼è¯­è¨€è¿›è¡Œå¤æ‚è®¡ç®—"});const _=[...M.map(r=>({value:r,label:r})),...c],k=r=>{G(r),v?.(r)},q=r=>{let n;switch(r){case"simple":n={type:"simple",field:"",operator:"eq",value:""};break;case"and":n={type:"and",and:[{type:"simple",field:"",operator:"eq",value:""},{type:"simple",field:"",operator:"eq",value:""}]};break;case"or":n={type:"or",or:[{type:"simple",field:"",operator:"eq",value:""},{type:"simple",field:"",operator:"eq",value:""}]};break;case"expression":n={type:"expression",expression:""};break;default:n={type:"simple",field:"",operator:"eq",value:""}}k(n)},X=(r,n)=>{if(!S)return;const i={...S,[r]:n};k(i)},N=(r,n,i=!0)=>{if(!S)return;const x={...S},j=i?"and":"or",H=x[j]||[];H[r]=n,x[j]=H,k(x)},$=(r=!0)=>{if(!S)return;const n={...S},i=r?"and":"or",x=n[i]||[];x.push({type:"simple",field:"",operator:"eq",value:""}),n[i]=x,k(n)},L=(r,n=!0)=>{if(!S)return;const i={...S},x=n?"and":"or",j=i[x]||[];j.splice(r,1),i[x]=j,k(i)},s=(r,n)=>{const i=S,x=k;return!i||i.type!=="simple"?null:e.jsxs(I,{size:"small",style:{backgroundColor:"#fafafa",marginBottom:16},children:[e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:8,children:e.jsx(u.Item,{label:e.jsxs(p,{size:"small",children:[e.jsx(_e,{style:{color:"#1890ff"}}),e.jsx("span",{children:"å­—æ®µ"})]}),children:e.jsx(O,{placeholder:"é€‰æ‹©å­—æ®µ",value:i.field,onChange:j=>x({...i,field:j}),showSearch:!0,size:"large",style:{width:"100%"},optionLabelProp:"label",children:_.map(j=>e.jsx(tt,{value:j.value,label:j.label,children:e.jsxs("div",{style:{padding:"6px 0",lineHeight:"1.4"},children:[e.jsx("div",{children:e.jsx(fe,{strong:!0,style:{fontSize:"14px"},children:j.label})}),j.description&&e.jsx("div",{children:e.jsx(fe,{type:"secondary",style:{fontSize:"12px"},children:j.description})})]})},j.value))})})}),e.jsx(R,{span:6,children:e.jsx(u.Item,{label:e.jsxs(p,{size:"small",children:[e.jsx(se,{style:{color:"#52c41a"}}),e.jsx("span",{children:"æ“ä½œç¬¦"})]}),children:e.jsx(O,{placeholder:"é€‰æ‹©æ“ä½œç¬¦",value:i.operator,onChange:j=>x({...i,operator:j}),size:"large",style:{width:"100%"},optionLabelProp:"label",children:J.map(j=>e.jsx(tt,{value:j.value,label:j.label,children:e.jsxs("div",{style:{padding:"6px 0",lineHeight:"1.4"},children:[e.jsx("div",{children:e.jsx(fe,{strong:!0,style:{fontSize:"14px"},children:j.label})}),e.jsx("div",{children:e.jsx(fe,{type:"secondary",style:{fontSize:"12px"},children:j.description})})]})},j.value))})})}),e.jsx(R,{span:10,children:e.jsx(u.Item,{label:e.jsxs(p,{size:"small",children:[e.jsx(ce,{style:{color:"#fa8c16"}}),e.jsx("span",{children:"å€¼"})]}),children:i.operator==="regex"?e.jsx(B,{placeholder:"è¾“å…¥æ­£åˆ™è¡¨è¾¾å¼",value:i.value,onChange:j=>x({...i,value:j.target.value}),size:"large",style:{fontFamily:"Monaco, Consolas, monospace"}}):["gt","gte","lt","lte"].includes(i.operator||"")?e.jsx(W,{placeholder:"è¾“å…¥æ•°å­—å€¼",value:i.value,onChange:j=>x({...i,value:j}),style:{width:"100%"},size:"large",precision:2}):e.jsx(B,{placeholder:"è¾“å…¥æ¯”è¾ƒå€¼",value:i.value,onChange:j=>x({...i,value:j.target.value}),size:"large"})})})]}),i.field&&i.operator&&i.value!==""&&e.jsx(P,{message:"æ¡ä»¶é¢„è§ˆ",description:e.jsxs(g,{color:"blue",style:{fontSize:"12px"},children:[i.field," ",J.find(j=>j.value===i.operator)?.label," ",i.value]}),type:"info",showIcon:!0,style:{marginTop:8},size:"small"})]})},t=(r=!0)=>{if(!S)return null;const i=S[r?"and":"or"]||[],x=r?"ANDæ¡ä»¶":"ORæ¡ä»¶",j=r?"æ‰€æœ‰å­æ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³":"è‡³å°‘ä¸€ä¸ªå­æ¡ä»¶æ»¡è¶³",H=r?"blue":"green";return e.jsxs("div",{children:[e.jsx(P,{message:e.jsxs(p,{children:[e.jsx(g,{color:H,icon:r?e.jsx(_e,{}):e.jsx(se,{}),children:x}),e.jsx("span",{children:j}),V&&e.jsx(g,{color:"green",size:"small",children:"æ”¯æŒè¡¨è¾¾å¼"})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),i.map((Q,A)=>e.jsx(I,{size:"small",style:{marginBottom:16,border:`2px dashed ${r?"#1890ff":"#52c41a"}`,borderRadius:8},title:e.jsxs(p,{children:[e.jsxs(g,{color:H,children:["æ¡ä»¶ ",A+1]}),r?"AND":"OR"]}),extra:i.length>1&&e.jsx(oe,{title:"åˆ é™¤è¿™ä¸ªæ¡ä»¶",children:e.jsx(E,{type:"link",icon:e.jsx(Ee,{}),danger:!0,size:"small",onClick:()=>L(A,r),children:"åˆ é™¤"})}),children:e.jsx(Fe,{value:Q,onChange:re=>re&&N(A,re,r),availableFields:M,customFieldOptions:c,allowedOperators:C,supportExpressions:V,dataTypeName:m})},A)),e.jsxs(E,{type:"dashed",icon:e.jsx($e,{}),onClick:()=>$(r),style:{width:"100%",height:"48px",borderColor:r?"#1890ff":"#52c41a",color:r?"#1890ff":"#52c41a"},size:"large",children:["æ·»åŠ ",r?"AND":"OR","æ¡ä»¶"]})]})},l=()=>!S||S.type!=="expression"?null:e.jsxs(I,{size:"small",style:{backgroundColor:"#f6ffed",marginBottom:16},children:[e.jsx(P,{message:"è¡¨è¾¾å¼æ¨¡å¼",description:"ä½¿ç”¨è¡¨è¾¾å¼è¯­è¨€è¿›è¡Œå¤æ‚è®¡ç®—ï¼Œæ”¯æŒæ•°å­¦è¿ç®—ã€å­—ç¬¦ä¸²æ“ä½œå’Œé€»è¾‘åˆ¤æ–­",type:"success",showIcon:!0,style:{marginBottom:16}}),e.jsx(u.Item,{label:e.jsxs(p,{children:[e.jsx(se,{style:{color:"#52c41a"}}),e.jsxs("span",{children:[m,"è¡¨è¾¾å¼"]})]}),children:e.jsx(Ia,{placeholder:`è¾“å…¥${m}è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼švalue > 30 && contains(device_id, "sensor")`,value:S.expression,onChange:r=>X("expression",r.target.value),rows:4,style:{fontFamily:'Monaco, Consolas, "Courier New", monospace',fontSize:"13px",lineHeight:"1.5"}})}),e.jsx("div",{style:{marginTop:12},children:e.jsxs(fe,{type:"secondary",style:{fontSize:12},children:[e.jsx(ce,{style:{marginRight:4}}),"ç¤ºä¾‹: value ",">"," 30 ","&&",' contains(device_id, "sensor") ',"||"," temperature ","<"," 0"]})})]});return S?e.jsxs(I,{title:e.jsxs(p,{children:[e.jsx(_e,{style:{color:"#1890ff"}}),e.jsx("span",{children:"è§„åˆ™æ¡ä»¶"}),e.jsx(g,{color:"blue",children:m})]}),style:{border:"1px solid #e8f4fd",borderRadius:8,backgroundColor:"#fafcff"},children:[e.jsx(u.Item,{label:e.jsxs(p,{children:[e.jsx(se,{style:{color:"#52c41a"}}),e.jsx("span",{children:"æ¡ä»¶ç±»å‹"})]}),children:e.jsx(O,{value:S.type,onChange:q,size:"large",style:{width:"100%"},optionLabelProp:"label",children:D.map(r=>e.jsx(tt,{value:r.value,label:r.label,children:e.jsxs("div",{style:{padding:"6px 0",lineHeight:"1.4"},children:[e.jsx("div",{children:e.jsx(fe,{strong:!0,style:{fontSize:"14px"},children:r.label})}),e.jsx("div",{children:e.jsx(fe,{type:"secondary",style:{fontSize:"12px"},children:r.description})})]})},r.value))})}),e.jsx(st,{style:{margin:"16px 0"}}),S.type==="simple"&&s(),S.type==="and"&&t(!0),S.type==="or"&&t(!1),S.type==="expression"&&l()]}):e.jsxs(I,{title:e.jsxs(p,{children:[e.jsx(_e,{style:{color:"#1890ff"}}),e.jsx("span",{children:"è®¾ç½®æ¡ä»¶"})]}),style:{border:"2px dashed #d9d9d9",borderRadius:8,backgroundColor:"#fafafa"},children:[e.jsx(P,{message:"é€‰æ‹©æ¡ä»¶ç±»å‹å¼€å§‹é…ç½®",description:"é€‰æ‹©é€‚åˆçš„æ¡ä»¶ç±»å‹æ¥å®šä¹‰è§„åˆ™çš„è§¦å‘æ¡ä»¶",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(u.Item,{label:e.jsxs(p,{children:[e.jsx(se,{style:{color:"#52c41a"}}),e.jsx("span",{children:"æ¡ä»¶ç±»å‹"})]}),children:e.jsx(O,{placeholder:"é€‰æ‹©æ¡ä»¶ç±»å‹",onChange:q,size:"large",style:{width:"100%"},optionLabelProp:"label",children:D.map(r=>e.jsx(tt,{value:r.value,label:r.label,children:e.jsxs("div",{style:{padding:"6px 0",lineHeight:"1.4"},children:[e.jsx("div",{children:e.jsx(fe,{strong:!0,style:{fontSize:"14px"},children:r.label})}),e.jsx("div",{children:e.jsx(fe,{type:"secondary",style:{fontSize:"12px"},children:r.description})})]})},r.value))})})]})},{Option:xt}=O,{Text:Dt}=pe,{TextArea:ht}=B,Le=({value:h=[],onChange:v,availableActionTypes:M=["alert","transform","filter","aggregate","forward"],customActionOptions:c=[],dataTypeName:C="æ•°æ®"})=>{const[V,m]=b.useState(h),S=[{value:"alert",label:"å‘Šè­¦åŠ¨ä½œ",description:"å‘é€å‘Šè­¦é€šçŸ¥",configSchema:{level:{type:"string",label:"å‘Šè­¦çº§åˆ«",required:!0,options:[{value:"info",label:"ä¿¡æ¯"},{value:"warning",label:"è­¦å‘Š"},{value:"error",label:"é”™è¯¯"},{value:"critical",label:"ä¸¥é‡"}],defaultValue:"warning"},message:{type:"textarea",label:"å‘Šè­¦æ¶ˆæ¯",required:!0,placeholder:"å‘Šè­¦æ¶ˆæ¯æ¨¡æ¿ï¼Œæ”¯æŒå˜é‡ï¼š{{.DeviceID}}, {{.Value}}",description:"æ”¯æŒæ¨¡æ¿å˜é‡ï¼Œå¦‚ {{.DeviceID}}, {{.Value}}, {{.Timestamp}}"},type:{type:"string",label:"é€šçŸ¥ç±»å‹",options:[{value:"console",label:"æ§åˆ¶å°"},{value:"webhook",label:"Webhook"},{value:"email",label:"é‚®ä»¶"},{value:"sms",label:"çŸ­ä¿¡"}],defaultValue:"console"}}},{value:"transform",label:"æ•°æ®è½¬æ¢",description:"è½¬æ¢æˆ–ä¿®æ”¹æ•°æ®",configSchema:{output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"è½¬æ¢åçš„å­—æ®µå",description:"è½¬æ¢ç»“æœå­˜å‚¨çš„å­—æ®µå"},output_type:{type:"string",label:"è¾“å‡ºç±»å‹",options:[{value:"float",label:"æµ®ç‚¹æ•°"},{value:"int",label:"æ•´æ•°"},{value:"string",label:"å­—ç¬¦ä¸²"},{value:"boolean",label:"å¸ƒå°”å€¼"}],defaultValue:"float"},type:{type:"string",label:"è½¬æ¢ç±»å‹",required:!0,options:[{value:"scale",label:"æ•°å€¼ç¼©æ”¾"},{value:"offset",label:"æ•°å€¼åç§»"},{value:"expression",label:"è¡¨è¾¾å¼è®¡ç®—"},{value:"lookup",label:"æŸ¥æ‰¾è¡¨æ˜ å°„"},{value:"format",label:"æ ¼å¼åŒ–"}]}}},{value:"filter",label:"æ•°æ®è¿‡æ»¤",description:"è¿‡æ»¤æˆ–ç­›é€‰æ•°æ®",configSchema:{type:{type:"string",label:"è¿‡æ»¤ç±»å‹",required:!0,options:[{value:"range",label:"èŒƒå›´è¿‡æ»¤"},{value:"pattern",label:"æ¨¡å¼åŒ¹é…"},{value:"deduplication",label:"å»é‡è¿‡æ»¤"},{value:"rate_limit",label:"é€Ÿç‡é™åˆ¶"}]},drop_on_match:{type:"boolean",label:"åŒ¹é…æ—¶ä¸¢å¼ƒ",description:"true: åŒ¹é…æ¡ä»¶æ—¶ä¸¢å¼ƒæ•°æ®ï¼Œfalse: ä¸åŒ¹é…æ—¶ä¸¢å¼ƒ",defaultValue:!1}}},{value:"aggregate",label:"æ•°æ®èšåˆ",description:"ç»Ÿè®¡è®¡ç®—å’Œèšåˆ",configSchema:{functions:{type:"array",label:"èšåˆå‡½æ•°",required:!0,description:"é€‰æ‹©è¦è®¡ç®—çš„ç»Ÿè®¡å‡½æ•°",options:[{value:"count",label:"è®¡æ•°"},{value:"sum",label:"æ±‚å’Œ"},{value:"avg",label:"å¹³å‡å€¼"},{value:"min",label:"æœ€å°å€¼"},{value:"max",label:"æœ€å¤§å€¼"},{value:"stddev",label:"æ ‡å‡†å·®"},{value:"p90",label:"90åˆ†ä½æ•°"},{value:"p95",label:"95åˆ†ä½æ•°"}]},window_type:{type:"string",label:"çª—å£ç±»å‹",required:!0,options:[{value:"count",label:"è®¡æ•°çª—å£"},{value:"time",label:"æ—¶é—´çª—å£"},{value:"sliding",label:"æ»‘åŠ¨çª—å£"}]},window_size:{type:"number",label:"çª—å£å¤§å°",placeholder:"çª—å£å¤§å°ï¼ˆæ•°é‡æˆ–ç§’æ•°ï¼‰"}}},{value:"forward",label:"æ•°æ®è½¬å‘",description:"è½¬å‘æ•°æ®åˆ°å…¶ä»–ä¸»é¢˜",configSchema:{subject:{type:"string",label:"ç›®æ ‡ä¸»é¢˜",required:!0,placeholder:"iot.processed.{{device_id}}",description:"æ”¯æŒæ¨¡æ¿å˜é‡ï¼Œå¦‚ {{device_id}}, {{key}}"}}}],G={visual:{alert:"visual_alert",transform:"color_transform"},vector_generic:{alert:"generic_vector_alert",transform:"generic_vector_transform"},geospatial:{alert:"geospatial_alert",transform:"geospatial_transform"},vector3d:{alert:"vector3d_alert",transform:"vector3d_transform"}},D=(()=>{if(c.length>0){const x=c[0].value;if(x.includes("color")||x.includes("visual"))return"visual";if(x.includes("vector")&&x.includes("generic"))return"vector_generic";if(x.includes("geospatial"))return"geospatial";if(x.includes("vector3d"))return"vector3d"}const i=C?.toLowerCase()||"";return i.includes("è§†è§‰")||i.includes("visual")||i.includes("é¢œè‰²")||i.includes("color")?"visual":i.includes("é€šç”¨å‘é‡")||i.includes("generic")||i.includes("vector")?"vector_generic":i.includes("åœ°ç†")||i.includes("geospatial")||i.includes("ä½ç½®")||i.includes("location")?"geospatial":i.includes("3d")||i.includes("å‘é‡3d")||i.includes("vector3d")?"vector3d":"unknown"})(),_=Ht.useCallback(i=>{if(c.some(j=>j.value===i))return i;const x=G[D];if(x&&x[i]){const j=x[i];return console.log(`ActionFormBuilder: åŠ¨ä½œç±»å‹æ˜ å°„ "${i}" -> "${j}" (æ•°æ®ç±»å‹: ${D})`),j}return i},[c,D]),k=[...S.filter(i=>M.includes(i.value)),...c];b.useEffect(()=>{console.log("ActionFormBuilderæ¥æ”¶åˆ°æ–°çš„value:",h);const i=h.map(x=>{const j=_(x.type);return j!==x.type?(console.log(`ActionFormBuilder: è½¬æ¢åŠ¨ä½œç±»å‹ "${x.type}" -> "${j}"`),{...x,type:j}):x});m(i),i.some((x,j)=>x.type!==h[j]?.type)&&(console.log("ActionFormBuilder: åŠ¨ä½œç±»å‹å·²è½¬æ¢ï¼Œå¼‚æ­¥é€šçŸ¥çˆ¶ç»„ä»¶"),setTimeout(()=>{v?.(i)},0))},[h,_]);const q=i=>{console.log("ActionFormBuilder updateActions:",i),m(i),v?.(i)},X=()=>{const i={type:"alert",config:{},async:!1,timeout:"0s",retry:0};q([...V,i])},N=i=>{const x=V.filter((j,H)=>H!==i);q(x)},$=(i,x)=>{const j=[...V];j[i]=x,q(j)},L=(i,x,j,H)=>{const{type:Q,label:A,required:re,placeholder:U,description:le,options:te,defaultValue:ae}=x;switch(console.log(`æ¸²æŸ“é…ç½®å­—æ®µ ${i}:`,{type:Q,value:j,defaultValue:ae}),Q){case"string":return te?e.jsx(O,{placeholder:U||`é€‰æ‹©${A}`,value:j!==void 0?j:ae,onChange:o=>{console.log(`Selectå­—æ®µ ${i} å˜æ›´:`,o),H(o)},size:"large",children:te.map(o=>e.jsx(xt,{value:o.value,children:o.label},o.value))}):e.jsx(B,{placeholder:U,value:j!==void 0?j:ae,onChange:o=>{console.log(`Inputå­—æ®µ ${i} å˜æ›´:`,o.target.value),H(o.target.value)},size:"large"});case"textarea":return e.jsx(ht,{rows:3,placeholder:U,value:j!==void 0?j:ae,onChange:o=>{console.log(`TextAreaå­—æ®µ ${i} å˜æ›´:`,o.target.value),H(o.target.value)},size:"large"});case"number":return e.jsx(W,{style:{width:"100%"},placeholder:U,value:j!==void 0?j:ae,onChange:o=>{console.log(`InputNumberå­—æ®µ ${i} å˜æ›´:`,o),H(o)},size:"large"});case"boolean":return e.jsx(he,{checked:j!==void 0?j:ae,onChange:o=>{console.log(`Switchå­—æ®µ ${i} å˜æ›´:`,o),H(o)}});case"array":return te?e.jsx(O,{mode:"multiple",placeholder:U||`é€‰æ‹©${A}`,value:j||[],onChange:o=>{console.log(`å¤šé€‰å­—æ®µ ${i} å˜æ›´:`,o),H(o)},size:"large",children:te.map(o=>e.jsx(xt,{value:o.value,children:o.label},o.value))}):e.jsx(ht,{rows:2,placeholder:"æ¯è¡Œä¸€ä¸ªå€¼",value:j!==void 0?j:ae,onChange:o=>{console.log(`æ•°ç»„TextAreaå­—æ®µ ${i} å˜æ›´:`,o.target.value),H(o.target.value)},size:"large"});case"object":return e.jsx(ht,{rows:3,placeholder:U||"JSONæ ¼å¼çš„å¯¹è±¡",value:typeof j=="object"?JSON.stringify(j,null,2):j||"",onChange:o=>{try{const y=JSON.parse(o.target.value);console.log(`å¯¹è±¡å­—æ®µ ${i} å˜æ›´:`,y),H(y)}catch{console.log(`å¯¹è±¡å­—æ®µ ${i} å˜æ›´ (æ–‡æœ¬):`,o.target.value),H(o.target.value)}},size:"large"});default:return e.jsx(B,{placeholder:U,value:j!==void 0?j:ae,onChange:o=>{console.log(`é»˜è®¤Inputå­—æ®µ ${i} å˜æ›´:`,o.target.value),H(o.target.value)},size:"large"})}},s=i=>({level:e.jsx(kt,{style:{color:"#fa8c16"}}),message:e.jsx(ce,{style:{color:"#1890ff"}}),type:e.jsx(be,{style:{color:"#52c41a"}}),output_key:e.jsx(dt,{style:{color:"#722ed1"}}),output_type:e.jsx(Me,{style:{color:"#13c2c2"}}),transform_type:e.jsx(se,{style:{color:"#eb2f96"}}),subject:e.jsx(dt,{style:{color:"#fa541c"}}),functions:e.jsx(se,{style:{color:"#1890ff"}}),window_type:e.jsx(_e,{style:{color:"#52c41a"}}),window_size:e.jsx(ce,{style:{color:"#fa8c16"}})})[i]||e.jsx(be,{style:{color:"#666666"}}),t=(i,x)=>{const j=_(i.type),H=k.find(Q=>Q.value===j);return H?.configSchema?e.jsx(I,{size:"small",style:{marginTop:16,backgroundColor:"#fafcff",border:"1px solid #e8f4fd"},title:e.jsxs(p,{children:[e.jsx(be,{style:{color:"#1890ff"}}),e.jsx("span",{children:"åŠ¨ä½œé…ç½®"}),e.jsx(g,{color:"blue",children:H.label})]}),children:e.jsx(Z,{gutter:[16,16],children:Object.entries(H.configSchema).map(([Q,A])=>{if(A.conditionalDisplay){const{dependsOn:U,showWhen:le}=A.conditionalDisplay,te=i.config?.[U];if(!le.includes(te))return null}const re=A.type==="textarea"||A.type==="array"?24:(A.type==="boolean",12);return e.jsx(R,{span:re,children:e.jsxs(u.Item,{label:e.jsxs(p,{size:"small",children:[s(Q),e.jsx("span",{children:A.label}),A.required&&e.jsx(g,{color:"red",size:"small",children:"å¿…å¡«"})]}),children:[L(Q,A,i.config?.[Q],U=>{const le={...i,config:{...i.config,[Q]:U}};$(x,le)}),A.description&&e.jsx("div",{style:{marginTop:4},children:e.jsxs(Dt,{type:"secondary",style:{fontSize:11},children:[e.jsx(ce,{style:{marginRight:4}}),A.description]})})]})},Q)})})}):null},l=i=>({alert:e.jsx(kt,{style:{color:"#fa8c16"}}),transform:e.jsx(Me,{style:{color:"#52c41a"}}),filter:e.jsx(_e,{style:{color:"#1890ff"}}),aggregate:e.jsx(se,{style:{color:"#722ed1"}}),forward:e.jsx(dt,{style:{color:"#13c2c2"}})})[i]||e.jsx(be,{style:{color:"#666666"}}),r=i=>({alert:"#fa8c16",transform:"#52c41a",filter:"#1890ff",aggregate:"#722ed1",forward:"#13c2c2"})[i]||"#666666",n=(i,x)=>{const j=_(i.type),H=k.find(A=>A.value===j),Q=r(j);return H||(console.warn(`ActionFormBuilder: æ‰¾ä¸åˆ°åŠ¨ä½œç±»å‹ "${j}" (åŸå§‹: "${i.type}")ï¼Œå¯ç”¨ç±»å‹:`,k.map(A=>A.value)),console.warn(`ActionFormBuilder: å½“å‰æ•°æ®ç±»å‹: ${D}, æ˜ å°„è§„åˆ™:`,G[D])),e.jsxs(I,{size:"small",style:{marginBottom:16,border:`2px solid ${Q}20`,borderRadius:8},title:e.jsxs(p,{children:[l(j),e.jsxs("span",{children:["åŠ¨ä½œ ",x+1]}),H&&e.jsx(g,{color:Q.replace("#",""),style:{marginLeft:8},children:H.label})]}),extra:V.length>1&&e.jsx(oe,{title:"åˆ é™¤è¿™ä¸ªåŠ¨ä½œ",children:e.jsx(E,{type:"link",icon:e.jsx(Ee,{}),danger:!0,size:"small",onClick:()=>N(x),children:"åˆ é™¤"})}),children:[e.jsxs(Z,{gutter:[16,16],children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:e.jsxs(p,{size:"small",children:[e.jsx(be,{style:{color:"#1890ff"}}),e.jsx("span",{children:"åŠ¨ä½œç±»å‹"})]}),children:e.jsx(O,{value:j,onChange:A=>{const re=k.find(le=>le.value===A),U={...i,type:A,config:re?.configSchema?{}:i.config};$(x,U)},size:"large",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©åŠ¨ä½œç±»å‹",showSearch:!0,optionFilterProp:"children",optionLabelProp:"label",children:k.map(A=>e.jsx(xt,{value:A.value,label:A.label,title:A.description,children:e.jsxs(p,{size:"small",children:[l(A.value),e.jsx("span",{children:A.label}),A.description&&e.jsxs(Dt,{type:"secondary",style:{fontSize:"12px"},children:["- ",A.description]})]})},A.value))})})}),e.jsx(R,{span:6,children:e.jsx(u.Item,{label:e.jsxs(p,{size:"small",children:[e.jsx(jt,{style:{color:"#52c41a"}}),e.jsx("span",{children:"å¼‚æ­¥æ‰§è¡Œ"})]}),children:e.jsx(he,{checked:i.async,onChange:A=>$(x,{...i,async:A}),checkedChildren:"å¼‚æ­¥",unCheckedChildren:"åŒæ­¥"})})}),e.jsx(R,{span:6,children:e.jsx(u.Item,{label:e.jsxs(p,{size:"small",children:[e.jsx(ce,{style:{color:"#fa8c16"}}),e.jsx("span",{children:"é‡è¯•æ¬¡æ•°"})]}),children:e.jsx(W,{min:0,max:10,value:i.retry,onChange:A=>$(x,{...i,retry:A||0}),size:"large",style:{width:"100%"}})})})]}),i.type&&e.jsx(P,{message:"åŠ¨ä½œé¢„è§ˆ",description:e.jsxs(p,{direction:"vertical",size:"small",children:[e.jsxs(g,{color:r(i.type).replace("#",""),style:{fontSize:"12px"},children:["ç±»å‹: ",H?.label||i.type]}),e.jsxs(p,{size:"small",children:[e.jsx(g,{color:i.async?"green":"blue",style:{fontSize:"11px"},children:i.async?"å¼‚æ­¥æ‰§è¡Œ":"åŒæ­¥æ‰§è¡Œ"}),i.retry>0&&e.jsxs(g,{color:"orange",style:{fontSize:"11px"},children:["é‡è¯• ",i.retry," æ¬¡"]})]})]}),type:"info",showIcon:!0,style:{marginTop:12,marginBottom:8},size:"small"}),t(i,x)]},x)};return e.jsxs(I,{title:e.jsxs(p,{children:[e.jsx(be,{style:{color:"#1890ff"}}),e.jsxs("span",{children:[C,"åŠ¨ä½œé…ç½®"]}),e.jsx(g,{color:"blue",children:"è§„åˆ™æ‰§è¡Œ"})]}),style:{border:"1px solid #e8f4fd",borderRadius:8,backgroundColor:"#fafcff"},children:[e.jsx(P,{message:"åŠ¨ä½œæ‰§è¡Œè¯´æ˜",description:"é…ç½®è§„åˆ™è§¦å‘æ—¶æ‰§è¡Œçš„åŠ¨ä½œï¼Œæ”¯æŒå¤šç§åŠ¨ä½œç±»å‹å’Œæ‰§è¡Œç­–ç•¥",type:"info",showIcon:!0,style:{marginBottom:16},size:"small"}),V.map((i,x)=>n(i,x)),e.jsx(E,{type:"dashed",icon:e.jsx($e,{}),onClick:X,style:{width:"100%",height:"48px",borderColor:"#1890ff",color:"#1890ff"},size:"large",children:"æ·»åŠ åŠ¨ä½œ"})]})},{TextArea:Oa}=B,{Text:ne,Paragraph:Xa}=pe,{Panel:Na}=lt,Ge=({value:h="",onChange:v,dataType:M="generic",availableFunctions:c=[],availableVariables:C=[],placeholder:V="è¾“å…¥è¡¨è¾¾å¼...",rows:m=4})=>{const[S,G]=b.useState(!1),J=[{name:"abs",description:"ç»å¯¹å€¼",syntax:"abs(number)",example:"abs(-5) // è¿”å› 5",category:"æ•°å­¦å‡½æ•°"},{name:"max",description:"æœ€å¤§å€¼",syntax:"max(a, b)",example:"max(10, 20) // è¿”å› 20",category:"æ•°å­¦å‡½æ•°"},{name:"min",description:"æœ€å°å€¼",syntax:"min(a, b)",example:"min(10, 20) // è¿”å› 10",category:"æ•°å­¦å‡½æ•°"},{name:"sqrt",description:"å¹³æ–¹æ ¹",syntax:"sqrt(number)",example:"sqrt(16) // è¿”å› 4",category:"æ•°å­¦å‡½æ•°"},{name:"pow",description:"å¹‚è¿ç®—",syntax:"pow(base, exp)",example:"pow(2, 3) // è¿”å› 8",category:"æ•°å­¦å‡½æ•°"},{name:"round",description:"å››èˆäº”å…¥",syntax:"round(number)",example:"round(3.14) // è¿”å› 3",category:"æ•°å­¦å‡½æ•°"},{name:"len",description:"å­—ç¬¦ä¸²é•¿åº¦",syntax:"len(string)",example:'len("hello") // è¿”å› 5',category:"å­—ç¬¦ä¸²å‡½æ•°"},{name:"contains",description:"åŒ…å«æ£€æŸ¥",syntax:"contains(str, substr)",example:'contains("hello", "ell") // è¿”å› true',category:"å­—ç¬¦ä¸²å‡½æ•°"},{name:"startswith",description:"å¼€å¤´åŒ¹é…",syntax:"startswith(str, prefix)",example:'startswith("hello", "he") // è¿”å› true',category:"å­—ç¬¦ä¸²å‡½æ•°"},{name:"endswith",description:"ç»“å°¾åŒ¹é…",syntax:"endswith(str, suffix)",example:'endswith("hello", "lo") // è¿”å› true',category:"å­—ç¬¦ä¸²å‡½æ•°"},{name:"upper",description:"è½¬å¤§å†™",syntax:"upper(string)",example:'upper("hello") // è¿”å› "HELLO"',category:"å­—ç¬¦ä¸²å‡½æ•°"},{name:"lower",description:"è½¬å°å†™",syntax:"lower(string)",example:'lower("HELLO") // è¿”å› "hello"',category:"å­—ç¬¦ä¸²å‡½æ•°"},{name:"now",description:"å½“å‰æ—¶é—´æˆ³",syntax:"now()",example:"now() // è¿”å›å½“å‰Unixæ—¶é—´æˆ³",category:"æ—¶é—´å‡½æ•°"},{name:"timeFormat",description:"æ—¶é—´æ ¼å¼åŒ–",syntax:"timeFormat(timestamp, format)",example:'timeFormat(now(), "2006-01-02 15:04:05")',category:"æ—¶é—´å‡½æ•°"}],D=s=>{switch(s){case"vector3d":return[{name:"vectorMagnitude",description:"3Då‘é‡æ¨¡é•¿",syntax:"vectorMagnitude(x, y, z)",example:"vectorMagnitude(acceleration.x, acceleration.y, acceleration.z)",category:"å‘é‡å‡½æ•°"}];case"vector":case"vector_generic":return[{name:"genericVectorMagnitude",description:"é€šç”¨å‘é‡æ¨¡é•¿",syntax:"genericVectorMagnitude(vector)",example:"genericVectorMagnitude(sensor_vector)",category:"å‘é‡å‡½æ•°"},{name:"vectorMean",description:"å‘é‡å…ƒç´ å¹³å‡å€¼",syntax:"vectorMean(vector)",example:"vectorMean(sensor_vector)",category:"å‘é‡å‡½æ•°"}];case"array":return[{name:"arraySum",description:"æ•°ç»„æ±‚å’Œ",syntax:"arraySum(array)",example:"arraySum(sensor_readings)",category:"æ•°ç»„å‡½æ•°"},{name:"arrayMean",description:"æ•°ç»„å¹³å‡å€¼",syntax:"arrayMean(array)",example:"arrayMean(sensor_readings)",category:"æ•°ç»„å‡½æ•°"},{name:"arrayMax",description:"æ•°ç»„æœ€å¤§å€¼",syntax:"arrayMax(array)",example:"arrayMax(sensor_readings)",category:"æ•°ç»„å‡½æ•°"},{name:"arrayMin",description:"æ•°ç»„æœ€å°å€¼",syntax:"arrayMin(array)",example:"arrayMin(sensor_readings)",category:"æ•°ç»„å‡½æ•°"}];case"geospatial":case"location":return[{name:"distance",description:"GPSè·ç¦»è®¡ç®—",syntax:"distance(lat1, lon1, lat2, lon2)",example:"distance(location.latitude, location.longitude, 39.9, 116.4)",category:"åœ°ç†å‡½æ•°"}];default:return[]}},_=[{name:"value",description:"å½“å‰æ•°æ®å€¼",type:"any",example:"value > 30"},{name:"device_id",description:"è®¾å¤‡ID",type:"string",example:'contains(device_id, "sensor")'},{name:"key",description:"æ•°æ®é”®å",type:"string",example:'key == "temperature"'},{name:"timestamp",description:"æ—¶é—´æˆ³",type:"number",example:"timestamp > now() - 3600"},{name:"quality",description:"æ•°æ®è´¨é‡",type:"number",example:"quality == 0"}],k=[...J,...D(M),...c],q=[..._,...C],X=k.reduce((s,t)=>(s[t.category]||(s[t.category]=[]),s[t.category].push(t),s),{}),N=s=>{if(v){const t=h+s;v(t)}},$=()=>e.jsx(lt,{size:"small",children:Object.entries(X).map(([s,t])=>e.jsx(Na,{header:s,children:e.jsx(De,{size:"small",dataSource:t,renderItem:l=>e.jsx(De.Item,{actions:[e.jsx(E,{type:"link",size:"small",onClick:()=>N(l.syntax),children:"æ’å…¥"})],children:e.jsx(De.Item.Meta,{title:e.jsxs(p,{children:[e.jsx(ne,{code:!0,children:l.name}),e.jsx(ne,{type:"secondary",children:l.description})]}),description:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(ne,{strong:!0,children:"è¯­æ³•ï¼š"}),e.jsx(ne,{code:!0,children:l.syntax})]}),e.jsxs("div",{children:[e.jsx(ne,{strong:!0,children:"ç¤ºä¾‹ï¼š"}),e.jsx(ne,{code:!0,style:{color:"#52c41a"},children:l.example})]})]})})})})},s))}),L=()=>e.jsx(De,{size:"small",header:e.jsx(ne,{strong:!0,children:"å¯ç”¨å˜é‡"}),dataSource:q,renderItem:s=>e.jsx(De.Item,{actions:[e.jsx(E,{type:"link",size:"small",onClick:()=>N(s.name),children:"æ’å…¥"})],children:e.jsx(De.Item.Meta,{title:e.jsxs(p,{children:[e.jsx(ne,{code:!0,children:s.name}),e.jsx(g,{color:"blue",children:s.type}),e.jsx(ne,{type:"secondary",children:s.description})]}),description:s.example&&e.jsxs("div",{children:[e.jsx(ne,{strong:!0,children:"ç¤ºä¾‹ï¼š"}),e.jsx(ne,{code:!0,style:{color:"#52c41a"},children:s.example})]})})})});return e.jsx("div",{children:e.jsxs(I,{title:e.jsxs(p,{children:[e.jsx(de,{}),e.jsx(ne,{children:"è¡¨è¾¾å¼ç¼–è¾‘å™¨"}),e.jsx(E,{type:"link",icon:e.jsx(ce,{}),onClick:()=>G(!S),children:S?"éšè—å¸®åŠ©":"æ˜¾ç¤ºå¸®åŠ©"})]}),size:"small",children:[e.jsx(Oa,{value:h,onChange:s=>v?.(s.target.value),placeholder:V,rows:m,style:{fontFamily:"Consolas, Monaco, monospace"}}),S&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx(I,{size:"small",title:e.jsxs(ne,{children:[e.jsx(se,{})," å‡½æ•°å‚è€ƒ"]}),children:$()}),e.jsx(I,{size:"small",title:"å˜é‡å‚è€ƒ",style:{marginTop:16},children:L()})]}),e.jsx("div",{style:{marginTop:8},children:e.jsx(ne,{type:"secondary",style:{fontSize:12},children:"æ”¯æŒJavaScriptè¯­æ³•ï¼Œä½¿ç”¨ && (AND), || (OR), ! (NOT) è¿›è¡Œé€»è¾‘è¿ç®—"})})]})})},{Option:ee}=O,{Text:Ra}=pe,{TextArea:Da}=B,Aa=({visible:h,onClose:v,onSave:M,rule:c,dataType:C="array"})=>{const V=z=>{if(z.data_type)return z.data_type;if(z.tags){const F=z.tags.data_type||z.tags.data_category;if(F)return F}if(z.conditions){const F=JSON.stringify(z.conditions).toLowerCase();if(F.includes("array")||F.includes("length")||F.includes("size"))return"array";if(F.includes("matrix")||F.includes("rows")||F.includes("cols"))return"matrix";if(F.includes("timeseries")||F.includes("trend")||F.includes("seasonality"))return"timeseries";if(F.includes("mixed")||F.includes("nested")||F.includes("field_count"))return"mixed"}if(z.actions&&z.actions.length>0){const F=z.actions[0];if(F.type.includes("array"))return"array";if(F.type.includes("matrix"))return"matrix";if(F.type.includes("timeseries"))return"timeseries"}return"array"},m=c&&h?V(c):typeof C=="string"?C:C&&typeof C=="object"&&"key"in C?C.key:"array",{form:S,saving:G,validationErrors:J,handleSave:D,handleCancel:_}=Pe({visible:h,onClose:v,onSave:M,rule:c,title:"å¤æ‚æ•°æ®è§„åˆ™ç¼–è¾‘å™¨",dataTypeName:j(m)}),k=()=>{X(void 0),$([]),s("basic"),l(""),n(""),_()},[q,X]=b.useState(c?.conditions),[N,$]=b.useState(c?.actions||[]),[L,s]=b.useState("basic"),[t,l]=b.useState(""),[r,n]=b.useState("");b.useEffect(()=>{h&&c&&(console.log("å¤æ‚æ•°æ®ç¼–è¾‘å™¨åŠ è½½è§„åˆ™æ•°æ®:",c),console.log("åŠ è½½çš„åŠ¨ä½œé…ç½®:",c.actions),X(c.conditions),$(c.actions||[]),i())},[h,c]),b.useEffect(()=>{(L==="json"||L==="preview")&&i()},[N,q,L]);const i=()=>{try{const z={id:c?.id||"",name:S.getFieldValue("name")||"",description:S.getFieldValue("description")||"",priority:S.getFieldValue("priority")||50,enabled:S.getFieldValue("enabled")!==!1,data_type:m,conditions:q,actions:N,tags:{...c?.tags,data_type:m,data_category:"complex"},version:c?.version||1,created_at:c?.created_at||new Date().toISOString(),updated_at:new Date().toISOString()};l(JSON.stringify(z,null,2)),n("")}catch{n("JSONç”Ÿæˆå¤±è´¥")}},x=z=>{l(z);try{const F=JSON.parse(z);F.name&&F.conditions&&F.actions?(n(""),S.setFieldsValue({name:F.name,description:F.description,priority:F.priority,enabled:F.enabled}),X(F.conditions),$(F.actions||[])):n("JSONæ ¼å¼ä¸å®Œæ•´ï¼Œç¼ºå°‘å¿…è¦å­—æ®µ")}catch{n("JSONæ ¼å¼é”™è¯¯")}};function j(z){return{array:"æ•°ç»„æ•°æ®",matrix:"çŸ©é˜µæ•°æ®",timeseries:"æ—¶é—´åºåˆ—æ•°æ®",mixed:"æ··åˆç±»å‹æ•°æ®",json:"JSONæ•°æ®",nested:"åµŒå¥—æ•°æ®ç»“æ„",graph:"å›¾æ•°æ®ç»“æ„",tree:"æ ‘å½¢æ•°æ®ç»“æ„"}[z]||"å¤æ‚æ•°æ®"}const H=z=>{switch(z){case"array":return[{value:"array.length",label:"æ•°ç»„é•¿åº¦",description:"æ•°ç»„å…ƒç´ çš„æ€»æ•°"},{value:"array.size",label:"æ•°ç»„å¤§å°",description:"æ•°ç»„çš„å­—èŠ‚å¤§å°"},{value:"array.sum",label:"æ•°ç»„æ±‚å’Œ",description:"æ•°ç»„æ‰€æœ‰å…ƒç´ çš„å’Œ"},{value:"array.mean",label:"æ•°ç»„å‡å€¼",description:"æ•°ç»„å…ƒç´ çš„å¹³å‡å€¼"},{value:"array.median",label:"æ•°ç»„ä¸­ä½æ•°",description:"æ•°ç»„çš„ä¸­ä½æ•°"},{value:"array.min",label:"æ•°ç»„æœ€å°å€¼",description:"æ•°ç»„ä¸­çš„æœ€å°å…ƒç´ "},{value:"array.max",label:"æ•°ç»„æœ€å¤§å€¼",description:"æ•°ç»„ä¸­çš„æœ€å¤§å…ƒç´ "},{value:"array.std",label:"æ ‡å‡†å·®",description:"æ•°ç»„å…ƒç´ çš„æ ‡å‡†åå·®"},{value:"array.variance",label:"æ–¹å·®",description:"æ•°ç»„å…ƒç´ çš„æ–¹å·®"},{value:"array[0]",label:"ç¬¬ä¸€ä¸ªå…ƒç´ ",description:"æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ "},{value:"array[-1]",label:"æœ€åä¸€ä¸ªå…ƒç´ ",description:"æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ "},{value:"array.type",label:"å…ƒç´ ç±»å‹",description:"æ•°ç»„å…ƒç´ çš„æ•°æ®ç±»å‹"},{value:"array.unique_count",label:"å”¯ä¸€å…ƒç´ æ•°",description:"æ•°ç»„ä¸­å”¯ä¸€å…ƒç´ çš„æ•°é‡"},{value:"array.null_count",label:"ç©ºå€¼æ•°é‡",description:"æ•°ç»„ä¸­ç©ºå€¼çš„æ•°é‡"}];case"matrix":return[{value:"matrix.rows",label:"çŸ©é˜µè¡Œæ•°",description:"çŸ©é˜µçš„è¡Œæ•°"},{value:"matrix.cols",label:"çŸ©é˜µåˆ—æ•°",description:"çŸ©é˜µçš„åˆ—æ•°"},{value:"matrix.size",label:"çŸ©é˜µå¤§å°",description:"çŸ©é˜µçš„æ€»å…ƒç´ æ•°"},{value:"matrix.rank",label:"çŸ©é˜µç§©",description:"çŸ©é˜µçš„ç§©"},{value:"matrix.determinant",label:"è¡Œåˆ—å¼",description:"çŸ©é˜µçš„è¡Œåˆ—å¼å€¼"},{value:"matrix.trace",label:"çŸ©é˜µè¿¹",description:"çŸ©é˜µå¯¹è§’çº¿å…ƒç´ çš„å’Œ"},{value:"matrix.norm",label:"çŸ©é˜µèŒƒæ•°",description:"çŸ©é˜µçš„èŒƒæ•°"},{value:"matrix.condition",label:"æ¡ä»¶æ•°",description:"çŸ©é˜µçš„æ¡ä»¶æ•°"},{value:"matrix.eigenvalues",label:"ç‰¹å¾å€¼",description:"çŸ©é˜µçš„ç‰¹å¾å€¼"},{value:"matrix.is_symmetric",label:"æ˜¯å¦å¯¹ç§°",description:"çŸ©é˜µæ˜¯å¦ä¸ºå¯¹ç§°çŸ©é˜µ"},{value:"matrix.is_positive_definite",label:"æ˜¯å¦æ­£å®š",description:"çŸ©é˜µæ˜¯å¦ä¸ºæ­£å®šçŸ©é˜µ"},{value:"matrix[0,0]",label:"ç¬¬ä¸€ä¸ªå…ƒç´ ",description:"çŸ©é˜µ(0,0)ä½ç½®çš„å…ƒç´ "},{value:"matrix.sparsity",label:"ç¨€ç–åº¦",description:"çŸ©é˜µçš„ç¨€ç–ç¨‹åº¦"}];case"timeseries":return[{value:"timeseries.length",label:"åºåˆ—é•¿åº¦",description:"æ—¶é—´åºåˆ—çš„æ•°æ®ç‚¹æ•°é‡"},{value:"timeseries.duration",label:"æ—¶é—´è·¨åº¦",description:"æ—¶é—´åºåˆ—çš„æ€»æ—¶é•¿"},{value:"timeseries.frequency",label:"é‡‡æ ·é¢‘ç‡",description:"æ•°æ®é‡‡æ ·çš„é¢‘ç‡"},{value:"timeseries.interval",label:"é‡‡æ ·é—´éš”",description:"ç›¸é‚»æ•°æ®ç‚¹çš„æ—¶é—´é—´éš”"},{value:"timeseries.trend",label:"è¶‹åŠ¿æ–¹å‘",description:"æ—¶é—´åºåˆ—çš„æ•´ä½“è¶‹åŠ¿"},{value:"timeseries.seasonality",label:"å­£èŠ‚æ€§",description:"æ˜¯å¦å…·æœ‰å­£èŠ‚æ€§æ¨¡å¼"},{value:"timeseries.volatility",label:"æ³¢åŠ¨æ€§",description:"æ—¶é—´åºåˆ—çš„æ³¢åŠ¨ç¨‹åº¦"},{value:"timeseries.autocorr",label:"è‡ªç›¸å…³æ€§",description:"æ—¶é—´åºåˆ—çš„è‡ªç›¸å…³ç³»æ•°"},{value:"timeseries.stationarity",label:"å¹³ç¨³æ€§",description:"æ—¶é—´åºåˆ—çš„å¹³ç¨³æ€§"},{value:"timeseries.mean",label:"åºåˆ—å‡å€¼",description:"æ—¶é—´åºåˆ—çš„å¹³å‡å€¼"},{value:"timeseries.std",label:"åºåˆ—æ ‡å‡†å·®",description:"æ—¶é—´åºåˆ—çš„æ ‡å‡†åå·®"},{value:"timeseries.missing_rate",label:"ç¼ºå¤±ç‡",description:"ç¼ºå¤±æ•°æ®ç‚¹çš„æ¯”ä¾‹"},{value:"timeseries.outlier_count",label:"å¼‚å¸¸ç‚¹æ•°",description:"æ—¶é—´åºåˆ—ä¸­å¼‚å¸¸ç‚¹çš„æ•°é‡"}];case"mixed":return[{value:"data.structure_type",label:"æ•°æ®ç»“æ„ç±»å‹",description:"æ··åˆæ•°æ®çš„ä¸»è¦ç»“æ„ç±»å‹"},{value:"data.complexity",label:"å¤æ‚åº¦",description:"æ•°æ®ç»“æ„çš„å¤æ‚ç¨‹åº¦"},{value:"data.nested_levels",label:"åµŒå¥—å±‚çº§",description:"æ•°æ®åµŒå¥—çš„æœ€å¤§å±‚æ•°"},{value:"data.field_count",label:"å­—æ®µæ•°é‡",description:"æ•°æ®ä¸­å­—æ®µçš„æ€»æ•°"},{value:"data.type_diversity",label:"ç±»å‹å¤šæ ·æ€§",description:"åŒ…å«çš„æ•°æ®ç±»å‹ç§ç±»æ•°"},{value:"data.size_bytes",label:"æ•°æ®å¤§å°",description:"æ•°æ®çš„å­—èŠ‚å¤§å°"},{value:"data.null_fields",label:"ç©ºå­—æ®µæ•°",description:"å€¼ä¸ºç©ºçš„å­—æ®µæ•°é‡"},{value:"data.array_fields",label:"æ•°ç»„å­—æ®µæ•°",description:"åŒ…å«çš„æ•°ç»„ç±»å‹å­—æ®µæ•°"},{value:"data.object_fields",label:"å¯¹è±¡å­—æ®µæ•°",description:"åŒ…å«çš„å¯¹è±¡ç±»å‹å­—æ®µæ•°"}];default:return[{value:"data.size",label:"æ•°æ®å¤§å°",description:"æ•°æ®ç»“æ„çš„å¤§å°"},{value:"data.type",label:"æ•°æ®ç±»å‹",description:"æ•°æ®çš„ç±»å‹æ ‡è¯†"},{value:"data.complexity",label:"å¤æ‚åº¦",description:"æ•°æ®ç»“æ„çš„å¤æ‚ç¨‹åº¦"}]}},Q=z=>{switch(z){case"array":return[{value:"array_transform",label:"æ•°ç»„è½¬æ¢",description:"æ•°ç»„ç»Ÿè®¡ã€æ’åºã€ç­›é€‰ç­‰æ“ä½œ",configSchema:{transform_type:{type:"string",label:"è½¬æ¢ç±»å‹",required:!0,options:[{value:"statistics",label:"ç»Ÿè®¡è®¡ç®—"},{value:"sort",label:"æ•°ç»„æ’åº"},{value:"filter",label:"æ•°ç»„ç­›é€‰"},{value:"slice",label:"æ•°ç»„åˆ‡ç‰‡"},{value:"reshape",label:"æ•°ç»„é‡å¡‘"},{value:"normalize",label:"æ•°æ®æ ‡å‡†åŒ–"},{value:"aggregate",label:"èšåˆæ“ä½œ"},{value:"deduplication",label:"å»é‡å¤„ç†"}]},functions:{type:"array",label:"ç»Ÿè®¡å‡½æ•°",description:"é€‰æ‹©è¦è®¡ç®—çš„ç»Ÿè®¡å‡½æ•°",options:[{value:"mean",label:"å¹³å‡å€¼"},{value:"median",label:"ä¸­ä½æ•°"},{value:"std",label:"æ ‡å‡†å·®"},{value:"var",label:"æ–¹å·®"},{value:"min",label:"æœ€å°å€¼"},{value:"max",label:"æœ€å¤§å€¼"},{value:"sum",label:"æ±‚å’Œ"},{value:"count",label:"è®¡æ•°"}]},start_index:{type:"number",label:"å¼€å§‹ç´¢å¼•",description:"åˆ‡ç‰‡æ“ä½œçš„å¼€å§‹ä½ç½®"},end_index:{type:"number",label:"ç»“æŸç´¢å¼•",description:"åˆ‡ç‰‡æ“ä½œçš„ç»“æŸä½ç½®"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"è½¬æ¢ç»“æœçš„å­—æ®µå",description:"è½¬æ¢ç»“æœå­˜å‚¨çš„å­—æ®µå"}}},{value:"array_expression",label:"æ•°ç»„è¡¨è¾¾å¼æ“ä½œ",description:"ä½¿ç”¨è¡¨è¾¾å¼å¯¹æ•°ç»„æ•°æ®è¿›è¡Œå¤æ‚è®¡ç®—å’Œå¤„ç†",configSchema:{expression:{type:"textarea",label:"è¡¨è¾¾å¼",required:!0,placeholder:"arraySum(data_array) / arrayMean(data_array)",description:"æ”¯æŒæ•°ç»„å‡½æ•°å’Œæ•°å­¦è¿ç®—çš„è¡¨è¾¾å¼"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"ç»“æœå­˜å‚¨çš„å­—æ®µå",description:"è¡¨è¾¾å¼è®¡ç®—ç»“æœå­˜å‚¨çš„å­—æ®µå"},output_type:{type:"string",label:"è¾“å‡ºç±»å‹",options:[{value:"number",label:"æ•°å€¼"},{value:"array",label:"æ•°ç»„"},{value:"boolean",label:"å¸ƒå°”å€¼"},{value:"string",label:"å­—ç¬¦ä¸²"}],defaultValue:"number"}}}];case"matrix":return[{value:"matrix_transform",label:"çŸ©é˜µè½¬æ¢",description:"çŸ©é˜µè¿ç®—ã€åˆ†è§£ã€å˜æ¢ç­‰æ“ä½œ",configSchema:{transform_type:{type:"string",label:"è½¬æ¢ç±»å‹",required:!0,options:[{value:"transpose",label:"çŸ©é˜µè½¬ç½®"},{value:"inverse",label:"çŸ©é˜µæ±‚é€†"},{value:"multiply",label:"çŸ©é˜µä¹˜æ³•"},{value:"decomposition",label:"çŸ©é˜µåˆ†è§£"},{value:"eigendecomp",label:"ç‰¹å¾åˆ†è§£"},{value:"svd",label:"å¥‡å¼‚å€¼åˆ†è§£"},{value:"flatten",label:"çŸ©é˜µå±•å¹³"},{value:"reshape",label:"çŸ©é˜µé‡å¡‘"}]},decomp_method:{type:"string",label:"åˆ†è§£æ–¹æ³•",options:[{value:"lu",label:"LUåˆ†è§£"},{value:"qr",label:"QRåˆ†è§£"},{value:"cholesky",label:"Choleskyåˆ†è§£"},{value:"eigen",label:"ç‰¹å¾åˆ†è§£"},{value:"svd",label:"å¥‡å¼‚å€¼åˆ†è§£"}]},target_shape:{type:"string",label:"ç›®æ ‡å½¢çŠ¶",placeholder:"ä¾‹å¦‚ï¼š[3, 4]",description:"é‡å¡‘åçš„çŸ©é˜µå½¢çŠ¶"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"è½¬æ¢ç»“æœçš„å­—æ®µå",description:"çŸ©é˜µæ“ä½œç»“æœçš„å­—æ®µå"}}},{value:"matrix_expression",label:"çŸ©é˜µè¡¨è¾¾å¼æ“ä½œ",description:"ä½¿ç”¨è¡¨è¾¾å¼å¯¹çŸ©é˜µæ•°æ®è¿›è¡Œå¤æ‚è®¡ç®—å’Œå¤„ç†",configSchema:{expression:{type:"textarea",label:"è¡¨è¾¾å¼",required:!0,placeholder:"matrixDeterminant(data_matrix) * matrixTrace(data_matrix)",description:"æ”¯æŒçŸ©é˜µå‡½æ•°å’Œæ•°å­¦è¿ç®—çš„è¡¨è¾¾å¼"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"ç»“æœå­˜å‚¨çš„å­—æ®µå",description:"è¡¨è¾¾å¼è®¡ç®—ç»“æœå­˜å‚¨çš„å­—æ®µå"},output_type:{type:"string",label:"è¾“å‡ºç±»å‹",options:[{value:"number",label:"æ•°å€¼"},{value:"matrix",label:"çŸ©é˜µ"},{value:"array",label:"æ•°ç»„"},{value:"boolean",label:"å¸ƒå°”å€¼"}],defaultValue:"number"}}}];case"timeseries":return[{value:"timeseries_transform",label:"æ—¶é—´åºåˆ—è½¬æ¢",description:"æ—¶é—´åºåˆ—åˆ†æã€é¢„æµ‹ã€ç‰¹å¾æå–",configSchema:{transform_type:{type:"string",label:"è½¬æ¢ç±»å‹",required:!0,options:[{value:"trend_analysis",label:"è¶‹åŠ¿åˆ†æ"},{value:"seasonality_decomp",label:"å­£èŠ‚æ€§åˆ†è§£"},{value:"smoothing",label:"æ•°æ®å¹³æ»‘"},{value:"differencing",label:"å·®åˆ†å¤„ç†"},{value:"resampling",label:"é‡é‡‡æ ·"},{value:"interpolation",label:"æ•°æ®æ’å€¼"},{value:"outlier_detection",label:"å¼‚å¸¸æ£€æµ‹"},{value:"feature_extraction",label:"ç‰¹å¾æå–"}]},window_size:{type:"number",label:"çª—å£å¤§å°",description:"åˆ†æçª—å£çš„å¤§å°"},method:{type:"string",label:"å¤„ç†æ–¹æ³•",options:[{value:"moving_average",label:"ç§»åŠ¨å¹³å‡"},{value:"exponential_smoothing",label:"æŒ‡æ•°å¹³æ»‘"},{value:"linear_interpolation",label:"çº¿æ€§æ’å€¼"},{value:"spline_interpolation",label:"æ ·æ¡æ’å€¼"}]},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"è½¬æ¢ç»“æœçš„å­—æ®µå",description:"æ—¶é—´åºåˆ—åˆ†æç»“æœçš„å­—æ®µå"}}},{value:"timeseries_expression",label:"æ—¶åºè¡¨è¾¾å¼æ“ä½œ",description:"ä½¿ç”¨è¡¨è¾¾å¼å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œå¤æ‚è®¡ç®—å’Œå¤„ç†",configSchema:{expression:{type:"textarea",label:"è¡¨è¾¾å¼",required:!0,placeholder:'trendDirection(ts_data) == "increasing" && volatility(ts_data) < 0.1',description:"æ”¯æŒæ—¶åºå‡½æ•°å’Œæ•°å­¦è¿ç®—çš„è¡¨è¾¾å¼"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"ç»“æœå­˜å‚¨çš„å­—æ®µå",description:"è¡¨è¾¾å¼è®¡ç®—ç»“æœå­˜å‚¨çš„å­—æ®µå"},output_type:{type:"string",label:"è¾“å‡ºç±»å‹",options:[{value:"number",label:"æ•°å€¼"},{value:"timeseries",label:"æ—¶é—´åºåˆ—"},{value:"boolean",label:"å¸ƒå°”å€¼"},{value:"string",label:"å­—ç¬¦ä¸²"}],defaultValue:"number"}}}];case"mixed":return[{value:"data_transform",label:"æ•°æ®è½¬æ¢",description:"æ··åˆæ•°æ®çš„è§£æã€è½¬æ¢ã€é‡æ„",configSchema:{transform_type:{type:"string",label:"è½¬æ¢ç±»å‹",required:!0,options:[{value:"flatten",label:"æ•°æ®å±•å¹³"},{value:"normalize",label:"æ•°æ®æ ‡å‡†åŒ–"},{value:"extract_fields",label:"å­—æ®µæå–"},{value:"type_conversion",label:"ç±»å‹è½¬æ¢"},{value:"structure_analysis",label:"ç»“æ„åˆ†æ"},{value:"validation",label:"æ•°æ®éªŒè¯"}]},extract_paths:{type:"array",label:"æå–è·¯å¾„",description:"JSONè·¯å¾„è¡¨è¾¾å¼ï¼Œå¦‚$.data.array[*]"},target_type:{type:"string",label:"ç›®æ ‡ç±»å‹",options:[{value:"array",label:"æ•°ç»„"},{value:"object",label:"å¯¹è±¡"},{value:"string",label:"å­—ç¬¦ä¸²"},{value:"number",label:"æ•°å­—"}]},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"è½¬æ¢ç»“æœçš„å­—æ®µå",description:"æ•°æ®è½¬æ¢ç»“æœçš„å­—æ®µå"}}},{value:"mixed_expression",label:"æ··åˆæ•°æ®è¡¨è¾¾å¼æ“ä½œ",description:"ä½¿ç”¨è¡¨è¾¾å¼å¯¹æ··åˆæ•°æ®è¿›è¡Œå¤æ‚è®¡ç®—å’Œå¤„ç†",configSchema:{expression:{type:"textarea",label:"è¡¨è¾¾å¼",required:!0,placeholder:'fieldCount(json_data) > 5 && hasField(json_data, "timestamp")',description:"æ”¯æŒç»“æ„å‡½æ•°å’Œæ•°å­¦è¿ç®—çš„è¡¨è¾¾å¼"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"ç»“æœå­˜å‚¨çš„å­—æ®µå",description:"è¡¨è¾¾å¼è®¡ç®—ç»“æœå­˜å‚¨çš„å­—æ®µå"},output_type:{type:"string",label:"è¾“å‡ºç±»å‹",options:[{value:"number",label:"æ•°å€¼"},{value:"object",label:"å¯¹è±¡"},{value:"array",label:"æ•°ç»„"},{value:"boolean",label:"å¸ƒå°”å€¼"},{value:"string",label:"å­—ç¬¦ä¸²"}],defaultValue:"boolean"}}}];default:return[]}},A=z=>{const F=[{name:"size",description:"è·å–æ•°æ®å¤§å°",syntax:"size(data)",example:"size(array) > 10",category:"é€šç”¨å‡½æ•°",parameters:["data"]},{name:"type",description:"è·å–æ•°æ®ç±»å‹",syntax:"type(data)",example:'type(data) == "array"',category:"é€šç”¨å‡½æ•°",parameters:["data"]}];switch(z){case"array":return[...F,{name:"arraySum",description:"æ•°ç»„æ±‚å’Œ",syntax:"arraySum(array)",example:"arraySum(data_array) > 100",category:"æ•°ç»„å‡½æ•°",parameters:["array"]},{name:"arrayMean",description:"æ•°ç»„å¹³å‡å€¼",syntax:"arrayMean(array)",example:"arrayMean(data_array) > 10.5",category:"æ•°ç»„å‡½æ•°",parameters:["array"]},{name:"arrayMax",description:"æ•°ç»„æœ€å¤§å€¼",syntax:"arrayMax(array)",example:"arrayMax(data_array) < 50",category:"æ•°ç»„å‡½æ•°",parameters:["array"]},{name:"arrayMin",description:"æ•°ç»„æœ€å°å€¼",syntax:"arrayMin(array)",example:"arrayMin(data_array) > 0",category:"æ•°ç»„å‡½æ•°",parameters:["array"]},{name:"arrayStd",description:"æ•°ç»„æ ‡å‡†å·®",syntax:"arrayStd(array)",example:"arrayStd(data_array) > 2.0",category:"æ•°ç»„å‡½æ•°",parameters:["array"]}];case"matrix":return[...F,{name:"matrixRank",description:"çŸ©é˜µç§©",syntax:"matrixRank(matrix)",example:"matrixRank(data_matrix) == 3",category:"çŸ©é˜µå‡½æ•°",parameters:["matrix"]},{name:"matrixDeterminant",description:"çŸ©é˜µè¡Œåˆ—å¼",syntax:"matrixDeterminant(matrix)",example:"matrixDeterminant(data_matrix) != 0",category:"çŸ©é˜µå‡½æ•°",parameters:["matrix"]},{name:"matrixTrace",description:"çŸ©é˜µè¿¹",syntax:"matrixTrace(matrix)",example:"matrixTrace(data_matrix) > 0",category:"çŸ©é˜µå‡½æ•°",parameters:["matrix"]},{name:"matrixNorm",description:"çŸ©é˜µèŒƒæ•°",syntax:"matrixNorm(matrix, type)",example:'matrixNorm(data_matrix, "frobenius") > 1.0',category:"çŸ©é˜µå‡½æ•°",parameters:["matrix","type"]}];case"timeseries":return[...F,{name:"trendDirection",description:"è¶‹åŠ¿æ–¹å‘",syntax:"trendDirection(timeseries)",example:'trendDirection(ts_data) == "increasing"',category:"æ—¶åºå‡½æ•°",parameters:["timeseries"]},{name:"seasonality",description:"å­£èŠ‚æ€§æ£€æµ‹",syntax:"seasonality(timeseries, period)",example:"seasonality(ts_data, 24) > 0.5",category:"æ—¶åºå‡½æ•°",parameters:["timeseries","period"]},{name:"volatility",description:"æ³¢åŠ¨æ€§è®¡ç®—",syntax:"volatility(timeseries)",example:"volatility(ts_data) > 0.1",category:"æ—¶åºå‡½æ•°",parameters:["timeseries"]},{name:"autocorrelation",description:"è‡ªç›¸å…³æ€§",syntax:"autocorrelation(timeseries, lag)",example:"autocorrelation(ts_data, 1) > 0.8",category:"æ—¶åºå‡½æ•°",parameters:["timeseries","lag"]}];case"mixed":return[...F,{name:"fieldCount",description:"å­—æ®µæ•°é‡",syntax:"fieldCount(data)",example:"fieldCount(json_data) > 10",category:"ç»“æ„å‡½æ•°",parameters:["data"]},{name:"nestedLevels",description:"åµŒå¥—å±‚çº§",syntax:"nestedLevels(data)",example:"nestedLevels(nested_data) <= 5",category:"ç»“æ„å‡½æ•°",parameters:["data"]},{name:"hasField",description:"å­—æ®µå­˜åœ¨æ£€æŸ¥",syntax:"hasField(data, fieldPath)",example:'hasField(json_data, "user.profile.name")',category:"ç»“æ„å‡½æ•°",parameters:["data","fieldPath"]},{name:"extractField",description:"æå–å­—æ®µå€¼",syntax:"extractField(data, fieldPath)",example:'extractField(json_data, "$.items[0].price") > 100',category:"ç»“æ„å‡½æ•°",parameters:["data","fieldPath"]}];default:return F}},re=async()=>{i(),await D(()=>q,()=>N)},U=z=>{s(z),(z==="json"||z==="preview")&&setTimeout(i,50)},le=()=>{(L==="json"||L==="preview")&&setTimeout(i,100)},te=()=>e.jsxs(I,{title:e.jsxs(p,{children:[e.jsx(pt,{}),"å¤æ‚æ•°æ®é…ç½®"]}),style:{marginTop:16},children:[e.jsx(Z,{gutter:[16,16],children:e.jsx(R,{span:24,children:e.jsx(u.Item,{label:"æ•°æ®ç±»å‹",children:e.jsxs(O,{value:m,disabled:!0,children:[e.jsx(ee,{value:"array",children:"æ•°ç»„ (Array)"}),e.jsx(ee,{value:"matrix",children:"çŸ©é˜µ (Matrix)"}),e.jsx(ee,{value:"timeseries",children:"æ—¶é—´åºåˆ— (TimeSeries)"}),e.jsx(ee,{value:"mixed",children:"æ··åˆç±»å‹ (Mixed)"}),e.jsx(ee,{value:"json",children:"JSONæ•°æ®"}),e.jsx(ee,{value:"nested",children:"åµŒå¥—ç»“æ„"})]})})})}),m==="array"&&e.jsxs(Z,{gutter:[16,16],style:{marginTop:16},children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"é¢„æœŸæ•°ç»„å¤§å°",children:e.jsx(W,{placeholder:"å…ƒç´ æ•°é‡",style:{width:"100%"},min:0,max:1e6})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"å…ƒç´ ç±»å‹",children:e.jsxs(O,{defaultValue:"number",placeholder:"æ•°ç»„å…ƒç´ çš„æ•°æ®ç±»å‹",children:[e.jsx(ee,{value:"number",children:"æ•°å€¼ç±»å‹"}),e.jsx(ee,{value:"string",children:"å­—ç¬¦ä¸²ç±»å‹"}),e.jsx(ee,{value:"boolean",children:"å¸ƒå°”ç±»å‹"}),e.jsx(ee,{value:"object",children:"å¯¹è±¡ç±»å‹"}),e.jsx(ee,{value:"mixed",children:"æ··åˆç±»å‹"})]})})})]}),m==="matrix"&&e.jsxs(Z,{gutter:[16,16],style:{marginTop:16},children:[e.jsx(R,{span:8,children:e.jsx(u.Item,{label:"çŸ©é˜µç±»å‹",children:e.jsxs(O,{defaultValue:"dense",placeholder:"çŸ©é˜µå­˜å‚¨ç±»å‹",children:[e.jsx(ee,{value:"dense",children:"ç¨ å¯†çŸ©é˜µ"}),e.jsx(ee,{value:"sparse",children:"ç¨€ç–çŸ©é˜µ"}),e.jsx(ee,{value:"symmetric",children:"å¯¹ç§°çŸ©é˜µ"}),e.jsx(ee,{value:"diagonal",children:"å¯¹è§’çŸ©é˜µ"})]})})}),e.jsx(R,{span:8,children:e.jsx(u.Item,{label:"é¢„æœŸç»´åº¦",children:e.jsx(B,{placeholder:"ä¾‹å¦‚ï¼š3x4, 100x100"})})}),e.jsx(R,{span:8,children:e.jsx(u.Item,{label:"æ•°å€¼ç²¾åº¦",children:e.jsxs(O,{defaultValue:"float64",placeholder:"æ•°å€¼ç²¾åº¦",children:[e.jsx(ee,{value:"int32",children:"32ä½æ•´æ•°"}),e.jsx(ee,{value:"float32",children:"32ä½æµ®ç‚¹"}),e.jsx(ee,{value:"float64",children:"64ä½æµ®ç‚¹"}),e.jsx(ee,{value:"complex",children:"å¤æ•°"})]})})})]}),m==="timeseries"&&e.jsxs(Z,{gutter:[16,16],style:{marginTop:16},children:[e.jsx(R,{span:8,children:e.jsx(u.Item,{label:"æ—¶é—´ç²’åº¦",children:e.jsxs(O,{defaultValue:"second",placeholder:"æ—¶é—´åºåˆ—çš„ç²’åº¦",children:[e.jsx(ee,{value:"millisecond",children:"æ¯«ç§’"}),e.jsx(ee,{value:"second",children:"ç§’"}),e.jsx(ee,{value:"minute",children:"åˆ†é’Ÿ"}),e.jsx(ee,{value:"hour",children:"å°æ—¶"}),e.jsx(ee,{value:"day",children:"å¤©"})]})})}),e.jsx(R,{span:8,children:e.jsx(u.Item,{label:"é¢„æœŸé•¿åº¦",children:e.jsx(W,{placeholder:"æ•°æ®ç‚¹æ•°é‡",style:{width:"100%"},min:1,max:1e7})})}),e.jsx(R,{span:8,children:e.jsx(u.Item,{label:"æ˜¯å¦å®æ—¶",style:{display:"flex",alignItems:"center",height:"40px"},children:e.jsx(he,{defaultChecked:!0,checkedChildren:"å®æ—¶",unCheckedChildren:"ç¦»çº¿"})})})]}),e.jsx("div",{style:{marginTop:16},children:e.jsxs(Ra,{type:"secondary",children:[e.jsx(ce,{})," ",j(m),"æ”¯æŒå¤æ‚çš„æ•°æ®ç»“æ„åˆ†æå’Œå¤„ç†"]})})]}),ae=()=>e.jsxs(I,{title:`${j(m)}æ¡ä»¶`,style:{marginTop:16},children:[e.jsx(Fe,{value:q,onChange:X,availableFields:["device_id","key","value","timestamp"],customFieldOptions:H(m),allowedOperators:["eq","ne","gt","gte","lt","lte","contains","exists","regex"],supportExpressions:!0,dataTypeName:j(m)}),e.jsx("div",{style:{marginTop:16},children:e.jsx(Ge,{value:q?.type==="expression"?q.expression:"",onChange:z=>X({type:"expression",expression:z}),dataType:m,availableFunctions:A(m),availableVariables:H(m).map(z=>({name:z.value,description:z.description,type:"number",example:`${z.value} > 0`})),placeholder:`è¾“å…¥${j(m)}è¡¨è¾¾å¼`,rows:3})})]}),o=()=>e.jsx(I,{title:`${j(m)}åŠ¨ä½œ`,style:{marginTop:16},children:e.jsx(Le,{value:N,onChange:$,availableActionTypes:[],customActionOptions:Q(m),dataTypeName:j(m)})}),y=[{key:"basic",label:e.jsxs(p,{children:[e.jsx(ce,{}),"åŸºæœ¬ä¿¡æ¯"]}),children:e.jsxs(I,{title:"åŸºæœ¬ä¿¡æ¯",style:{border:"none",boxShadow:"none"},children:[e.jsxs(u,{form:S,layout:"vertical",initialValues:{priority:c?.priority||50,enabled:c?.enabled!==!1},onValuesChange:le,children:[e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"è§„åˆ™åç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥è§„åˆ™åç§°"}],children:e.jsx(B,{placeholder:`è¯·è¾“å…¥${j(m)}è§„åˆ™åç§°`})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"ä¼˜å…ˆçº§",name:"priority",rules:[{required:!0,message:"è¯·è¾“å…¥ä¼˜å…ˆçº§"},{type:"number",min:0,max:100,message:"ä¼˜å…ˆçº§å¿…é¡»åœ¨0-100ä¹‹é—´"}],children:e.jsx(W,{min:0,max:100,style:{width:"100%"}})})})]}),e.jsx(u.Item,{label:"è§„åˆ™æè¿°",name:"description",children:e.jsx(B.TextArea,{placeholder:`è¯·è¾“å…¥${j(m)}è§„åˆ™æè¿°`,rows:3})}),e.jsx(u.Item,{label:"å¯ç”¨çŠ¶æ€",name:"enabled",valuePropName:"checked",style:{display:"flex",alignItems:"center",height:"40px"},children:e.jsx(he,{checkedChildren:"å¯ç”¨",unCheckedChildren:"ç¦ç”¨"})})]}),te()]})},{key:"conditions",label:e.jsxs(p,{children:[e.jsx(pt,{}),"å¤æ‚æ¡ä»¶"]}),children:ae()},{key:"actions",label:e.jsxs(p,{children:[e.jsx(me,{}),"æ‰§è¡ŒåŠ¨ä½œ"]}),children:o()},{key:"preview",label:e.jsxs(p,{children:[e.jsx(Ie,{}),"é¢„è§ˆ"]}),children:e.jsxs(I,{title:"è§„åˆ™é¢„è§ˆ",style:{border:"none",boxShadow:"none"},children:[e.jsx(P,{message:"è§„åˆ™JSONé…ç½®",description:"ä»¥ä¸‹æ˜¯å½“å‰è§„åˆ™çš„å®Œæ•´JSONé…ç½®é¢„è§ˆ",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx("pre",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"6px",fontSize:"12px",lineHeight:"1.5",maxHeight:"400px",overflow:"auto",border:"1px solid #d9d9d9"},children:t})]})},{key:"json",label:e.jsxs(p,{children:[e.jsx(de,{}),"JSONç¼–è¾‘"]}),children:e.jsxs(I,{title:"JSONç›´æ¥ç¼–è¾‘",style:{border:"none",boxShadow:"none"},children:[e.jsx(P,{message:"JSONç¼–è¾‘æ¨¡å¼",description:"å¯ä»¥ç›´æ¥ç¼–è¾‘JSONé…ç½®ï¼Œä¿å­˜æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°è¡¨å•",type:"warning",showIcon:!0,style:{marginBottom:16}}),r&&e.jsx(P,{message:"JSONæ ¼å¼é”™è¯¯",description:r,type:"error",showIcon:!0,style:{marginBottom:16}}),e.jsx(Da,{value:t,onChange:z=>x(z.target.value),rows:20,style:{fontFamily:'Monaco, Consolas, "Courier New", monospace',fontSize:"12px",lineHeight:"1.5"},placeholder:"è¾“å…¥æˆ–ç¼–è¾‘JSONæ ¼å¼çš„è§„åˆ™é…ç½®..."}),e.jsx("div",{style:{marginTop:12},children:e.jsxs(p,{children:[e.jsx(E,{size:"small",onClick:i,icon:e.jsx(Ve,{}),children:"ä»è¡¨å•æ›´æ–°JSON"}),e.jsx(E,{size:"small",type:"primary",ghost:!0,onClick:()=>{try{const z=JSON.stringify(JSON.parse(t),null,2);l(z)}catch{}},icon:e.jsx(de,{}),children:"æ ¼å¼åŒ–JSON"})]})})]})}];return e.jsxs(Te,{title:e.jsxs(p,{children:[e.jsx(pt,{style:{color:"#1890ff"}}),e.jsx("span",{children:"å¤æ‚æ•°æ®è§„åˆ™ç¼–è¾‘å™¨"}),e.jsx(g,{color:"blue",icon:e.jsx(se,{}),children:j(m)})]}),open:h,onCancel:k,footer:e.jsxs(p,{children:[e.jsx(E,{onClick:k,size:"large",children:"å–æ¶ˆ"}),e.jsx(E,{type:"primary",loading:G,onClick:re,size:"large",icon:e.jsx(me,{}),children:"ä¿å­˜è§„åˆ™"})]}),width:1200,centered:!0,destroyOnHidden:!0,style:{maxHeight:"90vh",top:0},styles:{body:{padding:"20px",maxHeight:"calc(90vh - 140px)",overflowY:"auto",overflowX:"hidden"},header:{borderBottom:"1px solid #f0f0f0",paddingBottom:"16px"},content:{maxHeight:"90vh",display:"flex",flexDirection:"column"}},children:[J.length>0&&e.jsx(P,{message:"éªŒè¯é”™è¯¯",description:e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:J.map((z,F)=>e.jsx("li",{children:z},F))}),type:"error",showIcon:!0,style:{marginBottom:16},closable:!0}),e.jsx(ke,{activeKey:L,onChange:U,items:y,size:"large"})]})},{Option:Za}=O,{Text:Ka,Title:Ua}=pe,{TextArea:$a}=B,Va=({visible:h,onClose:v,onSave:M,rule:c})=>{const{form:C,saving:V,validationErrors:m,handleSave:S}=Pe({visible:h,onClose:v,onSave:M,rule:c,title:"åœ°ç†ç©ºé—´è§„åˆ™ç¼–è¾‘å™¨",dataTypeName:"åœ°ç†ä½ç½®æ•°æ®"}),G=()=>{D(void 0),k([]),X("basic"),$(""),s(""),v()},[J,D]=b.useState(c?.conditions),[_,k]=b.useState(c?.actions||[]),[q,X]=b.useState("basic"),[N,$]=b.useState(""),[L,s]=b.useState(""),l=c?(o=>{if(o.data_type){if(typeof o.data_type=="string")return o.data_type;if(typeof o.data_type=="object"&&o.data_type!==null)return o.data_type.type||"location"}if(o.tags){const z=o.tags.data_type||o.tags.data_category;if(z)return z}const y=`${o.name||""} ${o.description||""}`.toLowerCase();return y.includes("location")||y.includes("åœ°ç†")||y.includes("gps")||y.includes("ä½ç½®")||y.includes("geo")||y.includes("åæ ‡")||y.includes("latitude")||y.includes("longitude"),"location"})(c):"location";b.useEffect(()=>{h&&c&&(D(c.conditions),k(c.actions||[]),r())},[h,c]);const r=()=>{try{const o={id:c?.id||"",name:C.getFieldValue("name")||"",description:C.getFieldValue("description")||"",priority:C.getFieldValue("priority")||50,enabled:C.getFieldValue("enabled")!==!1,data_type:l,conditions:J,actions:_,tags:c?.tags||{},version:c?.version||1,created_at:c?.created_at||new Date().toISOString(),updated_at:new Date().toISOString()};$(JSON.stringify(o,null,2)),s("")}catch{s("JSONç”Ÿæˆå¤±è´¥")}},n=o=>{$(o);try{const y=JSON.parse(o);y.name&&y.conditions&&y.actions?(s(""),C.setFieldsValue({name:y.name,description:y.description,priority:y.priority,enabled:y.enabled}),D(y.conditions),k(y.actions||[])):s("JSONæ ¼å¼ä¸å®Œæ•´ï¼Œç¼ºå°‘å¿…è¦å­—æ®µ")}catch{s("JSONæ ¼å¼é”™è¯¯")}},i=[{value:"location.latitude",label:"çº¬åº¦",description:"åœ°ç†åæ ‡çº¬åº¦å€¼ (-90 åˆ° 90)"},{value:"location.longitude",label:"ç»åº¦",description:"åœ°ç†åæ ‡ç»åº¦å€¼ (-180 åˆ° 180)"},{value:"location.altitude",label:"æµ·æ‹”é«˜åº¦",description:"æµ·æ‹”é«˜åº¦å€¼ (ç±³)"},{value:"location.accuracy",label:"å®šä½ç²¾åº¦",description:"GPSå®šä½ç²¾åº¦ (ç±³)"},{value:"location.speed",label:"ç§»åŠ¨é€Ÿåº¦",description:"ç§»åŠ¨é€Ÿåº¦ (å…¬é‡Œ/å°æ—¶)"},{value:"location.heading",label:"æ–¹å‘è§’",description:"ç§»åŠ¨æ–¹å‘è§’åº¦ (0-360åº¦)"},{value:"location.distance",label:"è·ç¦»",description:"è·ç¦»å‚è€ƒç‚¹çš„è·ç¦»"},{value:"location.zone",label:"åœ°ç†åŒºåŸŸ",description:"åœ°ç†å›´æ åŒºåŸŸæ ‡è¯†"}],x=[{value:"geo_transform",label:"åœ°ç†æ•°æ®è½¬æ¢",description:"åœ°ç†åæ ‡ç³»è½¬æ¢ã€è·ç¦»è®¡ç®—ã€åŒºåŸŸåˆ¤æ–­",configSchema:{transform_type:{type:"string",label:"è½¬æ¢ç±»å‹",required:!0,options:[{value:"distance_calculation",label:"è·ç¦»è®¡ç®—"},{value:"coordinate_conversion",label:"åæ ‡ç³»è½¬æ¢"},{value:"geofence_check",label:"åœ°ç†å›´æ æ£€æŸ¥"},{value:"area_calculation",label:"é¢ç§¯è®¡ç®—"}]},reference_point:{type:"object",label:"å‚è€ƒç‚¹åæ ‡",description:"ç”¨äºè·ç¦»è®¡ç®—çš„å‚è€ƒç‚¹ (çº¬åº¦,ç»åº¦)",placeholder:'{"latitude": 39.9, "longitude": 116.4}'},geofence_zones:{type:"array",label:"åœ°ç†å›´æ åŒºåŸŸ",description:"å®šä¹‰åœ°ç†å›´æ çš„è¾¹ç•ŒåŒºåŸŸ"}}},{value:"geo_expression",label:"åœ°ç†è¡¨è¾¾å¼æ“ä½œ",description:"ä½¿ç”¨è¡¨è¾¾å¼å¯¹åœ°ç†æ•°æ®è¿›è¡Œå¤æ‚è®¡ç®—å’Œå¤„ç†",configSchema:{expression:{type:"textarea",label:"è¡¨è¾¾å¼",required:!0,placeholder:"distance(location.latitude, location.longitude, 39.9, 116.4)",description:"æ”¯æŒåœ°ç†å‡½æ•°å’Œæ•°å­¦è¿ç®—çš„è¡¨è¾¾å¼"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"ç»“æœå­˜å‚¨çš„å­—æ®µå",description:"è¡¨è¾¾å¼è®¡ç®—ç»“æœå­˜å‚¨çš„å­—æ®µå"},output_type:{type:"string",label:"è¾“å‡ºç±»å‹",options:[{value:"number",label:"æ•°å€¼"},{value:"string",label:"å­—ç¬¦ä¸²"},{value:"boolean",label:"å¸ƒå°”å€¼"},{value:"object",label:"åœ°ç†å¯¹è±¡"}],defaultValue:"number"}}},{value:"geo_alert",label:"åœ°ç†ä½ç½®å‘Šè­¦",description:"åŸºäºåœ°ç†ä½ç½®çš„å‘Šè­¦é€šçŸ¥",configSchema:{alert_type:{type:"string",label:"å‘Šè­¦ç±»å‹",options:[{value:"geofence_entry",label:"è¿›å…¥åœ°ç†å›´æ "},{value:"geofence_exit",label:"ç¦»å¼€åœ°ç†å›´æ "},{value:"distance_threshold",label:"è·ç¦»é˜ˆå€¼å‘Šè­¦"},{value:"speed_limit",label:"è¶…é€Ÿå‘Šè­¦"}]},message:{type:"textarea",label:"å‘Šè­¦æ¶ˆæ¯",required:!0,placeholder:"è®¾å¤‡{{.DeviceID}}ä½ç½®: çº¬åº¦{{.location.latitude}}, ç»åº¦{{.location.longitude}}"}}}],j=[{name:"distance",description:"è®¡ç®—ä¸¤ç‚¹é—´è·ç¦»",syntax:"distance(lat1, lon1, lat2, lon2)",example:"distance(location.latitude, location.longitude, 39.9, 116.4) > 1000",category:"åœ°ç†å‡½æ•°",parameters:["lat1","lon1","lat2","lon2"]},{name:"inGeofence",description:"æ£€æŸ¥æ˜¯å¦åœ¨åœ°ç†å›´æ å†…",syntax:"inGeofence(lat, lon, zoneName)",example:'inGeofence(location.latitude, location.longitude, "beijing_area")',category:"åœ°ç†å‡½æ•°",parameters:["lat","lon","zoneName"]},{name:"bearing",description:"è®¡ç®—ä¸¤ç‚¹é—´æ–¹ä½è§’",syntax:"bearing(lat1, lon1, lat2, lon2)",example:"bearing(location.latitude, location.longitude, 39.9, 116.4)",category:"åœ°ç†å‡½æ•°",parameters:["lat1","lon1","lat2","lon2"]}],H=[{name:"location.latitude",description:"å½“å‰çº¬åº¦",type:"number",example:"location.latitude > 39.8"},{name:"location.longitude",description:"å½“å‰ç»åº¦",type:"number",example:"location.longitude < 116.5"},{name:"location.altitude",description:"æµ·æ‹”é«˜åº¦",type:"number",example:"location.altitude > 100"},{name:"location.accuracy",description:"GPSç²¾åº¦",type:"number",example:"location.accuracy < 10"},{name:"location.speed",description:"ç§»åŠ¨é€Ÿåº¦",type:"number",example:"location.speed > 60"},{name:"location.heading",description:"ç§»åŠ¨æ–¹å‘",type:"number",example:"location.heading > 180"}],Q=async()=>{r(),await S(()=>J,()=>_)},A=o=>{X(o),(o==="json"||o==="preview")&&setTimeout(r,50)},re=()=>{(q==="json"||q==="preview")&&setTimeout(r,100)},U=()=>e.jsx(I,{title:e.jsxs(p,{children:[e.jsx(vt,{}),"åœ°ç†ä½ç½®é…ç½®"]}),style:{marginTop:16},children:e.jsx(P,{message:"åœ°ç†ç©ºé—´æ•°æ®ç±»å‹",description:"æ­¤æ•°æ®ç±»å‹ä¸“é—¨å¤„ç†GPSã€åæ ‡ã€ä½ç½®ç­‰åœ°ç†ç©ºé—´æ•°æ®ï¼Œæ”¯æŒWGS84ç­‰å¤šç§åæ ‡ç³»ç»Ÿå’Œåœ°ç†å›´æ åŠŸèƒ½",type:"info",showIcon:!0})}),le=()=>e.jsxs(I,{title:"åœ°ç†ä½ç½®æ¡ä»¶",style:{marginTop:16},children:[e.jsx(Fe,{value:J,onChange:D,availableFields:["device_id","key","value","timestamp"],customFieldOptions:i,allowedOperators:["eq","ne","gt","gte","lt","lte","contains","regex"],supportExpressions:!0,dataTypeName:"åœ°ç†ä½ç½®"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(Ge,{value:J?.type==="expression"?J.expression:"",onChange:o=>D({type:"expression",expression:o}),dataType:"geospatial",availableFunctions:j,availableVariables:H,placeholder:"è¾“å…¥åœ°ç†ä½ç½®è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼šdistance(location.latitude, location.longitude, 39.9, 116.4) > 1000",rows:3})})]}),te=()=>e.jsx(I,{title:"åœ°ç†ä½ç½®åŠ¨ä½œ",style:{marginTop:16},children:e.jsx(Le,{value:_,onChange:k,availableActionTypes:[],customActionOptions:x,dataTypeName:"åœ°ç†ä½ç½®"})}),ae=[{key:"basic",label:e.jsxs(p,{children:[e.jsx(ce,{}),"åŸºæœ¬ä¿¡æ¯"]}),children:e.jsxs(I,{title:"åŸºæœ¬ä¿¡æ¯",style:{border:"none",boxShadow:"none"},children:[e.jsxs(u,{form:C,layout:"vertical",initialValues:{priority:c?.priority||50,enabled:c?.enabled!==!1},onValuesChange:re,children:[e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"è§„åˆ™åç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥è§„åˆ™åç§°"}],children:e.jsx(B,{placeholder:"è¯·è¾“å…¥åœ°ç†ä½ç½®è§„åˆ™åç§°"})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"ä¼˜å…ˆçº§",name:"priority",rules:[{required:!0,message:"è¯·è¾“å…¥ä¼˜å…ˆçº§"},{type:"number",min:0,max:100,message:"ä¼˜å…ˆçº§å¿…é¡»åœ¨0-100ä¹‹é—´"}],children:e.jsx(W,{min:0,max:100,style:{width:"100%"}})})})]}),e.jsx(u.Item,{label:"è§„åˆ™æè¿°",name:"description",children:e.jsx(B.TextArea,{placeholder:"è¯·è¾“å…¥åœ°ç†ä½ç½®è§„åˆ™æè¿°",rows:3})}),e.jsx(u.Item,{label:"å¯ç”¨çŠ¶æ€",name:"enabled",valuePropName:"checked",children:e.jsx(he,{checkedChildren:"å¯ç”¨",unCheckedChildren:"ç¦ç”¨"})})]}),U()]})},{key:"conditions",label:e.jsxs(p,{children:[e.jsx(ma,{}),"åœ°ç†æ¡ä»¶"]}),children:le()},{key:"actions",label:e.jsxs(p,{children:[e.jsx(me,{}),"æ‰§è¡ŒåŠ¨ä½œ"]}),children:te()},{key:"preview",label:e.jsxs(p,{children:[e.jsx(Ie,{}),"é¢„è§ˆ"]}),children:e.jsxs(I,{title:"è§„åˆ™é¢„è§ˆ",style:{border:"none",boxShadow:"none"},children:[e.jsx(P,{message:"è§„åˆ™JSONé…ç½®",description:"ä»¥ä¸‹æ˜¯å½“å‰è§„åˆ™çš„å®Œæ•´JSONé…ç½®é¢„è§ˆ",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx("pre",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"6px",fontSize:"12px",lineHeight:"1.5",maxHeight:"400px",overflow:"auto",border:"1px solid #d9d9d9"},children:N})]})},{key:"json",label:e.jsxs(p,{children:[e.jsx(de,{}),"JSONç¼–è¾‘"]}),children:e.jsxs(I,{title:"JSONç›´æ¥ç¼–è¾‘",style:{border:"none",boxShadow:"none"},children:[e.jsx(P,{message:"JSONç¼–è¾‘æ¨¡å¼",description:"å¯ä»¥ç›´æ¥ç¼–è¾‘JSONé…ç½®ï¼Œä¿å­˜æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°è¡¨å•",type:"warning",showIcon:!0,style:{marginBottom:16}}),L&&e.jsx(P,{message:"JSONæ ¼å¼é”™è¯¯",description:L,type:"error",showIcon:!0,style:{marginBottom:16}}),e.jsx($a,{value:N,onChange:o=>n(o.target.value),rows:20,style:{fontFamily:'Monaco, Consolas, "Courier New", monospace',fontSize:"12px",lineHeight:"1.5"},placeholder:"è¾“å…¥æˆ–ç¼–è¾‘JSONæ ¼å¼çš„è§„åˆ™é…ç½®..."}),e.jsx("div",{style:{marginTop:12},children:e.jsxs(p,{children:[e.jsx(E,{size:"small",onClick:r,icon:e.jsx(Ve,{}),children:"ä»è¡¨å•æ›´æ–°JSON"}),e.jsx(E,{size:"small",type:"primary",ghost:!0,onClick:()=>{try{const o=JSON.stringify(JSON.parse(N),null,2);$(o)}catch{}},icon:e.jsx(de,{}),children:"æ ¼å¼åŒ–JSON"})]})})]})}];return e.jsxs(Te,{title:e.jsxs(p,{children:[e.jsx(vt,{style:{color:"#52c41a"}}),e.jsx("span",{children:"åœ°ç†ç©ºé—´è§„åˆ™ç¼–è¾‘å™¨"}),e.jsx(g,{color:"success",children:"åœ°ç†ä½ç½®æ•°æ®"})]}),open:h,onCancel:G,footer:e.jsxs(p,{children:[e.jsx(E,{onClick:G,size:"large",children:"å–æ¶ˆ"}),e.jsx(E,{type:"primary",loading:V,onClick:Q,size:"large",icon:e.jsx(me,{}),children:"ä¿å­˜è§„åˆ™"})]}),width:1200,centered:!0,destroyOnHidden:!0,style:{maxHeight:"90vh",top:0},styles:{body:{padding:"20px",maxHeight:"calc(90vh - 140px)",overflowY:"auto",overflowX:"hidden"},header:{borderBottom:"1px solid #f0f0f0",paddingBottom:"16px"},content:{maxHeight:"90vh",display:"flex",flexDirection:"column"}},children:[m.length>0&&e.jsx(P,{message:"éªŒè¯é”™è¯¯",description:e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:m.map((o,y)=>e.jsx("li",{children:o},y))}),type:"error",showIcon:!0,style:{marginBottom:16},closable:!0}),e.jsx(ke,{activeKey:q,onChange:A,items:ae,size:"large"})]})},{Option:Wa}=O,{Text:Qa}=pe,{TextArea:Fa}=B,Ja=({visible:h,onClose:v,onSave:M,rule:c})=>{const{form:C,saving:V,validationErrors:m,handleSave:S}=Pe({visible:h,onClose:v,onSave:M,rule:c,title:"3Då‘é‡è§„åˆ™ç¼–è¾‘å™¨",dataTypeName:"3Då‘é‡æ•°æ®"}),G=()=>{D(void 0),k([]),X("basic"),$(""),s(""),v()},[J,D]=b.useState(c?.conditions),[_,k]=b.useState(c?.actions||[]),[q,X]=b.useState("basic"),[N,$]=b.useState(""),[L,s]=b.useState(""),l=c?(o=>{if(o.data_type){if(typeof o.data_type=="string")return o.data_type;if(typeof o.data_type=="object"&&o.data_type!==null)return o.data_type.type||"vector3d"}if(o.tags){const z=o.tags.data_type||o.tags.data_category;if(z)return z}const y=`${o.name||""} ${o.description||""}`.toLowerCase();return y.includes("vector3d")||y.includes("ä¸‰è½´")||y.includes("xyz")||y.includes("ä¸‰ç»´")||y.includes("vector")||y.includes("å‘é‡")||y.includes("acceleration")||y.includes("åŠ é€Ÿåº¦"),"vector3d"})(c):"vector3d";b.useEffect(()=>{h&&c&&(D(c.conditions),k(c.actions||[]),r())},[h,c]);const r=()=>{try{const o={id:c?.id||"",name:C.getFieldValue("name")||"",description:C.getFieldValue("description")||"",priority:C.getFieldValue("priority")||50,enabled:C.getFieldValue("enabled")!==!1,data_type:l,conditions:J,actions:_,tags:{...c?.tags,data_type:l,data_category:"vector"},version:c?.version||1,created_at:c?.created_at||new Date().toISOString(),updated_at:new Date().toISOString()};$(JSON.stringify(o,null,2)),s("")}catch{s("JSONç”Ÿæˆå¤±è´¥")}},n=o=>{$(o);try{const y=JSON.parse(o);y.name&&y.conditions&&y.actions?(s(""),C.setFieldsValue({name:y.name,description:y.description,priority:y.priority,enabled:y.enabled}),D(y.conditions),k(y.actions||[])):s("JSONæ ¼å¼ä¸å®Œæ•´ï¼Œç¼ºå°‘å¿…è¦å­—æ®µ")}catch{s("JSONæ ¼å¼é”™è¯¯")}},i=[{value:"acceleration.x",label:"åŠ é€Ÿåº¦Xåˆ†é‡",description:"åŠ é€Ÿåº¦å‘é‡çš„Xè½´åˆ†é‡ (m/sÂ²)"},{value:"acceleration.y",label:"åŠ é€Ÿåº¦Yåˆ†é‡",description:"åŠ é€Ÿåº¦å‘é‡çš„Yè½´åˆ†é‡ (m/sÂ²)"},{value:"acceleration.z",label:"åŠ é€Ÿåº¦Zåˆ†é‡",description:"åŠ é€Ÿåº¦å‘é‡çš„Zè½´åˆ†é‡ (m/sÂ²)"},{value:"acceleration.magnitude",label:"åŠ é€Ÿåº¦æ¨¡é•¿",description:"åŠ é€Ÿåº¦å‘é‡çš„æ¨¡é•¿"},{value:"velocity.x",label:"é€Ÿåº¦Xåˆ†é‡",description:"é€Ÿåº¦å‘é‡çš„Xè½´åˆ†é‡ (m/s)"},{value:"velocity.y",label:"é€Ÿåº¦Yåˆ†é‡",description:"é€Ÿåº¦å‘é‡çš„Yè½´åˆ†é‡ (m/s)"},{value:"velocity.z",label:"é€Ÿåº¦Zåˆ†é‡",description:"é€Ÿåº¦å‘é‡çš„Zè½´åˆ†é‡ (m/s)"},{value:"velocity.magnitude",label:"é€Ÿåº¦æ¨¡é•¿",description:"é€Ÿåº¦å‘é‡çš„æ¨¡é•¿"},{value:"position.x",label:"ä½ç½®Xåæ ‡",description:"ä½ç½®å‘é‡çš„Xè½´åæ ‡ (m)"},{value:"position.y",label:"ä½ç½®Yåæ ‡",description:"ä½ç½®å‘é‡çš„Yè½´åæ ‡ (m)"},{value:"position.z",label:"ä½ç½®Zåæ ‡",description:"ä½ç½®å‘é‡çš„Zè½´åæ ‡ (m)"},{value:"force.x",label:"åŠ›Xåˆ†é‡",description:"åŠ›å‘é‡çš„Xè½´åˆ†é‡ (N)"},{value:"force.y",label:"åŠ›Yåˆ†é‡",description:"åŠ›å‘é‡çš„Yè½´åˆ†é‡ (N)"},{value:"force.z",label:"åŠ›Zåˆ†é‡",description:"åŠ›å‘é‡çš„Zè½´åˆ†é‡ (N)"},{value:"force.magnitude",label:"åˆåŠ›å¤§å°",description:"åŠ›å‘é‡çš„æ¨¡é•¿"},{value:"gyroscope.x",label:"é™€èºä»ªXè½´",description:"é™€èºä»ªXè½´è§’é€Ÿåº¦ (rad/s)"},{value:"gyroscope.y",label:"é™€èºä»ªYè½´",description:"é™€èºä»ªYè½´è§’é€Ÿåº¦ (rad/s)"},{value:"gyroscope.z",label:"é™€èºä»ªZè½´",description:"é™€èºä»ªZè½´è§’é€Ÿåº¦ (rad/s)"},{value:"magnetometer.x",label:"ç£åŠ›è®¡Xè½´",description:"ç£åŠ›è®¡Xè½´æµ‹é‡å€¼ (Î¼T)"},{value:"magnetometer.y",label:"ç£åŠ›è®¡Yè½´",description:"ç£åŠ›è®¡Yè½´æµ‹é‡å€¼ (Î¼T)"},{value:"magnetometer.z",label:"ç£åŠ›è®¡Zè½´",description:"ç£åŠ›è®¡Zè½´æµ‹é‡å€¼ (Î¼T)"}],x=[{value:"vector3d_transform",label:"3Då‘é‡è½¬æ¢",description:"å‘é‡æ¨¡é•¿è®¡ç®—ã€åˆ†é‡æå–ã€å‘é‡å½’ä¸€åŒ–ç­‰",configSchema:{transform_type:{type:"string",label:"è½¬æ¢ç±»å‹",required:!0,options:[{value:"vector_magnitude",label:"å‘é‡æ¨¡é•¿è®¡ç®—"},{value:"component_extract",label:"åˆ†é‡æå–"},{value:"vector_normalize",label:"å‘é‡å½’ä¸€åŒ–"},{value:"vector_cross_product",label:"å‰ç§¯è®¡ç®—"},{value:"vector_dot_product",label:"ç‚¹ç§¯è®¡ç®—"}]},vector_field:{type:"string",label:"å‘é‡å­—æ®µ",required:!0,placeholder:"acceleration, velocity, positionç­‰",description:"è¦å¤„ç†çš„å‘é‡å­—æ®µå"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"è½¬æ¢åçš„å­—æ®µå",description:"è½¬æ¢ç»“æœå­˜å‚¨çš„å­—æ®µå"},component:{type:"string",label:"åˆ†é‡é€‰æ‹©",options:[{value:"x",label:"Xåˆ†é‡"},{value:"y",label:"Yåˆ†é‡"},{value:"z",label:"Zåˆ†é‡"}],description:"ç”¨äºåˆ†é‡æå–æ—¶é€‰æ‹©ç‰¹å®šåˆ†é‡",conditionalDisplay:{dependsOn:"transform_type",showWhen:["component_extract"]}},precision:{type:"number",label:"ç²¾åº¦",placeholder:"å°æ•°ç‚¹åä½æ•°",description:"è®¡ç®—ç»“æœçš„å°æ•°ç²¾åº¦"}}},{value:"vector3d_expression",label:"3Då‘é‡è¡¨è¾¾å¼æ“ä½œ",description:"ä½¿ç”¨è¡¨è¾¾å¼å¯¹3Då‘é‡æ•°æ®è¿›è¡Œå¤æ‚è®¡ç®—å’Œå¤„ç†",configSchema:{expression:{type:"textarea",label:"è¡¨è¾¾å¼",required:!0,placeholder:"vectorMagnitude(acceleration.x, acceleration.y, acceleration.z)",description:"æ”¯æŒ3Då‘é‡å‡½æ•°å’Œæ•°å­¦è¿ç®—çš„è¡¨è¾¾å¼"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"ç»“æœå­˜å‚¨çš„å­—æ®µå",description:"è¡¨è¾¾å¼è®¡ç®—ç»“æœå­˜å‚¨çš„å­—æ®µå"},output_type:{type:"string",label:"è¾“å‡ºç±»å‹",options:[{value:"number",label:"æ•°å€¼"},{value:"vector",label:"å‘é‡"},{value:"boolean",label:"å¸ƒå°”å€¼"},{value:"string",label:"å­—ç¬¦ä¸²"}],defaultValue:"number"}}},{value:"vector3d_alert",label:"3Då‘é‡å‘Šè­¦",description:"åŸºäºå‘é‡æ•°æ®çš„å‘Šè­¦é€šçŸ¥",configSchema:{alert_type:{type:"string",label:"å‘Šè­¦ç±»å‹",options:[{value:"magnitude_threshold",label:"æ¨¡é•¿é˜ˆå€¼å‘Šè­¦"},{value:"component_threshold",label:"åˆ†é‡é˜ˆå€¼å‘Šè­¦"},{value:"vector_angle",label:"å‘é‡è§’åº¦å‘Šè­¦"},{value:"vibration_anomaly",label:"æŒ¯åŠ¨å¼‚å¸¸å‘Šè­¦"}]},threshold:{type:"number",label:"å‘Šè­¦é˜ˆå€¼",required:!0,placeholder:"è§¦å‘å‘Šè­¦çš„æ•°å€¼é˜ˆå€¼"},message:{type:"textarea",label:"å‘Šè­¦æ¶ˆæ¯",required:!0,placeholder:"è®¾å¤‡{{.DeviceID}}å‘é‡{{.VectorField}}å¼‚å¸¸: å½“å‰å€¼{{.CurrentValue}}ï¼Œé˜ˆå€¼{{.Threshold}}"}}}],j=[{name:"vectorMagnitude",description:"è®¡ç®—3Då‘é‡æ¨¡é•¿",syntax:"vectorMagnitude(x, y, z)",example:"vectorMagnitude(acceleration.x, acceleration.y, acceleration.z) > 9.8",category:"å‘é‡å‡½æ•°",parameters:["x","y","z"]},{name:"vectorAngle",description:"è®¡ç®—ä¸¤å‘é‡å¤¹è§’",syntax:"vectorAngle(x1, y1, z1, x2, y2, z2)",example:"vectorAngle(velocity.x, velocity.y, velocity.z, 1, 0, 0) < 45",category:"å‘é‡å‡½æ•°",parameters:["x1","y1","z1","x2","y2","z2"]},{name:"vectorDot",description:"è®¡ç®—å‘é‡ç‚¹ç§¯",syntax:"vectorDot(x1, y1, z1, x2, y2, z2)",example:"vectorDot(force.x, force.y, force.z, 0, 0, 1) > 0",category:"å‘é‡å‡½æ•°",parameters:["x1","y1","z1","x2","y2","z2"]},{name:"vectorCross",description:"è®¡ç®—å‘é‡å‰ç§¯æ¨¡é•¿",syntax:"vectorCross(x1, y1, z1, x2, y2, z2)",example:"vectorCross(velocity.x, velocity.y, velocity.z, acceleration.x, acceleration.y, acceleration.z)",category:"å‘é‡å‡½æ•°",parameters:["x1","y1","z1","x2","y2","z2"]}],H=[{name:"acceleration.x",description:"åŠ é€Ÿåº¦Xåˆ†é‡",type:"number",example:"acceleration.x > 2.0"},{name:"acceleration.y",description:"åŠ é€Ÿåº¦Yåˆ†é‡",type:"number",example:"acceleration.y < -1.0"},{name:"acceleration.z",description:"åŠ é€Ÿåº¦Zåˆ†é‡",type:"number",example:"acceleration.z > 9.8"},{name:"velocity.x",description:"é€Ÿåº¦Xåˆ†é‡",type:"number",example:"velocity.x > 0"},{name:"velocity.y",description:"é€Ÿåº¦Yåˆ†é‡",type:"number",example:"velocity.y < 0"},{name:"velocity.z",description:"é€Ÿåº¦Zåˆ†é‡",type:"number",example:"velocity.z == 0"},{name:"position.x",description:"ä½ç½®Xåæ ‡",type:"number",example:"position.x > 100"},{name:"position.y",description:"ä½ç½®Yåæ ‡",type:"number",example:"position.y < -50"},{name:"position.z",description:"ä½ç½®Zåæ ‡",type:"number",example:"position.z > 0"},{name:"force.magnitude",description:"åˆåŠ›å¤§å°",type:"number",example:"force.magnitude > 1000"},{name:"gyroscope.magnitude",description:"è§’é€Ÿåº¦æ¨¡é•¿",type:"number",example:"gyroscope.magnitude > 5.0"}],Q=async()=>{r(),await S(()=>J,()=>_)},A=o=>{X(o),(o==="json"||o==="preview")&&setTimeout(r,50)},re=()=>{(q==="json"||q==="preview")&&setTimeout(r,100)},U=()=>e.jsx(I,{title:e.jsxs(p,{children:[e.jsx(at,{}),"3Då‘é‡é…ç½®"]}),style:{marginTop:16},children:e.jsx(P,{message:"3Då‘é‡æ•°æ®ç±»å‹",description:"æ­¤æ•°æ®ç±»å‹ä¸“é—¨å¤„ç†ä¸‰è½´å‘é‡æ•°æ®ï¼Œå¦‚åŠ é€Ÿåº¦ã€é€Ÿåº¦ã€ä½ç½®ã€åŠ›ç­‰ï¼Œæ”¯æŒå®æ—¶æ¨¡é•¿è®¡ç®—ã€åˆ†é‡æå–å’Œå‘é‡è¿ç®—",type:"info",showIcon:!0})}),le=()=>e.jsxs(I,{title:"3Då‘é‡æ¡ä»¶",style:{marginTop:16},children:[e.jsx(Fe,{value:J,onChange:D,availableFields:["device_id","key","value","timestamp"],customFieldOptions:i,allowedOperators:["eq","ne","gt","gte","lt","lte","contains","regex"],supportExpressions:!0,dataTypeName:"3Då‘é‡"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(Ge,{value:J?.type==="expression"?J.expression:"",onChange:o=>D({type:"expression",expression:o}),dataType:"vector3d",availableFunctions:j,availableVariables:H,placeholder:"è¾“å…¥3Då‘é‡è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼švectorMagnitude(acceleration.x, acceleration.y, acceleration.z) > 9.8",rows:3})})]}),te=()=>e.jsx(I,{title:"3Då‘é‡åŠ¨ä½œ",style:{marginTop:16},children:e.jsx(Le,{value:_,onChange:k,availableActionTypes:[],customActionOptions:x,dataTypeName:"3Då‘é‡"})}),ae=[{key:"basic",label:e.jsxs(p,{children:[e.jsx(ce,{}),"åŸºæœ¬ä¿¡æ¯"]}),children:e.jsxs(I,{title:"åŸºæœ¬ä¿¡æ¯",style:{border:"none",boxShadow:"none"},children:[e.jsxs(u,{form:C,layout:"vertical",initialValues:{priority:c?.priority||50,enabled:c?.enabled!==!1},onValuesChange:re,children:[e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"è§„åˆ™åç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥è§„åˆ™åç§°"}],children:e.jsx(B,{placeholder:"è¯·è¾“å…¥3Då‘é‡è§„åˆ™åç§°"})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"ä¼˜å…ˆçº§",name:"priority",rules:[{required:!0,message:"è¯·è¾“å…¥ä¼˜å…ˆçº§"},{type:"number",min:0,max:100,message:"ä¼˜å…ˆçº§å¿…é¡»åœ¨0-100ä¹‹é—´"}],children:e.jsx(W,{min:0,max:100,style:{width:"100%"}})})})]}),e.jsx(u.Item,{label:"è§„åˆ™æè¿°",name:"description",children:e.jsx(B.TextArea,{placeholder:"è¯·è¾“å…¥3Då‘é‡è§„åˆ™æè¿°",rows:3})}),e.jsx(u.Item,{label:"å¯ç”¨çŠ¶æ€",name:"enabled",valuePropName:"checked",style:{display:"flex",alignItems:"center",height:"40px"},children:e.jsx(he,{checkedChildren:"å¯ç”¨",unCheckedChildren:"ç¦ç”¨"})})]}),U()]})},{key:"conditions",label:e.jsxs(p,{children:[e.jsx(at,{}),"å‘é‡æ¡ä»¶"]}),children:le()},{key:"actions",label:e.jsxs(p,{children:[e.jsx(me,{}),"æ‰§è¡ŒåŠ¨ä½œ"]}),children:te()},{key:"preview",label:e.jsxs(p,{children:[e.jsx(Ie,{}),"é¢„è§ˆ"]}),children:e.jsxs(I,{title:"è§„åˆ™é¢„è§ˆ",style:{border:"none",boxShadow:"none"},children:[e.jsx(P,{message:"è§„åˆ™JSONé…ç½®",description:"ä»¥ä¸‹æ˜¯å½“å‰è§„åˆ™çš„å®Œæ•´JSONé…ç½®é¢„è§ˆ",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx("pre",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"6px",fontSize:"12px",lineHeight:"1.5",maxHeight:"400px",overflow:"auto",border:"1px solid #d9d9d9"},children:N})]})},{key:"json",label:e.jsxs(p,{children:[e.jsx(de,{}),"JSONç¼–è¾‘"]}),children:e.jsxs(I,{title:"JSONç›´æ¥ç¼–è¾‘",style:{border:"none",boxShadow:"none"},children:[e.jsx(P,{message:"JSONç¼–è¾‘æ¨¡å¼",description:"å¯ä»¥ç›´æ¥ç¼–è¾‘JSONé…ç½®ï¼Œä¿å­˜æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°è¡¨å•",type:"warning",showIcon:!0,style:{marginBottom:16}}),L&&e.jsx(P,{message:"JSONæ ¼å¼é”™è¯¯",description:L,type:"error",showIcon:!0,style:{marginBottom:16}}),e.jsx(Fa,{value:N,onChange:o=>n(o.target.value),rows:20,style:{fontFamily:'Monaco, Consolas, "Courier New", monospace',fontSize:"12px",lineHeight:"1.5"},placeholder:"è¾“å…¥æˆ–ç¼–è¾‘JSONæ ¼å¼çš„è§„åˆ™é…ç½®..."}),e.jsx("div",{style:{marginTop:12},children:e.jsxs(p,{children:[e.jsx(E,{size:"small",onClick:r,icon:e.jsx(Ve,{}),children:"ä»è¡¨å•æ›´æ–°JSON"}),e.jsx(E,{size:"small",type:"primary",ghost:!0,onClick:()=>{try{const o=JSON.stringify(JSON.parse(N),null,2);$(o)}catch{}},icon:e.jsx(de,{}),children:"æ ¼å¼åŒ–JSON"})]})})]})}];return e.jsxs(Te,{title:e.jsxs(p,{children:[e.jsx(at,{style:{color:"#1890ff"}}),e.jsx("span",{children:"3Då‘é‡è§„åˆ™ç¼–è¾‘å™¨"}),e.jsx(g,{color:"blue",icon:e.jsx(se,{}),children:"3Då‘é‡æ•°æ®"})]}),open:h,onCancel:G,footer:e.jsxs(p,{children:[e.jsx(E,{onClick:G,size:"large",children:"å–æ¶ˆ"}),e.jsx(E,{type:"primary",loading:V,onClick:Q,size:"large",icon:e.jsx(me,{}),children:"ä¿å­˜è§„åˆ™"})]}),width:1200,centered:!0,destroyOnHidden:!0,style:{maxHeight:"90vh",top:0},styles:{body:{padding:"20px",maxHeight:"calc(90vh - 140px)",overflowY:"auto",overflowX:"hidden"},header:{borderBottom:"1px solid #f0f0f0",paddingBottom:"16px"},content:{maxHeight:"90vh",display:"flex",flexDirection:"column"}},children:[m.length>0&&e.jsx(P,{message:"éªŒè¯é”™è¯¯",description:e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:m.map((o,y)=>e.jsx("li",{children:o},y))}),type:"error",showIcon:!0,style:{marginBottom:16},closable:!0}),e.jsx(ke,{activeKey:q,onChange:A,items:ae,size:"large"})]})},{Option:er}=O,{Text:tr}=pe,{TextArea:qa}=B,Ba=({visible:h,onClose:v,onSave:M,rule:c})=>{const{form:C,saving:V,validationErrors:m,handleSave:S}=Pe({visible:h,onClose:v,onSave:M,rule:c,title:"é€šç”¨å‘é‡è§„åˆ™ç¼–è¾‘å™¨",dataTypeName:"é€šç”¨å‘é‡æ•°æ®"}),G=()=>{D(void 0),k([]),X("basic"),$(""),s(""),v()},[J,D]=b.useState(c?.conditions),[_,k]=b.useState(c?.actions||[]),[q,X]=b.useState("basic"),[N,$]=b.useState(""),[L,s]=b.useState(""),l=c?(o=>{if(o.data_type){if(typeof o.data_type=="string")return o.data_type;if(typeof o.data_type=="object"&&o.data_type!==null)return o.data_type.type||"vector_generic"}if(o.tags){const z=o.tags.data_type||o.tags.data_category;if(z)return z}const y=`${o.name||""} ${o.description||""}`.toLowerCase();return y.includes("vector")||y.includes("å‘é‡")||y.includes("array")||y.includes("æ•°ç»„")||y.includes("generic")||y.includes("é€šç”¨")||y.includes("sequence")||y.includes("åºåˆ—"),"vector_generic"})(c):"vector_generic";b.useEffect(()=>{h&&c&&(D(c.conditions),k(c.actions||[]),r())},[h,c]);const r=()=>{try{const o={id:c?.id||"",name:C.getFieldValue("name")||"",description:C.getFieldValue("description")||"",priority:C.getFieldValue("priority")||50,enabled:C.getFieldValue("enabled")!==!1,data_type:l,conditions:J,actions:_,tags:c?.tags||{},version:c?.version||1,created_at:c?.created_at||new Date().toISOString(),updated_at:new Date().toISOString()};$(JSON.stringify(o,null,2)),s("")}catch{s("JSONç”Ÿæˆå¤±è´¥")}},n=o=>{$(o);try{const y=JSON.parse(o);y.name&&y.conditions&&y.actions?(s(""),C.setFieldsValue({name:y.name,description:y.description,priority:y.priority,enabled:y.enabled}),D(y.conditions),k(y.actions||[])):s("JSONæ ¼å¼ä¸å®Œæ•´ï¼Œç¼ºå°‘å¿…è¦å­—æ®µ")}catch{s("JSONæ ¼å¼é”™è¯¯")}},i=[{value:"sensor_vector.dimension",label:"å‘é‡ç»´åº¦",description:"å‘é‡çš„ç»´æ•°"},{value:"sensor_vector.magnitude",label:"å‘é‡æ¨¡é•¿",description:"å‘é‡çš„æ¬§å‡ é‡Œå¾·é•¿åº¦"},{value:"sensor_vector.mean",label:"å‘é‡å‡å€¼",description:"æ‰€æœ‰å…ƒç´ çš„å¹³å‡å€¼"},{value:"sensor_vector.max",label:"å‘é‡æœ€å¤§å€¼",description:"æ‰€æœ‰å…ƒç´ çš„æœ€å¤§å€¼"},{value:"sensor_vector.min",label:"å‘é‡æœ€å°å€¼",description:"æ‰€æœ‰å…ƒç´ çš„æœ€å°å€¼"},{value:"signal_array.length",label:"æ•°ç»„é•¿åº¦",description:"æ•°ç»„å…ƒç´ ä¸ªæ•°"},{value:"signal_array.sum",label:"æ•°ç»„å’Œ",description:"æ‰€æœ‰å…ƒç´ çš„æ€»å’Œ"},{value:"signal_array.avg",label:"æ•°ç»„å¹³å‡å€¼",description:"æ‰€æœ‰å…ƒç´ çš„å¹³å‡å€¼"},{value:"measurement_vector.stddev",label:"å‘é‡æ ‡å‡†å·®",description:"å…ƒç´ çš„æ ‡å‡†åå·®"},{value:"measurement_vector.variance",label:"å‘é‡æ–¹å·®",description:"å…ƒç´ çš„æ–¹å·®"},{value:"data_sequence[0]",label:"ç¬¬ä¸€ä¸ªå…ƒç´ ",description:"å‘é‡/æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ "},{value:"data_sequence[1]",label:"ç¬¬äºŒä¸ªå…ƒç´ ",description:"å‘é‡/æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ "},{value:"data_sequence[-1]",label:"æœ€åä¸€ä¸ªå…ƒç´ ",description:"å‘é‡/æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ "},{value:"feature_vector.norm",label:"å‘é‡èŒƒæ•°",description:"å‘é‡çš„2èŒƒæ•°"},{value:"values.size",label:"å…ƒç´ æ•°é‡",description:"å‘é‡ä¸­å…ƒç´ çš„æ•°é‡"}],x=[{value:"generic_vector_transform",label:"é€šç”¨å‘é‡è½¬æ¢",description:"å‘é‡æ¨¡é•¿ã€å‡å€¼ã€å…ƒç´ æå–ç­‰é€šç”¨æ“ä½œ",configSchema:{transform_type:{type:"string",label:"è½¬æ¢ç±»å‹",required:!0,options:[{value:"generic_magnitude",label:"é€šç”¨å‘é‡æ¨¡é•¿"},{value:"vector_mean",label:"å‘é‡å…ƒç´ å‡å€¼"},{value:"vector_sum",label:"å‘é‡å…ƒç´ æ±‚å’Œ"},{value:"vector_max",label:"å‘é‡æœ€å¤§å€¼"},{value:"vector_min",label:"å‘é‡æœ€å°å€¼"},{value:"vector_stddev",label:"å‘é‡æ ‡å‡†å·®"},{value:"element_extract",label:"å…ƒç´ æå–"},{value:"subvector_extract",label:"å­å‘é‡æå–"}]},vector_field:{type:"string",label:"å‘é‡å­—æ®µ",required:!0,placeholder:"sensor_vector, signal_arrayç­‰",description:"è¦å¤„ç†çš„å‘é‡å­—æ®µå"},element_index:{type:"number",label:"å…ƒç´ ç´¢å¼•",placeholder:"0, 1, 2...",description:"ç”¨äºå…ƒç´ æå–çš„ç´¢å¼•ä½ç½®",conditionalDisplay:{dependsOn:"transform_type",showWhen:["element_extract"]}},start_index:{type:"number",label:"å¼€å§‹ç´¢å¼•",placeholder:"å­å‘é‡å¼€å§‹ä½ç½®",description:"å­å‘é‡æå–çš„å¼€å§‹ä½ç½®",conditionalDisplay:{dependsOn:"transform_type",showWhen:["subvector_extract"]}},end_index:{type:"number",label:"ç»“æŸç´¢å¼•",placeholder:"å­å‘é‡ç»“æŸä½ç½®",description:"å­å‘é‡æå–çš„ç»“æŸä½ç½®",conditionalDisplay:{dependsOn:"transform_type",showWhen:["subvector_extract"]}},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"è½¬æ¢åçš„å­—æ®µå",description:"è½¬æ¢ç»“æœå­˜å‚¨çš„å­—æ®µå"}}},{value:"generic_vector_expression",label:"é€šç”¨å‘é‡è¡¨è¾¾å¼æ“ä½œ",description:"ä½¿ç”¨è¡¨è¾¾å¼å¯¹é€šç”¨å‘é‡æ•°æ®è¿›è¡Œå¤æ‚è®¡ç®—å’Œå¤„ç†",configSchema:{expression:{type:"textarea",label:"è¡¨è¾¾å¼",required:!0,placeholder:"genericVectorMagnitude(sensor_vector) + vectorMean(signal_array)",description:"æ”¯æŒé€šç”¨å‘é‡å‡½æ•°å’Œæ•°å­¦è¿ç®—çš„è¡¨è¾¾å¼"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"ç»“æœå­˜å‚¨çš„å­—æ®µå",description:"è¡¨è¾¾å¼è®¡ç®—ç»“æœå­˜å‚¨çš„å­—æ®µå"},output_type:{type:"string",label:"è¾“å‡ºç±»å‹",options:[{value:"number",label:"æ•°å€¼"},{value:"array",label:"æ•°ç»„"},{value:"boolean",label:"å¸ƒå°”å€¼"},{value:"string",label:"å­—ç¬¦ä¸²"}],defaultValue:"number"}}},{value:"generic_vector_alert",label:"é€šç”¨å‘é‡å‘Šè­¦",description:"åŸºäºå‘é‡ç»Ÿè®¡ç‰¹æ€§çš„å‘Šè­¦",configSchema:{alert_type:{type:"string",label:"å‘Šè­¦ç±»å‹",options:[{value:"magnitude_threshold",label:"æ¨¡é•¿é˜ˆå€¼å‘Šè­¦"},{value:"mean_threshold",label:"å‡å€¼é˜ˆå€¼å‘Šè­¦"},{value:"element_threshold",label:"å…ƒç´ é˜ˆå€¼å‘Šè­¦"},{value:"dimension_check",label:"ç»´åº¦æ£€æŸ¥å‘Šè­¦"},{value:"variance_anomaly",label:"æ–¹å·®å¼‚å¸¸å‘Šè­¦"}]},threshold:{type:"number",label:"å‘Šè­¦é˜ˆå€¼",required:!0,placeholder:"è§¦å‘å‘Šè­¦çš„æ•°å€¼é˜ˆå€¼"},message:{type:"textarea",label:"å‘Šè­¦æ¶ˆæ¯",required:!0,placeholder:"è®¾å¤‡{{.DeviceID}}å‘é‡{{.VectorField}}å¼‚å¸¸: å½“å‰å€¼{{.CurrentValue}}"}}}],j=[{name:"genericVectorMagnitude",description:"è®¡ç®—é€šç”¨å‘é‡æ¨¡é•¿",syntax:"genericVectorMagnitude(vector)",example:"genericVectorMagnitude(sensor_vector) > 10.5",category:"å‘é‡å‡½æ•°",parameters:["vector"]},{name:"vectorMean",description:"è®¡ç®—å‘é‡å…ƒç´ å‡å€¼",syntax:"vectorMean(vector)",example:"vectorMean(signal_array) > 5.0",category:"å‘é‡å‡½æ•°",parameters:["vector"]},{name:"vectorMax",description:"è·å–å‘é‡æœ€å¤§å…ƒç´ ",syntax:"vectorMax(vector)",example:"vectorMax(measurement_vector) < 100",category:"å‘é‡å‡½æ•°",parameters:["vector"]},{name:"vectorMin",description:"è·å–å‘é‡æœ€å°å…ƒç´ ",syntax:"vectorMin(vector)",example:"vectorMin(measurement_vector) > -50",category:"å‘é‡å‡½æ•°",parameters:["vector"]},{name:"vectorStddev",description:"è®¡ç®—å‘é‡æ ‡å‡†å·®",syntax:"vectorStddev(vector)",example:"vectorStddev(sensor_data) > 2.0",category:"å‘é‡å‡½æ•°",parameters:["vector"]},{name:"vectorDimension",description:"è·å–å‘é‡ç»´åº¦",syntax:"vectorDimension(vector)",example:"vectorDimension(feature_vector) == 128",category:"å‘é‡å‡½æ•°",parameters:["vector"]},{name:"vectorElement",description:"è®¿é—®å‘é‡æŒ‡å®šå…ƒç´ ",syntax:"vectorElement(vector, index)",example:"vectorElement(data_sequence, 0) > 0",category:"å‘é‡å‡½æ•°",parameters:["vector","index"]}],H=[{name:"sensor_vector",description:"ä¼ æ„Ÿå™¨å‘é‡æ•°æ®",type:"vector",example:"genericVectorMagnitude(sensor_vector) > 5.0"},{name:"signal_array",description:"ä¿¡å·æ•°ç»„æ•°æ®",type:"array",example:"vectorMean(signal_array) > 0"},{name:"measurement_vector",description:"æµ‹é‡å‘é‡",type:"vector",example:"vectorMax(measurement_vector) < 100"},{name:"data_sequence",description:"æ•°æ®åºåˆ—",type:"array",example:"vectorElement(data_sequence, 0) > threshold"},{name:"feature_vector",description:"ç‰¹å¾å‘é‡",type:"vector",example:"vectorDimension(feature_vector) == 64"},{name:"values",description:"æ•°å€¼å‘é‡",type:"vector",example:"vectorStddev(values) < 1.0"}],Q=async()=>{r(),await S(()=>J,()=>_)},A=o=>{X(o),(o==="json"||o==="preview")&&setTimeout(r,50)},re=()=>{(q==="json"||q==="preview")&&setTimeout(r,100)},U=()=>e.jsx(I,{title:e.jsxs(p,{children:[e.jsx(se,{}),"é€šç”¨å‘é‡é…ç½®"]}),style:{marginTop:16},children:e.jsx(P,{message:"é€šç”¨å‘é‡æ•°æ®ç±»å‹",description:"æ­¤æ•°æ®ç±»å‹ä¸“é—¨å¤„ç†ä»»æ„ç»´åº¦çš„å‘é‡ã€æ•°ç»„å’Œåºåˆ—æ•°æ®ï¼Œæ”¯æŒä¸°å¯Œçš„ç»Ÿè®¡å’Œæ•°å­¦è¿ç®—åŠŸèƒ½",type:"info",showIcon:!0})}),le=()=>e.jsxs(I,{title:"é€šç”¨å‘é‡æ¡ä»¶",style:{marginTop:16},children:[e.jsx(Fe,{value:J,onChange:D,availableFields:["device_id","key","value","timestamp"],customFieldOptions:i,allowedOperators:["eq","ne","gt","gte","lt","lte","contains","regex"],supportExpressions:!0,dataTypeName:"é€šç”¨å‘é‡"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(Ge,{value:J?.type==="expression"?J.expression:"",onChange:o=>D({type:"expression",expression:o}),dataType:"vector_generic",availableFunctions:j,availableVariables:H,placeholder:"è¾“å…¥é€šç”¨å‘é‡è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼šgenericVectorMagnitude(sensor_vector) > 10.0",rows:3})})]}),te=()=>e.jsx(I,{title:"é€šç”¨å‘é‡åŠ¨ä½œ",style:{marginTop:16},children:e.jsx(Le,{value:_,onChange:k,availableActionTypes:[],customActionOptions:x,dataTypeName:"é€šç”¨å‘é‡"})}),ae=[{key:"basic",label:e.jsxs(p,{children:[e.jsx(ce,{}),"åŸºæœ¬ä¿¡æ¯"]}),children:e.jsxs(I,{title:"åŸºæœ¬ä¿¡æ¯",style:{border:"none",boxShadow:"none"},children:[e.jsxs(u,{form:C,layout:"vertical",initialValues:{priority:c?.priority||50,enabled:c?.enabled!==!1},onValuesChange:re,children:[e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"è§„åˆ™åç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥è§„åˆ™åç§°"}],children:e.jsx(B,{placeholder:"è¯·è¾“å…¥é€šç”¨å‘é‡è§„åˆ™åç§°"})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"ä¼˜å…ˆçº§",name:"priority",rules:[{required:!0,message:"è¯·è¾“å…¥ä¼˜å…ˆçº§"},{type:"number",min:0,max:100,message:"ä¼˜å…ˆçº§å¿…é¡»åœ¨0-100ä¹‹é—´"}],children:e.jsx(W,{min:0,max:100,style:{width:"100%"}})})})]}),e.jsx(u.Item,{label:"è§„åˆ™æè¿°",name:"description",children:e.jsx(B.TextArea,{placeholder:"è¯·è¾“å…¥é€šç”¨å‘é‡è§„åˆ™æè¿°",rows:3})}),e.jsx(u.Item,{label:"å¯ç”¨çŠ¶æ€",name:"enabled",valuePropName:"checked",children:e.jsx(he,{checkedChildren:"å¯ç”¨",unCheckedChildren:"ç¦ç”¨"})})]}),U()]})},{key:"conditions",label:e.jsxs(p,{children:[e.jsx(se,{}),"å‘é‡æ¡ä»¶"]}),children:le()},{key:"actions",label:e.jsxs(p,{children:[e.jsx(me,{}),"æ‰§è¡ŒåŠ¨ä½œ"]}),children:te()},{key:"preview",label:e.jsxs(p,{children:[e.jsx(Ie,{}),"é¢„è§ˆ"]}),children:e.jsxs(I,{title:"è§„åˆ™é¢„è§ˆ",style:{border:"none",boxShadow:"none"},children:[e.jsx(P,{message:"è§„åˆ™JSONé…ç½®",description:"ä»¥ä¸‹æ˜¯å½“å‰è§„åˆ™çš„å®Œæ•´JSONé…ç½®é¢„è§ˆ",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx("pre",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"6px",fontSize:"12px",lineHeight:"1.5",maxHeight:"400px",overflow:"auto",border:"1px solid #d9d9d9"},children:N})]})},{key:"json",label:e.jsxs(p,{children:[e.jsx(de,{}),"JSONç¼–è¾‘"]}),children:e.jsxs(I,{title:"JSONç›´æ¥ç¼–è¾‘",style:{border:"none",boxShadow:"none"},children:[e.jsx(P,{message:"JSONç¼–è¾‘æ¨¡å¼",description:"å¯ä»¥ç›´æ¥ç¼–è¾‘JSONé…ç½®ï¼Œä¿å­˜æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°è¡¨å•",type:"warning",showIcon:!0,style:{marginBottom:16}}),L&&e.jsx(P,{message:"JSONæ ¼å¼é”™è¯¯",description:L,type:"error",showIcon:!0,style:{marginBottom:16}}),e.jsx(qa,{value:N,onChange:o=>n(o.target.value),rows:20,style:{fontFamily:'Monaco, Consolas, "Courier New", monospace',fontSize:"12px",lineHeight:"1.5"},placeholder:"è¾“å…¥æˆ–ç¼–è¾‘JSONæ ¼å¼çš„è§„åˆ™é…ç½®..."}),e.jsx("div",{style:{marginTop:12},children:e.jsxs(p,{children:[e.jsx(E,{size:"small",onClick:r,icon:e.jsx(Ve,{}),children:"ä»è¡¨å•æ›´æ–°JSON"}),e.jsx(E,{size:"small",type:"primary",ghost:!0,onClick:()=>{try{const o=JSON.stringify(JSON.parse(N),null,2);$(o)}catch{}},icon:e.jsx(de,{}),children:"æ ¼å¼åŒ–JSON"})]})})]})}];return e.jsxs(Te,{title:e.jsxs(p,{children:[e.jsx(se,{style:{color:"#fa8c16"}}),e.jsx("span",{children:"é€šç”¨å‘é‡è§„åˆ™ç¼–è¾‘å™¨"}),e.jsx(g,{color:"orange",children:"é€šç”¨å‘é‡æ•°æ®"})]}),open:h,onCancel:G,footer:e.jsxs(p,{children:[e.jsx(E,{onClick:G,size:"large",children:"å–æ¶ˆ"}),e.jsx(E,{type:"primary",loading:V,onClick:Q,size:"large",icon:e.jsx(me,{}),children:"ä¿å­˜è§„åˆ™"})]}),width:1200,centered:!0,destroyOnHidden:!0,style:{maxHeight:"90vh",top:0},styles:{body:{padding:"20px",maxHeight:"calc(90vh - 140px)",overflowY:"auto",overflowX:"hidden"},header:{borderBottom:"1px solid #f0f0f0",paddingBottom:"16px"},content:{maxHeight:"90vh",display:"flex",flexDirection:"column"}},children:[m.length>0&&e.jsx(P,{message:"éªŒè¯é”™è¯¯",description:e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:m.map((o,y)=>e.jsx("li",{children:o},y))}),type:"error",showIcon:!0,style:{marginBottom:16},closable:!0}),e.jsx(ke,{activeKey:q,onChange:A,items:ae,size:"large"})]})},{Option:ar}=O,{Text:rr}=pe,{TextArea:Ha}=B,Ma=({visible:h,onClose:v,onSave:M,rule:c})=>{const{form:C,saving:V,validationErrors:m,handleSave:S,handleCancel:G}=Pe({visible:h,onClose:v,onSave:M,rule:c,title:"è§†è§‰è§„åˆ™ç¼–è¾‘å™¨",dataTypeName:"è§†è§‰æ•°æ®"}),J=()=>{console.log("VisualRuleEditor handleCancel è¢«è°ƒç”¨"),_(void 0),q([]),N("basic"),L(""),t(""),console.log("è°ƒç”¨ baseHandleCancel"),G()},[D,_]=b.useState(c?.conditions),[k,q]=b.useState(c?.actions||[]),[X,N]=b.useState("basic"),[$,L]=b.useState(""),[s,t]=b.useState(""),r=c?(y=>{if(y.data_type){if(typeof y.data_type=="string")return y.data_type;if(typeof y.data_type=="object"&&y.data_type!==null)return y.data_type.type||"color"}if(y.tags){const F=y.tags.data_type||y.tags.data_category;if(F)return F}const z=`${y.name||""} ${y.description||""}`.toLowerCase();return z.includes("color")||z.includes("é¢œè‰²")||z.includes("rgb")||z.includes("hsl")||z.includes("visual")||z.includes("è§†è§‰")||z.includes("brightness")||z.includes("äº®åº¦"),"color"})(c):"color";b.useEffect(()=>{h&&c&&(_(c.conditions),q(c.actions||[]),n())},[h,c]);const n=()=>{try{const y={id:c?.id||"",name:C.getFieldValue("name")||"",description:C.getFieldValue("description")||"",priority:C.getFieldValue("priority")||50,enabled:C.getFieldValue("enabled")!==!1,data_type:r,conditions:D,actions:k,tags:c?.tags||{},version:c?.version||1,created_at:c?.created_at||new Date().toISOString(),updated_at:new Date().toISOString()};L(JSON.stringify(y,null,2)),t("")}catch{t("JSONç”Ÿæˆå¤±è´¥")}},i=y=>{L(y);try{const z=JSON.parse(y);z.name&&z.conditions&&z.actions?(t(""),C.setFieldsValue({name:z.name,description:z.description,priority:z.priority,enabled:z.enabled}),_(z.conditions),q(z.actions||[])):t("JSONæ ¼å¼ä¸å®Œæ•´ï¼Œç¼ºå°‘å¿…è¦å­—æ®µ")}catch{t("JSONæ ¼å¼é”™è¯¯")}},x=[{value:"color.r",label:"çº¢è‰²åˆ†é‡ (R)",description:"RGBé¢œè‰²çš„çº¢è‰²åˆ†é‡ (0-255)"},{value:"color.g",label:"ç»¿è‰²åˆ†é‡ (G)",description:"RGBé¢œè‰²çš„ç»¿è‰²åˆ†é‡ (0-255)"},{value:"color.b",label:"è“è‰²åˆ†é‡ (B)",description:"RGBé¢œè‰²çš„è“è‰²åˆ†é‡ (0-255)"},{value:"color.a",label:"é€æ˜åº¦ (Alpha)",description:"é¢œè‰²é€æ˜åº¦ (0.0-1.0)"},{value:"hsl.h",label:"è‰²ç›¸ (Hue)",description:"HSLé¢œè‰²çš„è‰²ç›¸å€¼ (0-360)"},{value:"hsl.s",label:"é¥±å’Œåº¦ (Saturation)",description:"HSLé¢œè‰²çš„é¥±å’Œåº¦ (0-100)"},{value:"hsl.l",label:"äº®åº¦ (Lightness)",description:"HSLé¢œè‰²çš„äº®åº¦ (0-100)"},{value:"hsv.h",label:"HSVè‰²ç›¸",description:"HSVé¢œè‰²çš„è‰²ç›¸å€¼ (0-360)"},{value:"hsv.s",label:"HSVé¥±å’Œåº¦",description:"HSVé¢œè‰²çš„é¥±å’Œåº¦ (0-100)"},{value:"hsv.v",label:"æ˜åº¦ (Value)",description:"HSVé¢œè‰²çš„æ˜åº¦å€¼ (0-100)"},{value:"color.hex",label:"HEXé¢œè‰²å€¼",description:"åå…­è¿›åˆ¶é¢œè‰²è¡¨ç¤º (#RRGGBB)"},{value:"color.brightness",label:"æ•´ä½“äº®åº¦",description:"æ„ŸçŸ¥äº®åº¦å€¼ (0.0-1.0)"},{value:"color.contrast",label:"å¯¹æ¯”åº¦",description:"ç›¸å¯¹äºå‚è€ƒè‰²çš„å¯¹æ¯”åº¦"},{value:"color.dominant",label:"ä¸»è‰²è°ƒ",description:"å›¾åƒæˆ–åŒºåŸŸçš„ä¸»è‰²è°ƒåˆ†ç±»"}],j=[{value:"color_transform",label:"é¢œè‰²è½¬æ¢",description:"é¢œè‰²ç©ºé—´è½¬æ¢ã€è‰²å½©è°ƒæ•´ã€æ ¼å¼è½¬æ¢",configSchema:{transform_type:{type:"string",label:"è½¬æ¢ç±»å‹",required:!0,options:[{value:"color_space_convert",label:"é¢œè‰²ç©ºé—´è½¬æ¢"},{value:"brightness_adjust",label:"äº®åº¦è°ƒæ•´"},{value:"saturation_adjust",label:"é¥±å’Œåº¦è°ƒæ•´"},{value:"hue_shift",label:"è‰²ç›¸åç§»"},{value:"contrast_adjust",label:"å¯¹æ¯”åº¦è°ƒæ•´"},{value:"gamma_correction",label:"ä¼½é©¬æ ¡æ­£"},{value:"color_invert",label:"é¢œè‰²åè½¬"},{value:"grayscale_convert",label:"ç°åº¦è½¬æ¢"}]},source_color_space:{type:"string",label:"æºé¢œè‰²ç©ºé—´",options:[{value:"RGB",label:"RGB"},{value:"HSL",label:"HSL"},{value:"HSV",label:"HSV"},{value:"CMYK",label:"CMYK"},{value:"LAB",label:"LAB"}],defaultValue:"RGB"},target_color_space:{type:"string",label:"ç›®æ ‡é¢œè‰²ç©ºé—´",options:[{value:"RGB",label:"RGB"},{value:"HSL",label:"HSL"},{value:"HSV",label:"HSV"},{value:"CMYK",label:"CMYK"},{value:"LAB",label:"LAB"}],defaultValue:"HSL"},adjustment_value:{type:"number",label:"è°ƒæ•´æ•°å€¼",placeholder:"è°ƒæ•´å¼ºåº¦ (-100åˆ°100)",description:"é¢œè‰²è°ƒæ•´çš„å¼ºåº¦å€¼"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"è½¬æ¢åçš„å­—æ®µå",description:"è½¬æ¢ç»“æœå­˜å‚¨çš„å­—æ®µå"}}},{value:"color_analysis",label:"é¢œè‰²åˆ†æ",description:"é¢œè‰²ç›¸ä¼¼åº¦ã€ä¸»è‰²è°ƒæå–ã€è‰²å½©ç»Ÿè®¡",configSchema:{analysis_type:{type:"string",label:"åˆ†æç±»å‹",required:!0,options:[{value:"similarity_check",label:"é¢œè‰²ç›¸ä¼¼åº¦æ£€æŸ¥"},{value:"dominant_color",label:"ä¸»è‰²è°ƒæå–"},{value:"color_histogram",label:"é¢œè‰²ç›´æ–¹å›¾"},{value:"color_temperature",label:"è‰²æ¸©åˆ†æ"},{value:"color_palette",label:"è°ƒè‰²æ¿ç”Ÿæˆ"}]},reference_color:{type:"object",label:"å‚è€ƒé¢œè‰²",placeholder:'{"r": 255, "g": 0, "b": 0}',description:"ç”¨äºç›¸ä¼¼åº¦æ¯”è¾ƒçš„å‚è€ƒé¢œè‰²"},similarity_threshold:{type:"number",label:"ç›¸ä¼¼åº¦é˜ˆå€¼",placeholder:"0.0-1.0ä¹‹é—´çš„æ•°å€¼",description:"é¢œè‰²ç›¸ä¼¼åº¦åˆ¤æ–­é˜ˆå€¼"},distance_method:{type:"string",label:"è·ç¦»ç®—æ³•",options:[{value:"euclidean",label:"æ¬§æ°è·ç¦»"},{value:"manhattan",label:"æ›¼å“ˆé¡¿è·ç¦»"},{value:"cosine",label:"ä½™å¼¦è·ç¦»"},{value:"cie2000",label:"CIE2000è‰²å·®"}],defaultValue:"euclidean"}}},{value:"visual_expression",label:"è§†è§‰è¡¨è¾¾å¼æ“ä½œ",description:"ä½¿ç”¨è¡¨è¾¾å¼å¯¹è§†è§‰æ•°æ®è¿›è¡Œå¤æ‚è®¡ç®—å’Œå¤„ç†",configSchema:{expression:{type:"textarea",label:"è¡¨è¾¾å¼",required:!0,placeholder:"getBrightness(color.r, color.g, color.b) * 0.8",description:"æ”¯æŒé¢œè‰²å‡½æ•°å’Œæ•°å­¦è¿ç®—çš„è¡¨è¾¾å¼"},output_key:{type:"string",label:"è¾“å‡ºå­—æ®µ",placeholder:"ç»“æœå­˜å‚¨çš„å­—æ®µå",description:"è¡¨è¾¾å¼è®¡ç®—ç»“æœå­˜å‚¨çš„å­—æ®µå"},output_type:{type:"string",label:"è¾“å‡ºç±»å‹",options:[{value:"number",label:"æ•°å€¼"},{value:"string",label:"å­—ç¬¦ä¸²"},{value:"boolean",label:"å¸ƒå°”å€¼"},{value:"object",label:"å¯¹è±¡"}],defaultValue:"number"}}},{value:"visual_alert",label:"è§†è§‰å‘Šè­¦",description:"åŸºäºè§†è§‰ç‰¹å¾çš„å‘Šè­¦é€šçŸ¥",configSchema:{alert_type:{type:"string",label:"å‘Šè­¦ç±»å‹",options:[{value:"color_change",label:"é¢œè‰²å˜åŒ–å‘Šè­¦"},{value:"brightness_threshold",label:"äº®åº¦é˜ˆå€¼å‘Šè­¦"},{value:"contrast_anomaly",label:"å¯¹æ¯”åº¦å¼‚å¸¸å‘Šè­¦"},{value:"color_similarity",label:"é¢œè‰²åŒ¹é…å‘Šè­¦"}]},threshold:{type:"number",label:"å‘Šè­¦é˜ˆå€¼",required:!0,placeholder:"è§¦å‘å‘Šè­¦çš„æ•°å€¼é˜ˆå€¼"},message:{type:"textarea",label:"å‘Šè­¦æ¶ˆæ¯",required:!0,placeholder:"è®¾å¤‡{{.DeviceID}}é¢œè‰²å¼‚å¸¸: R={{.color.r}}, G={{.color.g}}, B={{.color.b}}"}}}],H=[{name:"colorSimilarity",description:"è®¡ç®—ä¸¤ç§é¢œè‰²çš„ç›¸ä¼¼åº¦",syntax:"colorSimilarity(r1, g1, b1, r2, g2, b2, method)",example:'colorSimilarity(color.r, color.g, color.b, 255, 0, 0, "euclidean") > 0.8',category:"é¢œè‰²å‡½æ•°",parameters:["r1","g1","b1","r2","g2","b2","method"]},{name:"rgbToHsl",description:"RGBè½¬HSLé¢œè‰²ç©ºé—´",syntax:"rgbToHsl(r, g, b)",example:"rgbToHsl(color.r, color.g, color.b)",category:"é¢œè‰²å‡½æ•°",parameters:["r","g","b"]},{name:"hslToRgb",description:"HSLè½¬RGBé¢œè‰²ç©ºé—´",syntax:"hslToRgb(h, s, l)",example:"hslToRgb(hsl.h, hsl.s, hsl.l)",category:"é¢œè‰²å‡½æ•°",parameters:["h","s","l"]},{name:"getBrightness",description:"è®¡ç®—é¢œè‰²äº®åº¦",syntax:"getBrightness(r, g, b)",example:"getBrightness(color.r, color.g, color.b) > 0.5",category:"é¢œè‰²å‡½æ•°",parameters:["r","g","b"]},{name:"getContrast",description:"è®¡ç®—ä¸¤ç§é¢œè‰²çš„å¯¹æ¯”åº¦",syntax:"getContrast(r1, g1, b1, r2, g2, b2)",example:"getContrast(color.r, color.g, color.b, 255, 255, 255) > 4.5",category:"é¢œè‰²å‡½æ•°",parameters:["r1","g1","b1","r2","g2","b2"]},{name:"hexToRgb",description:"åå…­è¿›åˆ¶è½¬RGB",syntax:"hexToRgb(hex)",example:"hexToRgb(color.hex)",category:"é¢œè‰²å‡½æ•°",parameters:["hex"]},{name:"rgbToHex",description:"RGBè½¬åå…­è¿›åˆ¶",syntax:"rgbToHex(r, g, b)",example:"rgbToHex(color.r, color.g, color.b)",category:"é¢œè‰²å‡½æ•°",parameters:["r","g","b"]}],Q=[{name:"color.r",description:"çº¢è‰²åˆ†é‡",type:"number",example:"color.r > 128"},{name:"color.g",description:"ç»¿è‰²åˆ†é‡",type:"number",example:"color.g > 128"},{name:"color.b",description:"è“è‰²åˆ†é‡",type:"number",example:"color.b > 128"},{name:"color.a",description:"é€æ˜åº¦",type:"number",example:"color.a > 0.5"},{name:"hsl.h",description:"HSLè‰²ç›¸",type:"number",example:"hsl.h > 180"},{name:"hsl.s",description:"HSLé¥±å’Œåº¦",type:"number",example:"hsl.s > 50"},{name:"hsl.l",description:"HSLäº®åº¦",type:"number",example:"hsl.l > 50"},{name:"color.hex",description:"HEXé¢œè‰²",type:"string",example:'contains(color.hex, "FF")'},{name:"color.brightness",description:"æ„ŸçŸ¥äº®åº¦",type:"number",example:"color.brightness > 0.5"},{name:"color.contrast",description:"å¯¹æ¯”åº¦",type:"number",example:"color.contrast > 4.5"}],A=async()=>{n(),await S(()=>D,()=>k)},re=y=>{N(y),(y==="json"||y==="preview")&&setTimeout(n,50)},U=()=>{(X==="json"||X==="preview")&&setTimeout(n,100)},le=()=>e.jsx(I,{title:e.jsxs(p,{children:[e.jsx(rt,{}),"è§†è§‰æ•°æ®é…ç½®"]}),style:{marginTop:16},children:e.jsx(P,{message:"è§†è§‰æ•°æ®ç±»å‹",description:"æ­¤æ•°æ®ç±»å‹ä¸“é—¨å¤„ç†é¢œè‰²ã€å›¾åƒç­‰è§†è§‰ç›¸å…³æ•°æ®ï¼Œæ”¯æŒRGBã€HSLã€HSVç­‰å¤šç§é¢œè‰²ç©ºé—´çš„åˆ†æå’Œè½¬æ¢",type:"info",showIcon:!0})}),te=()=>e.jsxs(I,{title:"è§†è§‰æ•°æ®æ¡ä»¶",style:{marginTop:16},children:[e.jsx(Fe,{value:D,onChange:_,availableFields:["device_id","key","value","timestamp"],customFieldOptions:x,allowedOperators:["eq","ne","gt","gte","lt","lte","contains","regex"],supportExpressions:!0,dataTypeName:"è§†è§‰æ•°æ®"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(Ge,{value:D?.type==="expression"?D.expression:"",onChange:y=>_({type:"expression",expression:y}),dataType:"visual",availableFunctions:H,availableVariables:Q,placeholder:"è¾“å…¥è§†è§‰æ•°æ®è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼šcolorSimilarity(color.r, color.g, color.b, 255, 0, 0, 'euclidean') > 0.8",rows:3})})]}),ae=()=>e.jsx(I,{title:"è§†è§‰æ•°æ®åŠ¨ä½œ",style:{marginTop:16},children:e.jsx(Le,{value:k,onChange:q,availableActionTypes:[],customActionOptions:j,dataTypeName:"è§†è§‰æ•°æ®"})}),o=[{key:"basic",label:e.jsxs(p,{children:[e.jsx(ce,{}),"åŸºæœ¬ä¿¡æ¯"]}),children:e.jsxs(I,{title:"åŸºæœ¬ä¿¡æ¯",style:{border:"none",boxShadow:"none"},children:[e.jsxs(u,{form:C,layout:"vertical",initialValues:{priority:c?.priority||50,enabled:c?.enabled!==!1},onValuesChange:U,children:[e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"è§„åˆ™åç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥è§„åˆ™åç§°"}],children:e.jsx(B,{placeholder:"è¯·è¾“å…¥è§†è§‰è§„åˆ™åç§°"})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"ä¼˜å…ˆçº§",name:"priority",rules:[{required:!0,message:"è¯·è¾“å…¥ä¼˜å…ˆçº§"},{type:"number",min:0,max:100,message:"ä¼˜å…ˆçº§å¿…é¡»åœ¨0-100ä¹‹é—´"}],children:e.jsx(W,{min:0,max:100,style:{width:"100%"}})})})]}),e.jsx(u.Item,{label:"è§„åˆ™æè¿°",name:"description",children:e.jsx(B.TextArea,{placeholder:"è¯·è¾“å…¥è§†è§‰è§„åˆ™æè¿°",rows:3})}),e.jsx(u.Item,{label:"å¯ç”¨çŠ¶æ€",name:"enabled",valuePropName:"checked",children:e.jsx(he,{checkedChildren:"å¯ç”¨",unCheckedChildren:"ç¦ç”¨"})})]}),le()]})},{key:"conditions",label:e.jsxs(p,{children:[e.jsx(rt,{}),"è§†è§‰æ¡ä»¶"]}),children:te()},{key:"actions",label:e.jsxs(p,{children:[e.jsx(me,{}),"æ‰§è¡ŒåŠ¨ä½œ"]}),children:ae()},{key:"preview",label:e.jsxs(p,{children:[e.jsx(Ie,{}),"é¢„è§ˆ"]}),children:e.jsxs(I,{title:"è§„åˆ™é¢„è§ˆ",style:{border:"none",boxShadow:"none"},children:[e.jsx(P,{message:"è§„åˆ™JSONé…ç½®",description:"ä»¥ä¸‹æ˜¯å½“å‰è§„åˆ™çš„å®Œæ•´JSONé…ç½®é¢„è§ˆ",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx("pre",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"6px",fontSize:"12px",lineHeight:"1.5",maxHeight:"400px",overflow:"auto",border:"1px solid #d9d9d9"},children:$})]})},{key:"json",label:e.jsxs(p,{children:[e.jsx(de,{}),"JSONç¼–è¾‘"]}),children:e.jsxs(I,{title:"JSONç›´æ¥ç¼–è¾‘",style:{border:"none",boxShadow:"none"},children:[e.jsx(P,{message:"JSONç¼–è¾‘æ¨¡å¼",description:"å¯ä»¥ç›´æ¥ç¼–è¾‘JSONé…ç½®ï¼Œä¿å­˜æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°è¡¨å•",type:"warning",showIcon:!0,style:{marginBottom:16}}),s&&e.jsx(P,{message:"JSONæ ¼å¼é”™è¯¯",description:s,type:"error",showIcon:!0,style:{marginBottom:16}}),e.jsx(Ha,{value:$,onChange:y=>i(y.target.value),rows:20,style:{fontFamily:'Monaco, Consolas, "Courier New", monospace',fontSize:"12px",lineHeight:"1.5"},placeholder:"è¾“å…¥æˆ–ç¼–è¾‘JSONæ ¼å¼çš„è§„åˆ™é…ç½®..."}),e.jsx("div",{style:{marginTop:12},children:e.jsxs(p,{children:[e.jsx(E,{size:"small",onClick:n,icon:e.jsx(Ve,{}),children:"ä»è¡¨å•æ›´æ–°JSON"}),e.jsx(E,{size:"small",type:"primary",ghost:!0,onClick:()=>{try{const y=JSON.stringify(JSON.parse($),null,2);L(y)}catch{}},icon:e.jsx(de,{}),children:"æ ¼å¼åŒ–JSON"})]})})]})}];return e.jsxs(Te,{title:e.jsxs(p,{children:[e.jsx(rt,{style:{color:"#722ed1"}}),e.jsx("span",{children:"è§†è§‰è§„åˆ™ç¼–è¾‘å™¨"}),e.jsx(g,{color:"purple",children:"è§†è§‰æ•°æ®"})]}),open:h,onCancel:J,footer:e.jsxs(p,{children:[e.jsx(E,{onClick:J,size:"large",children:"å–æ¶ˆ"}),e.jsx(E,{type:"primary",loading:V,onClick:A,size:"large",icon:e.jsx(me,{}),children:"ä¿å­˜è§„åˆ™"})]}),width:1200,centered:!0,destroyOnHidden:!0,style:{maxHeight:"90vh",top:0},styles:{body:{padding:"20px",maxHeight:"calc(90vh - 140px)",overflowY:"auto",overflowX:"hidden"},header:{borderBottom:"1px solid #f0f0f0",paddingBottom:"16px"},content:{maxHeight:"90vh",display:"flex",flexDirection:"column"}},children:[m.length>0&&e.jsx(P,{message:"éªŒè¯é”™è¯¯",description:e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:m.map((y,z)=>e.jsx("li",{children:y},z))}),type:"error",showIcon:!0,style:{marginBottom:16},closable:!0}),e.jsx(ke,{activeKey:X,onChange:re,items:o,size:"large"})]})},{Title:mt,Text:yt}=pe,{Search:Ea}=B,{Option:At}=O,{TextArea:gt}=B,lr=()=>{const[h,v]=b.useState([]),[M,c]=b.useState(!1),[C,V]=b.useState(""),[m,S]=b.useState(),[G,J]=b.useState({current:1,pageSize:10,total:0}),[D,_]=b.useState(!1),[k,q]=b.useState(null),[X,N]=b.useState(!1),[$,L]=b.useState(!1),[s]=u.useForm(),[t,l]=b.useState(!1),[r,n]=b.useState(!1),[i,x]=b.useState(!1),[j,H]=b.useState(null),[Q,A]=b.useState(!1),[re,U]=b.useState(!1),[le,te]=b.useState(!1),[ae,o]=b.useState(!1),[y,z]=b.useState(!1),[F,it]=b.useState("visual"),[Ye,Je]=b.useState(),[Xe,qe]=b.useState([]),[Mt,Et]=b.useState(""),[ft,Be]=b.useState([]),Ze=a=>!a||!a.type?(console.error("æ¡ä»¶ç¼ºå°‘ type å­—æ®µ"),!1):a.type==="simple"?a.and||a.or||a.expression?(console.error("simple ç±»å‹æ¡ä»¶ä¸åº”åŒ…å« andã€or æˆ– expression å­—æ®µ",a),!1):!0:a.type==="and"?!a.and||!Array.isArray(a.and)?(console.error("and ç±»å‹æ¡ä»¶å¿…é¡»åŒ…å« and æ•°ç»„",a),!1):a.field||a.operator||a.value||a.expression?(console.error("and ç±»å‹æ¡ä»¶ä¸åº”åŒ…å« fieldã€operatorã€value æˆ– expression å­—æ®µ",a),!1):a.and.every(Ze):a.type==="or"?!a.or||!Array.isArray(a.or)?(console.error("or ç±»å‹æ¡ä»¶å¿…é¡»åŒ…å« or æ•°ç»„",a),!1):a.field||a.operator||a.value||a.expression?(console.error("or ç±»å‹æ¡ä»¶ä¸åº”åŒ…å« fieldã€operatorã€value æˆ– expression å­—æ®µ",a),!1):a.or.every(Ze):a.type==="expression"?a.expression?a.field||a.operator||a.value||a.and||a.or?(console.error("expression ç±»å‹æ¡ä»¶ä¸åº”åŒ…å«å…¶ä»–å­—æ®µ",a),!1):!0:(console.error("expression ç±»å‹æ¡ä»¶å¿…é¡»åŒ…å« expression å­—æ®µ",a),!1):(console.error("æœªçŸ¥çš„æ¡ä»¶ç±»å‹:",a.type),!1),Oe=async()=>{c(!0);try{const a={page:G.current,page_size:G.pageSize,search:C||void 0,enabled:m},d=await ve.getRules(a);v(d.data),J(f=>({...f,total:d.pagination.total}))}catch(a){Y.error("è·å–è§„åˆ™åˆ—è¡¨å¤±è´¥ï¼š"+(a.message||"æœªçŸ¥é”™è¯¯"))}finally{c(!1)}},Pt=async a=>{try{a.enabled?(await ve.disableRule(a.id),Y.success("è§„åˆ™å·²ç¦ç”¨")):(await ve.enableRule(a.id),Y.success("è§„åˆ™å·²å¯ç”¨")),await new Promise(d=>setTimeout(d,300)),await Oe()}catch(d){Y.error("æ“ä½œå¤±è´¥ï¼š"+(d.message||"æœªçŸ¥é”™è¯¯"))}},Lt=async a=>{try{await ve.deleteRule(a.id),Y.success("åˆ é™¤è§„åˆ™æˆåŠŸ"),await new Promise(d=>setTimeout(d,300)),await Oe()}catch(d){Y.error("åˆ é™¤è§„åˆ™å¤±è´¥ï¼š"+(d.message||"æœªçŸ¥é”™è¯¯"))}},Gt=a=>{q(a),_(!0)},Yt=()=>{x(!0)},Xt=a=>{if(H(a),x(!1),a.type==="complex")switch(a.category){case"geospatial":U(!0);break;case"vector":te(!0);break;case"vector_generic":o(!0);break;case"visual":z(!0);break;default:A(!0);break}else nt()},nt=a=>{if(L(!!a),a)q(a),s.setFieldsValue({name:a.name,description:a.description,enabled:a.enabled,priority:a.priority,tags:a.tags?Object.entries(a.tags).map(([d,f])=>({key:d,value:f})):[]}),Je(a.conditions),qe(a.actions||[]),s.setFieldsValue({conditions:JSON.stringify(a.conditions,null,2),actions:JSON.stringify(a.actions,null,2)});else{s.resetFields();const d={type:"simple",field:"key",operator:"eq",value:"temperature"},f=[{type:"alert",config:{level:"warning",message:"å‘Šè­¦ä¿¡æ¯"}}];s.setFieldsValue({enabled:!0,priority:100,conditions:JSON.stringify(d,null,2),actions:JSON.stringify(f,null,2)}),Je(d),qe(f)}it("visual"),Be([]),Ne(),N(!0)},Ne=()=>{try{const a=s.getFieldsValue();let d,f;F==="visual"?(d=Ye,f=Xe):(d=a.conditions?JSON.parse(a.conditions):void 0,f=a.actions?JSON.parse(a.actions):[]);const K={name:a.name||"",description:a.description||"",enabled:a.enabled??!0,priority:a.priority||100,conditions:d,actions:f,tags:a.tags?.reduce((we,ue)=>(ue.key&&ue.value&&(we[ue.key]=ue.value),we),{})||{}};Et(JSON.stringify(K,null,2)),Be([])}catch(a){Be([a.message||"JSONæ ¼å¼é”™è¯¯"])}},Zt=()=>{Ne()},Kt=a=>{Je(a),Ne()},Ut=a=>{qe(a),Ne()},Wt=a=>{if(a==="json"&&F==="visual")s.setFieldsValue({conditions:JSON.stringify(Ye,null,2),actions:JSON.stringify(Xe,null,2)});else if(a==="visual"&&F==="json")try{const d=s.getFieldsValue();if(d.conditions){const f=JSON.parse(d.conditions);Je(f)}if(d.actions){const f=JSON.parse(d.actions);qe(f)}Be([])}catch{Y.error("JSONæ ¼å¼é”™è¯¯ï¼Œæ— æ³•åˆ‡æ¢åˆ°å¯è§†åŒ–æ¨¡å¼");return}it(a),setTimeout(Ne,0)},Qt=async()=>{try{const a=await s.validateFields();let d,f;if(F==="visual"){if(d=Ye,f=Xe,d&&!Ze(d)){Y.error("æ¡ä»¶æ•°æ®ç»“æ„ä¸æ­£ç¡®ï¼Œæ— æ³•ä¿å­˜");return}}else if(d=JSON.parse(a.conditions),f=JSON.parse(a.actions),d&&!Ze(d)){Y.error("æ¡ä»¶æ•°æ®ç»“æ„ä¸æ­£ç¡®ï¼Œæ— æ³•ä¿å­˜");return}if(!d){Y.error("è¯·é…ç½®è§¦å‘æ¡ä»¶");return}if(!f||f.length===0){Y.error("è¯·é…ç½®è‡³å°‘ä¸€ä¸ªåŠ¨ä½œ");return}const K=a.tags?.reduce((ue,Re)=>(Re.key&&Re.value&&(ue[Re.key]=Re.value),ue),{}),we={name:a.name,description:a.description,enabled:a.enabled,priority:a.priority,conditions:d,actions:f,tags:K};$&&k?(await ve.updateRule(k.id,{...we,version:k.version}),Y.success("è§„åˆ™æ›´æ–°æˆåŠŸ")):(await ve.createRule(we),Y.success("è§„åˆ™åˆ›å»ºæˆåŠŸ")),N(!1),await new Promise(ue=>setTimeout(ue,500)),await Oe()}catch(a){if(console.error("ä¿å­˜è§„åˆ™å¤±è´¥:",a),a instanceof SyntaxError)Y.error("JSON æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ¡ä»¶å’ŒåŠ¨ä½œé…ç½®");else if(a.response){const d=a.response.data?.message||a.response.data?.error||a.response.statusText||"æœåŠ¡å™¨é”™è¯¯";Y.error(`ä¿å­˜è§„åˆ™å¤±è´¥: ${d} (çŠ¶æ€ç : ${a.response.status})`),console.error("APIé”™è¯¯å“åº”:",{status:a.response.status,data:a.response.data,headers:a.response.headers})}else a.request?(Y.error("ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"),console.error("ç½‘ç»œè¯·æ±‚å¤±è´¥:",a.request)):(Y.error("ä¿å­˜è§„åˆ™å¤±è´¥ï¼š"+(a.message||"æœªçŸ¥é”™è¯¯")),console.error("å…¶ä»–é”™è¯¯:",a.message))}},ea=a=>{const d={...a,name:`${a.name} (å‰¯æœ¬)`,id:""};Ue(d)?St(d):nt(d)},ta=a=>{const d=a.rule;s.setFieldsValue({name:d.name,description:d.description,enabled:d.enabled??!0,priority:d.priority||100,tags:d.tags?Object.entries(d.tags).map(([f,K])=>({key:f,value:K})):[]}),Je(d.conditions),qe(d.actions||[]),s.setFieldsValue({conditions:JSON.stringify(d.conditions,null,2),actions:JSON.stringify(d.actions,null,2)}),it("visual"),Be([]),L(!1),q(null),setTimeout(Ne,0),N(!0),Y.success(`å·²åŠ è½½æ¨¡æ¿ï¼š${a.name}`)},aa=async a=>{try{$&&k?(await ve.updateRule(k.id,{...a,version:k.version}),Y.success("å¤åˆæ•°æ®è§„åˆ™æ›´æ–°æˆåŠŸ")):(await ve.createRule(a),Y.success("å¤åˆæ•°æ®è§„åˆ™åˆ›å»ºæˆåŠŸ")),A(!1),H(null),await new Promise(d=>setTimeout(d,500)),await Oe()}catch(d){if(console.error("ä¿å­˜å¤åˆæ•°æ®è§„åˆ™å¤±è´¥:",d),d.response){const f=d.response.data?.message||d.response.data?.error||d.response.statusText||"æœåŠ¡å™¨é”™è¯¯";Y.error(`ä¿å­˜å¤åˆæ•°æ®è§„åˆ™å¤±è´¥: ${f} (çŠ¶æ€ç : ${d.response.status})`)}else d.request?Y.error("ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"):Y.error("ä¿å­˜å¤åˆæ•°æ®è§„åˆ™å¤±è´¥ï¼š"+(d.message||"æœªçŸ¥é”™è¯¯"))}},ra=()=>{A(!1),H(null),q(null),L(!1)},Ke=async a=>{try{$&&k?(await ve.updateRule(k.id,{...a,version:k.version}),Y.success("å¤åˆæ•°æ®è§„åˆ™æ›´æ–°æˆåŠŸ")):(await ve.createRule(a),Y.success("å¤åˆæ•°æ®è§„åˆ™åˆ›å»ºæˆåŠŸ")),U(!1),te(!1),o(!1),z(!1),A(!1),H(null),await new Promise(d=>setTimeout(d,500)),await Oe()}catch(d){if(console.error("ä¿å­˜ä¸“é—¨åŒ–è§„åˆ™å¤±è´¥:",d),d.response){const f=d.response.data?.message||d.response.data?.error||d.response.statusText||"æœåŠ¡å™¨é”™è¯¯";Y.error(`ä¿å­˜è§„åˆ™å¤±è´¥: ${f} (çŠ¶æ€ç : ${d.response.status})`)}else d.request?Y.error("ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"):Y.error("ä¿å­˜è§„åˆ™å¤±è´¥ï¼š"+(d.message||"æœªçŸ¥é”™è¯¯"))}},bt=()=>{console.log("handleSpecializedRuleCancel è¢«è°ƒç”¨ï¼Œå½“å‰çŠ¶æ€:"),console.log("- visualEditorVisible:",y),console.log("- geospatialEditorVisible:",re),console.log("- vector3dEditorVisible:",le),U(!1),te(!1),o(!1),z(!1),A(!1),H(null),q(null),L(!1),console.log("å·²è®¾ç½®æ‰€æœ‰ç¼–è¾‘å™¨ä¸ºä¸å¯è§")},Ue=a=>{const d=a.data_type,f=a.tags?a.tags.data_type||a.tags.data_category:null,K=d||f;if(K&&["geospatial","vector","visual","array","matrix","timeseries","location","vector3d","color","gps","vector_generic","mixed"].includes(K))return console.log(`æ£€æµ‹åˆ°å¤åˆæ•°æ®è§„åˆ™ [${a.name}]: æ•°æ®ç±»å‹æ ‡è®° = ${K}`),!0;const ue=["geo_transform","geo_aggregate","geo_filter","geospatial_transform","vector_transform","vector_aggregate","vector_filter","color_transform","color_aggregate","color_filter","visual_transform","array_transform","array_aggregate","array_filter","matrix_transform","matrix_aggregate","matrix_filter","timeseries_transform","timeseries_aggregate","timeseries_filter"];if(a.actions&&a.actions.some(ze=>ue.includes(ze.type))){const ze=a.actions.find(ye=>ue.includes(ye.type))?.type;return console.log(`æ£€æµ‹åˆ°å¤åˆæ•°æ®è§„åˆ™ [${a.name}]: å¤åˆåŠ¨ä½œç±»å‹ = ${ze}`),!0}const Re=["latitude","longitude","altitude","lat","lng","coord","location","x","y","z","magnitude","direction","velocity","acceleration","r","g","b","hue","saturation","lightness","alpha","rgb","hsl","rows","cols","size","length","dimensions","matrix","array","duration","data_points","timestamps","series","trend"];if(a.conditions){const ze=ye=>!!(ye.field&&Re.includes(ye.field)||ye.and&&ye.and.some(ze)||ye.or&&ye.or.some(ze));if(ze(a.conditions)){const ye=We(a.conditions);return console.log(`æ£€æµ‹åˆ°å¤åˆæ•°æ®è§„åˆ™ [${a.name}]: å¤åˆå­—æ®µ = ${ye}`),!0}}return!1},We=a=>{const d=["latitude","longitude","altitude","lat","lng","coord","location","x","y","z","magnitude","direction","velocity","acceleration","r","g","b","hue","saturation","lightness","alpha","rgb","hsl","rows","cols","size","length","dimensions","matrix","array","duration","data_points","timestamps","series","trend"];if(a.field&&d.includes(a.field))return a.field;if(a.and)for(const f of a.and){const K=We(f);if(K)return K}if(a.or)for(const f of a.or){const K=We(f);if(K)return K}return"æœªçŸ¥å¤åˆå­—æ®µ"},ot=a=>{const d=a.data_type;if(d){console.log(`è§„åˆ™ [${a.name}] æ£€æµ‹åˆ° data_type å­—æ®µ:`,d);const K={location:"geospatial",vector3d:"vector",vector_generic:"vector_generic",gps:"geospatial",color:"visual",array:"array",matrix:"matrix",timeseries:"timeseries",mixed:"mixed"}[d]||d;return console.log(`æ•°æ®ç±»å‹ ${d} æ˜ å°„åˆ°ç±»åˆ«:`,K),K}if(a.tags&&a.tags.data_category)return a.tags.data_category;if(a.actions&&a.actions.length>0){const f=a.actions[0].type;if(f.includes("geo"))return"geospatial";if(f.includes("vector"))return"vector";if(f.includes("color")||f.includes("visual"))return"visual";if(f.includes("array"))return"array";if(f.includes("matrix"))return"matrix";if(f.includes("timeseries")||f.includes("time"))return"timeseries"}if(a.conditions){const f=We(a.conditions);if(["latitude","longitude","altitude","lat","lng","coord","location"].includes(f))return"geospatial";if(["x","y","z","magnitude","direction","velocity","acceleration"].includes(f))return"vector";if(["r","g","b","hue","saturation","lightness","alpha","rgb","hsl"].includes(f))return"visual";if(["rows","cols","dimensions","matrix"].includes(f))return"matrix";if(["size","length","array"].includes(f))return"array";if(["duration","data_points","timestamps","series","trend"].includes(f))return"timeseries"}return"geospatial"},ct=a=>({geospatial:"GPSä½ç½®æ•°æ®",vector:"å‘é‡æ•°æ®",visual:"é¢œè‰²æ•°æ®",array:"æ•°ç»„æ•°æ®",matrix:"çŸ©é˜µæ•°æ®",timeseries:"æ—¶é—´åºåˆ—æ•°æ®"})[a]||"å¤åˆæ•°æ®",_t=a=>({geospatial:e.jsx(zt,{}),vector:e.jsx(ut,{}),visual:e.jsx(Ie,{}),array:e.jsx(de,{}),matrix:e.jsx(be,{}),timeseries:e.jsx(jt,{})})[a]||e.jsx(ut,{}),wt=a=>({geospatial:"#52c41a",vector:"#1890ff",visual:"#fa541c",array:"#722ed1",matrix:"#eb2f96",timeseries:"#13c2c2"})[a]||"#722ed1",St=a=>{if(Ue(a)){q(a),L(!0);let d=ot(a),f=ct(d),K=a.tags?.data_type||`${d}_data`;const we={type:"complex",category:d,key:K,name:f,icon:_t(d),description:`æ£€æµ‹åˆ°çš„${f}è§„åˆ™`,examples:[],color:wt(d)};switch(H(we),console.log(`ä¸ºè§„åˆ™ [${a.name}] é€‰æ‹©ç¼–è¾‘å™¨ï¼Œæ•°æ®ç±»åˆ«:`,d),d){case"geospatial":console.log("ä½¿ç”¨åœ°ç†æ•°æ®ä¸“é—¨ç¼–è¾‘å™¨"),U(!0);break;case"vector":console.log("ä½¿ç”¨3Då‘é‡ä¸“é—¨ç¼–è¾‘å™¨"),te(!0);break;case"vector_generic":console.log("ä½¿ç”¨é€šç”¨å‘é‡ä¸“é—¨ç¼–è¾‘å™¨"),o(!0);break;case"visual":console.log("ä½¿ç”¨é¢œè‰²æ•°æ®ä¸“é—¨ç¼–è¾‘å™¨"),z(!0);break;case"array":case"matrix":case"timeseries":case"mixed":console.log("ä½¿ç”¨å¤åˆæ•°æ®é€šç”¨ç¼–è¾‘å™¨"),A(!0);break;default:console.log("ä½¿ç”¨å¤åˆæ•°æ®é€šç”¨ç¼–è¾‘å™¨ï¼ˆé»˜è®¤ï¼‰"),A(!0);break}}else nt(a)},Ct=a=>a>=150?"red":a>=100?"orange":a>=50?"blue":"green",Tt=a=>{const d={alert:"red",transform:"blue",filter:"purple",aggregate:"cyan",forward:"green"};return e.jsx(g,{color:d[a]||"default",children:a})},la=a=>{const{type:d,config:f}=a;switch(d){case"aggregate":return`çª—å£å¤§å°: ${f.size||f.window_size||"N/A"} ä¸ªæ•°æ®ç‚¹
èšåˆå‡½æ•°: ${Array.isArray(f.functions)?f.functions.join(", "):"N/A"}
åˆ†ç»„å­—æ®µ: ${Array.isArray(f.group_by)?f.group_by.join(", "):"N/A"}
è¾“å‡ºå­—æ®µ: ${f.output_key||"N/A"}
è½¬å‘ç»“æœ: ${f.forward?"æ˜¯":"å¦"}`;case"transform":const K=f.transforms&&f.transforms[0];return`ç›®æ ‡å­—æ®µ: ${f.field||"N/A"}
ç¼©æ”¾å› å­: ${f.scale_factor||K?.scale_factor||"N/A"}
åç§»é‡: ${f.offset||K?.offset||"N/A"}
ç²¾åº¦: ${f.precision||K?.precision||"N/A"}
è½¬æ¢ç±»å‹: ${K?.type||"N/A"}
æ·»åŠ æ ‡ç­¾: ${f.add_tags?JSON.stringify(f.add_tags):"N/A"}`;case"alert":return`å‘Šè­¦çº§åˆ«: ${f.level||"N/A"}
å‘Šè­¦æ¶ˆæ¯: ${f.message||"N/A"}
é™æµæ—¶é—´: ${f.throttle||"N/A"}
é€šçŸ¥æ¸ é“: ${Array.isArray(f.channels)?f.channels.join(", "):"N/A"}`;case"filter":return`è¿‡æ»¤ç±»å‹: ${f.type||"N/A"}
æœ€å°å€¼: ${f.min!==void 0?f.min:"N/A"}
æœ€å¤§å€¼: ${f.max!==void 0?f.max:"N/A"}
åŒ¹é…åŠ¨ä½œ: ${f.drop_on_match?"ä¸¢å¼ƒ":"é€šè¿‡"}
é€Ÿç‡é™åˆ¶: ${f.rate||"N/A"}
æ—¶é—´çª—å£: ${f.window||"N/A"}`;case"forward":return`è½¬å‘ç›®æ ‡: ${f.target_type||"N/A"}
URLåœ°å€: ${f.url||"N/A"}
HTTPæ–¹æ³•: ${f.method||"N/A"}
MQTTä»£ç†: ${f.broker||"N/A"}
ä¸»é¢˜æ¨¡æ¿: ${f.topic||"N/A"}
æ–‡ä»¶è·¯å¾„: ${f.path||"N/A"}
æ‰¹å¤„ç†å¤§å°: ${f.batch_size||"N/A"}
è¶…æ—¶æ—¶é—´: ${f.timeout||"N/A"}`;default:return JSON.stringify(f,null,2)}},sa=[{title:"è§„åˆ™åç§°",dataIndex:"name",key:"name",sorter:(a,d)=>a.name.localeCompare(d.name),render:(a,d)=>{const f=Ue(d),K=f?ot(d):null;return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:a}),f&&e.jsx(g,{size:"small",color:wt(K),icon:_t(K),style:{marginLeft:8},children:ct(K)})]}),e.jsx(yt,{type:"secondary",style:{fontSize:12},children:d.description})]})}},{title:"ä¼˜å…ˆçº§",dataIndex:"priority",key:"priority",width:100,render:a=>e.jsx(g,{color:Ct(a),children:a}),sorter:(a,d)=>a.priority!==d.priority?d.priority-a.priority:a.name.localeCompare(d.name),defaultSortOrder:"ascend"},{title:"çŠ¶æ€",dataIndex:"enabled",key:"enabled",width:100,render:(a,d)=>e.jsx(he,{checked:a,onChange:()=>Pt(d),checkedChildren:"å¯ç”¨",unCheckedChildren:"ç¦ç”¨"}),filters:[{text:"å·²å¯ç”¨",value:!0},{text:"å·²ç¦ç”¨",value:!1}]},{title:"åŠ¨ä½œç±»å‹",dataIndex:"actions",key:"actions",width:150,render:a=>e.jsx(p,{wrap:!0,children:a&&a.length>0?e.jsxs(e.Fragment,{children:[a.slice(0,2).map((d,f)=>e.jsx(oe,{title:la(d),overlayStyle:{maxWidth:"400px"},children:Tt(d.type)},f)),a.length>2&&e.jsxs(g,{children:["+",a.length-2]})]}):e.jsx(g,{color:"default",children:"æ— åŠ¨ä½œ"})})},{title:"æ›´æ–°æ—¶é—´",dataIndex:"updated_at",key:"updated_at",width:180,render:a=>new Date(a).toLocaleString()},{title:"æ“ä½œ",key:"actions",width:200,render:(a,d)=>e.jsxs(p,{children:[e.jsx(oe,{title:"æŸ¥çœ‹è¯¦æƒ…",children:e.jsx(E,{type:"link",icon:e.jsx(Ie,{}),onClick:()=>Gt(d)})}),e.jsx(oe,{title:Ue(d)?`ç¼–è¾‘å¤åˆè§„åˆ™ (${ct(ot(d))})`:"ç¼–è¾‘è§„åˆ™",children:e.jsx(E,{type:"link",icon:e.jsx(Ve,{}),onClick:()=>St(d)})}),e.jsx(oe,{title:"å¤åˆ¶",children:e.jsx(E,{type:"link",icon:e.jsx(va,{}),onClick:()=>ea(d)})}),e.jsx(ja,{title:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè§„åˆ™å—ï¼Ÿ",description:"åˆ é™¤åæ— æ³•æ¢å¤",onConfirm:()=>Lt(d),okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",children:e.jsx(oe,{title:"åˆ é™¤",children:e.jsx(E,{type:"link",danger:!0,icon:e.jsx(Ee,{})})})})]})}],ia=(a,d)=>{J(f=>({...f,current:a.current||1,pageSize:a.pageSize||10})),d.enabled!==void 0&&S(d.enabled?.[0])};return b.useEffect(()=>{Oe()},[G.current,G.pageSize,C,m]),e.jsxs("div",{children:[e.jsx(mt,{level:2,children:"è§„åˆ™ç®¡ç†"}),e.jsx(I,{style:{marginBottom:16},children:e.jsxs(Z,{gutter:16,align:"middle",children:[e.jsx(R,{flex:"auto",children:e.jsxs(p,{children:[e.jsx(Ea,{placeholder:"æœç´¢è§„åˆ™åç§°æˆ–æè¿°",allowClear:!0,style:{width:300},onSearch:V,onClear:()=>V("")}),e.jsxs(O,{placeholder:"çŠ¶æ€ç­›é€‰",allowClear:!0,style:{width:120},value:m,onChange:S,children:[e.jsx(At,{value:!0,children:"å·²å¯ç”¨"}),e.jsx(At,{value:!1,children:"å·²ç¦ç”¨"})]})]})}),e.jsx(R,{children:e.jsxs(p,{children:[e.jsx(E,{icon:e.jsx(Ce,{}),onClick:()=>l(!0),children:"å¸®åŠ©æ–‡æ¡£"}),e.jsx(E,{icon:e.jsx(jt,{}),children:"è§„åˆ™æµ‹è¯•"}),e.jsx(E,{icon:e.jsx(be,{}),onClick:()=>n(!0),children:"æ¨¡æ¿åº“"}),e.jsx(E,{type:"primary",icon:e.jsx($e,{}),onClick:Yt,children:"åˆ›å»ºè§„åˆ™"})]})})]})}),e.jsx(I,{children:e.jsx(Vt,{columns:sa,dataSource:h,rowKey:"id",loading:M,pagination:{current:G.current,pageSize:G.pageSize,total:G.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(a,d)=>`ç¬¬ ${d[0]}-${d[1]} æ¡ï¼Œå…± ${a} æ¡`},onChange:ia})}),e.jsx($t,{title:"è§„åˆ™è¯¦æƒ…",width:800,open:D,onClose:()=>_(!1),children:k&&e.jsx(ke,{defaultActiveKey:"1",items:[{key:"1",label:"åŸºæœ¬ä¿¡æ¯",children:e.jsxs(je,{title:"åŸºæœ¬ä¿¡æ¯",bordered:!0,children:[e.jsx(je.Item,{label:"è§„åˆ™åç§°",children:k.name}),e.jsx(je.Item,{label:"æè¿°",span:2,children:k.description}),e.jsx(je.Item,{label:"çŠ¶æ€",children:k.enabled?e.jsx(g,{color:"green",icon:e.jsx(me,{}),children:"å·²å¯ç”¨"}):e.jsx(g,{color:"red",icon:e.jsx(ya,{}),children:"å·²ç¦ç”¨"})}),e.jsx(je.Item,{label:"ä¼˜å…ˆçº§",children:e.jsx(g,{color:Ct(k.priority),children:k.priority})}),e.jsxs(je.Item,{label:"ç‰ˆæœ¬",children:["v",k.version]}),e.jsx(je.Item,{label:"åˆ›å»ºæ—¶é—´",children:new Date(k.created_at).toLocaleString()}),e.jsx(je.Item,{label:"æ›´æ–°æ—¶é—´",children:new Date(k.updated_at).toLocaleString()}),e.jsx(je.Item,{label:"æ ‡ç­¾",span:2,children:k.tags&&Object.entries(k.tags).map(([a,d])=>e.jsxs(g,{children:[a,": ",d]},a))})]})},{key:"2",label:"æ¡ä»¶é…ç½®",children:e.jsxs("div",{children:[e.jsx(mt,{level:4,children:"è§¦å‘æ¡ä»¶"}),e.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4},children:JSON.stringify(k.conditions,null,2)})]})},{key:"3",label:"åŠ¨ä½œé…ç½®",children:e.jsxs("div",{children:[e.jsx(mt,{level:4,children:"æ‰§è¡ŒåŠ¨ä½œ"}),k.actions&&k.actions.length>0?k.actions.map((a,d)=>e.jsxs(I,{size:"small",style:{marginBottom:8},children:[e.jsxs(p,{children:[Tt(a.type),e.jsxs(yt,{strong:!0,children:["åŠ¨ä½œ ",d+1]})]}),e.jsx("pre",{style:{background:"#f5f5f5",padding:8,marginTop:8,borderRadius:4},children:JSON.stringify(a.config,null,2)})]},d)):e.jsx(yt,{type:"secondary",children:"è¯¥è§„åˆ™æš‚æ— é…ç½®åŠ¨ä½œ"})]})}]})}),e.jsx(Te,{title:e.jsxs(p,{children:[$?"ç¼–è¾‘è§„åˆ™":"åˆ›å»ºè§„åˆ™",e.jsx(E,{type:"link",icon:e.jsx(zt,{}),onClick:()=>l(!0),size:"small",children:"å¸®åŠ©"})]}),open:X,onOk:Qt,onCancel:()=>N(!1),width:1200,okText:"ä¿å­˜",cancelText:"å–æ¶ˆ",styles:{body:{maxHeight:"70vh",overflowY:"auto"}},children:e.jsxs(Z,{gutter:16,children:[e.jsxs(R,{span:F==="visual"?24:14,children:[e.jsx(I,{size:"small",style:{marginBottom:16},children:e.jsxs(Z,{justify:"space-between",align:"middle",children:[e.jsx(R,{children:e.jsx(ga,{value:F,onChange:Wt,options:[{label:e.jsxs(p,{children:[e.jsx(ut,{}),"å¯è§†åŒ–ç¼–è¾‘"]}),value:"visual"},{label:e.jsxs(p,{children:[e.jsx(de,{}),"JSONç¼–è¾‘"]}),value:"json"}]})}),e.jsx(R,{children:ft.length>0&&e.jsx(P,{message:"é…ç½®é”™è¯¯",description:ft.join(", "),type:"error",showIcon:!0})})]})}),e.jsxs(u,{form:s,layout:"vertical",onValuesChange:Zt,children:[e.jsxs(I,{title:"åŸºæœ¬ä¿¡æ¯",size:"small",style:{marginBottom:16},children:[e.jsxs(Z,{gutter:16,children:[e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"è§„åˆ™åç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥è§„åˆ™åç§°"}],children:e.jsx(B,{placeholder:"è¾“å…¥è§„åˆ™åç§°"})})}),e.jsx(R,{span:12,children:e.jsx(u.Item,{label:"ä¼˜å…ˆçº§",name:"priority",rules:[{required:!0,message:"è¯·è¾“å…¥ä¼˜å…ˆçº§"}],children:e.jsx(W,{placeholder:"æ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜",style:{width:"100%"},min:1,max:999})})})]}),e.jsx(u.Item,{label:"æè¿°",name:"description",rules:[{required:!0,message:"è¯·è¾“å…¥è§„åˆ™æè¿°"}],children:e.jsx(gt,{rows:2,placeholder:"è¾“å…¥è§„åˆ™æè¿°"})}),e.jsx(u.Item,{label:"å¯ç”¨çŠ¶æ€",name:"enabled",valuePropName:"checked",children:e.jsx(he,{checkedChildren:"å¯ç”¨",unCheckedChildren:"ç¦ç”¨"})})]}),F==="visual"?e.jsxs(e.Fragment,{children:[e.jsx(ba,{value:Ye,onChange:Kt}),e.jsx("div",{style:{marginBottom:16}}),e.jsx(wa,{value:Xe,onChange:Ut})]}):e.jsx(e.Fragment,{children:e.jsxs(I,{title:"JSONé…ç½®",size:"small",children:[e.jsx(u.Item,{label:"è§¦å‘æ¡ä»¶ (JSON æ ¼å¼)",name:"conditions",rules:[{required:!0,message:"è¯·è¾“å…¥è§¦å‘æ¡ä»¶"},{validator:(a,d)=>{try{return JSON.parse(d),Promise.resolve()}catch{return Promise.reject(new Error("JSON æ ¼å¼é”™è¯¯"))}}}],children:e.jsx(gt,{rows:8,placeholder:'{"type": "simple", "field": "key", "operator": "eq", "value": "temperature"}',style:{fontFamily:"monospace"}})}),e.jsx(u.Item,{label:"æ‰§è¡ŒåŠ¨ä½œ (JSON æ ¼å¼)",name:"actions",rules:[{required:!0,message:"è¯·è¾“å…¥æ‰§è¡ŒåŠ¨ä½œ"},{validator:(a,d)=>{try{return JSON.parse(d),Promise.resolve()}catch{return Promise.reject(new Error("JSON æ ¼å¼é”™è¯¯"))}}}],children:e.jsx(gt,{rows:8,placeholder:'[{"type": "alert", "config": {"level": "warning", "message": "å‘Šè­¦ä¿¡æ¯"}}]',style:{fontFamily:"monospace"}})})]})})]})]}),F==="json"&&e.jsx(R,{span:10,children:e.jsx(I,{title:"å®æ—¶é¢„è§ˆ",size:"small",style:{position:"sticky",top:0},children:e.jsx("pre",{style:{background:"#f5f5f5",padding:12,borderRadius:4,fontSize:12,lineHeight:1.4,maxHeight:"60vh",overflow:"auto"},children:Mt})})})]})}),e.jsx(fa,{visible:t,onClose:()=>l(!1)}),e.jsx(Ta,{visible:r,onClose:()=>n(!1),onSelect:ta}),e.jsx(za,{visible:i,onTypeSelect:Xt,onCancel:()=>x(!1)}),e.jsx(Aa,{visible:Q,dataType:j,rule:k,onSave:aa,onClose:ra}),e.jsx(Va,{visible:re,rule:k,onSave:Ke,onClose:bt}),e.jsx(Ja,{visible:le,rule:k,mode:$?"edit":"create",onSave:Ke,onClose:()=>te(!1)}),e.jsx(Ba,{visible:ae,rule:k,mode:$?"edit":"create",onSave:Ke,onClose:()=>o(!1)}),e.jsx(Ma,{visible:y,rule:k,onSave:Ke,onClose:bt})]})};export{lr as default};
