import{r as s,k as e}from"./react-vendor-XKB30K_c.js";import{b as t}from"./index-SZKmSCox.js";import{a}from"./antd-form-D97X3GMQ.js";import{R as r,N as n,aj as i,aq as c,am as o,aC as l,B as d,ak as h,ap as j,au as x,av as g,ay as m}from"./antd-vendor-BEPv5fMA.js";import{a6 as y,$ as p,P as u}from"./antd-icons-Cd9MHNVc.js";import"./vendor-CG-KndAb.js";import"./utils-vendor-DHyCJoYc.js";import"./state-vendor-DvJGcyIt.js";import"./antd-date-picker-BA1qR6od.js";import"./antd-select-B9qIJAZm.js";const f={getStatus:async()=>(await t.get("/system/status")).data.data,getMetrics:async()=>(await t.get("/system/metrics")).data.data,getHealth:async()=>(await t.get("/system/health")).data.data,getConfig:async()=>(await t.get("/system/config")).data.data,async updateConfig(s){await t.put("/system/config",s)},validateConfig:async s=>(await t.post("/system/config/validate",s)).data.data,async restart(s){await t.post("/system/restart",{delay:s||0})}},{Title:w}=h,v=()=>{const[t,h]=s.useState(!1),[v,k]=s.useState(null),[C,B]=s.useState(null),[E]=a.useForm(),[T,_]=s.useState("status"),b=async()=>{try{const s=await f.getStatus();k(s)}catch(s){const e=s instanceof Error?s.message:"未知错误";g.error("获取系统状态失败："+e)}},M=async()=>{try{const s=await f.getMetrics();B(s)}catch(s){const e=s instanceof Error?s.message:"未知错误";g.error("获取系统指标失败："+e)}},S=async()=>{try{const s=await f.getHealth();console.log("健康检查数据:",s)}catch(s){const e=s instanceof Error?s.message:"未知错误";g.error("获取健康检查失败："+e)}},$=async()=>{try{const s=await f.getConfig();E.setFieldsValue(s)}catch(s){const e=s instanceof Error?s.message:"未知错误";g.error("获取系统配置失败："+e)}},F=async()=>{h(!0);try{await Promise.all([b(),M(),S(),$()])}finally{h(!1)}},I=s=>{const e=["B","KB","MB","GB","TB"];let t=s,a=0;for(;t>=1024&&a<e.length-1;)t/=1024,a++;return`${t.toFixed(2)} ${e[a]}`};s.useEffect(()=>{F()},[]);const P=[{key:"status",label:"系统状态",children:e.jsx("div",{children:e.jsxs(r,{gutter:[16,16],children:[e.jsx(n,{span:12,children:e.jsx(i,{title:"基本信息",size:"small",children:v&&e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"状态:"})," ",e.jsx(c,{color:(s=>{switch(s.toLowerCase()){case"running":case"healthy":case"connected":return"success";case"warning":case"degraded":return"warning";case"error":case"failed":case"disconnected":return"error";default:return"default"}})(v.status),children:v.status})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"版本:"})," ",v.version]}),e.jsxs("p",{children:[e.jsx("strong",{children:"运行时间:"})," ",(H=v.uptime,`${Math.floor(H/86400)}天 ${Math.floor(H%86400/3600)}小时 ${Math.floor(H%3600/60)}分钟`)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Go版本:"})," ",v.go_version]})]})})}),e.jsx(n,{span:12,children:e.jsx(i,{title:"资源使用",size:"small",children:C&&e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"CPU:"})," ",C.cpu_percent.toFixed(1),"%"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"内存:"})," ",I(C.memory_used)," / ",I(C.memory_total)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"磁盘:"})," ",I(C.disk_used)," / ",I(C.disk_total)]})]})})})]})})},{key:"config",label:"系统配置",children:e.jsx(i,{title:"配置管理",extra:e.jsx(d,{type:"primary",icon:e.jsx(y,{}),onClick:async()=>{try{const s=await E.validateFields();await f.updateConfig(s),g.success("配置保存成功"),await $()}catch(s){const e=s instanceof Error?s.message:"未知错误";g.error("保存配置失败："+e)}},children:"保存配置"}),children:e.jsx(a,{form:E,layout:"vertical",children:e.jsxs(r,{gutter:16,children:[e.jsx(n,{span:12,children:e.jsx(a.Item,{label:"网关ID",name:["gateway","id"],children:e.jsx(o,{})})}),e.jsx(n,{span:12,children:e.jsx(a.Item,{label:"HTTP端口",name:["gateway","http_port"],children:e.jsx(l,{min:1,max:65535})})})]})})})}];var H;return e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{style:{marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(w,{level:2,children:"系统管理"}),e.jsxs(j,{children:[e.jsx(d,{icon:e.jsx(p,{}),onClick:F,loading:t,children:"刷新"}),e.jsx(d,{danger:!0,icon:e.jsx(u,{}),onClick:()=>{m.confirm({title:"确认重启系统",content:"重启系统将会中断所有正在运行的连接和任务，确定要继续吗？",okText:"确认重启",okType:"danger",cancelText:"取消",onOk:async()=>{try{await f.restart(),g.success("系统重启中...")}catch(s){const e=s instanceof Error?s.message:"未知错误";g.error("重启失败："+e)}}})},children:"重启系统"})]})]}),e.jsx(x,{activeKey:T,onChange:_,items:P})]})};export{v as default};
//# sourceMappingURL=SystemPage-D4CTnP3l.js.map
