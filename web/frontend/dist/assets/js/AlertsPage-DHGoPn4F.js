import{r as e,k as l}from"./react-vendor-XKB30K_c.js";import{a}from"./alertService-D3M29e-e.js";import{u as s}from"./useRealTimeData-Cyo8mKv8.js";import{a as r}from"./antd-form-D97X3GMQ.js";import{av as t,aj as n,R as i,N as c,aq as d,am as o,ap as h,B as x,at as j,ak as u,au as m,ay as p,ar as v,T as g,aB as y}from"./antd-vendor-BEPv5fMA.js";import{S as b}from"./antd-select-B9qIJAZm.js";import{$ as w,A as k,N as f,P as C,a7 as S,a5 as I,a0 as A,a2 as z}from"./antd-icons-Cd9MHNVc.js";import{F as q}from"./antd-table-PbtM5e6h.js";import"./vendor-CG-KndAb.js";import"./index-SZKmSCox.js";import"./utils-vendor-DHyCJoYc.js";import"./state-vendor-DvJGcyIt.js";import"./antd-date-picker-BA1qR6od.js";import"./antd-tree-U-o4Fj3K.js";const T=[{value:"info",label:"信息",color:"blue"},{value:"warning",label:"警告",color:"orange"},{value:"error",label:"错误",color:"red"},{value:"critical",label:"严重",color:"purple"}],F=[{value:"active",label:"活跃",color:"red"},{value:"acknowledged",label:"已确认",color:"orange"},{value:"resolved",label:"已解决",color:"green"}],N=[{value:"email",label:"邮件",icon:l.jsx(S,{})},{value:"webhook",label:"Webhook",icon:l.jsx(S,{})},{value:"sms",label:"短信",icon:l.jsx(S,{})},{value:"slack",label:"Slack",icon:l.jsx(S,{})},{value:"dingtalk",label:"钉钉",icon:l.jsx(S,{})}],{Text:O}=u,{Option:L}=b,B=()=>{const[u,B]=e.useState("alerts"),[J,K]=e.useState(!1),[R,$]=e.useState([]),[D,E]=e.useState(0),[V,P]=e.useState({page:1,pageSize:20}),[Q,W]=e.useState([]),[G,H]=e.useState([]),[M,U]=e.useState(!1),[X,Y]=e.useState(!1),[Z,_]=e.useState(!1),[ee]=r.useForm(),[le]=r.useForm(),[ae]=r.useForm(),{data:se}=s({autoConnect:!0,enableSystemEvents:!0});e.useEffect(()=>{"alerts"===u?re():"rules"===u?te():"channels"===u&&ne()},[u,V]),e.useEffect(()=>{se&&"alerts"===u&&re()},[se,u]);const re=async()=>{try{K(!0);const e=await a.getAlerts(V);$(e.alerts),E(e.total)}catch(e){t.error("获取告警列表失败: "+e.message)}finally{K(!1)}},te=async()=>{try{K(!0);const e=await a.getAlertRules();W(e)}catch(e){t.error("获取告警规则失败: "+e.message)}finally{K(!1)}},ne=async()=>{try{K(!0);const e=await a.getNotificationChannels();H(e)}catch(e){t.error("获取通知渠道失败: "+e.message)}finally{K(!1)}},ie=[{title:"标题",dataIndex:"title",key:"title",ellipsis:!0},{title:"级别",dataIndex:"level",key:"level",width:80,render:e=>l.jsx(d,{color:a.getAlertLevelColor(e),children:a.getAlertLevelText(e)})},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>l.jsx(d,{color:a.getAlertStatusColor(e),icon:"active"===e?l.jsx(I,{}):"acknowledged"===e?l.jsx(A,{}):l.jsx(z,{}),children:a.getAlertStatusText(e)})},{title:"来源",dataIndex:"source",key:"source",width:120},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:160,render:e=>new Date(e).toLocaleString()},{title:"操作",key:"actions",width:200,render:(e,s)=>l.jsxs(h,{size:"small",children:["active"===s.status&&l.jsx(g,{title:"确认告警",children:l.jsx(x,{size:"small",icon:l.jsx(A,{}),onClick:()=>(async e=>{try{await a.acknowledgeAlert(e,"手动确认"),t.success("告警确认成功"),re()}catch(l){t.error("确认告警失败: "+l.message)}})(s.id),children:"确认"})}),("active"===s.status||"acknowledged"===s.status)&&l.jsx(g,{title:"解决告警",children:l.jsx(x,{size:"small",type:"primary",icon:l.jsx(z,{}),onClick:()=>(async e=>{try{await a.resolveAlert(e,"手动解决"),t.success("告警解决成功"),re()}catch(l){t.error("解决告警失败: "+l.message)}})(s.id),children:"解决"})}),l.jsx(y,{title:"确定要删除这个告警吗？",onConfirm:()=>(async e=>{try{await a.deleteAlert(e),t.success("告警删除成功"),re()}catch(l){t.error("删除告警失败: "+l.message)}})(s.id),children:l.jsx(x,{size:"small",danger:!0,children:"删除"})})]})}],ce=[{title:"名称",dataIndex:"name",key:"name"},{title:"级别",dataIndex:"level",key:"level",width:80,render:e=>l.jsx(d,{color:a.getAlertLevelColor(e),children:a.getAlertLevelText(e)})},{title:"状态",dataIndex:"enabled",key:"enabled",width:80,render:e=>l.jsx(j,{status:e?"success":"default",text:e?"启用":"禁用"})},{title:"条件",key:"condition",render:(e,a)=>l.jsxs(O,{code:!0,children:[a.condition.field," ",a.condition.operator," ",a.condition.value]})},{title:"通知渠道",dataIndex:"notificationChannels",key:"notificationChannels",render:e=>l.jsxs("span",{children:[e?.length||0," 个渠道"]})},{title:"操作",key:"actions",width:150,render:e=>l.jsxs(h,{size:"small",children:[l.jsx(x,{size:"small",children:"测试"}),l.jsx(x,{size:"small",children:"编辑"}),l.jsx(x,{size:"small",danger:!0,children:"删除"})]})}],de=[{title:"名称",dataIndex:"name",key:"name"},{title:"类型",dataIndex:"type",key:"type",width:100,render:e=>{const a=N.find(l=>l.value===e);return l.jsxs("span",{children:[a?.icon," ",a?.label||e]})}},{title:"状态",dataIndex:"enabled",key:"enabled",width:80,render:e=>l.jsx(j,{status:e?"success":"default",text:e?"启用":"禁用"})},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:160,render:e=>new Date(e).toLocaleString()},{title:"操作",key:"actions",width:150,render:(e,s)=>l.jsxs(h,{size:"small",children:[l.jsx(x,{size:"small",icon:l.jsx(S,{}),onClick:()=>(async e=>{try{await a.testNotificationChannel(e),t.success("测试通知发送成功")}catch(l){t.error("测试通知失败: "+l.message)}})(s.id),children:"测试"}),l.jsx(x,{size:"small",children:"编辑"}),l.jsx(x,{size:"small",danger:!0,children:"删除"})]})}],oe=[{key:"alerts",label:l.jsxs("span",{children:[l.jsx(f,{}),"告警列表",R.filter(e=>"active"===e.status).length>0&&l.jsx(j,{count:R.filter(e=>"active"===e.status).length,style:{marginLeft:8}})]}),children:l.jsxs("div",{children:[l.jsx(n,{size:"small",style:{marginBottom:16},children:l.jsxs(i,{gutter:16,children:[l.jsx(c,{span:4,children:l.jsx(b,{placeholder:"告警级别",allowClear:!0,value:V.level,onChange:e=>P({...V,level:e,page:1}),children:T.map(e=>l.jsx(L,{value:e.value,children:l.jsx(d,{color:e.color,children:e.label})},e.value))})}),l.jsx(c,{span:4,children:l.jsx(b,{placeholder:"告警状态",allowClear:!0,value:V.status,onChange:e=>P({...V,status:e,page:1}),children:F.map(e=>l.jsx(L,{value:e.value,children:l.jsx(d,{color:e.color,children:e.label})},e.value))})}),l.jsx(c,{span:4,children:l.jsx(o,{placeholder:"来源筛选",allowClear:!0,value:V.source,onChange:e=>P({...V,source:e.target.value,page:1})})}),l.jsx(c,{span:6,children:l.jsx(o.Search,{placeholder:"搜索告警",allowClear:!0,value:V.search,onChange:e=>P({...V,search:e.target.value,page:1}),onSearch:()=>re()})}),l.jsx(c,{span:6,children:l.jsxs(h,{children:[l.jsx(x,{icon:l.jsx(w,{}),onClick:re,children:"刷新"}),l.jsx(x,{type:"primary",icon:l.jsx(k,{}),onClick:()=>U(!0),children:"手动创建告警"})]})})]})}),l.jsx(n,{children:l.jsx(q,{columns:ie,dataSource:R,rowKey:"id",loading:J,pagination:{current:V.page,pageSize:V.pageSize,total:D,onChange:(e,l)=>P({...V,page:e,pageSize:l}),showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,l)=>`第 ${l[0]}-${l[1]} 条，共 ${e} 条`}})})]})},{key:"rules",label:l.jsxs("span",{children:[l.jsx(C,{}),"告警规则"]}),children:l.jsxs(n,{children:[l.jsx("div",{style:{marginBottom:16},children:l.jsxs(h,{children:[l.jsx(x,{icon:l.jsx(w,{}),onClick:te,children:"刷新"}),l.jsx(x,{type:"primary",icon:l.jsx(k,{}),onClick:()=>Y(!0),children:"创建规则"})]})}),l.jsx(q,{columns:ce,dataSource:Q,rowKey:"id",loading:J,pagination:{pageSize:10}})]})},{key:"channels",label:l.jsxs("span",{children:[l.jsx(S,{}),"通知渠道"]}),children:l.jsxs(n,{children:[l.jsx("div",{style:{marginBottom:16},children:l.jsxs(h,{children:[l.jsx(x,{icon:l.jsx(w,{}),onClick:ne,children:"刷新"}),l.jsx(x,{type:"primary",icon:l.jsx(k,{}),onClick:()=>_(!0),children:"创建渠道"})]})}),l.jsx(q,{columns:de,dataSource:G,rowKey:"id",loading:J,pagination:{pageSize:10}})]})}];return l.jsxs("div",{children:[l.jsxs("div",{style:{marginBottom:24},children:[l.jsx("h2",{children:"告警管理"}),l.jsx(O,{type:"secondary",children:"管理系统告警、告警规则和通知渠道"})]}),l.jsx(m,{activeKey:u,onChange:B,items:oe}),l.jsx(p,{title:"创建告警",open:M,onOk:async()=>{try{const e=await ee.validateFields(),l={title:e.title,description:e.description,level:e.level,source:e.source||"manual",data:e.data?JSON.parse(e.data):{}};await a.createAlert(l),t.success("告警创建成功"),U(!1),ee.resetFields(),re()}catch(e){t.error("创建告警失败: "+e.message)}},onCancel:()=>U(!1),width:600,children:l.jsxs(r,{form:ee,layout:"vertical",children:[l.jsx(r.Item,{name:"title",label:"告警标题",rules:[{required:!0}],children:l.jsx(o,{placeholder:"请输入告警标题"})}),l.jsx(r.Item,{name:"description",label:"告警描述",rules:[{required:!0}],children:l.jsx(o.TextArea,{rows:3,placeholder:"请输入告警描述"})}),l.jsxs(i,{gutter:16,children:[l.jsx(c,{span:12,children:l.jsx(r.Item,{name:"level",label:"告警级别",rules:[{required:!0}],children:l.jsx(b,{placeholder:"选择告警级别",children:T.map(e=>l.jsx(L,{value:e.value,children:l.jsx(d,{color:e.color,children:e.label})},e.value))})})}),l.jsx(c,{span:12,children:l.jsx(r.Item,{name:"source",label:"告警来源",children:l.jsx(o,{placeholder:"请输入告警来源"})})})]}),l.jsx(r.Item,{name:"data",label:"附加数据",children:l.jsx(o.TextArea,{rows:3,placeholder:"请输入JSON格式的附加数据（可选）"})})]})}),l.jsx(p,{title:"创建告警规则",open:X,onOk:async()=>{try{const e=await le.validateFields(),l={name:e.name,description:e.description,enabled:e.enabled,level:e.level,condition:{type:e.conditionType,field:e.field,operator:e.operator,value:e.value},notificationChannels:e.notificationChannels||[]};await a.createAlertRule(l),t.success("告警规则创建成功"),Y(!1),le.resetFields(),te()}catch(e){t.error("创建告警规则失败: "+e.message)}},onCancel:()=>Y(!1),width:700,children:l.jsxs(r,{form:le,layout:"vertical",children:[l.jsx(r.Item,{name:"name",label:"规则名称",rules:[{required:!0}],children:l.jsx(o,{placeholder:"请输入规则名称"})}),l.jsx(r.Item,{name:"description",label:"规则描述",children:l.jsx(o.TextArea,{rows:2,placeholder:"请输入规则描述"})}),l.jsxs(i,{gutter:16,children:[l.jsx(c,{span:12,children:l.jsx(r.Item,{name:"level",label:"告警级别",rules:[{required:!0}],children:l.jsx(b,{placeholder:"选择告警级别",children:T.map(e=>l.jsx(L,{value:e.value,children:l.jsx(d,{color:e.color,children:e.label})},e.value))})})}),l.jsx(c,{span:12,children:l.jsx(r.Item,{name:"enabled",label:"启用状态",initialValue:!0,children:l.jsxs(b,{children:[l.jsx(L,{value:!0,children:"启用"}),l.jsx(L,{value:!1,children:"禁用"})]})})})]}),l.jsx(v,{children:"告警条件"}),l.jsxs(i,{gutter:16,children:[l.jsx(c,{span:8,children:l.jsx(r.Item,{name:"field",label:"字段名",rules:[{required:!0}],children:l.jsx(o,{placeholder:"如: temperature"})})}),l.jsx(c,{span:8,children:l.jsx(r.Item,{name:"operator",label:"操作符",rules:[{required:!0}],children:l.jsxs(b,{placeholder:"选择操作符",children:[l.jsx(L,{value:"gt",children:"大于 (>)"}),l.jsx(L,{value:"lt",children:"小于 (<)"}),l.jsx(L,{value:"eq",children:"等于 (=)"}),l.jsx(L,{value:"gte",children:"大于等于 (≥)"}),l.jsx(L,{value:"lte",children:"小于等于 (≤)"})]})})}),l.jsx(c,{span:8,children:l.jsx(r.Item,{name:"value",label:"阈值",rules:[{required:!0}],children:l.jsx(o,{placeholder:"如: 80"})})})]}),l.jsx(r.Item,{name:"notificationChannels",label:"通知渠道",children:l.jsx(b,{mode:"multiple",placeholder:"选择通知渠道（可选）",children:G.map(e=>l.jsx(L,{value:e.id,children:e.name},e.id))})})]})}),l.jsx(p,{title:"创建通知渠道",open:Z,onOk:async()=>{try{const e=await ae.validateFields(),l={name:e.name,type:e.type,enabled:e.enabled,config:e.config?JSON.parse(e.config):{}};await a.createNotificationChannel(l),t.success("通知渠道创建成功"),_(!1),ae.resetFields(),ne()}catch(e){t.error("创建通知渠道失败: "+e.message)}},onCancel:()=>_(!1),width:600,children:l.jsxs(r,{form:ae,layout:"vertical",children:[l.jsx(r.Item,{name:"name",label:"渠道名称",rules:[{required:!0}],children:l.jsx(o,{placeholder:"请输入渠道名称"})}),l.jsxs(i,{gutter:16,children:[l.jsx(c,{span:12,children:l.jsx(r.Item,{name:"type",label:"渠道类型",rules:[{required:!0}],children:l.jsx(b,{placeholder:"选择渠道类型",children:N.map(e=>l.jsxs(L,{value:e.value,children:[e.icon," ",e.label]},e.value))})})}),l.jsx(c,{span:12,children:l.jsx(r.Item,{name:"enabled",label:"启用状态",initialValue:!0,children:l.jsxs(b,{children:[l.jsx(L,{value:!0,children:"启用"}),l.jsx(L,{value:!1,children:"禁用"})]})})})]}),l.jsx(r.Item,{name:"config",label:"渠道配置",rules:[{required:!0}],children:l.jsx(o.TextArea,{rows:6,placeholder:'请输入JSON格式的渠道配置，例如：\n{\n  "url": "https://hooks.slack.com/...",\n  "channel": "#alerts"\n}'})})]})})]})};export{B as AlertsPage};
//# sourceMappingURL=AlertsPage-DHGoPn4F.js.map
