import{r as e,o as s,R as t,k as o}from"./react-vendor-XKB30K_c.js";import{u as r,a}from"./index-SZKmSCox.js";import{aj as n,ak as l,al as i,am as m,B as c}from"./antd-vendor-BEPv5fMA.js";import{a as d}from"./antd-form-D97X3GMQ.js";import{S as p,T as u}from"./antd-icons-Cd9MHNVc.js";import"./vendor-CG-KndAb.js";import"./utils-vendor-DHyCJoYc.js";import"./state-vendor-DvJGcyIt.js";import"./antd-date-picker-BA1qR6od.js";import"./antd-select-B9qIJAZm.js";const{Title:j}=l,g=()=>{const[l,g]=e.useState(!1),[h,x]=e.useState(null),[f,y]=e.useState(null),v=s(),{setTokens:w,setUser:k,isAuthenticated:I}=r();return t.useEffect(()=>{I&&(console.log("用户已认证，跳转到首页"),v("/",{replace:!0}))},[I,v]),o.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"#f0f2f5"},children:o.jsxs(n,{style:{width:400},children:[o.jsx("div",{style:{textAlign:"center",marginBottom:"24px"},children:o.jsx(j,{level:2,children:"IoT Gateway 登录"})}),h&&o.jsx(i,{message:h,type:"error",showIcon:!0,style:{marginBottom:24}}),f&&o.jsx(i,{message:f,type:"success",showIcon:!0,style:{marginBottom:24}}),o.jsxs(d,{name:"login",initialValues:{username:"admin",password:"admin123"},onFinish:async e=>{console.log("开始登录，用户名:",e.username),g(!0),x(null),y(null);try{console.log("发送登录请求...");const s=await a.login(e);console.log("登录请求成功，收到数据:",s),w(s.token,s.refresh_token),k(s.user),console.log("设置token和用户信息完成"),console.log("当前认证状态:",r.getState().isAuthenticated),y("登录成功！正在跳转..."),setTimeout(()=>{console.log("准备跳转到首页..."),v("/",{replace:!0})},1e3)}catch(s){console.error("登录失败:",s),console.error("错误详情:",s.response?.data),x(s.response?.data?.message||s.message||"登录失败，请检查您的用户名和密码。")}finally{g(!1)}},children:[o.jsx(d.Item,{name:"username",rules:[{required:!0,message:"请输入用户名!"}],children:o.jsx(m,{prefix:o.jsx(p,{}),placeholder:"用户名"})}),o.jsx(d.Item,{name:"password",rules:[{required:!0,message:"请输入密码!"}],children:o.jsx(m.Password,{prefix:o.jsx(u,{}),placeholder:"密码"})}),o.jsx(d.Item,{children:o.jsx(c,{type:"primary",htmlType:"submit",loading:l,style:{width:"100%"},children:"登录"})})]})]})})};export{g as default};
//# sourceMappingURL=Login-BORNirjJ.js.map
