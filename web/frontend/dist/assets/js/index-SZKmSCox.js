const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/Login-BORNirjJ.js","assets/js/react-vendor-XKB30K_c.js","assets/js/vendor-CG-KndAb.js","assets/js/antd-vendor-BEPv5fMA.js","assets/js/antd-date-picker-BA1qR6od.js","assets/js/utils-vendor-DHyCJoYc.js","assets/js/antd-icons-Cd9MHNVc.js","assets/js/antd-form-D97X3GMQ.js","assets/js/antd-select-B9qIJAZm.js","assets/js/state-vendor-DvJGcyIt.js","assets/js/Dashboard-C6AofQgs.js","assets/js/pluginService-DOYhogIr.js","assets/js/alertService-D3M29e-e.js","assets/js/echarts-vendor-D7t-5Co9.js","assets/js/echarts-core-DHH3aYep.js","assets/js/echarts-charts-BwTN3nNH.js","assets/js/echarts-components-qRndAGwt.js","assets/js/useRealTimeData-Cyo8mKv8.js","assets/js/antd-table-PbtM5e6h.js","assets/js/antd-tree-U-o4Fj3K.js","assets/js/PluginsPage-BhXx9UDQ.js","assets/js/RulesPage-Dh3wZUoq.js","assets/js/SystemPage-D4CTnP3l.js","assets/js/AlertsPage-DHGoPn4F.js","assets/js/MonitoringPage-pT9ry3lq.js"])))=>i.map(i=>d[i]);
import{k as e,N as t,O as s,r,u as n,L as a,R as o,B as l,l as i,m as c,n as d}from"./react-vendor-XKB30K_c.js";import{be as u,bf as h}from"./vendor-CG-KndAb.js";import{d as m}from"./utils-vendor-DHyCJoYc.js";import{c as p,p as f,a as j}from"./state-vendor-DvJGcyIt.js";import{ag as g,a5 as x,ah as y,ai as k,ab as b}from"./antd-vendor-BEPv5fMA.js";import{K as _,L as P,M as T,N as E,O as S,P as v,Q as A}from"./antd-icons-Cd9MHNVc.js";import"./antd-date-picker-BA1qR6od.js";import"./antd-form-D97X3GMQ.js";import"./antd-select-B9qIJAZm.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const w={},z=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),n=s?.nonce||s?.getAttribute("nonce");r=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in w)return;w[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,n&&r.setAttribute("nonce",n),document.head.appendChild(r),t?new Promise((t,s)=>{r.addEventListener("load",t),r.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})},L=p()(f((e,t)=>({accessToken:null,refreshToken:null,user:null,isAuthenticated:!1,setTokens:(t,s)=>{e({accessToken:t,refreshToken:s,isAuthenticated:!!t})},setUser:t=>e({user:t}),logout:()=>{e({accessToken:null,refreshToken:null,user:null,isAuthenticated:!1})},initialize:()=>{const{accessToken:s,refreshToken:r}=t();e(s&&r?{isAuthenticated:!0}:{isAuthenticated:!1})}}),{name:"auth-storage",storage:j(()=>localStorage)})),O=({children:r})=>{const{isAuthenticated:n}=L();return n?r||e.jsx(s,{}):e.jsx(t,{to:"/login",replace:!0})},R=u.create({baseURL:"/api/v1",headers:{"Content-Type":"application/json"}});R.interceptors.request.use(e=>{const{accessToken:t}=L.getState();return console.log("发送API请求:",e.url),console.log("当前accessToken:",t?`${t.substring(0,20)}...`:"null"),t?(e.headers.Authorization=`Bearer ${t}`,console.log("已添加Authorization header")):console.log("没有accessToken，未添加Authorization header"),e},e=>Promise.reject(e));let I=!1,N=[];const C=(e,t=null)=>{N.forEach(s=>{e?s.reject(e):s.resolve(t)}),N=[]};R.interceptors.response.use(e=>e,async e=>{const t=e.config;if(!t)return Promise.reject(e);if(401===e.response?.status&&!t._retry){if(I)return new Promise(function(e,t){N.push({resolve:e,reject:t})}).then(e=>(t.headers.Authorization="Bearer "+e,u(t))).catch(e=>Promise.reject(e));t._retry=!0,I=!0;const{refreshToken:r,logout:n,setTokens:a}=L.getState();if(!r)return n(),I=!1,Promise.reject(e);try{const{data:e}=await u.post("/api/v1/auth/refresh",{refreshToken:r}),{accessToken:s,refreshToken:n}=e;return a(s,n),R.defaults.headers.common&&(R.defaults.headers.common.Authorization="Bearer "+s),t.headers.Authorization="Bearer "+s,C(null,s),R(t)}catch(s){const e=s instanceof Error?s:new Error(String(s));return C(e,null),n(),Promise.reject(s)}finally{I=!1}}return Promise.reject(e)});const D={async login(e){const{setTokens:t,setUser:s}=L.getState(),r=await R.post("/auth/login",e),{token:n,refresh_token:a,user:o}=r.data.data;return t(n,a),s(o),r.data.data},async logout(){const{logout:e}=L.getState();try{await R.post("/auth/logout")}catch(t){console.error("Logout failed:",t)}finally{e()}},async getProfile(){const{setUser:e}=L.getState(),t=await R.get("/auth/profile");return e(t.data.data||t.data),t.data.data||t.data},async updateProfile(e){const{setUser:t}=L.getState(),s=await R.put("/auth/profile",e);return t(s.data.data||s.data),s.data.data||s.data},changePassword:async e=>await R.put("/auth/password",e),async refreshToken(){const{refreshToken:e,setTokens:t}=L.getState();if(!e)throw new Error("No refresh token available.");const s=await R.post("/auth/refresh",{refreshToken:e}),{token:r,refresh_token:n}=s.data.data||s.data;return t(r,n),r}},{Header:B,Content:V,Sider:W}=g,U=()=>{const[t,o]=r.useState(!1),l=n(),i=[{key:"1",icon:e.jsx(_,{}),label:e.jsx(a,{to:"/",children:"仪表盘"})},{key:"2",icon:e.jsx(P,{}),label:e.jsx(a,{to:"/plugins",children:"插件管理"})},{key:"3",icon:e.jsx(T,{}),label:e.jsx(a,{to:"/rules",children:"规则管理"})},{key:"4",icon:e.jsx(E,{}),label:e.jsx(a,{to:"/alerts",children:"告警管理"})},{key:"5",icon:e.jsx(S,{}),label:e.jsx(a,{to:"/monitoring",children:"连接监控"})},{key:"6",icon:e.jsx(v,{}),label:e.jsx(a,{to:"/system",children:"系统设置"})}],c=[{key:"logout",icon:e.jsx(A,{}),label:"退出登录",onClick:()=>{D.logout()}}];return e.jsxs(g,{style:{minHeight:"100vh"},children:[e.jsxs(W,{collapsible:!0,collapsed:t,onCollapse:o,width:256,children:[e.jsx("div",{className:"logo",style:{height:"32px",margin:"16px",background:"rgba(255, 255, 255, 0.2)",borderRadius:"4px"}}),e.jsx(x,{theme:"dark",selectedKeys:(()=>{const e=l.pathname;return"/"===e||e.startsWith("/dashboard")?["1"]:e.startsWith("/plugins")?["2"]:e.startsWith("/rules")?["3"]:e.startsWith("/alerts")?["4"]:e.startsWith("/monitoring")?["5"]:e.startsWith("/system")?["6"]:["1"]})(),mode:"inline",items:i})]}),e.jsxs(g,{className:"site-layout",children:[e.jsx(B,{className:"site-layout-background",style:{padding:"0 16px",background:"#fff",display:"flex",justifyContent:"flex-end",alignItems:"center",boxShadow:"0 1px 4px rgba(0,21,41,0.08)"},children:e.jsx(x,{mode:"horizontal",selectable:!1,items:c,style:{border:"none"}})}),e.jsx(V,{style:{margin:"16px"},children:e.jsx("div",{className:"site-layout-background",style:{padding:24,minHeight:360,background:"#fff",borderRadius:"6px",boxShadow:"0 1px 2px rgba(0,21,41,0.08)"},children:e.jsx(s,{})})})]})]})},$=o.lazy(()=>z(()=>import("./Login-BORNirjJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),q=o.lazy(()=>z(()=>import("./Dashboard-C6AofQgs.js"),__vite__mapDeps([10,1,2,11,12,13,14,15,16,3,4,5,6,7,8,17,18,19,9]))),M=o.lazy(()=>z(()=>import("./PluginsPage-BhXx9UDQ.js"),__vite__mapDeps([20,1,2,11,5,3,4,6,7,8,18,19,9]))),H=o.lazy(()=>z(()=>import("./RulesPage-Dh3wZUoq.js"),__vite__mapDeps([21,1,2,7,3,4,5,6,8,18,19,9]))),K=o.lazy(()=>z(()=>import("./SystemPage-D4CTnP3l.js"),__vite__mapDeps([22,1,2,7,3,4,5,6,8,9]))),Q=o.lazy(()=>z(()=>import("./AlertsPage-DHGoPn4F.js"),__vite__mapDeps([23,1,2,12,17,7,3,4,5,6,8,18,19,9])).then(e=>({default:e.AlertsPage}))),F=o.lazy(()=>z(()=>import("./MonitoringPage-pT9ry3lq.js"),__vite__mapDeps([24,1,2,17,13,14,15,16,3,4,5,6,7,8,18,19,9]))),G=()=>e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px"},children:e.jsx(b,{size:"large",tip:"页面加载中..."})});function J(){const{initialize:t}=L();return r.useEffect(()=>{t()},[t]),e.jsx(y,{locale:h,theme:{algorithm:k.defaultAlgorithm},children:e.jsx(l,{children:e.jsx(r.Suspense,{fallback:e.jsx(G,{}),children:e.jsxs(i,{children:[e.jsx(c,{path:"/login",element:e.jsx($,{})}),e.jsxs(c,{path:"/*",element:e.jsx(O,{children:e.jsx(U,{})}),children:[e.jsx(c,{index:!0,element:e.jsx(r.Suspense,{fallback:e.jsx(G,{}),children:e.jsx(q,{})})}),e.jsx(c,{path:"plugins",element:e.jsx(r.Suspense,{fallback:e.jsx(G,{}),children:e.jsx(M,{})})}),e.jsx(c,{path:"rules",element:e.jsx(r.Suspense,{fallback:e.jsx(G,{}),children:e.jsx(H,{})})}),e.jsx(c,{path:"alerts",element:e.jsx(r.Suspense,{fallback:e.jsx(G,{}),children:e.jsx(Q,{})})}),e.jsx(c,{path:"monitoring",element:e.jsx(r.Suspense,{fallback:e.jsx(G,{}),children:e.jsx(F,{})})}),e.jsx(c,{path:"system",element:e.jsx(r.Suspense,{fallback:e.jsx(G,{}),children:e.jsx(K,{})})})]})]})})})})}m.locale("zh-cn"),d.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(y,{locale:h,children:e.jsx(J,{})})}));export{D as a,R as b,L as u};
//# sourceMappingURL=index-SZKmSCox.js.map
